(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{438:function(t,s,a){"use strict";a.r(s);var n=a(42),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("header-table"),t._v(" "),a("h1",{attrs:{id:"goでwebアプリを作る"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#goでwebアプリを作る"}},[t._v("#")]),t._v(" GoでWebアプリを作る")]),t._v(" "),a("h2",{attrs:{id:"事前準備"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事前準備"}},[t._v("#")]),t._v(" 事前準備")]),t._v(" "),a("p",[a("a",{attrs:{href:"./init"}},[t._v("GoでWebアプリを作る(事前準備編)")])]),t._v(" "),a("h2",{attrs:{id:"goとは"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#goとは"}},[t._v("#")]),t._v(" Goとは")]),t._v(" "),a("p",[t._v("Googleが開発しているプログラミング言語。 "),a("br"),t._v("\nググラビリティが低いのでGolangやGo言語と書かれることもあるが、言語としての正式名称はGoである。 "),a("br"),t._v("\n参考: "),a("a",{attrs:{href:"https://twitter.com/rob_pike/status/886054143235719169",target:"_blank",rel:"noopener noreferrer"}},[t._v("開発者の一人(Rob Pike 氏)のツイート"),a("OutboundLink")],1)]),t._v(" "),a("h3",{attrs:{id:"特徴"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#特徴"}},[t._v("#")]),t._v(" 特徴")]),t._v(" "),a("p",[t._v("参考: "),a("a",{attrs:{href:"https://budougumi0617.github.io/2019/06/20/golangtokyo25-read-again-awesome-go-article/",target:"_blank",rel:"noopener noreferrer"}},[t._v("今改めて読み直したい Go基礎情報 その1"),a("OutboundLink")],1),t._v(" "),a("br"),t._v("\n参考: "),a("a",{attrs:{href:"https://www.slideshare.net/takuyaueda967/2016-go",target:"_blank",rel:"noopener noreferrer"}},[t._v("Go入門"),a("OutboundLink")],1)]),t._v(" "),a("h4",{attrs:{id:"ポータビリティが高い"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ポータビリティが高い"}},[t._v("#")]),t._v(" ポータビリティが高い")]),t._v(" "),a("ul",[a("li",[t._v("Cの標準ライブラリに依存しないようにソースコードをコンパイルできる")]),t._v(" "),a("li",[t._v("GoはGoで書かれている\n"),a("ul",[a("li",[t._v("つまりGoコンパイラ自身がGoで書かれている")]),t._v(" "),a("li",[t._v("標準パッケージ群もGoで書かれている(例外はあります)")])])])]),t._v(" "),a("h4",{attrs:{id:"クロスコンパイル"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#クロスコンパイル"}},[t._v("#")]),t._v(" クロスコンパイル")]),t._v(" "),a("ul",[a("li",[t._v("コンパイル時に環境変数を指定するだけで、例えばLinux端末上からWindows用のバイナリをコンパイルすることができる\n"),a("ul",[a("li",[t._v("ただし、ソースコード上もOSに依存しない記述にする必要がある")]),t._v(" "),a("li",[t._v("標準パッケージは大抵OSに依存しないように記述されているので、積極的に利用するとよい")])])])]),t._v(" "),a("h4",{attrs:{id:"文法がシンプル"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文法がシンプル"}},[t._v("#")]),t._v(" 文法がシンプル")]),t._v(" "),a("ul",[a("li",[t._v("設計思想としてSimplicityを是としている\n"),a("ul",[a("li",[t._v("参考: "),a("a",{attrs:{href:"https://talks.golang.org/2015/simplicity-is-complicated.slide#1",target:"_blank",rel:"noopener noreferrer"}},[t._v("Simplicity is Complicated"),a("OutboundLink")],1)])])]),t._v(" "),a("li",[a("code",[t._v("go")]),t._v("と書くだけで並行処理(並列ではない)が可能だったり")]),t._v(" "),a("li",[t._v("言語仕様が小さい(個人の感想)\n"),a("ul",[a("li",[t._v("参考: "),a("a",{attrs:{href:"https://golang.org/ref/spec",target:"_blank",rel:"noopener noreferrer"}},[t._v("The Go Programming Language Specification"),a("OutboundLink")],1)])])]),t._v(" "),a("li",[t._v("暗黙的な仕様が少ない(個人の感想)")])]),t._v(" "),a("h4",{attrs:{id:"並行プログラミングが文法レベルでサポートされている"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#並行プログラミングが文法レベルでサポートされている"}},[t._v("#")]),t._v(" 並行プログラミングが文法レベルでサポートされている")]),t._v(" "),a("ul",[a("li",[t._v("Goroutine : 軽量スレッドのようなもの")]),t._v(" "),a("li",[t._v("並列に動く、とは一言も言っていない点には注意が必要\n"),a("ul",[a("li",[t._v("参考: "),a("a",{attrs:{href:"https://www.oreilly.co.jp/books/9784873118468/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Go言語による並行処理"),a("OutboundLink")],1)])])])]),t._v(" "),a("h4",{attrs:{id:"周辺ツールが標準で提供されている"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#周辺ツールが標準で提供されている"}},[t._v("#")]),t._v(" 周辺ツールが標準で提供されている")]),t._v(" "),a("ul",[a("li",[t._v("go build: buildコマンド")]),t._v(" "),a("li",[t._v("go test: test実行")]),t._v(" "),a("li",[t._v("go fmt: コードフォーマッタ")]),t._v(" "),a("li",[t._v("go vet: 静的解析")]),t._v(" "),a("li",[t._v("go doc: ドキュメント生成")]),t._v(" "),a("li",[t._v("go mod: モジュール管理")]),t._v(" "),a("li",[t._v("...\n"),a("ul",[a("li",[t._v("参考: "),a("a",{attrs:{href:"https://golang.org/cmd/",target:"_blank",rel:"noopener noreferrer"}},[t._v("コマンド一覧"),a("OutboundLink")],1)])])])]),t._v(" "),a("h4",{attrs:{id:"標準パッケージが充実している"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#標準パッケージが充実している"}},[t._v("#")]),t._v(" 標準パッケージが充実している")]),t._v(" "),a("ul",[a("li",[t._v("net/http: HTTPサーバ/クライアントなど")]),t._v(" "),a("li",[t._v("html/template: HTMLテンプレート")]),t._v(" "),a("li",[t._v("database/sql: DB操作")]),t._v(" "),a("li",[t._v("...\n"),a("ul",[a("li",[t._v("参考: "),a("a",{attrs:{href:"https://golang.org/pkg/",target:"_blank",rel:"noopener noreferrer"}},[t._v("標準パッケージ一覧"),a("OutboundLink")],1)])])])]),t._v(" "),a("h2",{attrs:{id:"_1-hello-世界"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-hello-世界"}},[t._v("#")]),t._v(" 1. Hello, 世界")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://play.golang.org/p/7vin2BK8_A6",target:"_blank",rel:"noopener noreferrer"}},[t._v("The Go Playground"),a("OutboundLink")],1),t._v(" "),a("br"),t._v("\nチュートリアルリポジトリの"),a("code",[t._v("1_hello_world")]),t._v("ディレクトリにサンプルコードが入っています。")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("main.go")])])]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" main\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fmt"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  fmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello, 世界"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("このファイルを"),a("code",[t._v("main.go")]),t._v("というファイル名で保存して、次のようにコマンドを実行します。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ go run main.go\nHello, 世界\n")])])]),a("h3",{attrs:{id:"_1-1-解説"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-解説"}},[t._v("#")]),t._v(" 1-1. 解説")]),t._v(" "),a("h4",{attrs:{id:"_1-1-0-the-go-playground"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-0-the-go-playground"}},[t._v("#")]),t._v(" 1-1-0. The Go Playground")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://play.golang.org",target:"_blank",rel:"noopener noreferrer"}},[t._v("The Go Playground"),a("OutboundLink")],1),t._v("はGoのプログラムを手軽に実行できる環境で、Go公式に用意されています。 "),a("br"),t._v("\n後述しますが、一部のパッケージが動かないようにされていますが、簡単なコードを試しに動かすためには便利です。")]),t._v(" "),a("p",[t._v("念の為ですが、外部サイトになるため、業務で扱うプロダクトコードをここで実行してはいけません。")]),t._v(" "),a("h4",{attrs:{id:"_1-1-1-package文"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-1-package文"}},[t._v("#")]),t._v(" 1-1-1. package文")]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" main\n")])])]),a("p",[t._v("Go のプログラムはパッケージ単位で構成されます。 "),a("br"),t._v("\nそして、Go のプログラムは必ず"),a("code",[t._v("main")]),t._v("パッケージから実行されます。 "),a("br"),t._v("\n例えば、先の例で package 名を"),a("code",[t._v("hoge")]),t._v("にするとエラーが返ってきます。 "),a("br"),t._v("\n試しに先に作成した"),a("code",[t._v("main.go")]),t._v("を変更してみましょう。")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("main.go")]),t._v(" "),a("a",{attrs:{href:"https://play.golang.org/p/rlUktSgVozz",target:"_blank",rel:"noopener noreferrer"}},[t._v("The Go Playground"),a("OutboundLink")],1)])]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" hoge\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fmt"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  fmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello, 世界"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ go run test.go\ngo run: cannot run non-main package\n")])])]),a("h4",{attrs:{id:"_1-1-2-import文"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-2-import文"}},[t._v("#")]),t._v(" 1-1-2. import文")]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fmt"')]),t._v("\n")])])]),a("p",[t._v("他パッケージで定義された関数などを"),a("code",[t._v("import")]),t._v("文で取り込むことができます。")]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[t._v("  fmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello, 世界"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("具体的には、ここで"),a("code",[t._v("fmt")]),t._v("パッケージで定義されている"),a("code",[t._v("Println")]),t._v("関数を呼ぶために、"),a("code",[t._v("import")]),t._v("文で"),a("code",[t._v("fmt")]),t._v("パッケージを読み込んでいます。")]),t._v(" "),a("h4",{attrs:{id:"_1-1-3-func"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-3-func"}},[t._v("#")]),t._v(" 1-1-3. func")]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  fmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello, 世界"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("Go の関数定義は"),a("code",[t._v("func")]),t._v("キーワードで行います。 "),a("br"),t._v("\nここで"),a("code",[t._v("main")]),t._v("という名前の関数を定義しています。 "),a("br"),t._v("\nGoでコンパイルされた実行可能ファイルは"),a("code",[t._v("main")]),t._v("パッケージで定義された"),a("code",[t._v("main")]),t._v("関数から実行されます。 "),a("br"),t._v(" "),a("code",[t._v("fmt.Println()")]),t._v("は標準出力に引数の文字列(ここでは "),a("code",[t._v("Hello, 世界")]),t._v(")を最後に改行文字を付けて出力します。")]),t._v(" "),a("h2",{attrs:{id:"_2-パッケージ-モジュール"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-パッケージ-モジュール"}},[t._v("#")]),t._v(" 2. パッケージ/モジュール")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://play.golang.org/p/74u0FTkyOvZ",target:"_blank",rel:"noopener noreferrer"}},[t._v("The Go Playground"),a("OutboundLink")],1),t._v(" "),a("br"),t._v("\nチュートリアルリポジトリの"),a("code",[t._v("2_package")]),t._v("ディレクトリにサンプルコードが入っています。")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("go.mod")])])]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[t._v("module test\n")])])]),a("ul",[a("li",[a("code",[t._v("calc/add.go")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("calc")]),t._v("という名前のディレクトリを作成するのを忘れないように")])])])]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" calc\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  c "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" b\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" c\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ul",[a("li",[a("code",[t._v("main.go")])])]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" main\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fmt"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test/calc"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  fmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("calc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ go run main.go\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n")])])]),a("h3",{attrs:{id:"_2-1-解説"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-解説"}},[t._v("#")]),t._v(" 2-1. 解説")]),t._v(" "),a("h4",{attrs:{id:"_2-1-1-go-mod"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-1-go-mod"}},[t._v("#")]),t._v(" 2-1-1. "),a("code",[t._v("go.mod")])]),t._v(" "),a("p",[t._v("このファイルはGoプログラムを外部から読み込むときの名前を定義したり、ソースコードで利用している他モジュールを管理するためのものです。")]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[t._v("module test\n")])])]),a("p",[t._v("このように書くことで、このモジュールは"),a("code",[t._v("test")]),t._v("という名前で外部から読み込むことができます。")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("main.go")])])]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fmt"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test/calc"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("ここで"),a("code",[t._v("test/calc")]),t._v("というのは"),a("code",[t._v("test")]),t._v("モジュールの"),a("code",[t._v("calc")]),t._v("パッケージを読み込んでいる、と解釈されます。 "),a("br"),t._v("\nまた、"),a("code",[t._v("test/calc")]),t._v("でディレクトリ構造も指定されており、次のようなディレクトリ構造であることが期待されます。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("- test/\n  - main.go (`package main`と宣言されている)\n  - calc/\n    - add.go (`package calc`と宣言されている)\n")])])]),a("h4",{attrs:{id:"_2-1-2-続・func"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-2-続・func"}},[t._v("#")]),t._v(" 2-1-2. 続・func")]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  c "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" b\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" c\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("今回定義した"),a("code",[t._v("Add()")]),t._v("関数は"),a("code",[t._v("main")]),t._v("パッケージから呼ばれます。 "),a("br"),t._v("\nGo には外部に公開するためのキーワードは無く、大文字から始めるだけで外部に公開されます。 "),a("br"),t._v("\nもしこの関数名が"),a("code",[t._v("add()")]),t._v("であれば、外部から見えないので"),a("code",[t._v("main")]),t._v("で呼び出しても関数が見付からないと言われます。")]),t._v(" "),a("p",[t._v("また、Goの型名は変数宣言の後ろに書くことに注意しましょう。 "),a("br"),t._v("\n参考: "),a("a",{attrs:{href:"https://blog.golang.org/gos-declaration-syntax",target:"_blank",rel:"noopener noreferrer"}},[t._v("Go's Declaration Syntax"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("Go での変数宣言にはいくつか方法があり、一番単純なのは今回使用した、")]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[t._v("c "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" b\n")])])]),a("p",[t._v("の形式です。 "),a("br"),t._v(" "),a("code",[t._v("c")]),t._v("の型名は"),a("code",[t._v("a")]),t._v("と"),a("code",[t._v("b")]),t._v("が"),a("code",[t._v("int")]),t._v("であることから自明なので、記載を省略できます。 "),a("br"),t._v("\n当然省略せずに書くことも可能で、")]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" c "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" b\n")])])]),a("p",[t._v("と書きます。 "),a("br"),t._v("\nまた、")]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" c "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" b\n")])])]),a("p",[t._v("のようにも書けます。 "),a("br"),t._v(" "),a("code",[t._v(":=")]),t._v("による宣言は関数定義の中でしか書けないので、状況に応じて使い分ける必要があります。")]),t._v(" "),a("h2",{attrs:{id:"_3-net-httpはじめの一歩"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-net-httpはじめの一歩"}},[t._v("#")]),t._v(" 3. net/httpはじめの一歩")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://play.golang.org/p/5YXGZvJ73b_1",target:"_blank",rel:"noopener noreferrer"}},[t._v("The Go Playground"),a("OutboundLink")],1),t._v("(動きません)")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("The Go Playgroundでは"),a("code",[t._v("net/http")]),t._v("など一部のパッケージを利用したコードが動かないようになっています")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("main.go")])])])]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" main\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fmt"')]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"net/http"')]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"os"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tmux "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewServeMux")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\tmux"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("HandleFunc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/hello"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" helloHandler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\tserver "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tAddr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('":8080"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\tHandler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mux"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\tserver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ListenAndServe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("helloHandler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ResponseWriter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" r "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tfmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Fprintln")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello, world!"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"_3-1-動かし方"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-動かし方"}},[t._v("#")]),t._v(" 3-1. 動かし方")]),t._v(" "),a("p",[t._v("ターミナルを2つ用意します。\ndocker環境の方は2つ目のターミナルでコンテナ内に入るために、")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ docker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it go-tutor /bin/bash\n")])])]),a("p",[t._v("を実行する必要があります。")]),t._v(" "),a("p",[t._v("片方で以下を実行します。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ go run main.go\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## プロンプトが返ってこなくなる")]),t._v("\n")])])]),a("p",[t._v("もう一方のターミナルから以下を実行します。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" http://localhost:8080\nhello, world"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("\n")])])]),a("h3",{attrs:{id:"_3-2-解説"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-解説"}},[t._v("#")]),t._v(" 3-2. 解説")]),t._v(" "),a("h4",{attrs:{id:"_3-2-1-構造体と独自型とメソッド"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1-構造体と独自型とメソッド"}},[t._v("#")]),t._v(" 3-2-1. 構造体と独自型とメソッド")]),t._v(" "),a("p",[t._v("Go は構造体型を持ちます。\n"),a("a",{attrs:{href:"https://play.golang.org/p/ebEr372GDdp",target:"_blank",rel:"noopener noreferrer"}},[t._v("The Go Playground"),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 構造体型を基にしてAという型を宣言する。")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" A "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  X "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v("\n  Y "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 型AのメソッドHoge()を宣言する。")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a A"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Hoge")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  fmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"X:"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("X"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  fmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Y:"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Y"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// aにA型の値を代入する。")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" A"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  X"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  Y"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// aの型AのメソッドHoge()を実行する。")]),t._v("\na"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Hoge")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// X: 1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Y: 2")]),t._v("\n")])])]),a("p",[t._v("このようにすることで、オブジェクト指向言語におけるクラスとメソッドのようなことができます。 \\")]),t._v(" "),a("p",[t._v("メソッドは型に対して定義することができるので以下のようなことも可能です。 "),a("br"),t._v(" "),a("a",{attrs:{href:"https://play.golang.org/p/nb76TxzaYMb",target:"_blank",rel:"noopener noreferrer"}},[t._v("The Go Playground"),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Age "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("age Age"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("BirthYear")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 返り値はint型なのでint(age)でAge型からint型にキャスト(変換)している。")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("age"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("ここでは"),a("code",[t._v("int")]),t._v("型に"),a("code",[t._v("Age")]),t._v("という別名を付けて、そのメソッドとして"),a("code",[t._v("BirthYear()")]),t._v("を定義しています。")]),t._v(" "),a("h4",{attrs:{id:"_3-2-2-net-httpパッケージ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-2-net-httpパッケージ"}},[t._v("#")]),t._v(" 3-2-2. "),a("code",[t._v("net/http")]),t._v("パッケージ")]),t._v(" "),a("p",[a("code",[t._v("net/http")]),t._v("パッケージはその名の通り、HTTP通信に関連する関数、定数などが定義されたパッケージです。 "),a("br"),t._v("\nこのパッケージ一つでHTTPクライアントもHTTPサーバも書くことができます。")]),t._v(" "),a("h5",{attrs:{id:"_3-2-2-1-servemux"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-2-1-servemux"}},[t._v("#")]),t._v(" 3-2-2-1. "),a("code",[t._v("ServeMux")])]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[t._v("\tmux "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewServeMux")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\tmux"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("HandleFunc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/hello"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" helloHandler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("URLは"),a("code",[t._v("スキーマ名://ホスト名:ポート番号/パス名")]),t._v("という構造をしています。(他にもURLで表される項目はありますが、今回は使用しないため省略します。) "),a("br"),t._v(" "),a("code",[t._v("http://localhost:8080/hello")]),t._v("というURLであれば、\n*スキーマ名: http")]),t._v(" "),a("ul",[a("li",[t._v("ホスト名: localhost")]),t._v(" "),a("li",[t._v("ポート番号: 8080")]),t._v(" "),a("li",[t._v("パス名: /hello\nと解釈されます。")])]),t._v(" "),a("p",[a("code",[t._v("http.ServeMux")]),t._v("は特定のパスへのリクエストを特定の関数へ飛ばすためのものです。 "),a("br"),t._v("\n今回は"),a("code",[t._v("http://localhost:8080/hello")]),t._v("へのアクセスを"),a("code",[t._v("helloHandler()")]),t._v("という関数(ハンドラ)に引き渡す設定をします。 \\")]),t._v(" "),a("p",[a("code",[t._v("http.NewServeMux()")]),t._v("で"),a("code",[t._v("http.ServeMux")]),t._v("型の値を用意して、"),a("code",[t._v("mux.HandleFunc()")]),t._v("でハンドラの設定をしています。")]),t._v(" "),a("h5",{attrs:{id:"_3-2-2-2-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-2-2-server"}},[t._v("#")]),t._v(" 3-2-2-2. "),a("code",[t._v("Server")])]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[t._v("\tserver "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tAddr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('":8080"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\tHandler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mux"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\tserver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ListenAndServe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[a("code",[t._v("http.Server")]),t._v("はHTTPサーバそのものを表す型です。 "),a("br"),t._v(" "),a("code",[t._v("Addr")]),t._v("フィールドにHTTP通信を待ち受けるアドレスを設定し、"),a("code",[t._v("Handler")]),t._v("フィールドに先程説明した"),a("code",[t._v("ServeMux")]),t._v("を設定します。")]),t._v(" "),a("p",[t._v("そしてその"),a("code",[t._v("http.Server")]),t._v("型の値のメソッドである"),a("code",[t._v("server.ListenAndServe()")]),t._v("関数で実際にサーバを起動してHTTP通信を待ち受け始めます。")]),t._v(" "),a("h5",{attrs:{id:"_3-2-2-3-ハンドラ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-2-3-ハンドラ"}},[t._v("#")]),t._v(" 3-2-2-3. ハンドラ")]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("helloHandler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ResponseWriter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" r "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tfmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Fprintln")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello, world!"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("HTTP通信が飛んでくると"),a("code",[t._v("helloHandler()")]),t._v("という関数がそのリクエストを受けて処理をします。 "),a("br"),t._v("\n引数の"),a("code",[t._v("http.Request")]),t._v("型の値に実際のリクエストの内容が入っているので、それを利用して処理をすることも可能です。 "),a("br"),t._v("\n引数の"),a("code",[t._v("http.ResponseWriter")]),t._v("は"),a("code",[t._v("Write()")]),t._v("というメソッドを持っている型で、クライアントに送信したいメッセージを作って、"),a("code",[t._v("Write()")]),t._v("が叩かれれば、メッセージが送信されます。 "),a("br"),t._v("\nもう少し踏み込むと、Goではインターフェイス型と呼ばれるメソッド定義のみを持つ型が存在し、"),a("code",[t._v("http.ResponseWriter")]),t._v("型は"),a("code",[t._v("Write()")]),t._v("や"),a("code",[t._v("Header()")]),t._v("などのメソッドを持つインターフェイス型です。 "),a("br"),t._v("\n参考: "),a("a",{attrs:{href:"https://golang.org/pkg/net/http/#ResponseWriter",target:"_blank",rel:"noopener noreferrer"}},[t._v("ResponseWriter"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("code",[t._v("fmt.Fprintln()")]),t._v("関数は第二引数の値を第一引数の"),a("code",[t._v("Write()")]),t._v("メソッドを使って書き込む、という関数で、今回はその挙動を利用してレスポンスを返しています。")]),t._v(" "),a("h2",{attrs:{id:"_4-rdbをgoから触る"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-rdbをgoから触る"}},[t._v("#")]),t._v(" 4. RDBをGoから触る")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://play.golang.org/p/B0_HD0U241F",target:"_blank",rel:"noopener noreferrer"}},[t._v("The Go Playground"),a("OutboundLink")],1),t._v("(動きません)")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("go.mod")])])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("module test\n")])])]),a("ul",[a("li",[a("code",[t._v("main.go")])])]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" main\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"log"')]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"net/http"')]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"os"')]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test/handler"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tmux "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewServeMux")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// handlerパッケージのUserRead()関数を"/user/"というパスで登録している。')]),t._v("\n\tmux"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("HandleFunc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/user/"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" handler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("UserRead"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// HTTPサーバは"localhost:8080"で起動する。')]),t._v("\n\tserver "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tAddr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('":8080"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\tHandler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mux"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Goの特徴的なエラー処理。")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ListenAndServe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tlog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\tos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Exit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*\n\t  err := server.ListenAndServe()\n\t  if err != nil {\n\t    log.Println(err)\n\t    os.Exit(1)\n\t  }\n\t  と同等。\n\t*/")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ul",[a("li",[a("code",[t._v("handler/user.go")])])]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" handler\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"log"')]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"net/http"')]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"strconv"')]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"strings"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("UserRead")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ResponseWriter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" r "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// HTTPのリクエストがGETであることを確認している。")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" r"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Method "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("MethodGet "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// GETでなければ404を返す。")]),t._v("\n\t\thttp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("NotFound")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" r"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 関数を終了する。")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Goではこのようなearly returnというパターンが頻出で、else 文はほぼ書かない。")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// http://localhost:8080/user/1などでアクセスが来る。")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// r.URL.Pathには"/user/1"が入っているのでそれを"/"で分割した配列を作る。')]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// 作られた配列は["", "user", "1"]となっており、User IDは[2]に入っている。')]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// strings.SplitN()関数は第3引数の数だけ分割する。")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// 例えば、"/user/1/2/3"というパスを指定されていた場合はuserIDStrには"1/2/3"が入る。')]),t._v("\n\tuserIDStr "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" strings"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("SplitN")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("r"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("URL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// userIDStrは文字列なのでuint64型に変換する。")]),t._v("\n\tuserID"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" strconv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ParseUint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("userIDStr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// 先の"/user/1/2/3"みたいなパスの場合はこのパースに失敗してこの分岐に入る。')]),t._v("\n\t\tlog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// この場合は400を返す。")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("renderError")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("StatusBadRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// model packageの関数に処理を持って行き、エラーの判定をする。")]),t._v("\n\tuser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" model"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("FindUserByID")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("userID"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tlog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ここに入るということはサーバ側の処理で失敗しているので500を返す。")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("renderError")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("StatusInternalServerError"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 全ての処理が成功していれば、200とともにuserを返す。")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("renderResponse")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("StatusOK"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ul",[a("li",[a("code",[t._v("handler/handler.go")]),t._v(" "),a("ul",[a("li",[t._v("このファイルは頑張って JSON を返すための細かい設定をしてくれる便利関数を定義しています")])])])]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" handler\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"encoding/json"')]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"log"')]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"net/http"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("renderError")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ResponseWriter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" code "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// JSONで返すので"Content-Type"ヘッダに"application/json"を指定します。')]),t._v("\n\tw"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Header")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Content-Type"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"application/json"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 引数で指定されたレスポンスコードを登録します。")]),t._v("\n\tw"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("WriteHeader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\tret "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// `json:"error"`というのは構造体型のアノテーションと呼ばれるもので、特定の関数に構造体の情報を伝えるために使います。')]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// この場合はJSONに変換されるとき`error`というフィールド名にすることを指示しています。")]),t._v("\n\t\tError "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"error"`')]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ここまで構造体の定義。")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ここが実際の構造体型の値の定義。")]),t._v("\n\t\tError"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" json"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewEncoder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Encode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ret"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tlog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"render error"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('/*\n\t  enc := json.NewEncoder(w)\n\t  err := enc.Encode(ret)\n\t  if err != nil {\n\t    log.Println("render error", err)\n\t  }\n\t  と同等\n\t*/')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// interface{}型というのは、メソッドが一つも定義されていないメソッドを意味します。")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// つまり任意の型はinterface{}型を満たします。")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Goではインターフェイスは明示的に書かずともインターフェイス型で定義されたメソッドを全て定義した型は、")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// そのインターフェイスを満たしている、と判断されます。")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// このような値を引数にとることで、静的型付言語でありながら、任意の型を引数に取る関数を簡単に作ることができます。")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("renderResponse")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ResponseWriter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" code "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tw"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Header")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Content-Type"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"application/json"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tw"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("WriteHeader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" json"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewEncoder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Encode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tlog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"render error"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ul",[a("li",[a("code",[t._v("model/user.go")])])]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" model\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"database/sql"')]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// これはSQLite3を使うためのおまじない、として記述してください。")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 詳細知りたければteamsやハンズオン終了後に質問をください。")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("_")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/mattn/go-sqlite3"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// SQLite3を使ってdb/chat.dbというファイル名でDBを開き、その操作のための構造体をdbという変数に代入しています。")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// sql.Open()関数は2つの値を返す関数で、もう一つの返り値はerror型の値ですが、今回エラー処理をさぼるために値を無視します。")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// _を記載することで、そこに返るはずだった値を無視することができます。")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// エラーを握り潰すことはよいこはやってはいけません。")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("_")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" sql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sqlite3"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"db/chat.db"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" User "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tID   "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint64")]),t._v("\n\tName "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("FindUserByID")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint64")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("User"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// SQL文を作っています。")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// $1はプレースホルダで、後のstmt.QueryRow()の引数に設定した値が入ります。")]),t._v("\n\tsql "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SELECT id, name FROM users WHERE id = $1;"')]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 先に作成したのはただの文字列なので、正しいSQL文になっているかを検証しつつ、操作のための構造体を返します。")]),t._v("\n\tstmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Prepare")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// SQL文が間違っているとここで教えてくれます。")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// deferというのはGoの特徴的な機能の一つで、ここではstmt.Close()関数は実行されず、FindUserByID()関数の実行完了時に必ず(例外はあります)実行されます。")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ファイルを開いた際のClose処理などにも使われて、後処理を忘れないためによく使われます。")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("defer")]),t._v(" stmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Close")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\tuser "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" User"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// 先のSQL文は"SELECT id, name FROM users WHERE id = $1"となっており、`id`の中身が$1に収められstmt.QueryRow()メソッドで実行されます。')]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// その結果は id と name カラムが埋まっているので、その値を Scan()メソッドで user.ID と user.Name に放り込んでいます。")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// &は後ろにくる値のポインタを取得する演算子ですが、詳細には触れません。")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// こうしておかないと、Scan()メソッドには値のコピーが渡され、Scan()の中の操作が元の値に反映されなくなってしまいます。")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" stmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("QueryRow")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Scan")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ID"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ul",[a("li",[a("code",[t._v("db/setup.sql")]),t._v(" "),a("ul",[a("li",[t._v("少しMySQLとは文法が異なりますが、ここは主題ではないので触れません")])])])]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[t._v("DROP TABLE users"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nCREATE TABLE users "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  id integer PRIMARY KEY AUTOINCREMENT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  name text\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nINSERT INTO users "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" VALUES "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hogehoge"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nINSERT INTO users "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" VALUES "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fugafuga"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"_4-1-ディレクトリ構造"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-ディレクトリ構造"}},[t._v("#")]),t._v(" 4-1. ディレクトリ構造")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("- go.mod # パッケージ管理用ファイル\n- main.go # サーバを準備したり、起動したりする。最初に実行される。\n- handler/\n  - handler.go # JSON形式でレスポンスを返すためにごにょごにょしてくれる関数を定義。\n  - user.go # HTTPリクエストを受けると実行される関数を定義。\n- model/\n  - user.go # User構造体を定義し、DBからUserデータを取得するための関数を定義。\n- db/\n  - setup.sql # DBの初期化用SQLファイル。\n")])])]),a("h3",{attrs:{id:"_4-2-使い方"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-使い方"}},[t._v("#")]),t._v(" 4-2. 使い方")]),t._v(" "),a("p",[t._v("ターミナルを2つ用意します。\ndocker環境の方は2つ目のターミナルでコンテナ内に入るために、")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ docker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it go-tutor /bin/bash\n")])])]),a("p",[t._v("を実行する必要があります。 "),a("br"),t._v("\nまず、一方のターミナルで以下を実行します。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# まず、DBを用意します。")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# エラーが発生しますが、")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   Error: near line 1: no such table: users")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# であれば想定通りなので無視します。")]),t._v("\n$ sqlite3 db/chat.db -init "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"db/setup.sql"')]),t._v("\n-- Loading resources from db/setup.sql\nError: near line "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(": no such table: "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("users")]),t._v("\nSQLite version "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.16")]),t._v(".2 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2017")]),t._v("-01-06 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":32:41\nEnter "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('".help"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" usage hints.\nsqlite"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# sqlite を終了します。")]),t._v("\nsqlite"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" .exit\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# サーバを起動します。")]),t._v("\n$ go run main.go\ngo: finding github.com/mattn/go-sqlite3 v1.11.0\ngo: downloading github.com/mattn/go-sqlite3 v1.11.0\ngo: extracting github.com/mattn/go-sqlite3 v1.11.0\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# プロンプトが返ってこなくなる")]),t._v("\n")])])]),a("p",[t._v("その後、もう一方のターミナルで以下を叩きます。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" http://localhost:8080/user/1\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ID"')]),t._v(":1,"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Name"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hogehoge"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("credit-footer")],1)}),[],!1,null,null,null);s.default=e.exports}}]);