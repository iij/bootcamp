(window.webpackJsonp=window.webpackJsonp||[]).push([[51],{490:function(s,a,t){"use strict";t.r(a);var n=t(10),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"fastapiを使ったapiサーバ作り"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#fastapiを使ったapiサーバ作り"}},[s._v("#")]),s._v(" FastAPIを使ったAPIサーバ作り")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#fastapi%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9Fapi%E3%82%B5%E3%83%BC%E3%83%90%E4%BD%9C%E3%82%8A"}},[s._v("FastAPIを使ったAPIサーバ作り")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"}},[s._v("はじめに")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#%E6%BC%94%E7%BF%92%E7%92%B0%E5%A2%83"}},[s._v("演習環境")])])])]),s._v(" "),a("li",[a("a",{attrs:{href:"#0-%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99"}},[s._v("0. 事前準備")])]),s._v(" "),a("li",[a("a",{attrs:{href:"#fastapi%E6%A6%82%E8%A6%81"}},[s._v("FastAPI概要")])]),s._v(" "),a("li",[a("a",{attrs:{href:"#1-fastapi%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"}},[s._v("1. FastAPIのインストール")])]),s._v(" "),a("li",[a("a",{attrs:{href:"#2-fastapi%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9Fapi%E3%82%B5%E3%83%BC%E3%83%90%E3%81%AE%E9%96%8B%E7%99%BA"}},[s._v("2. FastAPIを使ったAPIサーバの開発")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#21-%E3%83%88%E3%83%83%E3%83%97%E3%83%9A%E3%83%BC%E3%82%B8%E3%81%AE%E4%BD%9C%E6%88%90"}},[s._v("2.1 トップページの作成")])]),s._v(" "),a("li",[a("a",{attrs:{href:"#22-apifastapi%E3%81%AE%E8%B5%B7%E5%8B%95"}},[s._v("2.2 API(FastAPI)の起動")])])])]),s._v(" "),a("li",[a("a",{attrs:{href:"#ex1-%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%81%AE%E5%A4%96%E3%81%8B%E3%82%89%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%82%92%E5%8F%AF%E8%83%BD%E3%81%AB%E3%81%99%E3%82%8B"}},[s._v("Ex1. コンテナの外からアクセスを可能にする")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%81%AE%E5%A4%96%E3%81%8B%E3%82%89-fastapi%E3%82%92%E8%B5%B7%E5%8B%95%E3%81%99%E3%82%8B"}},[s._v("コンテナの外から FastAPIを起動する")])]),s._v(" "),a("li",[a("a",{attrs:{href:"#%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%81%AE%E5%A4%96%E3%81%8B%E3%82%89%E3%82%82%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%A7%E3%81%8D%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B"}},[s._v("コンテナの外からもアクセスできるようにする")])])])]),s._v(" "),a("li",[a("a",{attrs:{href:"#3-swagger-%E3%81%AB%E3%82%88%E3%82%8Bapi%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E3%81%AE%E8%87%AA%E5%8B%95%E7%94%9F%E6%88%90"}},[s._v("3. swagger によるAPIドキュメントの自動生成")])]),s._v(" "),a("li",[a("a",{attrs:{href:"#ex2-%E8%A7%A3%E8%AA%AC"}},[s._v("Ex2. 解説")])]),s._v(" "),a("li",[a("a",{attrs:{href:"#4-fastapi%E3%81%A7web%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E4%BD%9C%E3%82%8B"}},[s._v("4. FastAPIでWebアプリケーションを作る")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#41-%E3%83%91%E3%82%B9%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF"}},[s._v("4.1 パスパラメータ")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#%E8%A7%A3%E8%AA%AC"}},[s._v("解説")])])])]),s._v(" "),a("li",[a("a",{attrs:{href:"#42-%E3%82%AF%E3%82%A8%E3%83%AA%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF"}},[s._v("4.2 クエリパラメータ")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#%E8%A7%A3%E8%AA%AC-1"}},[s._v("解説")])])])]),s._v(" "),a("li",[a("a",{attrs:{href:"#43-%E3%83%AA%E3%82%AF%E3%82%A8%E3%82%B9%E3%83%88%E3%83%9C%E3%83%87%E3%82%A3"}},[s._v("4.3 リクエストボディ")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#pydantic-%E3%81%AB%E3%82%88%E3%82%8B%E3%83%A2%E3%83%87%E3%83%AB%E3%81%AE%E5%AE%9A%E7%BE%A9"}},[s._v("Pydantic によるモデルの定義")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#%E8%A7%A3%E8%AA%AC-2"}},[s._v("解説")])])])]),s._v(" "),a("li",[a("a",{attrs:{href:"#%E3%83%AA%E3%82%AF%E3%82%A8%E3%82%B9%E3%83%88%E3%83%9C%E3%83%87%E3%82%A3%E3%82%92%E5%87%A6%E7%90%86%E3%81%99%E3%82%8B%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%AE%9A%E7%BE%A9"}},[s._v("リクエストボディを処理するメソッドの定義")])])])])])]),s._v(" "),a("li",[a("a",{attrs:{href:"#ex3-%E3%82%88%E3%82%8A%E6%9C%AC%E7%95%AA%E7%92%B0%E5%A2%83%E3%82%89%E3%81%97%E3%81%8Ffastapi%E3%82%92%E8%B5%B7%E5%8B%95%E3%81%99%E3%82%8B%E3%81%9F%E3%82%81%E3%81%AB"}},[s._v("Ex3. より本番環境らしくFastAPIを起動するために")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#gunicorn%E3%81%AE%E5%88%A9%E7%94%A8"}},[s._v("Gunicornの利用")])])])]),s._v(" "),a("li",[a("a",{attrs:{href:"#5-%E3%83%97%E3%83%AC%E3%83%BC%E3%83%B3%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88%E3%82%92%E8%BF%94%E3%81%99"}},[s._v("5. プレーンテキストを返す")])]),s._v(" "),a("li",[a("a",{attrs:{href:"#6-%E3%82%A8%E3%83%A9%E3%83%BC%E3%83%8F%E3%83%B3%E3%83%89%E3%83%AA%E3%83%B3%E3%82%B0"}},[s._v("6. エラーハンドリング")])]),s._v(" "),a("li",[a("a",{attrs:{href:"#7-%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E6%83%85%E5%A0%B1%E3%81%AE%E8%BF%BD%E5%8A%A0"}},[s._v("7. アプリケーション情報の追加")])]),s._v(" "),a("li",[a("a",{attrs:{href:"#ex4-%E9%9D%9E%E5%90%8C%E6%9C%9F%E5%87%A6%E7%90%86"}},[s._v("Ex4. 非同期処理")])]),s._v(" "),a("li",[a("a",{attrs:{href:"#%E3%81%BE%E3%81%A8%E3%82%81"}},[s._v("まとめ")])]),s._v(" "),a("li",[a("a",{attrs:{href:"#%E7%99%BA%E5%B1%95%E5%AD%A6%E7%BF%92"}},[s._v("発展学習")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#%E3%82%88%E3%82%8A%E8%A9%B3%E7%B4%B0%E3%81%AA%E3%83%AD%E3%82%B0%E5%87%BA%E5%8A%9B%E3%82%92%E3%81%97%E3%81%9F%E3%81%84%E6%99%82%E3%81%AF"}},[s._v("より詳細なログ出力をしたい時は？")])])])])])])]),s._v(" "),a("h2",{attrs:{id:"はじめに"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#はじめに"}},[s._v("#")]),s._v(" はじめに")]),s._v(" "),a("p",[s._v("この講義ではハンズオン形式でFastAPIを使ったAPIサーバ作りについて学びます。")]),s._v(" "),a("p",[s._v("講義を受けるにあたり、事前に環境準備が必要です。\n講義当日までに"),a("strong",[s._v("0.事前準備")]),s._v("を終え、Dockerが実行可能な環境を整えてください。")]),s._v(" "),a("p",[s._v("FastAPIはPythonのフレームワークのため、Pythonを触ったことがある方を想定しています。\n従って本項では、Pythonの基本的な文法や書き方などについては扱いません。")]),s._v(" "),a("p",[s._v("また、WebAPIについてもハンズオンで扱う限りにおいては解説をしますが、基本的なRDBMS・HTTPに関する知識についても体系だった説明は行いません。予めご了承ください。")]),s._v(" "),a("h3",{attrs:{id:"演習環境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#演習環境"}},[s._v("#")]),s._v(" 演習環境")]),s._v(" "),a("p",[s._v("本講義では"),a("code",[s._v("vscode + python")]),s._v(" を使って演習を行います。\nvim等による開発や"),a("code",[s._v("PyCharm")]),s._v("などでも問題ありませんが、講義においては講師の環境を"),a("code",[s._v("vscode")]),s._v("にて説明を行うため、vscode以外で開発を行う場合は適宜自身で読み替えてください。")]),s._v(" "),a("h2",{attrs:{id:"_0-事前準備"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_0-事前準備"}},[s._v("#")]),s._v(" 0. 事前準備")]),s._v(" "),a("p",[s._v("以下のような"),a("code",[s._v("docker-compose.yml")]),s._v("を作成し、FastAPI開発用、値の保存用(redis)2つのコンテナを起動してください。")]),s._v(" "),a("ul",[a("li",[s._v("docker-compose.yml"),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fastapi")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" iijbootcamp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("fastapi\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" python"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("3.11.4"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("bullseye\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8088:8000"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("working_dir")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /app\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tty")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ./app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/app\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" iijbootcamp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("backend\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"redis:alpine"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])])]),s._v(" "),a("li",[s._v("app ディレクトリ作成"),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" app\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[s._v("docker-compose.ymlと同じ階層で実行"),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" compose up -d\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[s._v("動作確認"),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\nCONTAINER ID   IMAGE                    COMMAND                  CREATED         STATUS         PORTS                                       NAMES\n41539a83d3e1   redis:alpine             "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker-entrypoint.s…"')]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" seconds ago   Up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" seconds   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("/tcp                                    iijbootcamp-backend\na26d57ce6c8e   python:3.11.4-bullseye   "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"python3"')]),s._v("                "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" seconds ago   Up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" seconds   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:8088-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("/tcp, :::8088-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("/tcp   iijbootcamp-fastapi\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ul",[a("li",[s._v("二つのコンテナの"),a("code",[s._v("STATUS")]),s._v("が"),a("strong",[s._v("Up")]),s._v("であること")])])]),s._v(" "),a("li",[s._v("docker コンテナの終了"),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" compose down\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])]),s._v(" "),a("h2",{attrs:{id:"fastapi概要"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#fastapi概要"}},[s._v("#")]),s._v(" FastAPI概要")]),s._v(" "),a("p",[s._v("では作業に入る前にFastAPIについておさらいしておきましょう。\nFastAPIについては公式ドキュメントに以下のような記載があります。")]),s._v(" "),a("p",[a("code",[s._v("FastAPI は、Pythonの標準である型ヒントに基づいてPython 3.6 以降でAPI を構築するための、 モダンで、高速(高パフォーマンス)な、Web フレームワークです。")]),s._v(" "),a("a",{attrs:{href:"https://fastapi.tiangolo.com/ja/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://fastapi.tiangolo.com/ja/"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("Pythonは動的型言語であるため、長らく型を意識すること無くコードを書くことが通常でした。")]),s._v(" "),a("p",[s._v("しかし、Python3.5以降、様々な要因から急速に型を意識して書くことが求められるようになってきました。\n従って従来のモジュール・フレームワークについても型を定義することが求められるようになっていますが歴史のあるモジュールほど対応が難しく、型定義の恩恵を受けられる機会が限定的でした。")]),s._v(" "),a("p",[s._v("そんな中、FastAPIはその流れにいち早く対応した形で登場し、注目を集めています。")]),s._v(" "),a("h2",{attrs:{id:"_1-fastapiのインストール"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-fastapiのインストール"}},[s._v("#")]),s._v(" 1. FastAPIのインストール")]),s._v(" "),a("p",[s._v("では、早速FastAPIを使ってAPIサーバを開発していきましょう。\nFastAPIはPythonのWebフレームワークですが、Pythonコアパッケージには含まれていません。\nもっともこれは他のPython製のフレームワークにも同様の事が言える為、インストール、という作業が必要な事は当然と言えましょう。")]),s._v(" "),a("p",[s._v("皆さんは既に事前準備で FastAPI用のコンテナが作成済みかと思います。\n従ってFastAPIコンテナにログインし、実際にFastAPIをインストールしてみましょう")]),s._v(" "),a("ul",[a("li",[s._v("FastAPIコンテナへのログイン"),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it iijbootcamp-fastapi "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[s._v("FastAPI のインストール"),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("pip "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" fastapi\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[s._v("uvicorn のインストール"),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("pip "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"uvicorn[standard]"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[s._v("インストール確認"),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("pip list\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("fastapi, uvicorn が出力結果に含まれること")]),s._v(" "),a("li",[s._v("出力例"),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("root@02d373178837:/app"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pip list")]),s._v("\nPackage           Version\n----------------- -------\nannotated-types   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.5")]),s._v(".0\nanyio             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.7")]),s._v(".1\nclick             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.1")]),s._v(".4\nfastapi           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.100")]),s._v(".0\nh11               "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.14")]),s._v(".0\nhttptools         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.6")]),s._v(".0\nidna              "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.4")]),s._v("\npip               "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23.1")]),s._v(".2\npydantic          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.0")]),s._v(".2\npydantic_core     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.1")]),s._v(".2\npython-dotenv     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v(".0\nPyYAML            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.0")]),s._v("\nsetuptools        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65.5")]),s._v(".1\nsniffio           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.3")]),s._v(".0\nstarlette         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.27")]),s._v(".0\ntyping_extensions "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.7")]),s._v(".1\nuvicorn           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.22")]),s._v(".0\nuvloop            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.17")]),s._v(".0\nwatchfiles        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.19")]),s._v(".0\nwebsockets        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11.0")]),s._v(".3\nwheel             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.40")]),s._v(".0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])])])])])]),s._v(" "),a("h2",{attrs:{id:"_2-fastapiを使ったapiサーバの開発"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-fastapiを使ったapiサーバの開発"}},[s._v("#")]),s._v(" 2. FastAPIを使ったAPIサーバの開発")]),s._v(" "),a("p",[s._v("FastAPIのインストールができたならばいよいよAPIの開発です。\n"),a("code",[s._v("vscode")]),s._v("での開発を行うため、いったん dockerコンテナからはログアウトします。\n事前準備の項で示した FastAPIコンテナは "),a("code",[s._v("app")]),s._v("フォルダを共有しているため、コンテナにログインすること無くアプリケーション開発を行う事が可能です。")]),s._v(" "),a("h3",{attrs:{id:"_2-1-トップページの作成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-トップページの作成"}},[s._v("#")]),s._v(" 2.1 トップページの作成")]),s._v(" "),a("p",[s._v("では、始めに公式ドキュメントの通り"),a("code",[s._v("main.py")]),s._v("というファイルを作成し、以下のようにコードを書いてみましょう。")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("app ディレクトリへの移動")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" app\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("vscode にて "),a("code",[s._v("main.py")]),s._v(" を作成")]),s._v(" "),a("ul",[a("li",[s._v("main.pyの中身は以下の通りに作成します"),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" fastapi "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" FastAPI\n\napp "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" FastAPI"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[s._v("@app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("read_root")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"World"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])])])])]),s._v(" "),a("li",[a("p",[s._v("よく分からない方は"),a("a",{attrs:{href:"%5Bfastapi/sample%5D(https://github.com/iij/bootcamp/tree/master/src/server-app/fastapi/sample)"}},[s._v("sample")]),s._v("ディレクトリに作成済みのサンプルファイルがあるので参考にしてください。")])])]),s._v(" "),a("h3",{attrs:{id:"_2-2-api-fastapi-の起動"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-api-fastapi-の起動"}},[s._v("#")]),s._v(" 2.2 API(FastAPI)の起動")]),s._v(" "),a("p",[a("code",[s._v("main.py")]),s._v("ファイルが作成できたら起動してみましょう。\n起動には先ほどインストールした"),a("code",[s._v("uvicorn")]),s._v("(コマンド)に"),a("code",[s._v("main:app")]),s._v("を引数として渡して実行します。")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("コンテナにログイン")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it iijbootcamp-fastapi "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("FastAPIの起動")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ uvicorn main:app\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("正常に起動した場合、そのまま以下のように出力され "),a("code",[s._v("http://127.0.0.1:8000")]),s._v("と表示されます。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("INFO:     Started server process [1990921]\nINFO:     Waiting for application startup.\nINFO:     Application startup complete.\nINFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("なお、上記のコマンドではターミナルがそのままフォアグラウンドで動き続けてしまうため、動作確認は別のターミナルを起動する必要があります。")]),s._v(" "),a("ul",[a("li",[s._v("別ターミナルを起動したら、コンテナにログインし、curlコマンドでアクセスしてみましょう。")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" --noproxy "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 http://127.0.0.1:8000\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"World"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("main.py")]),s._v("に記載した Hello Worldの出力と同時にFastAPIのコンソールにもアクセスログが出力されます。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("INFO:     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:60100 - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET / HTTP/1.1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" OK\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("ひとまずここまでできればFastAPIの実行環境としては十分になりました。")]),s._v(" "),a("ul",[a("li",[s._v("終了には"),a("code",[s._v("Ctrl+c")]),s._v("で止めてください。")])])])]),s._v(" "),a("h2",{attrs:{id:"ex1-コンテナの外からアクセスを可能にする"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ex1-コンテナの外からアクセスを可能にする"}},[s._v("#")]),s._v(" Ex1. コンテナの外からアクセスを可能にする")]),s._v(" "),a("p",[s._v("さて、ここまでの作業でアプリケーション開発自体はコンテナの外でもできることが分かりました。\nでは、起動は？アクセスは？\nこれらもコンテナの外部からできないのでしょうか。\n都度、コンテナへの出入りを繰り返さなければならないのでしょうか。")]),s._v(" "),a("p",[s._v("心配要りません、以下のようなことをする事でコンテナの外部からもアクセスが可能になります。")]),s._v(" "),a("h3",{attrs:{id:"コンテナの外から-fastapiを起動する"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#コンテナの外から-fastapiを起動する"}},[s._v("#")]),s._v(" コンテナの外から FastAPIを起動する")]),s._v(" "),a("p",[s._v("先ほどは "),a("code",[s._v("docker exec")]),s._v("の後に "),a("code",[s._v("bash")]),s._v("を引数としていましたが、ログイン後に実行していた"),a("code",[s._v("uvicorn main:app")]),s._v("を docker exec... の後に渡すことでそのまま実行する事が可能です。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it iijbootcamp-fastapi uvicorn main:app\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"コンテナの外からもアクセスできるようにする"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#コンテナの外からもアクセスできるようにする"}},[s._v("#")]),s._v(" コンテナの外からもアクセスできるようにする")]),s._v(" "),a("p",[s._v("FastAPIは何も指定しなければ"),a("code",[s._v("127.0.0.1(locahost)")]),s._v("のみListenするようになっています。しかし、これではコンテナの内部からしかアクセスができません。\nせっかく "),a("code",[s._v("docker-compose.yml")]),s._v("でportをエクスポートしたのですから、直接アクセスできるよう起動オプションを変更しましょう。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it iijbootcamp-fastapi uvicorn main:app --host "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"_3-swagger-によるapiドキュメントの自動生成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-swagger-によるapiドキュメントの自動生成"}},[s._v("#")]),s._v(" 3. swagger によるAPIドキュメントの自動生成")]),s._v(" "),a("p",[s._v("FastAPIのもう一つの優れた機能にAPIドキュメントおよびswagger clientの自動生成があります。")]),s._v(" "),a("p",[s._v("つまり、FastAPIではプログラムを書く事＝ドキュメント作成になります。このおかげでアプリケーション開発につきまとうドキュメント作成のコストが大幅に削減できます。\nドキュメントはOpenAPIという規格に沿って生成されており、そのドキュメントパスは "),a("code",[s._v("/docs")]),s._v("になっています。")]),s._v(" "),a("p",[s._v("それでは先ほどの"),a("code",[s._v("main.py")]),s._v("を再び起動しアクセスしてみましょう。\nなお、今回は敢えてFastAPIを起動する際のコマンドをそのまま記載してみましたので、コンテナ上で実行するにはどうすればよいか考えてみてください。")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("コマンド")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v(" uvicorn main:app --host "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("コンソール出力例")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("INFO:     Started server process "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1990921")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nINFO:     Waiting "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" application startup.\nINFO:     Application startup complete.\nINFO:     Uvicorn running on http://0.0.0.0:8000 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Press CTRL+C to quit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("起動したら "),a("code",[s._v("http://127.0.0.1:8000/docs/")]),s._v("にアクセスしてみましょう。"),a("a",{attrs:{href:"https://fastapi.tiangolo.com/ja/tutorial/first-steps/#api",target:"_blank",rel:"noopener noreferrer"}},[s._v("ここ"),a("OutboundLink")],1),s._v("で表示されているようなWeb画面にアクセスできれば正常です。")]),s._v(" "),a("ul",[a("li",[s._v("ここではFastAPIに定義した全てのパスについて入出力情報が記載されるだけで無く、swagger-clientも内包されているため、そのままテストを行うことも可能です。")])])])]),s._v(" "),a("h2",{attrs:{id:"ex2-解説"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ex2-解説"}},[s._v("#")]),s._v(" Ex2. 解説")]),s._v(" "),a("p",[s._v("ここでは本項で扱ったコードの解説を記載しています。\n演習の実施には必要ではありませんが、可能であれば呼んで理解を深めてください。")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"http://main.py",target:"_blank",rel:"noopener noreferrer"}},[s._v("main.py"),a("OutboundLink")],1),s._v(" "),a("ul",[a("li",[a("code",[s._v("from fastapi import FastAPI")]),s._v(": FastAPIモジュールのロード。Pythonではお馴染み")]),s._v(" "),a("li",[a("code",[s._v("app = FastAPI()")]),s._v(": appという名前でFastAPIをインスタンス化。後述のuvicornはこれを実行しているインスタンス化の際にいくつかオプションを渡すことができる")]),s._v(" "),a("li",[a("code",[s._v('@app.get("/")')]),s._v(": flask等でもお馴染みの記法。 "),a("code",[s._v("/")]),s._v(" に "),a("code",[s._v("GET")]),s._v(" メソッドが来たときの振る舞いを記載する")])])]),s._v(" "),a("li",[s._v("uvicorn main:appの示すもの\n"),a("ul",[a("li",[a("code",[s._v("main")]),s._v(' main.pyファイル (Python "module")。Pythonではディレクトリを'),a("code",[s._v(".")]),s._v("で表すため sample/main.pyの場合、 "),a("code",[s._v("sample.main")]),s._v(" になる")]),s._v(" "),a("li",[a("code",[s._v("app")]),s._v(" main.py内部で作られるobject（app = FastAPI()のように記述される）。")])])])]),s._v(" "),a("h2",{attrs:{id:"_4-fastapiでwebアプリケーションを作る"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-fastapiでwebアプリケーションを作る"}},[s._v("#")]),s._v(" 4. FastAPIでWebアプリケーションを作る")]),s._v(" "),a("p",[s._v("それではいよいよ本格的にWebアプリケーションの開発を行っていきます。\nFastAPIに限らずWebアプリケーションを作る以上、ただの静的データを返すだけでは意味がありませ\nん。\nAPIサーバを作る際には、アクセスする際に何らかのパラメータを受け、それに応じた応答を返す必要があります。\nここで代表的な3つの例を挙げて作ってみることにします。")]),s._v(" "),a("h3",{attrs:{id:"_4-1-パスパラメータ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-パスパラメータ"}},[s._v("#")]),s._v(" 4.1 パスパラメータ")]),s._v(" "),a("p",[s._v("Webアプリケーションを作る際にパス情報をパラメータとして何らかの処理をしたい場合を考えます。\nFastAPIでは、Pythonのformat文字列と同様のシンタックスで"),a("code",[s._v("パスパラメータ")]),s._v("や"),a("code",[s._v("パス変数")]),s._v("を宣言できます。")]),s._v(" "),a("p",[s._v("先ほどの"),a("code",[s._v("main.py")]),s._v("にパスパラメータを扱うメソッドを定義してみましょう。")]),s._v(" "),a("ul",[a("li",[s._v("追記する内容"),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[s._v("@app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/items/{item_id}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("read_item")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("item_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"item_id"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" item_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])])]),s._v(" "),a("p",[s._v("追記できたらFastAPIを起動しなおしてパスパラメータを与えてアクセスしてみましょう。")]),s._v(" "),a("h4",{attrs:{id:"解説"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解説"}},[s._v("#")]),s._v(" 解説")]),s._v(" "),a("ul",[a("li",[a("code",[s._v('@app.get("/items/{item_id}")')]),s._v(": URLパスの宣言\n"),a("ul",[a("li",[s._v("パスパラメータ item_id の値は、引数 item_id として関数に渡されます。")])])])]),s._v(" "),a("details",[a("summary",[s._v(" 実行例")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("FastAPI起動・コンソール出力")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("uvicorn main:app\n\nINFO:     Started server process "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1993570")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nINFO:     Waiting "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" application startup.\nINFO:     Application startup complete.\nINFO:     Uvicorn running on http://127.0.0.1:8000 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Press CTRL+C to quit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nINFO:     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:60230 - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET /items/hoge HTTP/1.1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" OK\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("curl実行、及び結果")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" --noproxy localhost http://localhost:8000/items/hoge\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"item_id"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hoge"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])])])]),s._v(" "),a("p",[s._v("参考: "),a("a",{attrs:{href:"https://fastapi.tiangolo.com/ja/tutorial/path-params/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://fastapi.tiangolo.com/ja/tutorial/path-params/"),a("OutboundLink")],1)]),s._v(" "),a("h3",{attrs:{id:"_4-2-クエリパラメータ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-クエリパラメータ"}},[s._v("#")]),s._v(" 4.2 クエリパラメータ")]),s._v(" "),a("p",[s._v('パスパラメータが実現できたら次はクエリパラメータの操作を作ってみましょう。\nFastAPIでは関数の引数を宣言した時にパスパラメータではない関数パラメータを宣言すると、それらは自動的に "クエリ" パラメータとして解釈されます。')]),s._v(" "),a("p",[s._v("それでは先ほどに続きmain.pyにクエリパラメータを扱うメソッドを定義してみましょう。")]),s._v(" "),a("ul",[a("li",[s._v("追記する内容"),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[s._v("fake_items_db "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"item_name"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Foo"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"item_name"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Bar"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"item_name"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Baz"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[s._v("@app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/items/"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("read_query_item")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("skip"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" limit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""クエリパラメータ"""')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" fake_items_db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("skip "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" skip "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" limit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])])])]),s._v(" "),a("p",[s._v("追記できたら再び起動してクエリパラメータを与えてアクセスしてみましょう。")]),s._v(" "),a("h4",{attrs:{id:"解説-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解説-2"}},[s._v("#")]),s._v(" 解説")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("fake_items_db")]),s._v(": クエリパラメータに応じて返答する数を変えるためのデータリスト")]),s._v(" "),a("li",[a("code",[s._v("def read_query_item(skip: int = 0, limit: int = 10):")]),s._v(": クエリパラメータ向けのメソッド追加\n"),a("ul",[a("li",[s._v("クエリ名"),a("code",[s._v("skip")]),s._v(", "),a("code",[s._v("limit")]),s._v("を宣言。それぞれ int型で定義しているため、 "),a("code",[s._v("skip=hoge")]),s._v(" みたいな形はエラーになる")])])])]),s._v(" "),a("details",[a("summary",[s._v(" 実行例")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("FastAPI起動・コンソール出力")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("uvicorn main:app\n\nINFO:     Started server process "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1993570")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nINFO:     Waiting "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" application startup.\nINFO:     Application startup complete.\nINFO:     Uvicorn running on http://127.0.0.1:8000 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Press CTRL+C to quit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nINFO:     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:60488 - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET /items/?skip=0&limit=1 HTTP/1.1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" OK\nINFO:     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:60514 - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET /items/?skip=0&limit=2 HTTP/1.1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" OK\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("curl実行、及び結果")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" --noproxy localhost "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://localhost:8000/items/?skip=0&limit=1"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"item_name"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Foo"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" --noproxy localhost "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://localhost:8000/items/?skip=0&limit=2"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"item_name"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Foo"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(","),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"item_name"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Bar"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])])])])]),s._v(" "),a("p",[s._v("参考: "),a("a",{attrs:{href:"https://fastapi.tiangolo.com/ja/tutorial/query-params/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://fastapi.tiangolo.com/ja/tutorial/query-params/"),a("OutboundLink")],1)]),s._v(" "),a("h3",{attrs:{id:"_4-3-リクエストボディ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-リクエストボディ"}},[s._v("#")]),s._v(" 4.3 リクエストボディ")]),s._v(" "),a("p",[s._v("パスパラメータ・クエリパラメータが実現できたら次はリクエストボディを扱ってみましょう。\nリクエストボディはクライアントからAPIにデータを送信する時に使います。")]),s._v(" "),a("p",[s._v("それでは"),a("code",[s._v("main.py")]),s._v("にリクエストボディを扱うメソッドを追加してみましょう。")]),s._v(" "),a("h4",{attrs:{id:"pydantic-によるモデルの定義"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pydantic-によるモデルの定義"}},[s._v("#")]),s._v(" Pydantic によるモデルの定義")]),s._v(" "),a("p",[s._v("FastAPIでは型を宣言することで入出力のvaidation checkを行っていることは冒頭で述べたとおりです。\nパスパラメータの項では型宣言を行いませんでしたがクエリパラメータの項では型を定義しチェックするようにしています。\nでは、リクエストボディの場合はどうすれば良いのでしょうか？\nそれに対する解が"),a("a",{attrs:{href:"https://pydantic-docs.helpmanual.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("pydantic"),a("OutboundLink")],1),s._v("です。")]),s._v(" "),a("p",[s._v("従ってまずは期待するリクエストボディの型を定義することから始めます。")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" pydantic "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" BaseModel\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" typing "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" Optional\n\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Item")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("BaseModel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("str")]),s._v("\n    description"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Optional"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("str")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),s._v("\n    price"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("float")]),s._v("\n    tax"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Optional"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("float")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h5",{attrs:{id:"解説-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解説-3"}},[s._v("#")]),s._v(" 解説")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("from pydantic import BaseModel")]),s._v(": pydantic のモジュールロード。基本的にはBaseModelを使う")]),s._v(" "),a("li",[a("code",[s._v("from typing import Optional")]),s._v(": Python typehintのロード")]),s._v(" "),a("li",[a("code",[s._v("class Item(BaseModel):")]),s._v(": リクエストボディの型を定義するクラス pydanticのBaseModelを継承")])]),s._v(" "),a("h4",{attrs:{id:"リクエストボディを処理するメソッドの定義"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#リクエストボディを処理するメソッドの定義"}},[s._v("#")]),s._v(" リクエストボディを処理するメソッドの定義")]),s._v(" "),a("p",[s._v("リクエストボディの型定義が済んだらこの型を用いてPOSTを受け付けるメソッドを定義します。\n本来であればPOSTされたデータをどこかに格納し、GETメソッドなどで中身を取り出すのですが\n今回はそういったデータストアを用いていないため、リクエストボディで受け付けた内容をそのまま返すものとします。")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[s._v("@app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("post")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/items/"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("create_item")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("item"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Item"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""リクエストボディ"""')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" item\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("追記できたら再び起動してリクエストボディを与えてアクセスしてみましょう。")]),s._v(" "),a("details",[a("summary",[s._v(" 実行例")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("FastAPI起動・コンソール出力")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("uvicorn main:app\n\nINFO:     Started server process "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1993570")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nINFO:     Waiting "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" application startup.\nINFO:     Application startup complete.\nINFO:     Uvicorn running on http://127.0.0.1:8000 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Press CTRL+C to quit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nINFO:     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:60644 - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"POST /items/ HTTP/1.1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" OK\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("curl実行、及び結果")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" --noproxy localhost -X "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'POST'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://localhost:8000/items/'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -H "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'accept: application/json'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -H "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Content-Type: application/json'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -d "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{\n  "name": "string",\n  "description": "string",\n  "price": 0,\n  "tax": 0\n}\'')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"string"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"description"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"string"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"price"')]),s._v(":0.0,"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tax"')]),s._v(":0.0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])])])])]),s._v(" "),a("p",[s._v("参考: "),a("a",{attrs:{href:"https://fastapi.tiangolo.com/ja/tutorial/body/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://fastapi.tiangolo.com/ja/tutorial/body/"),a("OutboundLink")],1)]),s._v(" "),a("h2",{attrs:{id:"ex3-より本番環境らしくfastapiを起動するために"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ex3-より本番環境らしくfastapiを起動するために"}},[s._v("#")]),s._v(" Ex3. より本番環境らしくFastAPIを起動するために")]),s._v(" "),a("p",[s._v("さて、ここまででFastAPIを用いて作るWebアプリケーションの基本的な部分は学びました。\nしかし、本格的に開発を行うのであれば抑えておきたいポイントがいくつかありますので\nそれらの一例を記載しておきます。")]),s._v(" "),a("h3",{attrs:{id:"gunicornの利用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gunicornの利用"}},[s._v("#")]),s._v(" Gunicornの利用")]),s._v(" "),a("p",[s._v("これまでFastAPIの起動には"),a("code",[s._v("uvicorn")]),s._v("を使ってきましたが\nuvicornのサイトにも記載されているとおり、Gunicornを使う方がより好ましいといえます。\n事実、uvicornのサイトでもGunicornの利用を推奨しています。\n"),a("a",{attrs:{href:"https://www.uvicorn.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.uvicorn.org/"),a("OutboundLink")],1)]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Gunicorn is a mature, fully featured server and process manager.\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("ではGunicornをインストールし、起動方法を変更してみましょう。\nNOTE: 必要に応じて "),a("code",[s._v("--upgrade")]),s._v("オプションを追加してください")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ pip3 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" fastapi Gunicorn uvicorn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("standard"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("GunicornがインストールできたらGunicornを使って先ほどのアプリケーションを起動してみましょう。\nこちらも以下の通り実行するとuvicornで起動した時と同様にフォアグラウンドで動作する為、確認の際は別ターミナルを起動します。\nまた、終了も同じように"),a("code",[s._v("Ctrl+c")]),s._v("で終了してください。")]),s._v(" "),a("details",[a("summary",[s._v(" 実行例")]),s._v(" "),a("ul",[a("li",[s._v("FastAPI起動・コンソール出力")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("gunicorn -k uvicorn.workers.UvicornWorker main:app\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-07-07 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":22:57 +0900"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1998398")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Starting gunicorn "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20.1")]),s._v(".0\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-07-07 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":22:57 +0900"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1998398")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Listening at: http://127.0.0.1:8000 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1998398")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-07-07 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":22:57 +0900"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1998398")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Using worker: uvicorn.workers.UvicornWorker\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-07-07 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":22:57 +0900"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1998400")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Booting worker with pid: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1998400")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-07-07 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":22:57 +0900"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1998400")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Started server process "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1998400")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-07-07 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":22:57 +0900"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1998400")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Waiting "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" application startup.\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-07-07 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":22:57 +0900"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1998400")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Application startup complete.\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("ul",[a("li",[s._v("curl実行、及び結果")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" --noproxy localhost "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://localhost:8000"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"World"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])]),s._v(" "),a("p",[s._v("参考: "),a("a",{attrs:{href:"https://zenn.dev/ainamori/articles/76990129cac97de0e30b",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://zenn.dev/ainamori/articles/76990129cac97de0e30b"),a("OutboundLink")],1)]),s._v(" "),a("h2",{attrs:{id:"_5-プレーンテキストを返す"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-プレーンテキストを返す"}},[s._v("#")]),s._v(" 5. プレーンテキストを返す")]),s._v(" "),a("p",[s._v('FastAPIはWebアプリケーション開発用フレームワークという事もありデフォルトでは全てJSONで返す挙動となっています。\nしかし、"/"のような場所はアプリケーションが起動しているか否かといった単純な監視用に定義するようなことがあり、そういうときには単純な平文を返したいと思うことでしょう。\nそのような時にはResponse_classを変更する事でPlain Textを返すことができます。')]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" fastapi"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("responses "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" PlainTextResponse\n\n"),a("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[s._v("@app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/plaintext/ok"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" response_class"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("PlainTextResponse"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("return_plain_text")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("str")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OK"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h2",{attrs:{id:"_6-エラーハンドリング"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-エラーハンドリング"}},[s._v("#")]),s._v(" 6. エラーハンドリング")]),s._v(" "),a("p",[s._v("FastAPIは存在しない（未定義）のURLパスにアクセスすると404を返す、といった基本的な動作は備えています。\nしかしながら受け付けたURLに対し、なんらかの処理を行い、その結果に応じてレスポンスコードを変化させたい、と言った時はどのようにすれば良いのでしょうか。")]),s._v(" "),a("p",[s._v("FastAPIにはHTTPExceptionが含まれている為、それを呼び出すことで任意のレスポンスコードを返すことができます。")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" fastapi "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" FastAPI"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" HTTPException\n\nitems "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hoge"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"This is Hoge"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[s._v("@app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/error/{item_id}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("read_item_with_error_handling")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("item_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("str")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" item_id "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("not")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" items"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("raise")]),s._v(" HTTPException"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("status_code"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("404")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" detail"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Item not found"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"item"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" items"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("item_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("参考: "),a("a",{attrs:{href:"https://fastapi.tiangolo.com/ja/tutorial/handling-errors/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://fastapi.tiangolo.com/ja/tutorial/handling-errors/"),a("OutboundLink")],1)]),s._v(" "),a("h2",{attrs:{id:"_7-アプリケーション情報の追加"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-アプリケーション情報の追加"}},[s._v("#")]),s._v(" 7. アプリケーション情報の追加")]),s._v(" "),a("p",[s._v("FastAPIは起動時に様々な情報を追加することができます。\n下記に一例を示しますので実際に設定を行ってみましょう。\nどのような違いが出るか試してみてください。")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[s._v("app "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" FastAPI"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    title"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IIJ Bootcamp HandsOn"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    description"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IIJ Bootcamp Web Application by FastAPI."')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    version"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.0"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h2",{attrs:{id:"ex4-非同期処理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ex4-非同期処理"}},[s._v("#")]),s._v(" Ex4. 非同期処理")]),s._v(" "),a("p",[s._v("起動をGunicornに変更できたら次はASGI対応のWebアプリケーションを作ってみましょう。\n実はuvicornでもASGI対応のWebアプリケーション作成は可能なのですが、前述の通りGunicornを使え、と言うのが\n公式の推奨という事もあり、まずはGunicornの活用を先に行っています。")]),s._v(" "),a("p",[s._v("また、ASGIとはWSGIと呼ばれるWebサーバとWebアプリケーションを接続するための、\n標準化されたインタフェース定義の精神的(*)な後継仕様です。\nASGIとは 非同期サーバゲートウェイインタフェース(Asynchronous Server Gateway Interface)の名の通り\nasyncioを介して非同期で動作するよう設計されています。\nFastAPIでASGI対応のアプリケーションを作るためにはFastAPIのBackgroundTaskを使います。")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" fastapi "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" BackgroundTasks"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" FastAPI\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" time "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" sleep\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("print_wait_time")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    sleep"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string-interpolation"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('f"Wait ')]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v(' second & print!"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[s._v("@app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/{count}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("async")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("asgi_task")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" background_tasks"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" BackgroundTasks"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    background_tasks"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("add_task"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("print_wait_time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"status"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"See the console log for wait time."')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("参考: "),a("a",{attrs:{href:"https://fastapi.tiangolo.com/ja/tutorial/background-tasks/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://fastapi.tiangolo.com/ja/tutorial/background-tasks/"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("*)ASGIの公式ドキュメントにもspiritualと書いてあり、「精神的な」後継である事が明記されている。")]),s._v(" "),a("h2",{attrs:{id:"まとめ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#まとめ"}},[s._v("#")]),s._v(" まとめ")]),s._v(" "),a("p",[s._v("今回は、FastAPIを使ってWebアプリケーションを作ってみました。\nFastAPIは決して大規模なWebアプリケーションを作るために作られた物ではありませんが、作り方次第で多くの処理を任せることができます。")]),s._v(" "),a("p",[s._v("BootCampではあくまでチュートリアルのような形で作成したため、全てを一つのmain.pyに記載しましたが開発をスムーズに行う上ではpydanticで定義するモデルファイルは分ける。エンドポイントも階層化に合わせてファイルを分ける、といったテクニックが必要になってきますのでそういった所を今後は学んでいって頂ければと思います。")]),s._v(" "),a("h2",{attrs:{id:"発展学習"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#発展学習"}},[s._v("#")]),s._v(" 発展学習")]),s._v(" "),a("h3",{attrs:{id:"より詳細なログ出力をしたい時は"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#より詳細なログ出力をしたい時は"}},[s._v("#")]),s._v(" より詳細なログ出力をしたい時は？")]),s._v(" "),a("p",[s._v("Webアプリケーションを開発する上で不具合を調査する上でログは大変重要です。\nここでは処理時間やリクエストをログに出力するためのTipsをご紹介します。\n先ほど示したsampleディレクトリに logging_context.py という、ログ出力のために作られたClassがあるので\nこれをimportし、LoggingContextRouteをappのrouter.route_class に指定することで詳細なログに出力されます。\nお時間があればやってみてください。")]),s._v(" "),a("ul",[a("li",[s._v("import/設定例")])]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" logging_context "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" LoggingContextRoute\n\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("router"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("route_class "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" LoggingContextRoute\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("credit-footer")],1)}),[],!1,null,null,null);a.default=e.exports}}]);