(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{515:function(s,a,t){"use strict";t.r(a);var n=t(10),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"database-redis-編"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#database-redis-編"}},[s._v("#")]),s._v(" Database: Redis 編")]),s._v(" "),a("p",[s._v("このハンズオンの狙い")]),s._v(" "),a("ul",[a("li",[s._v("Docker に慣れる")]),s._v(" "),a("li",[s._v("Redis を実際に使ってみる")]),s._v(" "),a("li",[s._v("よく使いたくなる処理(部品)を作ってみる")])]),s._v(" "),a("h2",{attrs:{id:"事前準備"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事前準備"}},[s._v("#")]),s._v(" 事前準備")]),s._v(" "),a("ul",[a("li",[s._v("Docker を使用できる\n"),a("ul",[a("li",[s._v("install は主題ではないので、Docker image を使用します")])])]),s._v(" "),a("li",[s._v("何らかの LL を使える\n"),a("ul",[a("li",[s._v("例は Python で書きますが、Ruby, Perl, JavaScript, Go なども使えます。適当に読み替えてください")])])])]),s._v(" "),a("h3",{attrs:{id:"事前準備手順"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事前準備手順"}},[s._v("#")]),s._v(" 事前準備手順")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("Redis と Python のイメージを使えるようにする")]),s._v(" "),a("div",{staticClass:"language-Shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull redis:6.2.3-alpine3.13\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull python:3.9.5-slim-buster\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" images\n\nREPOSITORY                                           TAG                 IMAGE ID            CREATED             SIZE\npython                                               "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.9")]),s._v(".5-slim-buster   afaa64e7c7fe        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" hours ago        115MB\nredis                                                "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.2")]),s._v(".3-alpine3.13    efb4fa30f1cf        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" days ago          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v(".3MB\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("サーバを起動する")]),s._v(" "),a("div",{staticClass:"language-Shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run --rm --name test-server redis:6.2.3-alpine3.13\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[a("code",[s._v("test-server")]),s._v(" という名前で redis サーバーを 起動します")]),s._v(" "),a("li",[a("code",[s._v("Ready to accept connections")]),s._v(" と出ればOK このターミナルは開いたままにします")]),s._v(" "),a("li",[s._v("もし、ターミナルが閉じたり、Ctrl-C で終了してしまったら、再度 起動してください")])])]),s._v(" "),a("li",[a("p",[s._v("別のターミナルを開いて、redis-cli でサーバに接続してみる")]),s._v(" "),a("ul",[a("li",[s._v("redis-cli を起動します。 これで対話的に コマンドが打てます。")]),s._v(" "),a("li",[s._v("下の二通りの使い方があります。どちらも "),a("code",[s._v("test-server")]),s._v(" として先程起動したredis の中を見れます")])]),s._v(" "),a("div",{staticClass:"language-Shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ネットワーク越し 別コンテナ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -it --link test-server:redis --rm redis:6.2.3-alpine3.13 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" -c "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'exec redis-cli -h "$REDIS_PORT_6379_TCP_ADDR" -p "$REDIS_PORT_6379_TCP_PORT"\'')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 直接 乗り込んで起動")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it test-server redis-cli\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ul",[a("li",[s._v("redis のping コマンドで PONG と帰ってくれば 正常に接続できています。")])]),s._v(" "),a("div",{staticClass:"language-Shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".0.2:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v("\nPONG\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".0.2:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ul",[a("li",[s._v("Ctrl-C もしくは exit コマンドで抜けます。")])]),s._v(" "),a("ul",[a("li",[s._v("Windows 環境は Git Bash の MINGW64 環境で動作確認しました\n"),a("ul",[a("li",[s._v("winpty docker -it 〜 としたらいけました")])])])])]),s._v(" "),a("li",[a("p",[s._v("終了")]),s._v(" "),a("ul",[a("li",[s._v("ここまで完了できたら 事前準備完了です。 無事 これらを行うことができました。\n"),a("ol",[a("li",[s._v("docker image の 取得")]),s._v(" "),a("li",[s._v("redis server の起動")]),s._v(" "),a("li",[s._v("redis-cli による Redis の操作")])])])])])]),s._v(" "),a("h2",{attrs:{id:"あらすじ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#あらすじ"}},[s._v("#")]),s._v(" あらすじ")]),s._v(" "),a("ul",[a("li",[s._v("Redis ざっくり説明")]),s._v(" "),a("li",[s._v("Redis を直接触ってみよう")]),s._v(" "),a("li",[s._v("応用課題: プログラムで DB 登録しよう")])]),s._v(" "),a("h2",{attrs:{id:"資料"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#資料"}},[s._v("#")]),s._v(" 資料")]),s._v(" "),a("h3",{attrs:{id:"redis-とは何か"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#redis-とは何か"}},[s._v("#")]),s._v(" Redis とは何か")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("KVS(Key-Value-Store) の一種")]),s._v(" "),a("ul",[a("li",[s._v("データを Key と Value で 管理するもの")]),s._v(" "),a("li",[s._v("構造が単純故に、気軽に使えたり、分散しやすいなど RDBMS とは違った特性を持つデータストア")])])]),s._v(" "),a("li",[a("p",[s._v("RDBMS vs KVS")]),s._v(" "),a("ul",[a("li",[s._v("よく言われるWebサービスの最小構成として LAMP (Linux, Apache, MySQL, PHP/Perl/Python) と言う言葉がある")]),s._v(" "),a("li",[s._v("データを扱うのに MySQL, PostgreSQL のような データを 表で管理する RDBMS を使うのはよくあること。\n"),a("ul",[a("li",[s._v("帳簿のように 決められた形式で決められた属性のデータをきれいに整理するのには向いていた")])])]),s._v(" "),a("li",[s._v("でも、 RDBMS では 困る場合もある。\n"),a("ul",[a("li",[s._v("多様: 例えばセンサーの情報 センサーが100種類あれば100種類のテーブルを作るのか? 1万なら? 現実的ではない")]),s._v(" "),a("li",[s._v("大量: 巨大な表同士を連携しながら1つのデータにするRDBMS では 1台のマシンで扱える規模に限界がある。")]),s._v(" "),a("li",[s._v("高頻度: 毎秒凄まじい数のリクエストを高速に処理しないといけない時、RDBMS の負荷分散では仕組み上の限界がある")])])]),s._v(" "),a("li",[s._v("そこで RDBMS とは別の仕組みでデータを処理できるデータベースが 最近 利用されてきた\n"),a("ul",[a("li",[s._v("KVSやドキュメントデータベース、JSONのママ登録できるRDBMSや、グラフデータベースなど")])])])])]),s._v(" "),a("li",[a("p",[s._v("Redis の特徴")]),s._v(" "),a("ul",[a("li",[s._v("オンメモリで動作し、速い\n"),a("ul",[a("li",[s._v("設定で永続化やクラスタリングもできる")])])]),s._v(" "),a("li",[s._v("便利な機能やデータ型がある\n"),a("ul",[a("li",[s._v("単純な KVS に加えて Redis では いくつものデータ型がサポートされている\n"),a("ul",[a("li",[s._v("String: 512MB までの テキストやバイナリ")]),s._v(" "),a("li",[s._v("Hashes: フィールドと値のリスト")]),s._v(" "),a("li",[s._v("Lists: 順序を保持してくれる文字列の集合 (4番目に入れたやつ などが取れる)")]),s._v(" "),a("li",[s._v("Sets: 順序なしの文字列の集合で、他のSets 同士で 足したり引いたり 共通する要素を抜き出したりなどの 演算ができる")]),s._v(" "),a("li",[s._v("Sorted sets: ソート済みのSets. 値を入れるときに並べ替えながら入れてくれる、 また、 決められた範囲で何件あるか、 3~5位は誰か などの演算ができる\n(bitmap, HLL, pubsub, streaming)")])])]),s._v(" "),a("li",[s._v("expire(データの有効期限): 決められた時間が立ったあとデータを消すという処理をする必要がない")]),s._v(" "),a("li",[s._v("トランザクション: Luaスクリプトなどを用意することで 複数の操作を一連の操作として行えることができる")]),s._v(" "),a("li",[s._v("Pub/Sub のメッセージング: 多対多の疎結合なやりとりをサポートしている。 これにより チャットや 配信の仕組みなどを 簡単に作れる")]),s._v(" "),a("li",[s._v("地理データ用のコマンド: 二点間の距離とか 10km四方にある ラーメン屋の検索 とかができる")])])]),s._v(" "),a("li",[s._v("シンプルに出来が良い\n"),a("ul",[a("li",[s._v("機能がコンパクトにまとまっており、信頼性が高く動かしていて気持ちがいい（主観）")])])])])]),s._v(" "),a("li",[a("p",[s._v("世間でのRedis の 使用例")]),s._v(" "),a("ul",[a("li",[s._v("Web server のセッション保持")]),s._v(" "),a("li",[s._v("高速にアクセスしたいメタデータの保持")]),s._v(" "),a("li",[s._v("コンテンツ/データのキャッシュ")]),s._v(" "),a("li",[s._v("データの一時キュー")]),s._v(" "),a("li",[s._v("sorted set 型によるランキング")]),s._v(" "),a("li",[s._v("set 型によるタグ付けと集合演算")])])])]),s._v(" "),a("h3",{attrs:{id:"redis-を直接触ってみよう"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#redis-を直接触ってみよう"}},[s._v("#")]),s._v(" Redis を直接触ってみよう")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://redis.io/commands",target:"_blank",rel:"noopener noreferrer"}},[s._v("Redis コマンド一覧"),a("OutboundLink")],1),s._v(" も見ながら色々触ってみましょう。")]),s._v(" "),a("h4",{attrs:{id:"一番単純なkey-value"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一番単純なkey-value"}},[s._v("#")]),s._v(" 一番単純なkey-value")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://redis.io/commands/set",target:"_blank",rel:"noopener noreferrer"}},[s._v("set"),a("OutboundLink")],1),s._v("/"),a("a",{attrs:{href:"https://redis.io/commands/get",target:"_blank",rel:"noopener noreferrer"}},[s._v("get"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("code",[s._v("set")]),s._v("で保存して"),a("code",[s._v("get")]),s._v("で取り出します。")]),s._v(" "),a("div",{staticClass:"language-terminal line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('172.17.0.2:6379> set key1 yamagarashi\nOK\n172.17.0.2:6379> set key2 kaizoku\nOK\n172.17.0.2:6379> get key1\n"yamagarashi"\n172.17.0.2:6379> get key2\n"kaizoku"\n172.17.0.2:6379> get key3\n(nil)\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("これがredisで最も基本的なkeyとvalueの扱いです。"),a("code",[s._v("set")]),s._v("や"),a("code",[s._v("get")]),s._v("を「コマンド」と呼び、その後ろは引数です。\nkeyを色々操作してみましょう。")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://redis.io/commands/keys",target:"_blank",rel:"noopener noreferrer"}},[s._v("keys"),a("OutboundLink")],1),s._v(" はkeyの検索ができます。"),a("code",[s._v("keys *")]),s._v("とすると存在するすべてのキーが出力されます。\nちなみにredisはシングルスレッドで動作するソフトウェアで、"),a("code",[s._v("keys *")]),s._v("で大量のkeyを表示すると一定時間処理が止まってしまい、本番サーバに重大な影響を与えてしまうので注意しましょう。")]),s._v(" "),a("div",{staticClass:"language-terminal line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('172.17.0.2:6379> keys key*\n1) "key1"\n2) "key2"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("他にも色々")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://redis.io/commands/exists",target:"_blank",rel:"noopener noreferrer"}},[s._v("exists"),a("OutboundLink")],1),s._v(": もうセットされてるのか とかがわかる")]),s._v(" "),a("li",[a("a",{attrs:{href:"https://redis.io/commands/del",target:"_blank",rel:"noopener noreferrer"}},[s._v("del"),a("OutboundLink")],1),s._v(": key を指定してそれを削除する")]),s._v(" "),a("li",[a("a",{attrs:{href:"https://redis.io/commands/rename",target:"_blank",rel:"noopener noreferrer"}},[s._v("rename"),a("OutboundLink")],1),s._v(": key の 名前を変えられる")])]),s._v(" "),a("div",{staticClass:"language-terminal line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('172.17.0.2:6379> exists key2\n(integer) 1                           # 存在しているので1(true)\n172.17.0.2:6379> exists key3\n(integer) 0                           # 存在しないので0(false)\n172.17.0.2:6379> del key2\n(integer) 1\n172.17.0.2:6379> keys *\n1) "key1"\n172.17.0.2:6379> rename key1 key5\nOK\n172.17.0.2:6379> get key5\n"yamagarashi"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("キーには有効期限を設定し、一定時間後に自動削除することができます。\nキャッシュなどの用途において、アプリケーション側でキャッシュ削除をしなくても勝手に削除されるのが非常に便利です。")]),s._v(" "),a("div",{staticClass:"language-terminal line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('172.17.0.2:6379> set key7 kiemasu\nOK\n172.17.0.2:6379> expire key7 20         # 20秒後に消す\n(integer) 1\n172.17.0.2:6379> ttl key7               # ttlは残り秒数を表示する\n(integer) 17\n172.17.0.2:6379> ttl key7\n(integer) 14\n172.17.0.2:6379> get key7               # まだ見えてる\n"kiemasu"\n172.17.0.2:6379> ttl key7\n(integer) 8\n172.17.0.2:6379> ttl key7\n(integer) 3\n172.17.0.2:6379> ttl key7\n(integer) 1\n172.17.0.2:6379> ttl key7\n(integer) -2\n172.17.0.2:6379> get key7               # 消えた\n(nil)\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("h4",{attrs:{id:"数値の扱い"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数値の扱い"}},[s._v("#")]),s._v(" 数値の扱い")]),s._v(" "),a("p",[s._v("redisはよくランキング情報を一時的にキャッシュしたり数値を扱うことが多いため、そのためのコマンドが用意されています。")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://redis.io/commands/incr",target:"_blank",rel:"noopener noreferrer"}},[s._v("incr"),a("OutboundLink")],1),s._v(": 1足す")]),s._v(" "),a("li",[a("a",{attrs:{href:"https://redis.io/commands/decr",target:"_blank",rel:"noopener noreferrer"}},[s._v("decr"),a("OutboundLink")],1),s._v(": 1引く")]),s._v(" "),a("li",[a("a",{attrs:{href:"https://redis.io/commands/incrby",target:"_blank",rel:"noopener noreferrer"}},[s._v("incrby"),a("OutboundLink")],1),s._v(": n足す")]),s._v(" "),a("li",[a("a",{attrs:{href:"https://redis.io/commands/decrby",target:"_blank",rel:"noopener noreferrer"}},[s._v("decrby"),a("OutboundLink")],1),s._v(": n引く")])]),s._v(" "),a("div",{staticClass:"language-terminal line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('172.17.0.2:6379> set boss_damage 0\nOK\n172.17.0.2:6379> incr boss_damage\n(integer) 1\n172.17.0.2:6379> incr boss_damage\n(integer) 2\n172.17.0.2:6379> get boss_damage\n"2"\n172.17.0.2:6379> incr boss_damage\n(integer) 3\n172.17.0.2:6379> get boss_damage\n"3"\n172.17.0.2:6379> decrby boss_damage 2\n(integer) 1\n172.17.0.2:6379> get boss_damage\n"1"\n172.17.0.2:6379> incrby boss_damage 10\n(integer) 11\n172.17.0.2:6379> get boss_damage\n"11"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("h4",{attrs:{id:"色々なデータ型-lists"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#色々なデータ型-lists"}},[s._v("#")]),s._v(" 色々なデータ型(Lists)")]),s._v(" "),a("p",[s._v("上で例に出したのは全てstring(文字列)型の単純なデータです。redisにはそれ以外にも面白いデータ型を用意しています。")]),s._v(" "),a("p",[s._v("最初に紹介するのは "),a("a",{attrs:{href:"https://redis.io/docs/data-types/lists/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Lists"),a("OutboundLink")],1),s._v(" 型です。")]),s._v(" "),a("div",{staticClass:"language-terminal line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('172.17.0.2:6379> rpush enemy_list slime\n(integer) 1\n172.17.0.2:6379> rpush enemy_list drakee\n(integer) 2\n172.17.0.2:6379> lrange enemy_list 0 -1\n1) "slime"\n2) "drakee"\n172.17.0.2:6379> lpush enemy_list magician\n(integer) 3\n172.17.0.2:6379> lrange enemy_list 0 -1\n1) "magician"\n2) "slime"\n3) "drakee"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[a("code",[s._v("rpush")]),s._v("はリストの末尾に要素を追加するコマンド、"),a("code",[s._v("lpush")]),s._v("は逆に先頭に追加するコマンドです。\n"),a("code",[s._v("lrange")]),s._v("の引数がどういう意味なのか、色々試してみてください。")]),s._v(" "),a("h4",{attrs:{id:"色々なデータ型-sets"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#色々なデータ型-sets"}},[s._v("#")]),s._v(" 色々なデータ型(Sets)")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://redis.io/docs/data-types/sets/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Sets"),a("OutboundLink")],1),s._v(" はunique性が保証されたリストです。\nSetsは順序を考慮しませんが、勝手にソートしてくれる "),a("a",{attrs:{href:"https://redis.io/docs/data-types/sorted-sets/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Sorted sets"),a("OutboundLink")],1),s._v(" も存在します。")]),s._v(" "),a("div",{staticClass:"language-terminal line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('172.17.0.2:6379> sadd favorites site1\n(integer) 1\n172.17.0.2:6379> sadd favorites siteABC\n(integer) 1\n172.17.0.2:6379> sadd favorites site3\n(integer) 1\n172.17.0.2:6379> sadd favorites siteABC\n(integer) 0\n172.17.0.2:6379> smembers favorites\n1) "site1"\n2) "siteABC"\n3) "site3"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h4",{attrs:{id:"色々なデータ型-hashes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#色々なデータ型-hashes"}},[s._v("#")]),s._v(" 色々なデータ型(Hashes)")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://redis.io/docs/data-types/hashes/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Hashes"),a("OutboundLink")],1),s._v(" はプログラミング言語で言うところのMap的な、あるいはオブジェクトを表現できるデータです。")]),s._v(" "),a("div",{staticClass:"language-terminal line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('172.17.0.2:6379> hset slime attack 5 deffence 3 hp 3 exp 1\n(integer) 4\n172.17.0.2:6379> hget slime hp\n"3"\n172.17.0.2:6379> hmget slime deffence hp\n1) "3"\n2) "3"\n172.17.0.2:6379> hmget slime attack deffence\n1) "5"\n2) "3"\n172.17.0.2:6379> hgetall slime\n1) "attack"\n2) "5"\n3) "deffence"\n4) "3"\n5) "hp"\n6) "3"\n7) "exp"\n8) "1"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("p",[s._v("例のようにオブジェクトを表現してもいいですし、key-value的な使い方もできます。")]),s._v(" "),a("h4",{attrs:{id:"pub-sub"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pub-sub"}},[s._v("#")]),s._v(" Pub/sub")]),s._v(" "),a("p",[s._v("redisはkey-valueストアとしてだけではなく、シンプルなpub/subとしても利用可能です。\npub/subとは特定のチャンネルをsubscribe(購読)しているプログラムに対して、そのチャンネルにpublish(出版)することで多数のsubscriber(読者)に情報を届けることができるモデルです。\npublisherとsubscriberそれぞれのプログラムがお互いを知らなくても通信ができるため素結合に維持ができ、動的に通信相手が変わるようなユースケースに利用されます。")]),s._v(" "),a("p",[s._v("pub/subモデルを利用したアーキテクチャは「イベント駆動型アーキテクチャ」とも呼ばれ、"),a("a",{attrs:{href:"https://kafka.apache.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Apache kafka"),a("OutboundLink")],1),s._v(" などが有名です。kafkaの場合はsubscriberが誰もいなかった時にデータを貯めておいて、確実に届けてくれたりもするのですが、redisのpub/subはリアルタイムにsubscribeしているプログラムにのみデータが送信され、届かなかったデータは破棄されるシンプルなものです。\nしかしシンプルであるがゆえ信頼性が高く、動作も軽いという特徴があります。")]),s._v(" "),a("p",[s._v("ターミナルを２つ開いてください。")]),s._v(" "),a("p",[s._v("ターミナル1で"),a("code",[s._v("subscribe")]),s._v("を実行すると、データ待ちの状態になります。")]),s._v(" "),a("div",{staticClass:"language-terminal line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('172.17.0.2:6379> subscribe channelA\nReading messages... (press Ctrl-C to quit)\n1) "subscribe"\n2) "channelA"\n3) (integer) 1\n\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("ターミナル2でデータを"),a("code",[s._v("publish")]),s._v("してみましょう。")]),s._v(" "),a("div",{staticClass:"language-terminal line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("172.17.0.2:6379> publish channelA hello\n(integer) 1\n172.17.0.2:6379> publish channelA I\n(integer) 1\n172.17.0.2:6379> publish channelA am\n(integer) 1\n172.17.0.2:6379>\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("subscribeしている側にどのように見えたでしょうか。")]),s._v(" "),a("h3",{attrs:{id:"データの永続性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#データの永続性"}},[s._v("#")]),s._v(" データの永続性")]),s._v(" "),a("p",[s._v("redisはオンメモリで動くため、再起動するとデータは消えます。\n基本的には消えてもいいデータを扱うことが多いですが、再起動のたびに消えてしまうのも面倒なので永続化の仕組みが存在します。")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://redis.io/docs/management/persistence/",target:"_blank",rel:"noopener noreferrer"}},[s._v("persistence"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("永続化には主に２つのやり方があります。")]),s._v(" "),a("ul",[a("li",[s._v("RDB(Redis Database): 一定時間ごとに全データをスナップショットしてファイルに残しておく。リレーショナルデータベース(RDB)とは関係ない")]),s._v(" "),a("li",[s._v("AOF(Append Only File): 更新をログとして記録していく。スナップショット作成が高コストなのに対して、小さいデータを追記していくので低コスト。一方でディスクサイズは大きくなる。")])]),s._v(" "),a("p",[s._v("どちらか、あるいは両方を使うかどうかはユースケース次第です。\nしかしいずれもデータの更新からファイルへの記録にはラグがあり、更新内容が必ず永続化される保証はないことに注意が必要です。")]),s._v(" "),a("h3",{attrs:{id:"応用課題-プログラムから-redis-を使おう"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#応用課題-プログラムから-redis-を使おう"}},[s._v("#")]),s._v(" 応用課題: プログラムから Redis を使おう")]),s._v(" "),a("ul",[a("li",[s._v("それでは、実際にPythonでRedis を利用するコードを書いていきます。")]),s._v(" "),a("li",[s._v("手元の環境で好きなエディタを使って Python のコードを書いた上で docker container の中から そのコードを読み出せるようにします。")]),s._v(" "),a("li",[s._v("事前準備のおさらいも兼ねています")])]),s._v(" "),a("h4",{attrs:{id:"コンテナの中から実行する"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#コンテナの中から実行する"}},[s._v("#")]),s._v(" コンテナの中から実行する")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("どこか作業用のディレクトリを作成してそこに移動してください")]),s._v(" "),a("div",{staticClass:"language-Shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" iij_bootcamp_redis\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" iij_bootcamp_redis\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("プログラムを置く場所として iij_bootcamp_redisの中に app ディレクトリを作成し その中にhello_world.py を作成してください エディタは自由です。")]),s._v(" "),a("div",{staticClass:"language-Shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" app\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" app/hello_world.py\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("div",{staticClass:"language-Python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello World!"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("今いる場所から見ると app/hello_world.py が作られたはずです。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('$ cat app/hello_world.py\nprint("Hello World!")\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ul",[a("li",[s._v("そうでない場合は cd コマンドで 階層を移動して 必ず app ディレクトリのひとつ上の階層に移動してください (例だとiij_bootcamp_redisにいてほしい)")])])]),s._v(" "),a("li",[a("p",[s._v("コンテナ の中から起動")]),s._v(" "),a("ul",[a("li",[s._v("-v で 今いるところの app ディレクトリを コンテナの中では /app に マウントします。"),a("div",{staticClass:"language-Shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -it --rm -v "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("/app:/app python:3.9.5-slim-buster "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[s._v("ls -l で ファイルが有るか確認します。"),a("div",{staticClass:"language-Shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("コンテナ内部 $ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -l /app\ntotal "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n-rw-rw-r-- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" May "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(" 08:37 hello_world.py\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])]),s._v(" "),a("li",[s._v("python で起動します"),a("div",{staticClass:"language-Shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("コンテナ内部: $ python /app/hello_world.py\nHello World"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])]),s._v(" "),a("li",[s._v("うまく Hello World! と表示されたら このコンテナは一旦閉じてしまいましょう"),a("div",{staticClass:"language-Shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("コンテナ内部: $ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])])]),s._v(" "),a("li",[a("p",[s._v("これで、 手元で書いたファイルを コンテナ内のPython から起動することができました。")])])]),s._v(" "),a("h4",{attrs:{id:"redis-server-起動"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#redis-server-起動"}},[s._v("#")]),s._v(" Redis Server 起動")]),s._v(" "),a("ul",[a("li",[s._v("事前準備の通り Redis Server を起動してください。")])]),s._v(" "),a("div",{staticClass:"language-Shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run --rm --name test-server redis:6.2.3-alpine3.13\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[a("code",[s._v("Ready to accept connections")]),s._v(" と出ればOK このターミナルは開いたままにします。")]),s._v(" "),a("li",[s._v("もし、ターミナルが閉じたり、Ctrl-C で終了してしまったら、再度 起動してください")])]),s._v(" "),a("h4",{attrs:{id:"redis-server-接続"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#redis-server-接続"}},[s._v("#")]),s._v(" Redis Server 接続")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("Redis には redis-cli という ツールが有ります。 事前準備では ping などを試しました。")]),s._v(" "),a("ul",[a("li",[s._v("他にも どんな動きがRedis に対して実行されているか知ることができる機能があるので紹介します\n"),a("ul",[a("li",[s._v("ref: "),a("a",{attrs:{href:"https://redis.io/topics/notifications",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://redis.io/topics/notifications"),a("OutboundLink")],1)])])])])]),s._v(" "),a("li",[a("p",[s._v("以下の二通りの接続方法のうち好きな方を選んでください")])])]),s._v(" "),a("div",{staticClass:"language-Shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ネットワーク越し 別コンテナ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -it --link test-server:redis --rm redis:6.2.3-alpine3.13 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" -c "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'exec redis-cli -h "$REDIS_PORT_6379_TCP_ADDR" -p "$REDIS_PORT_6379_TCP_PORT"\'')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 直接 乗り込んで起動")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it test-server redis-cli\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("ul",[a("li",[s._v("エラーメッセージ以外のすべてを通知するように設定")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("127.0.0.1:6379> config set 'notify-keyspace-events' AKE\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("すべてのキーに対して通知を購読")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("127.0.0.1:6379> psubscribe '__key*__:*'\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("最初は真っ黒のままです。 何かしら redis に対して操作を行うと どんなことを行ったのか画面に表示されるようになります。")]),s._v(" "),a("li",[s._v("今は開きっぱなしにしましょう")])]),s._v(" "),a("h4",{attrs:{id:"コンテナの中から-redis-server-へ接続"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#コンテナの中から-redis-server-へ接続"}},[s._v("#")]),s._v(" コンテナの中から Redis Server へ接続")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("次に Redis へ接続するコードを書いてみます。")]),s._v(" "),a("ul",[a("li",[s._v("再度、Pythonのコンテナを起動します。 先ほどと同様 iij_bootcamp_redis の中から実行してください。")])]),s._v(" "),a("div",{staticClass:"language-Shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -it --link test-server:redis --rm --name test-python -v "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("/app:/app python:3.9.5-slim-buster "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("先程と同様に /app には hello_world.py があるはずです")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("コンテナ内部: $ cd /app\nコンテナ内部: $ ls\nhello_world.py\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ul",[a("li",[s._v("さて、今度は redis と接続をするため 事前準備で行ったようにライブラリのインストールをしましょう。\n"),a("ul",[a("li",[s._v("なお、現状 コンテナを起動するたびに 必要ですが 自分でDockerfile を書くなど image を build することで割愛することも可能です")])])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("コンテナ内部: $ pip install redis\nCollecting redis\n  Downloading https://files.pythonhosted.org/packages/ac/a7/cff10cc5f1180834a3ed564d148fb4329c989cbb1f2e196fc9a10fa07072/redis-3.2.1-py2.py3-none-any.whl (65kB)\n     |████████████████████████████████| 71kB 3.2MB/s\nInstalling collected packages: redis\nSuccessfully installed redis-3.2.1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("ul",[a("li",[s._v("先程起動したRedis Server の情報が連携できているか確認します。\n"),a("ul",[a("li",[s._v("細かい値が違くても問題ないです。")])])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("コンテナ内部: $ env | grep REDIS\nREDIS_PORT_6379_TCP_PROTO=tcp\nREDIS_PORT=tcp://172.17.0.2:6379\nREDIS_NAME=/test-python/redis\nREDIS_PORT_6379_TCP_ADDR=172.17.0.2\nREDIS_PORT_6379_TCP=tcp://172.17.0.2:6379\nREDIS_ENV_REDIS_DOWNLOAD_URL=http://download.redis.io/releases/redis-5.0.5.tar.gz\nREDIS_PORT_6379_TCP_PORT=6379\nREDIS_ENV_REDIS_DOWNLOAD_SHA=2139009799d21d8ff94fc40b7f36ac46699b9e1254086299f8d3b223ca54a375\nREDIS_ENV_GOSU_VERSION=1.10\nREDIS_ENV_REDIS_VERSION=5.0.5\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])])])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("Python には 事前準備にも使った対話式のUIがあります。")]),s._v(" "),a("ul",[a("li",[s._v("起動")])]),s._v(" "),a("div",{staticClass:"language-Shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("コンテナ内部: $ python\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("ping してみる。")])]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" redis\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" conn "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("host"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("environ"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'REDIS_PORT_6379_TCP_ADDR'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("environ"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'REDIS_PORT_6379_TCP_PORT'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" db"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" conn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ping"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ul",[a("li",[s._v("事前準備ではここまででした。 それでは実際にこの対話式UIを利用して redis へ書き込みをしてみましょう")])]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v(" 複数データセット"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mset コマンド\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" conn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'key1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'value1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'key2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'value2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v(" 複数データゲット"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mget コマンド\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" conn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mget"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'key1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'key2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("b'value1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("b'value2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v(" 複数データセット"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ゲットを別手法でやってみる "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("mget"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("scan コマンド\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" keys "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" conn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("scan"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("match")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'key*'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" values_1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" conn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mget"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("keys"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("values_1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("b'value1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("b'value2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v(" データを追加して\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" conn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'key1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'value1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'key2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'value2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'id1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ichiro'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'id2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'jiro'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v(" key から始まるキーに紐づく値\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" keys "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" conn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("scan"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("match")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'key*'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" values_1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" conn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mget"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("keys"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("values_1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("b'value1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("b'value2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),s._v(" から始まるキーに紐づく値\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" keys "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" conn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("scan"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("match")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'id*'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" all_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" conn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mget"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("keys"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("all_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("b'ichiro'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("b'jiro'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v(" 複数データ削除"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" delete コマンド\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" _"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" keys "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" conn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("scan"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("match")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'key*'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("conn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mget"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("keys"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("b'value1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("b'value2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ret "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" conn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("delete"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("keys"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("conn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mget"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("keys"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v(" もちろん消してないやつは消えていない\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" _"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" keys "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" conn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("scan"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("match")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'id*'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("conn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mget"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("keys"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("b'ichiro'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("b'jiro'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])])])]),s._v(" "),a("h4",{attrs:{id:"要素を入れてみる"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#要素を入れてみる"}},[s._v("#")]),s._v(" 要素を入れてみる")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("普通に List や Hash として使って、適当に要素を入れてみよう")]),s._v(" "),a("ul",[a("li",[s._v("/etc/services の ポート -> プロトコル名称 対応表を作る")])]),s._v(" "),a("div",{staticClass:"language-Python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1/tcp'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'tcpmux'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'7/tcp'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'echo'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'7/udp'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'echo'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'9/tcp'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'discard'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sink'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'null'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'9/udp'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'discard'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sink'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'null'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'11/tcp'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'systat'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'users'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ...")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("サンプル: "),a("a",{attrs:{href:"https://github.com/iij/bootcamp/blob/master/src/database/redis/ex01.py",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/iij/bootcamp/blob/master/src/database/redis/ex01.py"),a("OutboundLink")],1)]),s._v(" "),a("ul",[a("li",[s._v("/etc/passwd の内容をユーザごとのハッシュに格納する")])]),s._v(" "),a("div",{staticClass:"language-Python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'root'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'passwd'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'x'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'uid'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'0'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'gid'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'0'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'name'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'root'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'home'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/root'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'shell'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/bin/bash'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'daemon'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'passwd'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'x'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'uid'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'gid'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'name'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'daemon'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'home'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/usr/sbin'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'shell'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/usr/sbin/nologin'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ...")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("サンプル: "),a("a",{attrs:{href:"https://github.com/iij/bootcamp/blob/master/src/database/redis/ex02.py",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/iij/bootcamp/blob/master/src/database/redis/ex02.py"),a("OutboundLink")],1)])])]),s._v(" "),a("h3",{attrs:{id:"expire-を試してみる"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#expire-を試してみる"}},[s._v("#")]),s._v(" Expire を試してみる")]),s._v(" "),a("ul",[a("li",[s._v("expire 付きで値を格納し、実際にその時間が過ぎると値が消えていくことを確認する\nサンプル: "),a("a",{attrs:{href:"https://github.com/iij/bootcamp/blob/master/src/database/redis/ex03.py",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/iij/bootcamp/blob/master/src/database/redis/ex03.py"),a("OutboundLink")],1)])]),s._v(" "),a("h3",{attrs:{id:"メッセージキューを実装する"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#メッセージキューを実装する"}},[s._v("#")]),s._v(" メッセージキューを実装する")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("メッセージキュー的なものを実装してみよう")]),s._v(" "),a("ul",[a("li",[s._v("依頼側: ランダム秒 sleep して、メッセージをキューに入れる")]),s._v(" "),a("li",[s._v("取り出し側: ランダム秒 sleep して、メッセージをキューから取り出す")])])]),s._v(" "),a("li",[a("p",[s._v("使用例: web クローラー")]),s._v(" "),a("ul",[a("li",[s._v("依頼側: URL をどんどんキューに入れる")]),s._v(" "),a("li",[s._v("取り出し側: キューを見て URL が入っていたら、取得してファイルに保存する\n"),a("ul",[a("li",[s._v("結果(ファイルの場所)を別のキューで戻してもいいですね")])])])])])]),s._v(" "),a("h3",{attrs:{id:"advanced-redis-pub-sub-streams-を使ってみよう"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#advanced-redis-pub-sub-streams-を使ってみよう"}},[s._v("#")]),s._v(" Advanced: Redis Pub/Sub, Streams を使ってみよう")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://redis.io/topics/pubsub",target:"_blank",rel:"noopener noreferrer"}},[s._v("Pub/Sub"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://redis.io/topics/streams-intro",target:"_blank",rel:"noopener noreferrer"}},[s._v("Introduction to Redis Streams"),a("OutboundLink")],1)])]),s._v(" "),a("h3",{attrs:{id:"advanced-gis-で遊んでみよう"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#advanced-gis-で遊んでみよう"}},[s._v("#")]),s._v(" Advanced: GIS で遊んでみよう")]),s._v(" "),a("ul",[a("li",[s._v("今どき オープンデータとして 様々な施設の座標を公開している自治体があります。")]),s._v(" "),a("li",[s._v("jupyter nodebook では csv の 処理などはとても簡便にすることができます")]),s._v(" "),a("li"),s._v(" "),a("li",[s._v("redis.geoadd で登録: "),a("a",{attrs:{href:"https://redis-py.readthedocs.io/en/stable/#redis.Redis.geoadd",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://redis-py.readthedocs.io/en/stable/#redis.Redis.geoadd"),a("OutboundLink")],1)]),s._v(" "),a("li",[s._v("redis.georadius で検索が可能です。:"),a("a",{attrs:{href:"https://redis-py.readthedocs.io/en/stable/#redis.Redis.georadius",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://redis-py.readthedocs.io/en/stable/#redis.Redis.georadius"),a("OutboundLink")],1)])]),s._v(" "),a("h2",{attrs:{id:"参考資料"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考資料"}},[s._v("#")]),s._v(" 参考資料")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://redis.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Redis 本家"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/andymccurdy/redis-py",target:"_blank",rel:"noopener noreferrer"}},[s._v("Redis Python Client"),a("OutboundLink")],1)])]),s._v(" "),a("credit-footer")],1)}),[],!1,null,null,null);a.default=e.exports}}]);