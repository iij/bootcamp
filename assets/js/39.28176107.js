(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{512:function(s,a,t){"use strict";t.r(a);var n=t(10),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"_2-インベントリ-の作成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-インベントリ-の作成"}},[s._v("#")]),s._v(" 2. インベントリ の作成")]),s._v(" "),a("h3",{attrs:{id:"インベントリとは何か"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#インベントリとは何か"}},[s._v("#")]),s._v(" インベントリとは何か？")]),s._v(" "),a("p",[s._v("Ansibleを実行する為にはまずインベントリを作成しなければなりません。\nでは、Ansibleインベントリとはなんでしょうか。")]),s._v(" "),a("p",[s._v("Ansibleのインベントリは、管理対象のノード（ホスト）のリストまたはリストのグループです。\nインベントリを使用することで、複数のホストに対して同時にタスクを実行できます。\nインベントリは、静的ファイルとして定義することも、動的に生成することも可能です。")]),s._v(" "),a("p",[s._v("インベントリでは管理ホストをグループに割り当てることが可能なほか\nグループは子グループを含むことも可能で、ホストは複数のグループのメンバーになることができます。\nまた、インベントリでは、それが定義するホストとグループに適用される、変数の設定も行います。")]),s._v(" "),a("h3",{attrs:{id:"インベントリを作成する"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#インベントリを作成する"}},[s._v("#")]),s._v(" インベントリを作成する")]),s._v(" "),a("p",[s._v("では、実際に Inventory ファイルと呼ばれる物を作成します。\nAnsible において、Inventory ファイルは対象を示していて実行に欠かせない要素です。")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/iij/ansible-exercise",target:"_blank",rel:"noopener noreferrer"}},[s._v("教材"),a("OutboundLink")],1),s._v("のフォルダには ansible フォルダの配下にインベントリファイルを置くためのフォルダ（inventories）があります。\n試しに開いてみましょう。")]),s._v(" "),a("p",[s._v("Ansible の Inventory ファイルは INI 形式に近い記述によって作成されます。\nインベントリファイルの括弧内の見出し("),a("code",[s._v("[app]")]),s._v("など)はグループ名を表し、\nホストをグルーピングすることができます。\nなお、[]に属さないホストはデフォルトである"),a("code",[s._v("all")]),s._v("グループに属することになります。")]),s._v(" "),a("h2",{attrs:{id:"演習-インベントリの作成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#演習-インベントリの作成"}},[s._v("#")]),s._v(" [演習]インベントリの作成")]),s._v(" "),a("p",[s._v("では、実際にインベントリファイルを作成してみましょう。\n"),a("code",[s._v("hosts")]),s._v(" というファイルを作成し "),a("code",[s._v("host00")]),s._v(", "),a("code",[s._v("host01")]),s._v(" を追加します。\nグループ名は"),a("code",[s._v("exercise")]),s._v("として下さい。")]),s._v(" "),a("ul",[a("li",[s._v("inventoryファイルを作成する"),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" hosts\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[s._v("記載内容"),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("exercise"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nhost00\nhost01\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])]),s._v(" "),a("li",[s._v("インベントリの動作確認\n"),a("ul",[a("li",[s._v("先ほど作成したインベントリが正しいことを確かめるために、"),a("code",[s._v("ansible")]),s._v("コマンドで ping モジュールを実行してみます。 コマンドと実行結果は下記のようになるはずです。"),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ansible -i hosts exercise -m "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" -k\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[s._v("パスワードを聞かれるため事前準備で設定したパスワード(ansible)を入力します")])])]),s._v(" "),a("li",[s._v("出力結果"),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("host01 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" SUCCESS "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ansible_facts"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"discovered_interpreter_python"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/bin/python"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"changed"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ping"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pong"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nhost00 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" SUCCESS "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ansible_facts"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"discovered_interpreter_python"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/bin/python"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"changed"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ping"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pong"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])])])]),s._v(" "),a("p",[s._v("正しく実行されれば "),a("em",[s._v("SUCCESS")]),s._v(" と出力されます。")]),s._v(" "),a("h2",{attrs:{id:"発展演習-不要エントリのコメントアウト"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#発展演習-不要エントリのコメントアウト"}},[s._v("#")]),s._v(" [発展演習] 不要エントリのコメントアウト")]),s._v(" "),a("h3",{attrs:{id:"想定シナリオ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#想定シナリオ"}},[s._v("#")]),s._v(" 想定シナリオ")]),s._v(" "),a("p",[s._v("先ほど作ったインベントリファイルですが、こんなケースは考えられないでしょうか。\nあるプロジェクトで、インベントリファイルに不要なホストエントリが含まれていることが判明しました。\nこれらのホストは現在使用されておらず、誤ってタスクが実行されるのを防ぐためにコメントアウトする必要があります。")]),s._v(" "),a("p",[s._v("デプロイの対象から特定のホストを除外するのはエントリを削除すれば良いのですが\n一時的な除外のためにエントリを削除してしまったのでは、元に戻すときに苦労してします。\n従って、そのような時のためにコメントアウトによる除外を試してみましょう。")]),s._v(" "),a("ul",[a("li",[s._v("インベントリファイルの確認:\n"),a("ul",[a("li",[s._v("現在のインベントリファイルを確認し、不要なホストエントリを特定します。"),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("exercise"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nhost00\nhost01\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])])])]),s._v(" "),a("li",[s._v("不要なホストエントリをコメントアウトします。"),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("exercise"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nhost00\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# host01")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])]),s._v(" "),a("li",[s._v("コメントアウトしたホストが正しく実行対象から外れていることを確認します。\n"),a("ul",[a("li",[s._v("以下のコマンドを使用して、インベントリの内容を確認します。"),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ansible-inventory --list -i hosts\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])])]),s._v(" "),a("li",[s._v("出力結果に host01 が"),a("strong",[s._v("含まれていないこと")]),s._v("を確認します。")])]),s._v(" "),a("h2",{attrs:{id:"発展演習-インベントリを-yaml-で書く"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#発展演習-インベントリを-yaml-で書く"}},[s._v("#")]),s._v(" [発展演習] インベントリを YAML で書く")]),s._v(" "),a("p",[s._v("Ansible のターゲットホストの情報を定義するインベントリファイルは、INI 形式の他にも YAML 形式でも定義できす。")]),s._v(" "),a("p",[s._v("先ほど利用した INI 形式の Inventory ファイルを YAML 形式で記述すると以下の通りになります。\nYAML 形式で記述すると全てのグループが"),a("code",[s._v("all")]),s._v("グループの配下にあることが分かります。")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("children")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("exercise")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host01")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("なお、YAML書式についてはiniファイルのインベントリファイルがあれば以下のようなコマンドで作成することが可能です")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ansible-inventory -i inventories/hosts --list -y\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);