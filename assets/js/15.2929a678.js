(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{377:function(s,a,t){s.exports=t.p+"assets/img/otel-diagram.6d9ff7ef.svg"},378:function(s,a,t){s.exports=t.p+"assets/img/todo-app-architecture.5f491bd4.svg"},379:function(s,a,t){s.exports=t.p+"assets/img/jaeger_search.c3e0a9e8.png"},380:function(s,a,t){s.exports=t.p+"assets/img/jaeger_create_task.7d29bc4b.png"},381:function(s,a,t){s.exports=t.p+"assets/img/jaeger_update_task.dc10596f.png"},552:function(s,a,t){"use strict";t.r(a);var e=t(16),r=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("header-table"),s._v(" "),a("h1",{attrs:{id:"opentelemetry-ハンズオン"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#opentelemetry-ハンズオン"}},[s._v("#")]),s._v(" OpenTelemetry ハンズオン")]),s._v(" "),a("h2",{attrs:{id:"はじめに"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#はじめに"}},[s._v("#")]),s._v(" はじめに")]),s._v(" "),a("h3",{attrs:{id:"受講対象者"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#受講対象者"}},[s._v("#")]),s._v(" 受講対象者")]),s._v(" "),a("ul",[a("li",[s._v("現代の監視についてどのような監視方法があるのかわからない")]),s._v(" "),a("li",[s._v("OpenTelemetryという言葉は知っているけど、実際に触ったことがない")])]),s._v(" "),a("h3",{attrs:{id:"前提知識"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前提知識"}},[s._v("#")]),s._v(" 前提知識")]),s._v(" "),a("p",[s._v("本講義では事前知識なしでも講義を進められるように心がけていますが、以下の点を抑えておくことで手を動かしつつ理解を深めることができます。")]),s._v(" "),a("ul",[a("li",[s._v("Dockerの基本知")]),s._v(" "),a("li",[s._v("Linuxの基礎知識（コマンド実行程度）")])]),s._v(" "),a("h3",{attrs:{id:"講義の目的"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#講義の目的"}},[s._v("#")]),s._v(" 講義の目的")]),s._v(" "),a("p",[s._v("講義の目的について説明します。")]),s._v(" "),a("p",[s._v("本講義では、OpenTelemetryについてハンズオンを通して理解を深めることを目的としています。")]),s._v(" "),a("p",[s._v("具体的なOpenTelemetryのアプリケーションへの実装方法についてまではここでは触れません。\nまた、本番環境でどのような運用をすることで効果的なOpenTelemetryの利用となるのかの説明も本講義のスコープ外とします。")]),s._v(" "),a("p",[s._v("あくまでもデモ用に用意したOpenTelemetry実装済みのアプリケーションを動かしてどのようなデータ、分析ができるのかを学習するためにあります。")]),s._v(" "),a("h2",{attrs:{id:"事前準備"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事前準備"}},[s._v("#")]),s._v(" 事前準備")]),s._v(" "),a("p",[s._v("本講義ではハンズオン用に用意したアプリケーションを実際に動かしながら進める講義です。")]),s._v(" "),a("p",[s._v("以下のコマンドを実行してサンプルアプリケーションを立ち上げてください。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/tamago0224/todo-with-gemini\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" todo-with-gemini\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" compose up "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--build")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h2",{attrs:{id:"opentelemetryとは"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#opentelemetryとは"}},[s._v("#")]),s._v(" OpenTelemetryとは")]),s._v(" "),a("p",[s._v("オブザーバビリティのためのフレームワークであり、トレース、メトリクス、ログといったテレメトリデータ生成、エクスポート、収集を行うための統一された処理を提供します。")]),s._v(" "),a("h3",{attrs:{id:"現在のアプリケーションの設計について"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#現在のアプリケーションの設計について"}},[s._v("#")]),s._v(" 現在のアプリケーションの設計について")]),s._v(" "),a("p",[s._v("昔のアプリケーションはおおよそ単一のWEBサーバとデータベースのようなシンプルな形で提供されてきた。")]),s._v(" "),a("p",[s._v("しかし、昨今のクラウドネイティブなアプリケーションの登場や大規模化により、１つのシステムでも複数のサーバから構成される形式となっていた。\nこういった形になると、従来のログとメトリクスによる監視だけではエラーが発生した場合にどこでどういった原因のエラーが発生したのかを把握するのが難しい。")]),s._v(" "),a("p",[s._v("そこで、登場したのがオブザーバビリティという概念です。")]),s._v(" "),a("h3",{attrs:{id:"オブザーバビリティとは"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#オブザーバビリティとは"}},[s._v("#")]),s._v(" オブザーバビリティとは")]),s._v(" "),a("p",[s._v("システムの出力を調べることで、システムの外側から内部状態を理解する能力のこと。\nこの能力があることで、未知の問題に対するトラブルシューティングが可能になります。")]),s._v(" "),a("p",[s._v("これは監視の文脈では最初に出たトレース、メトリクス、ログといった３つのテレメトリデータを調べることで可能としています。")]),s._v(" "),a("p",[s._v("ただし、システムがオブザーバビリティがある状態というためにはアプリケーションが適切に計装されていることが前提です。\n計装されている、とは前述した３つのシグナルをアプリケーションが出力している状態のことです。\nこれらの出力されたテレメトリデータがオブザーバビリティバックエンドに送信されて可視化されることで真価を発揮します。")]),s._v(" "),a("p",[s._v("OpenTelemetryはこれらの３つのシグナルをアプリケーションに計装するための仕組みです。")]),s._v(" "),a("h4",{attrs:{id:"トレースとは"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#トレースとは"}},[s._v("#")]),s._v(" トレースとは")]),s._v(" "),a("p",[s._v("アプリケーションがリクエストを受けた際に、内部で何が起こるのかを教えてくれる機能。\nリクエストがシステム内でどのような経路をたどるのかを理解するためには不可欠なものです")]),s._v(" "),a("h4",{attrs:{id:"メトリクスとは"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#メトリクスとは"}},[s._v("#")]),s._v(" メトリクスとは")]),s._v(" "),a("p",[s._v("取得時点におけるサービスの状態を数値で計測・記録したもの。\n数値以外にもその値をキャプチャした時刻とその他メタデータから構成される。")]),s._v(" "),a("h4",{attrs:{id:"ログとは"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ログとは"}},[s._v("#")]),s._v(" ログとは")]),s._v(" "),a("p",[s._v("構造化、または非構造化されたタイムスタンプ付きのテキストレコードのこと。\nOpenTelemetryでのログサポートは、追加のメタデータを追加したり、様々なソースから共通のフォーマットに解析・変換するための方法を提供します。")]),s._v(" "),a("h2",{attrs:{id:"opentelemetryのアーキテクチャ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#opentelemetryのアーキテクチャ"}},[s._v("#")]),s._v(" OpenTelemetryのアーキテクチャ")]),s._v(" "),a("p",[a("img",{attrs:{src:t(377),alt:"OpenTelemetryアーキテクチャ"}})]),s._v(" "),a("blockquote",[a("p",[a("a",{attrs:{href:"https://opentelemetry.io/ja/docs/",target:"_blank",rel:"noopener noreferrer"}},[s._v("OpenTelemetry ドキュメント"),a("OutboundLink")],1),s._v("より引用")])]),s._v(" "),a("h2",{attrs:{id:"ハンズオン"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ハンズオン"}},[s._v("#")]),s._v(" ハンズオン")]),s._v(" "),a("h3",{attrs:{id:"今回利用するアプリケーションについて"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#今回利用するアプリケーションについて"}},[s._v("#")]),s._v(" 今回利用するアプリケーションについて")]),s._v(" "),a("p",[s._v("今回利用するアプリケーションはユーザ認証付きのTODOアプリになります。\nユーザはログイン後、TODOタスクを追加・更新・削除することが可能です。")]),s._v(" "),a("p",[s._v("以下にアプリケーションの簡単な設計図を示します。")]),s._v(" "),a("p",[a("img",{attrs:{src:t(378),alt:"TODOアプリのアーキテクチャ"}})]),s._v(" "),a("p",[s._v("そして内部的な設計の話になりますが、本アプリケーションではMVCアーキテクチャを用いており、処理の流れとしてController層、Service層、Repository層を流れるようになっています。")]),s._v(" "),a("p",[s._v("大まかな流れとしては\nリクエストをControllerで受け取り、Serviceで必要な処理を実装し、Repostiroyでデータベースへのアクセスなどを請け負う形となっています。")]),s._v(" "),a("p",[s._v("もし何かしらの名前にXXXControllerやXXXServiceがついている場合はその処理におけるレイヤーを表していると見てください。")]),s._v(" "),a("p",[s._v("OpenTelemetryが提供するテレメトリについては前述した３つがありますが、今回のハンズオンではその中でもトレースについて重点を置いて確認していきます。")]),s._v(" "),a("h3",{attrs:{id:"ユーザの作成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ユーザの作成"}},[s._v("#")]),s._v(" ユーザの作成")]),s._v(" "),a("p",[s._v("アプリケーションでログインするためにまずはユーザの作成を行います。\n以下のコマンドを実行し、ユーザを作成してください。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-H")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Content-Type: application/json"')]),s._v(" http://localhost:8080/signup "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-XPOST")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{"username":"user1","password":"pass"}\'')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"message"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"User created successfully"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("ユーザの成功を表すメッセージが上記の通り表示されると思います。\nこれでユーザの作成は完了です。")]),s._v(" "),a("h3",{attrs:{id:"ログイン"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ログイン"}},[s._v("#")]),s._v(" ログイン")]),s._v(" "),a("p",[s._v("次に作成したユーザでログインします。\n以下のコマンドを実行し、ログインしてください。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-H")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Content-Type: application/json"')]),s._v(" http://localhost:8080/login "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-XPOST")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{"username":"user1","password":"pass"}\'')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"token"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"your-token"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("ログインに成功すると上記のようなJSONが返ってきます。\nこの"),a("code",[s._v("your-token")]),s._v("に当たるところをメモしておいてください。\nこれからこの文字列を使ってリクエストを送るので、使い回すためです。")]),s._v(" "),a("p",[s._v("この文字列自体は皆さんの環境によって異なるので、完全に一致している必要はありません。")]),s._v(" "),a("h3",{attrs:{id:"タスクを登録する"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#タスクを登録する"}},[s._v("#")]),s._v(" タスクを登録する")]),s._v(" "),a("p",[s._v("以下のコマンドでタスクを登録してみましょう。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-H")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Content-Type: application/json"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-H")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Authorization: Bearer your-token"')]),s._v(" http://localhost:8080/api/tasks "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-XPOST")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{"title":"task1","completed":false}\'')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"id"')]),s._v(":1,"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user_id"')]),s._v(":1,"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"title"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"task1"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"completed"')]),s._v(":false"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("⏎\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("成功するとタスクの内容が返ってくると思います。\n"),a("code",[s._v("id")]),s._v("や"),a("code",[s._v("user_id")]),s._v("は皆さんの環境によって変わってくるので上記の内容と異なっていても問題ありません。")]),s._v(" "),a("p",[s._v("それでは、成功したら実際にOpenTelemetryによって出力されたトレースについて見てみましょう。")]),s._v(" "),a("h3",{attrs:{id:"タスクを登録した際のトレースを確認する"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#タスクを登録した際のトレースを確認する"}},[s._v("#")]),s._v(" タスクを登録した際のトレースを確認する")]),s._v(" "),a("p",[s._v("OpenTelemetryは仕様としてトレースの可視化まではサポートしていません。\nそこで今回はJaegerを可視化ツールとして利用します。")]),s._v(" "),a("p",[s._v("アプリケーションの起動とともに、以下のURLからJaegerのWEB UIにアクセスすることができるため、ブラウザを起動してアクセスしてください。")]),s._v(" "),a("p",[a("code",[s._v("http://<url>:16686/search")])]),s._v(" "),a("p",[s._v("すると、以下のような画面が表示されると思います。")]),s._v(" "),a("p",[a("img",{attrs:{src:t(379),alt:"Jaeger 検索画面"}})]),s._v(" "),a("p",[s._v("画面左にある"),a("code",[s._v("Serivce")]),s._v("から、"),a("code",[s._v("unknown_service:backend")]),s._v("という項目を選択できると思うので、選択後、"),a("code",[s._v("Find Traces")]),s._v("ボタンを押してください。")]),s._v(" "),a("p",[s._v("すると、いくつか検索結果が表示されると思います。\nその中から"),a("code",[s._v("unknown_service:backend:POST /api/tasks")]),s._v("を選択してください。もし複数同じタイトルが表示されているようでしたら右側に表示されている時刻が最も新しいものを選択してください。")]),s._v(" "),a("p",[s._v("すると、以下のような画面が表示されるはずです。")]),s._v(" "),a("p",[a("img",{attrs:{src:t(380),alt:"Jaeder タスク作成トレース"}})]),s._v(" "),a("p",[s._v("なにやら4本ほどの横線が確認できると思います。このラインをトレースではスパンと呼びます。")]),s._v(" "),a("p",[s._v("1番上のスパンが"),a("code",[s._v("POST /api/tasks")]),s._v("とあるように、リクエスト全体を表すものになります。")]),s._v(" "),a("p",[s._v("2番目のスパンが"),a("code",[s._v("TaskController.CreateTask")]),s._v("とあるように、リクエストを受け付けて後続の処理を呼び出すController層の処理になります。")]),s._v(" "),a("p",[s._v("3番目のスパンが"),a("code",[s._v("TaskService.CreateTask")]),s._v("とあるので、ControllerからSerivce層の処理を呼び出してそこでかかった処理になります。")]),s._v(" "),a("p",[s._v("そして最後のスパンが"),a("code",[s._v("TaskRepository.CreateTask")]),s._v("とあるため、Serviceからデータベース操作の処理であるRepositoryを呼び出してかかった処理になります。")]),s._v(" "),a("p",[s._v("そして、このリクエストが成功しているかどうかは、一番上のスパンをクリックすることでスパンの詳細を確認できます。\nスパンには様々なメタ属性が追加されているので、その中のHTTPステータスコードを見ればリクエストが成功しているかどうか確認できます。")]),s._v(" "),a("p",[s._v("このようにして、トレースによってリクエストが各処理でどの程度処理の時間がかかったのか、どのようなステータスコードを返したのかが可視化されるようになります。")]),s._v(" "),a("h3",{attrs:{id:"タスクの状態を更新する"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#タスクの状態を更新する"}},[s._v("#")]),s._v(" タスクの状態を更新する")]),s._v(" "),a("p",[s._v("続いて、タスクの状態を更新してみます。")]),s._v(" "),a("p",[s._v("タスクには完了済みかどうかを表すフラグが存在するため、フラグを完了済みに更新するリクエストを送りましょう。")]),s._v(" "),a("p",[s._v("以下のコマンドで対象のタスクを更新できます。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# タスクのIDが必要なので一度GETして更新したいタスクのIDを確認する")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-H")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Content-Type: application/json"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-H")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Authorization: Bearer your-token"')]),s._v(" http://localhost:8080/api/tasks "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-XGET")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"id"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user_id"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"title"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"task1"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"completed"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("上記のようなJSONが返ってくるはずです。"),a("code",[s._v("id")]),s._v("や"),a("code",[s._v("user_id")]),s._v("は人によって異なる値になるかもしれませんが、今回必要なのは"),a("code",[s._v("id")]),s._v("の値なので、こちらをメモっておいてください。\nもし、複数出てきた場合は一番上の"),a("code",[s._v("id")]),s._v("をメモしておきましょう。")]),s._v(" "),a("p",[s._v("それでは実際に更新リクエストを送ってみます。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-H")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Content-Type: application/json"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-H")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Authorization: Bearer your-token"')]),s._v(" http://localhost:8080/api/tasks/1 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-XPUT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{"title":"task1","completed":true}\'')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"message"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Task updated successfully"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("もう一度GETしてみると"),a("code",[s._v("completed")]),s._v("の値がfalseからtrueに変わっていることがわかります。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-H")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Content-Type: application/json"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-H")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Authorization: Bearer your-token"')]),s._v(" http://localhost:8080/api/tasks "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-XGET")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"id"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user_id"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"title"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"task1"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"completed"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h3",{attrs:{id:"タスク更新のトレース情報を確認する"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#タスク更新のトレース情報を確認する"}},[s._v("#")]),s._v(" タスク更新のトレース情報を確認する")]),s._v(" "),a("p",[s._v("それではタスクの更新のトレースを見てみましょう。")]),s._v(" "),a("p",[s._v("今回も同じようにJaegerの画面にアクセスして、"),a("code",[s._v("Serivce")]),s._v("から"),a("code",[s._v("unknown_service:backend")]),s._v("を選択して"),a("code",[s._v("Find Traces")]),s._v("ボタンを押してください。")]),s._v(" "),a("p",[s._v("今度は"),a("code",[s._v("PUT /api/tasks/:id")]),s._v("という項目があると思うのでそちらをクリックしてください。\n以下のような画面が確認できると思います。\nこちらも前回タスク作成の画面で見たものとおおよそ同じ内容が表示されています。")]),s._v(" "),a("p",[a("img",{attrs:{src:t(381),alt:"Jaeger タスク更新"}})]),s._v(" "),a("h2",{attrs:{id:"まとめ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#まとめ"}},[s._v("#")]),s._v(" まとめ")]),s._v(" "),a("p",[s._v("OpenTelemeryのハンズオンを通して以下のことが理解できるようになったと思います。")]),s._v(" "),a("ul",[a("li",[s._v("OpenTelemetryの概要")]),s._v(" "),a("li",[s._v("システムの処理の可視化\n"),a("ul",[a("li",[s._v("今回はトレースを通してリクエストの処理を可視化しましたが、ログにtrace_idを表示させることで、リクエストのとレースとログを一意に紐づけることもできます。")])])]),s._v(" "),a("li",[s._v("問題の迅速な特定\n"),a("ul",[a("li",[s._v("処理がどこまで進んだのかわかるため、ソースコード見ずともおおよその発生源を特定することができます")])])]),s._v(" "),a("li",[s._v("パフォーマンス調査\n"),a("ul",[a("li",[s._v("リクエストで各処理がどの程度かかっているのかを可視化できているので時間がかかっている箇所の特定が容易")])])])]),s._v(" "),a("credit-footer")],1)}),[],!1,null,null,null);a.default=r.exports}}]);