(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{466:function(s,t,a){"use strict";a.r(t);var n=a(10),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"fastapi入門-fastapiを使ったwebapiサーバ作り"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#fastapi入門-fastapiを使ったwebapiサーバ作り"}},[s._v("#")]),s._v(" FastAPI入門（FastAPIを使ったWebAPIサーバ作り)")]),s._v(" "),t("h2",{attrs:{id:"はじめに"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#はじめに"}},[s._v("#")]),s._v(" はじめに")]),s._v(" "),t("p",[s._v("この講義ではハンズオン形式でFastAPIについて学びます。\n講義を受けるにあたり、事前に環境準備が必要です。")]),s._v(" "),t("p",[s._v("講義当日までにハンズオン事前準備を終え、Dockerが実行可能な環境を整えてください。\nまた、FastAPIはPython製のWebフレームワークのため、ある程度Pythonを触ったことがある方を想定しています。\n従って本項では、Pythonの基本的な文法や書き方などについては扱いません。")]),s._v(" "),t("p",[s._v("また、Web APIについてもハンズオンで扱う限りにおいては解説をしますが、基本的なRDBMS・HTTPに関する知識についても体系だった説明は行いません。予めご了承ください。")]),s._v(" "),t("h2",{attrs:{id:"fastapi概要"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#fastapi概要"}},[s._v("#")]),s._v(" FastAPI概要")]),s._v(" "),t("p",[s._v("公式ドキュメント: "),t("a",{attrs:{href:"https://fastapi.tiangolo.com/ja/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://fastapi.tiangolo.com/ja/"),t("OutboundLink")],1)]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("FastAPI は、Pythonの標準である型ヒントに基づいてPython 3.6 以降でAPI を構築するための、\nモダンで、高速(高パフォーマンス)な、Web フレームワークです。\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("FastAPIとは、Python、特に3.5から導入されたtypehintと、ASGIサーバへの対応を強く意識したWebフレームワークです。")]),s._v(" "),t("p",[s._v("Pythonは元来、動的型言語、と言うことで長らく型を意識すること無くコードが書かれていましたが\n3.5以降、急速に型を意識するようになっています。\nFastAPIはその流れにいち早く対応し、"),t("code",[s._v("高速")]),s._v("、"),t("code",[s._v("堅牢")]),s._v("を実現するために最小限の構造とtypehintを元に\nvalidationを強く意識した構造になっています。")]),s._v(" "),t("h2",{attrs:{id:"開発環境の作成"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#開発環境の作成"}},[s._v("#")]),s._v(" 開発環境の作成")]),s._v(" "),t("p",[s._v("すでにPython3.8以上 + IDE 環境を構築済みの方は本項を読み飛ばして構いませんが、\nここではWindowsユーザ向けに環境作りの一例を示しておきます。")]),s._v(" "),t("h3",{attrs:{id:"ubuntu-のインストール"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ubuntu-のインストール"}},[s._v("#")]),s._v(" Ubuntu のインストール")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://ubuntu.com/tutorials/install-ubuntu-on-wsl2-on-windows-10#1-overview",target:"_blank",rel:"noopener noreferrer"}},[s._v("Install Ubuntu on WSL2"),t("OutboundLink")],1),s._v("、または"),t("a",{attrs:{href:"https://docs.microsoft.com/ja-jp/windows/wsl/install",target:"_blank",rel:"noopener noreferrer"}},[s._v("WSL のインストール"),t("OutboundLink")],1),s._v("を参考にWSL2上にUbuntuをインストールします。")]),s._v(" "),t("p",[s._v("2022年6月現在においては"),t("strong",[s._v("Ubuntu 22.04 LTS")]),s._v("を選択すると良いでしょう。")]),s._v(" "),t("h3",{attrs:{id:"vscode-remote-wsl2-の導入"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#vscode-remote-wsl2-の導入"}},[s._v("#")]),s._v(" VScode - Remote-WSL2 の導入")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://docs.microsoft.com/ja-jp/windows/wsl/tutorials/wsl-vscode",target:"_blank",rel:"noopener noreferrer"}},[s._v("Linux 用 Windows サブシステムで Visual Studio Code の使用を開始する"),t("OutboundLink")],1),s._v("を参考にvscode上でUbuntuが操作できるようにします。")]),s._v(" "),t("h3",{attrs:{id:"python3-9-のインストール"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#python3-9-のインストール"}},[s._v("#")]),s._v(" Python3.9 のインストール")]),s._v(" "),t("h2",{attrs:{id:"fastapiのインストール・動作確認"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#fastapiのインストール・動作確認"}},[s._v("#")]),s._v(" FastAPIのインストール・動作確認")]),s._v(" "),t("p",[s._v("開発環境の準備ができたならば、いよいよFastAPIを使った開発を行います。\nまずは、FastAPIをインストールします。")]),s._v(" "),t("p",[s._v("Pythonのパッケージ管理を厳格に行うのであれば"),t("strong",[s._v("poetry")]),s._v("等を使う事が好ましいのですが、本項とは主旨が外れるため、今回は\n"),t("a",{attrs:{href:"https://fastapi.tiangolo.com/ja/",target:"_blank",rel:"noopener noreferrer"}},[s._v("公式ドキュメント"),t("OutboundLink")],1),s._v("にそのまま従ってインストールしてみましょう。")]),s._v(" "),t("h3",{attrs:{id:"fastapi-uvicornのインストール"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#fastapi-uvicornのインストール"}},[s._v("#")]),s._v(" FastAPI/uvicornのインストール")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v(" pip3 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" fastapi\n pip3 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" uvicorn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("standard"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"fastapiを使ったapiサーバの開発"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#fastapiを使ったapiサーバの開発"}},[s._v("#")]),s._v(" FastAPIを使ったAPIサーバの開発")]),s._v(" "),t("h3",{attrs:{id:"トップページの作成"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#トップページの作成"}},[s._v("#")]),s._v(" トップページの作成")]),s._v(" "),t("p",[s._v("インストールが完了したら次にFastAPI用のコードを作成します。\n公式ドキュメントの通りmain.pyというファイルを作成し、以下のようにコードを書いてみましょう。")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" fastapi "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" FastAPI\n\napp "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" FastAPI"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[s._v("@app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("read_root")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"World"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("よく分からない方は"),t("a",{attrs:{href:"%5Bfastapi/sample%5D(https://github.com/iij/bootcamp/tree/master/src/server-app/fastapi/sample)"}},[s._v("sample")]),s._v("ディレクトリに作成済みのサンプルファイルがあるので参考にしてください。")]),s._v(" "),t("h3",{attrs:{id:"api-fastapi-の起動"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#api-fastapi-の起動"}},[s._v("#")]),s._v(" API(FastAPI)の起動")]),s._v(" "),t("p",[t("code",[s._v("main.py")]),s._v("ファイルが作成できたら起動してみましょう。\n起動には先ほどインストールした"),t("code",[s._v("uvicorn")]),s._v("(コマンド)に"),t("code",[s._v("main:app")]),s._v("を引数として渡して実行します。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ uvicorn main:app\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("正常に起動した場合、そのまま以下のように出力され "),t("code",[s._v("http://127.0.0.1:8000")]),s._v("と表示されます。\nここまでくれば無事に起動しています。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("INFO:     Started server process [1990921]\nINFO:     Waiting for application startup.\nINFO:     Application startup complete.\nINFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("なお、上記のコマンドではターミナルがそのままフォアグラウンドで動き続けてしまうため、\n動作確認は別のターミナルを起動する必要があります。\n別ターミナルを起動したら、curlコマンドでアクセスしてみましょう。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" --noproxy "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 http://127.0.0.1:8000\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"World"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("main.pyに記載した Hello Worldの出力と同時にFastAPIのコンソールにもアクセスログが出力されます。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("INFO:     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:60100 - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET / HTTP/1.1"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" OK\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("ひとまずここまでできればFastAPIの実行環境としては十分になりました。\n終了には"),t("code",[s._v("Ctrl+c")]),s._v("で止めてください。")]),s._v(" "),t("h3",{attrs:{id:"swagger-ドキュメントの確認"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#swagger-ドキュメントの確認"}},[s._v("#")]),s._v(" swagger ドキュメントの確認")]),s._v(" "),t("p",[s._v("FastAPIには"),t("code",[s._v("swagger-ui")]),s._v("が含まれており、デフォルトの動作としてOpenAPIドキュメントを生成します。\nこのOpenAPIのドキュメントパスは "),t("code",[s._v("/docs")]),s._v("になっており起動と同時にアクセスが可能です。\nそれでは先ほどのmain.pyを再び起動しアクセスしてみましょう。\n環境によってはListenアドレスが"),t("code",[s._v("127.0.0.1")]),s._v("のみでは都合が悪いので"),t("code",[s._v("--host 0.0.0.0")]),s._v("を追加します。\nそうすることにより 0.0.0.0:8000　でListenするようになるため、外部からのアクセスも可能になります")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v(" uvicorn main:app --host "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0 --reload\n\nINFO:     Started server process "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1990921")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nINFO:     Waiting "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" application startup.\nINFO:     Application startup complete.\nINFO:     Uvicorn running on http://0.0.0.0:8000 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Press CTRL+C to quit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("起動したら "),t("code",[s._v("http://127.0.0.1:8000/docs/")]),s._v("にアクセスしてみましょう。"),t("a",{attrs:{href:"https://fastapi.tiangolo.com/ja/tutorial/first-steps/#api",target:"_blank",rel:"noopener noreferrer"}},[s._v("ここ"),t("OutboundLink")],1),s._v("で表示されているようなWeb画面にアクセスできれば正常です。\nここではFastAPIに定義した全てのパスについて入出力情報が記載されるだけで無く、swagger-clientも内包されているため、そのままテストを行うことも可能です。")]),s._v(" "),t("h4",{attrs:{id:"解説"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#解説"}},[s._v("#")]),s._v(" 解説")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"http://main.py",target:"_blank",rel:"noopener noreferrer"}},[s._v("main.py"),t("OutboundLink")],1),s._v(" "),t("ul",[t("li",[t("code",[s._v("from fastapi import FastAPI")]),s._v(": FastAPIモジュールのロード。Pythonではお馴染み")]),s._v(" "),t("li",[t("code",[s._v("app = FastAPI()")]),s._v(": appという名前でFastAPIをインスタンス化。後述のuvicornはこれを実行しているインスタンス化の際にいくつかオプションを渡すことができる")]),s._v(" "),t("li",[t("code",[s._v('@app.get("/")')]),s._v(": flask等でもお馴染みの記法。 "),t("code",[s._v("/")]),s._v(" に "),t("code",[s._v("GET")]),s._v(" メソッドが来たときの振る舞いを記載する")])])]),s._v(" "),t("li",[s._v("uvicorn main:appの示すもの\n"),t("ul",[t("li",[t("code",[s._v("main")]),s._v(' main.pyファイル (Python "module")。Pythonではディレクトリを'),t("code",[s._v(".")]),s._v("で表すため sample/main.pyの場合、 "),t("code",[s._v("sample.main")]),s._v(" になる")]),s._v(" "),t("li",[t("code",[s._v("app")]),s._v(" main.py内部で作られるobject（app = FastAPI()のように記述される）。")]),s._v(" "),t("li",[t("code",[s._v("--reload")]),s._v(": コードの変更時にサーバーを再起動させる。開発用。")])])])]),s._v(" "),t("h2",{attrs:{id:"fastapiでwebアプリケーションを作る"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#fastapiでwebアプリケーションを作る"}},[s._v("#")]),s._v(" FastAPIでWebアプリケーションを作る")]),s._v(" "),t("p",[s._v("それではいよいよ本格的にWebアプリケーションの開発を行っていきます。")]),s._v(" "),t("p",[s._v("FastAPIに限らずWebアプリケーションを作る以上、ただの静的データを返すだけでは意味がありません。\nまた、固定値しか返さないのであればそれもまた意味が無いので以下の項目をそれぞれ実装してみます。")]),s._v(" "),t("h3",{attrs:{id:"パスパラメータ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#パスパラメータ"}},[s._v("#")]),s._v(" パスパラメータ")]),s._v(" "),t("p",[s._v("Webアプリケーションを作る際にパス情報をパラメータとして何らかの処理をしたい場合を考えます。\nFastAPIでは、Pythonのformat文字列と同様のシンタックスで"),t("code",[s._v("パスパラメータ")]),s._v("や"),t("code",[s._v("パス変数")]),s._v("を宣言できます。")]),s._v(" "),t("p",[s._v("先ほどのmain.pyにパスパラメータを扱うメソッドを定義してみましょう。")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[s._v("@app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/items/{item_id}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("read_item")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("item_id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"item_id"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" item_id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("追記できたら同様に起動してパスパラメータを与えてアクセスしてみましょう。")]),s._v(" "),t("h4",{attrs:{id:"解説-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#解説-2"}},[s._v("#")]),s._v(" 解説")]),s._v(" "),t("ul",[t("li",[t("code",[s._v('@app.get("/items/{item_id}")')]),s._v(": URLパスの宣言\n"),t("ul",[t("li",[s._v("パスパラメータ item_id の値は、引数 item_id として関数に渡されます。")])])])]),s._v(" "),t("details",[t("summary",[s._v(" 実行例")]),s._v(" "),t("ul",[t("li",[s._v("FastAPI起動・コンソール出力")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("uvicorn main:app\n\nINFO:     Started server process "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1993570")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nINFO:     Waiting "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" application startup.\nINFO:     Application startup complete.\nINFO:     Uvicorn running on http://127.0.0.1:8000 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Press CTRL+C to quit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nINFO:     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:60230 - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET /items/hoge HTTP/1.1"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" OK\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("ul",[t("li",[s._v("curl実行、及び結果")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" --noproxy localhost http://localhost:8000/items/hoge\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"item_id"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hoge"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])])]),s._v(" "),t("p",[s._v("参考: "),t("a",{attrs:{href:"https://fastapi.tiangolo.com/ja/tutorial/path-params/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://fastapi.tiangolo.com/ja/tutorial/path-params/"),t("OutboundLink")],1)]),s._v(" "),t("h3",{attrs:{id:"クエリパラメータ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#クエリパラメータ"}},[s._v("#")]),s._v(" クエリパラメータ")]),s._v(" "),t("p",[s._v('パスパラメータが実現できたら次はクエリパラメータの操作を作ってみましょう。\nFastAPIでは関数の引数を宣言した時にパスパラメータではない関数パラメータを宣言すると、それらは自動的に "クエリ" パラメータとして解釈されます。')]),s._v(" "),t("p",[s._v("それでは先ほどに続きmain.pyにクエリパラメータを扱うメソッドを定義してみましょう。")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("fake_items_db "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"item_name"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Foo"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"item_name"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Bar"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"item_name"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Baz"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[s._v("@app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/items/"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("read_query_item")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("skip"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" limit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""クエリパラメータ"""')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" fake_items_db"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("skip "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" skip "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" limit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("追記できたら再び起動してクエリパラメータを与えてアクセスしてみましょう。")]),s._v(" "),t("h4",{attrs:{id:"解説-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#解説-3"}},[s._v("#")]),s._v(" 解説")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("fake_items_db")]),s._v(": クエリパラメータに応じて返答する数を変えるためのデータリスト")]),s._v(" "),t("li",[t("code",[s._v("def read_query_item(skip: int = 0, limit: int = 10):")]),s._v(": クエリパラメータ向けのメソッド追加\n"),t("ul",[t("li",[s._v("クエリ名"),t("code",[s._v("skip")]),s._v(", "),t("code",[s._v("limit")]),s._v("を宣言。それぞれ int型で定義しているため、 "),t("code",[s._v("skip=hoge")]),s._v(" みたいな形はエラーになる")])])])]),s._v(" "),t("details",[t("summary",[s._v(" 実行例")]),s._v(" "),t("ul",[t("li",[s._v("FastAPI起動・コンソール出力")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("uvicorn main:app\n\nINFO:     Started server process "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1993570")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nINFO:     Waiting "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" application startup.\nINFO:     Application startup complete.\nINFO:     Uvicorn running on http://127.0.0.1:8000 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Press CTRL+C to quit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nINFO:     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:60488 - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET /items/?skip=0&limit=1 HTTP/1.1"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" OK\nINFO:     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:60514 - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET /items/?skip=0&limit=2 HTTP/1.1"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" OK\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("ul",[t("li",[s._v("curl実行、及び結果")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" --noproxy localhost "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://localhost:8000/items/?skip=0&limit=1"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"item_name"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Foo"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" --noproxy localhost "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://localhost:8000/items/?skip=0&limit=2"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"item_name"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Foo"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(","),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"item_name"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Bar"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])])]),s._v(" "),t("p",[s._v("参考: "),t("a",{attrs:{href:"https://fastapi.tiangolo.com/ja/tutorial/query-params/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://fastapi.tiangolo.com/ja/tutorial/query-params/"),t("OutboundLink")],1)]),s._v(" "),t("h3",{attrs:{id:"リクエストボディ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#リクエストボディ"}},[s._v("#")]),s._v(" リクエストボディ")]),s._v(" "),t("p",[s._v("パスパラメータ・クエリパラメータが実現できたら次はリクエストボディを扱ってみましょう。\nリクエストボディはクライアントからAPIにデータを送信する時に使います。")]),s._v(" "),t("p",[s._v("それではmain.pyにリクエストボディを扱うメソッドを追加してみましょう。")]),s._v(" "),t("h4",{attrs:{id:"pydantic-によるモデルの定義"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pydantic-によるモデルの定義"}},[s._v("#")]),s._v(" Pydantic によるモデルの定義")]),s._v(" "),t("p",[s._v("FastAPIでは型を宣言することで入出力のvaidation checkを行っていることは冒頭で述べたとおりです。\nパスパラメータの項では型宣言を行いませんでしたがのクエリパラメータの項では型を定義しチェックするようにしています。\nでは、リクエストボディの場合はどうすれば良いのでしょうか？\nそれに対する解が"),t("a",{attrs:{href:"https://pydantic-docs.helpmanual.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("pydantic"),t("OutboundLink")],1),s._v("です。")]),s._v(" "),t("p",[s._v("従ってまずは期待するリクエストボディの型を定義することから始めます。")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" pydantic "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" BaseModel\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" typing "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" Optional\n\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Item")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("BaseModel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("str")]),s._v("\n    description"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Optional"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("str")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),s._v("\n    price"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("float")]),s._v("\n    tax"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Optional"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("float")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h5",{attrs:{id:"解説-4"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#解説-4"}},[s._v("#")]),s._v(" 解説")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("from pydantic import BaseModel")]),s._v(": pydantic のモジュールロード。基本的にはBaseModelを使う")]),s._v(" "),t("li",[t("code",[s._v("from typing import Optional")]),s._v(": Python typehintのロード")]),s._v(" "),t("li",[t("code",[s._v("class Item(BaseModel):")]),s._v(": リクエストボディの型を定義するクラス pydanticのBaseModelを継承")])]),s._v(" "),t("h4",{attrs:{id:"リクエストボディを処理するメソッドの定義"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#リクエストボディを処理するメソッドの定義"}},[s._v("#")]),s._v(" リクエストボディを処理するメソッドの定義")]),s._v(" "),t("p",[s._v("リクエストボディの型定義が済んだらこの型を用いてPOSTを受け付けるメソッドを定義します。\n本来であればPOSTされたデータをどこかに格納し、GETメソッドなどで中身を取り出すのですが\n今回はそういったデータストアを用いていないため、リクエストボディで受け付けた内容をそのまま返すものとします。")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[s._v("@app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("post")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/items/"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("create_item")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("item"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Item"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""リクエストボディ"""')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" item\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("追記できたら再び起動してリクエストボディを与えてアクセスしてみましょう。")]),s._v(" "),t("details",[t("summary",[s._v(" 実行例")]),s._v(" "),t("ul",[t("li",[s._v("FastAPI起動・コンソール出力")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("uvicorn main:app\n\nINFO:     Started server process "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1993570")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nINFO:     Waiting "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" application startup.\nINFO:     Application startup complete.\nINFO:     Uvicorn running on http://127.0.0.1:8000 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Press CTRL+C to quit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nINFO:     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:60644 - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"POST /items/ HTTP/1.1"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" OK\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("ul",[t("li",[s._v("curl実行、及び結果")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" --noproxy localhost -X "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'POST'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://localhost:8000/items/'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -H "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'accept: application/json'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -H "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Content-Type: application/json'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -d "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{\n  "name": "string",\n  "description": "string",\n  "price": 0,\n  "tax": 0\n}\'')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"string"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"description"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"string"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"price"')]),s._v(":0.0,"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tax"')]),s._v(":0.0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])])]),s._v(" "),t("p",[s._v("参考: "),t("a",{attrs:{href:"https://fastapi.tiangolo.com/ja/tutorial/body/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://fastapi.tiangolo.com/ja/tutorial/body/"),t("OutboundLink")],1)]),s._v(" "),t("h2",{attrs:{id:"発展学習"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#発展学習"}},[s._v("#")]),s._v(" 発展学習")]),s._v(" "),t("p",[s._v("さて、ここまででFastAPIを用いて作るWebアプリケーションの基本的な部分は学びました。\nしかし、本格的に開発を行うのであれば抑えておきたいポイントがいくつかありますので\nそれらの一例を記載しておきます。")]),s._v(" "),t("h3",{attrs:{id:"gunicornの利用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#gunicornの利用"}},[s._v("#")]),s._v(" Gunicornの利用")]),s._v(" "),t("p",[s._v("これまでFastAPIの起動には"),t("code",[s._v("uvicorn")]),s._v("を使ってきましたが\nuvicornのサイトにも記載されているとおり、Gunicornを使う方がより好ましいといえます。\n事実、uvicornのサイトでもGunicornの利用を推奨しています。\n"),t("a",{attrs:{href:"https://www.uvicorn.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.uvicorn.org/"),t("OutboundLink")],1)]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("Gunicorn is a mature, fully featured server and process manager.\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("ではGunicornをインストールし、起動方法を変更してみましょう。\nNOTE: 必要に応じて "),t("code",[s._v("--upgrade")]),s._v("オプションを追加してください")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ pip3 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" fastapi Gunicorn uvicorn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("standard"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("GunicornがインストールできたらGunicornを使って先ほどのアプリケーションを起動してみましょう。\nこちらも以下の通り実行するとuvicornで起動した時と同様にフォアグラウンドで動作する為、確認の際は別ターミナルを起動します。\nまた、終了も同じように"),t("code",[s._v("Ctrl+c")]),s._v("で終了してください。")]),s._v(" "),t("details",[t("summary",[s._v(" 実行例")]),s._v(" "),t("ul",[t("li",[s._v("FastAPI起動・コンソール出力")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("gunicorn -k uvicorn.workers.UvicornWorker main:app\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-07-07 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":22:57 +0900"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1998398")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Starting gunicorn "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20.1")]),s._v(".0\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-07-07 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":22:57 +0900"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1998398")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Listening at: http://127.0.0.1:8000 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1998398")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-07-07 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":22:57 +0900"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1998398")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Using worker: uvicorn.workers.UvicornWorker\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-07-07 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":22:57 +0900"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1998400")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Booting worker with pid: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1998400")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-07-07 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":22:57 +0900"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1998400")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Started server process "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1998400")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-07-07 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":22:57 +0900"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1998400")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Waiting "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" application startup.\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-07-07 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":22:57 +0900"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1998400")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Application startup complete.\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("ul",[t("li",[s._v("curl実行、及び結果")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" --noproxy localhost "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://localhost:8000"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"World"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])])]),s._v(" "),t("p",[s._v("参考: "),t("a",{attrs:{href:"https://zenn.dev/ainamori/articles/76990129cac97de0e30b",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://zenn.dev/ainamori/articles/76990129cac97de0e30b"),t("OutboundLink")],1)]),s._v(" "),t("h3",{attrs:{id:"非同期処理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#非同期処理"}},[s._v("#")]),s._v(" 非同期処理")]),s._v(" "),t("p",[s._v("起動をGunicornに変更できたら次はASGI対応のWebアプリケーションを作ってみましょう。\n実はuvicornでもASGI対応のWebアプリケーション作成は可能なのですが、前述の通りGunicornを使え、と言うのが\n公式の推奨という事もあり、まずはGunicornの活用を先に行っています。")]),s._v(" "),t("p",[s._v("また、ASGIとはWSGIと呼ばれるWebサーバとWebアプリケーションを接続するための、\n標準化されたインタフェース定義の精神的(*)な後継仕様です。\nASGIとは 非同期サーバゲートウェイインタフェース(Asynchronous Server Gateway Interface)の名の通り\nasyncioを介して非同期で動作するよう設計されています。\nFastAPIでASGI対応のアプリケーションを作るためにはFastAPIのBackgroundTaskを使います。")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" fastapi "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" BackgroundTasks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" FastAPI\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" time "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" sleep\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("print_wait_time")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    sleep"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string-interpolation"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('f"Wait ')]),t("span",{pre:!0,attrs:{class:"token interpolation"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v(' second & print!"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[s._v("@app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/{count}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("async")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("asgi_task")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" background_tasks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" BackgroundTasks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    background_tasks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("add_task"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("print_wait_time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"status"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"See the console log for wait time."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("参考: "),t("a",{attrs:{href:"https://fastapi.tiangolo.com/ja/tutorial/background-tasks/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://fastapi.tiangolo.com/ja/tutorial/background-tasks/"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("*)ASGIの公式ドキュメントにもspiritualと書いてあり、「精神的な」後継である事が明記されている。")]),s._v(" "),t("h3",{attrs:{id:"plaintext-response"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#plaintext-response"}},[s._v("#")]),s._v(" PlainText Response")]),s._v(" "),t("p",[s._v('FastAPIはWebアプリケーション開発用フレームワークという事もありデフォルトでは全てJSONで返す挙動となっています。\nしかし、"/"のような場所はアプリケーションが起動しているか否かといった単純な監視用に定義するようなことがあり、そういうときには単純な平文を返したいと思うことでしょう。\nそのような時にはResponse_classを変更する事でPlain Textを返すことができます。')]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" fastapi"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("responses "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" PlainTextResponse\n\n"),t("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[s._v("@app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/plaintext/ok"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" response_class"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("PlainTextResponse"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("return_plain_text")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("str")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OK"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"エラーハンドリング"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#エラーハンドリング"}},[s._v("#")]),s._v(" エラーハンドリング")]),s._v(" "),t("p",[s._v("FastAPIは存在しない（未定義）のURLパスにアクセスすると404を返す、といった基本的な動作は備えています。\nしかしながら受け付けたURLに対し、なんらかの処理を行い、その結果に応じてレスポンスコードを変化させたい、と言った時はどのようにすれば良いのでしょうか。")]),s._v(" "),t("p",[s._v("FastAPIにはHTTPExceptionが含まれている為、それを呼び出すことで任意のレスポンスコードを返すことができます。")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" fastapi "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" FastAPI"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" HTTPException\n\nitems "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hoge"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"This is Hoge"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[s._v("@app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/error/{item_id}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("read_item_with_error_handling")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("item_id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("str")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" item_id "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("not")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" items"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("raise")]),s._v(" HTTPException"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("status_code"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("404")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" detail"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Item not found"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"item"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" items"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("item_id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("参考: "),t("a",{attrs:{href:"https://fastapi.tiangolo.com/ja/tutorial/handling-errors/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://fastapi.tiangolo.com/ja/tutorial/handling-errors/"),t("OutboundLink")],1)]),s._v(" "),t("h3",{attrs:{id:"extra-info"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#extra-info"}},[s._v("#")]),s._v(" Extra Info")]),s._v(" "),t("p",[s._v("FastAPIは起動時に様々な情報を追加することができます。\n下記に一例を示しますので実際に設定を行ってみましょう。\nどのような違いが出るか試してみてください。")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("app "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" FastAPI"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    title"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IIJ Bootcamp HandsOn"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    description"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IIJ Bootcamp Web Application by FastAPI."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    version"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.0"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h2",{attrs:{id:"まとめ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#まとめ"}},[s._v("#")]),s._v(" まとめ")]),s._v(" "),t("p",[s._v("今回は、FastAPIを使ってWebアプリケーションを作ってみました。\nFastAPIは決して大規模なWebアプリケーションを作るために作られた物ではありませんが、作り方次第で多くの処理を任せることができます。")]),s._v(" "),t("p",[s._v("BootCampではあくまでチュートリアルのような形で作成したため、全てを一つのmain.pyに記載しましたが開発をスムーズに行う上ではpydanticで定義するモデルファイルは分ける。エンドポイントも階層化に合わせてファイルを分ける、といったテクニックが必要になってきますのでそういった所を今後は学んでいって頂ければと思います。")]),s._v(" "),t("h2",{attrs:{id:"tips"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tips"}},[s._v("#")]),s._v(" Tips")]),s._v(" "),t("h3",{attrs:{id:"より詳細なログ出力をしたい時は"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#より詳細なログ出力をしたい時は"}},[s._v("#")]),s._v(" より詳細なログ出力をしたい時は？")]),s._v(" "),t("p",[s._v("Webアプリケーションを開発する上で不具合を調査する上でログは大変重要です。\nここでは処理時間やリクエストをログに出力するためのTipsをご紹介します。\n先ほど示したsampleディレクトリに logging_context.py という、ログ出力のために作られたClassがあるので\nこれをimportし、LoggingContextRouteをappのrouter.route_class に指定することで詳細なログに出力されます。\nお時間があればやってみてください。")]),s._v(" "),t("ul",[t("li",[s._v("import/設定例")])]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" logging_context "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" LoggingContextRoute\n\napp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("router"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("route_class "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" LoggingContextRoute\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("credit-footer")],1)}),[],!1,null,null,null);t.default=e.exports}}]);