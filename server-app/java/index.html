<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Java; Spring Boot | IIJ Bootcamp</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Spring Bootを使ったアプリ開発を体験するハンズオンです">
    
    <link rel="preload" href="/bootcamp/assets/css/0.styles.34adc732.css" as="style"><link rel="preload" href="/bootcamp/assets/js/app.023cf0af.js" as="script"><link rel="preload" href="/bootcamp/assets/js/2.a4216570.js" as="script"><link rel="preload" href="/bootcamp/assets/js/22.2daaf7e7.js" as="script"><link rel="preload" href="/bootcamp/assets/js/14.8a7c315b.js" as="script"><link rel="preload" href="/bootcamp/assets/js/13.b4ca2fef.js" as="script"><link rel="prefetch" href="/bootcamp/assets/js/10.313de95e.js"><link rel="prefetch" href="/bootcamp/assets/js/11.c44fc613.js"><link rel="prefetch" href="/bootcamp/assets/js/12.e958781e.js"><link rel="prefetch" href="/bootcamp/assets/js/15.4b92e5b8.js"><link rel="prefetch" href="/bootcamp/assets/js/16.fe22010f.js"><link rel="prefetch" href="/bootcamp/assets/js/17.8e4bef4f.js"><link rel="prefetch" href="/bootcamp/assets/js/18.2b5b2c13.js"><link rel="prefetch" href="/bootcamp/assets/js/19.d88a8a54.js"><link rel="prefetch" href="/bootcamp/assets/js/20.a46a1fc9.js"><link rel="prefetch" href="/bootcamp/assets/js/21.33c59fe8.js"><link rel="prefetch" href="/bootcamp/assets/js/23.d9a084ac.js"><link rel="prefetch" href="/bootcamp/assets/js/24.a014948b.js"><link rel="prefetch" href="/bootcamp/assets/js/25.d0f632a7.js"><link rel="prefetch" href="/bootcamp/assets/js/26.6cbcdedf.js"><link rel="prefetch" href="/bootcamp/assets/js/27.f64fbf54.js"><link rel="prefetch" href="/bootcamp/assets/js/28.5eee9b10.js"><link rel="prefetch" href="/bootcamp/assets/js/29.420196f9.js"><link rel="prefetch" href="/bootcamp/assets/js/3.d2fefaef.js"><link rel="prefetch" href="/bootcamp/assets/js/30.2176486a.js"><link rel="prefetch" href="/bootcamp/assets/js/31.4acac59e.js"><link rel="prefetch" href="/bootcamp/assets/js/32.7bb8d951.js"><link rel="prefetch" href="/bootcamp/assets/js/33.25c97d1d.js"><link rel="prefetch" href="/bootcamp/assets/js/34.adaa7d1c.js"><link rel="prefetch" href="/bootcamp/assets/js/35.5e759d0a.js"><link rel="prefetch" href="/bootcamp/assets/js/36.e64f3970.js"><link rel="prefetch" href="/bootcamp/assets/js/37.4fb99eba.js"><link rel="prefetch" href="/bootcamp/assets/js/38.d8ba136a.js"><link rel="prefetch" href="/bootcamp/assets/js/39.6a4eaff8.js"><link rel="prefetch" href="/bootcamp/assets/js/4.60c296d5.js"><link rel="prefetch" href="/bootcamp/assets/js/40.00f5da48.js"><link rel="prefetch" href="/bootcamp/assets/js/41.2faebe81.js"><link rel="prefetch" href="/bootcamp/assets/js/42.2fd508ae.js"><link rel="prefetch" href="/bootcamp/assets/js/43.5ac84f01.js"><link rel="prefetch" href="/bootcamp/assets/js/44.94550c6b.js"><link rel="prefetch" href="/bootcamp/assets/js/45.655b341d.js"><link rel="prefetch" href="/bootcamp/assets/js/46.d8fca033.js"><link rel="prefetch" href="/bootcamp/assets/js/47.3c2aa8b0.js"><link rel="prefetch" href="/bootcamp/assets/js/48.c64ebaa9.js"><link rel="prefetch" href="/bootcamp/assets/js/49.d3c22c8c.js"><link rel="prefetch" href="/bootcamp/assets/js/5.157ad8f3.js"><link rel="prefetch" href="/bootcamp/assets/js/50.5e57f7d8.js"><link rel="prefetch" href="/bootcamp/assets/js/51.8293bae3.js"><link rel="prefetch" href="/bootcamp/assets/js/52.c38c2072.js"><link rel="prefetch" href="/bootcamp/assets/js/53.512e1d72.js"><link rel="prefetch" href="/bootcamp/assets/js/54.c41641a2.js"><link rel="prefetch" href="/bootcamp/assets/js/55.985ee6ce.js"><link rel="prefetch" href="/bootcamp/assets/js/6.68a1d4fd.js"><link rel="prefetch" href="/bootcamp/assets/js/7.0c596cdd.js"><link rel="prefetch" href="/bootcamp/assets/js/8.1e3750bd.js"><link rel="prefetch" href="/bootcamp/assets/js/9.89641915.js">
    <link rel="stylesheet" href="/bootcamp/assets/css/0.styles.34adc732.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/bootcamp/" class="home-link router-link-active"><!----> <span class="site-name">IIJ Bootcamp</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/iij/bootcamp" target="_blank" rel="noopener noreferrer" class="repo-link">
      GitHub
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/iij/bootcamp" target="_blank" rel="noopener noreferrer" class="repo-link">
      GitHub
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Java; Spring Boot</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/bootcamp/server-app/java/#始めに" class="sidebar-link">始めに</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bootcamp/server-app/java/#本講義の前提" class="sidebar-link">本講義の前提</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/java/#この資料のお約束" class="sidebar-link">この資料のお約束</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/java/#下準備" class="sidebar-link">下準備</a></li></ul></li><li><a href="/bootcamp/server-app/java/#javaの基本" class="sidebar-link">Javaの基本</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bootcamp/server-app/java/#言語としての特徴" class="sidebar-link">言語としての特徴</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/java/#プロジェクト構成" class="sidebar-link">プロジェクト構成</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/java/#gradle" class="sidebar-link">Gradle</a></li></ul></li><li><a href="/bootcamp/server-app/java/#spring-bootの基本" class="sidebar-link">Spring Bootの基本</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bootcamp/server-app/java/#特徴" class="sidebar-link">特徴</a></li></ul></li><li><a href="/bootcamp/server-app/java/#spring-bootハンズオン" class="sidebar-link">Spring Bootハンズオン</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bootcamp/server-app/java/#簡単なクラスを作ってみる" class="sidebar-link">簡単なクラスを作ってみる</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/java/#簡単なhttpのインタフェースを作成してみる" class="sidebar-link">簡単なHTTPのインタフェースを作成してみる</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/java/#簡単なリクエストを受け取ってみる" class="sidebar-link">簡単なリクエストを受け取ってみる</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/java/#責任を分離する" class="sidebar-link">責任を分離する</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/java/#少し複雑なリクエストを受け取ってみる" class="sidebar-link">少し複雑なリクエストを受け取ってみる</a></li></ul></li><li><a href="/bootcamp/server-app/java/#まとめ" class="sidebar-link">まとめ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bootcamp/server-app/java/#追加の資料" class="sidebar-link">追加の資料</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><table><tr><td>このハンズオンでやること</td><td>Spring Bootを使ったアプリ開発を体験するハンズオンです</td></tr> <tr><td>想定時間</td><td>2h</td></tr> <tr><td>前提知識・用語</td><td>Java</td></tr></table> <h1 id="page-frontmatter-title"><a href="#page-frontmatter-title" class="header-anchor">#</a> Java; Spring Boot</h1> <h2 id="始めに"><a href="#始めに" class="header-anchor">#</a> 始めに</h2> <ul><li>Javaの基本</li> <li>Spring Bootの基本</li> <li>Spring Bootハンズオン</li></ul> <p>本講義では上記について紹介し、Javaというプログラミング言語とそのWebフレームワークであるSpring Bootといった技術的な選択肢を増やすことを目的としています。</p> <h3 id="本講義の前提"><a href="#本講義の前提" class="header-anchor">#</a> 本講義の前提</h3> <p>本講義ではプログラム言語共通の制御構文や概念、たとえばif文や型など、の解説は行いません。そのため、受講者は何らかのプログラミング言語で簡単な制御構文が書けることを前提とさせてください。</p> <h3 id="この資料のお約束"><a href="#この資料のお約束" class="header-anchor">#</a> この資料のお約束</h3> <p>💻 は自分で操作する箇所を示しています。 また<code>$</code>はホストマシンのプロンプトを意味し、<code>❯</code>はコンテナ内部でのプロンプトを意味します。</p> <p>たとえば下記の通りです。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># ホストマシン上で git clone git@github.com:iij/bootcamp.git を実行する</span>
$ <span class="token function">git</span> clone git@github.com:iij/bootcamp.git

<span class="token comment"># コンテナ上で curl localhost:8080 を実行する</span>
❯ <span class="token function">curl</span> localhost:8080
</code></pre></div><h3 id="下準備"><a href="#下準備" class="header-anchor">#</a> 下準備</h3> <p>講義を受講する前にコンテナイメージのpullと起動をしておくことをお勧めしています。
また、Dockerの実行環境があることを前提として本講義を進めます。</p> <h4 id="手順"><a href="#手順" class="header-anchor">#</a> 手順</h4> <ol><li>ハンズオン用のDockerイメージをpullしてくる</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># やや重たいので注意してください</span>
$ <span class="token function">docker</span> pull ryusa/bootcamp-springboot:2021
</code></pre></div><ol start="2"><li>コンテナを起動する</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># プロキシ環境下にいる人はプロキシの設定をする</span>
$ <span class="token assign-left variable">PROXY_HOST</span><span class="token operator">=</span>YOUR.PROXY.HOST
$ <span class="token assign-left variable">PROXY_PORT</span><span class="token operator">=</span>YOUR_PROXY_PORT
$ <span class="token assign-left variable">JAVA_OPT</span><span class="token operator">=</span><span class="token string">&quot;-Dhttp.proxyHost=<span class="token variable">${PROXY_HOST}</span> -Dhttp.proxyPort=<span class="token variable">${PROXY_PORT}</span> -Dhttps.proxyHost=<span class="token variable">${PROXY_HOST}</span> -Dhttps.proxyPort=<span class="token variable">${PROXY_PORT}</span>&quot;</span>
<span class="token comment"># プロキシ設定ここまで</span>
<span class="token comment"># コンテナを起動する</span>
$ <span class="token function">docker</span> run --name bootcamp-springboot -itd -p <span class="token number">8080</span>:8080 -e <span class="token assign-left variable">JAVA_OPT</span><span class="token operator">=</span><span class="token variable">${JAVA_OPT}</span> ryusa/bootcamp-springboot:2021
</code></pre></div><ol start="3"><li>アプリケーションの起動チェック</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># コンテナの中にアタッチする</span>
$ <span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it bootcamp-springboot <span class="token function">bash</span>
<span class="token comment"># Spring Bootを起動する</span>
❯ ./gradlew bootrun
<span class="token comment"># ...</span>
<span class="token comment"># いろんなログが流れる</span>
</code></pre></div><ol start="4"><li>動作チェック</li></ol> <p>ホストマシンの適当なブラウザから<a href="http://localhost:8080" target="_blank" rel="noopener noreferrer">localhost:8080<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>にアクセスし、下記のようなエラーページが表示されることを確認してください。</p> <p><img src="/bootcamp/assets/img/white-label-error.c9ee4513.png" alt="初回起動 - WhitelabelErrorPage"></p> <details class="custom-block details"><summary>オプション設定</summary> <p>ハンズオンにおいて必須ではありませんが、Visual Studio Code(以下 VSCode)を利用することでより良い開発体験ができます。</p> <ol><li>VSCodeをインストールする</li> <li>拡張機能<code>RemoteDevelopment</code>をインストールする</li> <li>拡張機能<code>Java Extention Pack</code>をインストールする</li> <li>拡張機能<code>Remote-Container</code>を使って起動したコンテナの中へアタッチする</li></ol></details> <h2 id="javaの基本"><a href="#javaの基本" class="header-anchor">#</a> Javaの基本</h2> <p>JavaはOracle社が開発しているプログラミング言語です。<br>
古くから利用されているプログラミング言語/プラットフォームである一方、2021年現在でもSIや大規模開発の現場などでよく利用されています。</p> <h3 id="言語としての特徴"><a href="#言語としての特徴" class="header-anchor">#</a> 言語としての特徴</h3> <p>JavaはC言語やRustと同じ静的型付き言語です。そのため文法や記法はC言語を踏襲した書き方となっています。<br>
Javaの言語のパラダイムとしては、クラスの継承の概念やインタフェースなどの言語仕様を持つためオブジェクト指向プログラミングであります。その一方、Javaのバージョン8以降は関数型インタフェースやパターンマッチなど、関数型プログラミングを楽しめるような仕様も導入されています。</p> <details class="custom-block details"><summary>Javaのサンプルコード</summary> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>iij<span class="token punctuation">.</span>bootcamp<span class="token punctuation">.</span>serverapp</span><span class="token punctuation">;</span> <span class="token comment">// パッケージ名(世界でユニークであると良い)</span>

<span class="token comment">// 自社ドメインを持つ企業での製造物には自社ドメインをそのまま利用することが多い</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span> <span class="token comment">// 外部モジュールの利用(JavaではIDEに任せてしまうのが一般的)</span>

<span class="token comment">/**
 * 複数行に渡るコメント文、特にメソッドとクラスに付与する複数行のコメント文をJavaDocと呼ぶ
 *
 * - 一般的にはJavaのクラス名の命名はパスカルケース - クラス名とjavaファイルの名前は一致させる方が良い(1クラス1ファイル)
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SampleClass</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span> <span class="token punctuation">{</span>

  <span class="token comment">// アクセス修飾子はprivate/protected/public</span>
  <span class="token keyword">private</span> <span class="token class-name">String</span> iamPrivate<span class="token punctuation">;</span>

  <span class="token comment">// Javaの変数・メソッドの命名は(ローワー)キャメルケース</span>
  <span class="token keyword">protected</span> <span class="token class-name">String</span> iamProtected<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token class-name">String</span> iamPublic<span class="token punctuation">;</span>

  <span class="token comment">// アノテーション。そのものに効果があるものではなく、横断的に処理したりする際の目印として使うことが多い</span>
  <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;unused&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">sampleMethod</span><span class="token punctuation">(</span><span class="token class-name">String</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> b <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      b <span class="token operator">=</span> <span class="token string">&quot;world&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> b<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 残念ながらJavaはnull安全な言語ではない(NullPointerExceptionの危機)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyInnerClass</span> <span class="token punctuation">{</span> <span class="token comment">// クラスの中にクラスを定義することもできる(インナークラス)</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> finalizedString<span class="token punctuation">;</span> <span class="token comment">// final化(不変化)ができる</span>

    <span class="token keyword">public</span> <span class="token class-name">MyInnerClass</span><span class="token punctuation">(</span><span class="token class-name">String</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// コンストラクタはクラス名を同一にすることで表現</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>finalizedString <span class="token operator">=</span> arg<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getFinalizedString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>finalizedString<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">makeInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// クラスの具体的な値(オブジェクト)のことを&quot;インスタンス&quot;と言います</span>
    <span class="token keyword">var</span> ins <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyInnerClass</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Java11から型推論が使える</span>
    ins<span class="token punctuation">.</span><span class="token function">getFinalizedString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// → hello</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></details> <h3 id="プロジェクト構成"><a href="#プロジェクト構成" class="header-anchor">#</a> プロジェクト構成</h3> <p>Javaのプロジェクトのディレクトリ構成は、ほかのプログラミング言語と異なり言語として定められています。名前空間として定義できる&quot;パッケージ&quot;がそのままディレクトリに反映されるようにディレクトリを構成する必要があります。</p> <p>参考: <a href="https://docs.oracle.com/javase/tutorial/java/package/managingfiles.html" target="_blank" rel="noopener noreferrer">https://docs.oracle.com/javase/tutorial/java/package/managingfiles.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>たとえば<code>com.github.iij.bootcamp</code>パッケージ(=名前空間)配下に<code>Hoge</code>と<code>Huga</code>というクラスを作成する場合、下記のようなディレクトリ構造/ファイル構造になります。</p> <div class="language- extra-class"><pre class="language-text"><code>.
├── build.gradle
└── src
    └── main
        └── java
            └── com
                └── github
                    └── iij
                        └── bootcamp
                            └── Hoge.java
                            │   └── class Hoge { ... }
                            └── Huga.java
                                └── class Huga { ... }
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">パッケージ</p> <p>Javaにおけるパッケージとは、DNS形式で定義できる名前空間のような概念です。<code>.</code>で区切ることでパッケージ間の親子関係を定義できます。たとえば<code>com.example.iij</code>パッケージと<code>com.example.iij.bootcamp</code>パッケージでは前者が親で後者が子といった関係があります。</p></div> <h3 id="gradle"><a href="#gradle" class="header-anchor">#</a> Gradle</h3> <p>Pythonであればpip、Rustであればcargo、Node.jsであればnpmのようにプログラミング言語にはそれぞれ依存関係を解決しビルドを自動化する自動化システムツールが用意されています。</p> <p>JavaではMavenとGradleという2つの種類の自動化システムツールがよく利用されています。本講義ではGradleを利用して話を進めていきます。</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Mavenを使わずにGradleを利用する理由は、Gradleの方が優れている/イケているからではなく、単に筆者がXMLが嫌いであるためである。</p></div> <h2 id="spring-bootの基本"><a href="#spring-bootの基本" class="header-anchor">#</a> Spring Bootの基本</h2> <p>SprinbBootはJavaのWebフレームワークのひとつです。Spring Bootの規約に従ってアプリケーションロジックを実装することで簡単にWebアプリケーションを構築できます。</p> <p>このフレームワークは大規模な主幹システムやWebアプリケーションを実装/構築する際によく利用されており、IIJがホストしているいくつかのサービスもSpring Bootを利用して実装されています。</p> <h3 id="特徴"><a href="#特徴" class="header-anchor">#</a> 特徴</h3> <p>Spring Bootは複雑な業務要件や非機能要件をクリアするためのさまざまな機能を有しています。依存関係を宣言して注入してくれるDIコンテナや横断的な関心事を解決するAOPのサポート、数多く公開されているstarterパッケージなどはその最たる例です。</p> <p>残念ながらこのBootcampですべての要素に触れることはできないため、興味のあるほうはドキュメントを読んでみることをお勧めします。</p> <h2 id="spring-bootハンズオン"><a href="#spring-bootハンズオン" class="header-anchor">#</a> Spring Bootハンズオン</h2> <p>本ハンズオンではブラウザで閲覧できるWeb UIの機能を持たない、HTTP API(Application Programming Interface)だけを持つAPIサーバを構築していきます。</p> <p>それでは始めましょう。</p> <h3 id="簡単なクラスを作ってみる"><a href="#簡単なクラスを作ってみる" class="header-anchor">#</a> 簡単なクラスを作ってみる</h3> <p>まず始めに、Java言語のウォーミングアップとして純粋なJavaのクラスを作ってみましょう。</p> <p>💻 <code>User</code>クラスを作成します。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 下記の通りに修正する</span>
❯ <span class="token function">vim</span> src/main/java/com/github/iij/bootcamp/serverapp/User.java
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>iij<span class="token punctuation">.</span>bootcamp<span class="token punctuation">.</span>serverapp</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>

  <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name">String</span> slug<span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> slug<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>slug <span class="token operator">=</span> slug<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getSlug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>slug<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSlug</span><span class="token punctuation">(</span><span class="token class-name">String</span> slug<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>slug <span class="token operator">=</span> slug<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;name: &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;slug: &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>slug<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>これで<code>User</code>クラスを作成できました。次にこのクラスを実際にインスタンス化してみます。<br>
Spring Bootアプリケーションのmain関数は<code>com.github.iij.bootcamp.serverapp.ServerAppApplication</code>にあります。ためしにこのmain関数の中で<code>User</code>クラスをインスタンス化してみます。</p> <p>💻 ServerAppApplication.javaを修正してください。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 下記の通りに修正する</span>
❯ <span class="token function">vim</span> src/main/java/com/github/iij/bootcamp/serverapp/ServerAppApplication.java 
<span class="token comment"># Spring Bootサーバーを再起動する</span>
❯ ./gradlew bootRun
</code></pre></div><div class="language-java extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br></div><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>iij<span class="token punctuation">.</span>bootcamp<span class="token punctuation">.</span>serverapp</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServerAppApplication</span> <span class="token punctuation">{</span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 追記BEGIN</span>
		<span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;アリス&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;alice&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 追記END</span>
		<span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ServerAppApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>再起動時にログに&quot;name: アリス,slug: alice&quot;と表示されていればOKです。</p> <h4 id="チェックポイント"><a href="#チェックポイント" class="header-anchor">#</a> チェックポイント</h4> <ul><li>Javaのクラスを作成した</li> <li>クラスをインスタンス化し、標準出力に文字列を表示した</li></ul> <h4 id="解説"><a href="#解説" class="header-anchor">#</a> 解説</h4> <p>純粋なJavaのクラスを作成し、インスタンス化とメソッドの呼び出しを行いました。<code>User</code>クラスを眺めてもらうとわかるとおり、<code>getName</code>や<code>getSlug</code>などJavaにはかなり冗長なコードが多いです。これらのコードはよく「ボイラーテンプレート」と呼ばれ、開発者が嫌うコードです。</p> <p>JavaにはLombokなどのボイラーテンプレートを解消するツールなどありますが、本講義はあえて紹介しません。興味がある人は調べてみてください。</p> <h3 id="簡単なhttpのインタフェースを作成してみる"><a href="#簡単なhttpのインタフェースを作成してみる" class="header-anchor">#</a> 簡単なHTTPのインタフェースを作成してみる</h3> <p>それではSpring Bootを使ってみましょう。<br>
簡単なHTTPのインタフェースを作成し、実際にSpring Bootがどのように動作しているのかを見てみます。</p> <p>💻 DemoApplication.javaを修正し、サーバを再起動してみてください。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 下記の通りに修正する</span>
❯ <span class="token function">vim</span> src/main/java/com/github/iij/bootcamp/serverapp/ServerAppApplication.java
<span class="token comment"># Spring Bootサーバーを再起動する</span>
❯ ./gradlew bootRun
</code></pre></div><div class="language-java extra-class"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br></div><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>iij<span class="token punctuation">.</span>bootcamp<span class="token punctuation">.</span>serverapp</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span>
<span class="token comment">// 追記BEGIN</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>
<span class="token comment">// 追記END</span>

<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServerAppApplication</span> <span class="token punctuation">{</span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;アリス&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;alice&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ServerAppApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

  <span class="token comment">// 追記BEGIN</span>
	<span class="token annotation punctuation">@RestController</span>
  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>path <span class="token operator">=</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">helloWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">&quot;hello world&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 追記END</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 動作確認</span>
$ <span class="token function">curl</span> localhost:8080 -X GET
hello world
</code></pre></div><p>&quot;hello world&quot;が返ってきたら成功です。</p> <h4 id="チェックポイント-2"><a href="#チェックポイント-2" class="header-anchor">#</a> チェックポイント</h4> <ul><li><code>@RestController</code>アノテーションをクラスに付与してHTTPのインタフェースを作成した</li></ul> <h4 id="解説-2"><a href="#解説-2" class="header-anchor">#</a> 解説</h4> <p><code>bootRun</code>コマンドによりSpring Bootが起動します。すると、Spring Bootの機能により <code>@RestController</code>アノテーションが付いている<code>ServerAppApplication.HelloController</code>がHTTPのインタフェースとして登録されます。</p> <p><img src="/bootcamp/assets/img/http-handler.0b72f6d9.png" alt="handler"></p> <p>その結果、このSpring Bootが動いている8080番ポート宛のHTTPリクエストと<code>ServerAppApplication.HelloController#helloWorld</code>が紐づけられることになり、<code>GET /</code>へのリクエストのレスポンスとして&quot;hello world&quot;が返ってきました。</p> <details class="custom-block details"><summary>Spring BootとDIコンテナ</summary> <p>Spring Bootは起動時に起動クラスのパッケージ配下のJavaファイルから特殊なアノテーション(<code>@Contoroller</code> / <code>@Component</code> / etc...)がついたクラスを探し出します。そしてSpring Bootはそのクラスを適当な方法でインスタンス化し、自身の管理下(=DI コンテナ)に置きます。</p> <p>(「適当な方法」を指定することもできます &gt; <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/Bean.html" target="_blank" rel="noopener noreferrer">Bean Annotation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)</p> <p>DIコンテナに格納されたインスタンスは、後述する<code>@Autowired</code>アノテーションを使って引き出すことができます。</p> <p>特に、<code>@Controller</code> <code>@RestController</code>アノテーションが付与されたクラスから生成されたインスタンスはHTTPのインタフェースとして働くことになります。</p> <p>今回の例では、 <code>ServerAppApplication</code>クラスに<code>@SpringBootApplication</code>アノテーションが付与されているので<code>ServerAppApplication</code>クラスのパッケージ<code>com.github.iij.bootcamp.serverapp</code>配下のクラスから上述の特殊なアノテーションがついているクラスを探索します。</p> <p><code>HelloController</code>クラスは<code>@RestController</code>アノテーションが付与されているため、Spring Boot起動時に<code>HelloController</code>がSpring Bootによってインスタンス化されDIコンテナに登録されました。
その結果、<code>GET /</code>のリクエストをSpring Bootが受け取ると<code>HelloController#helloWorld</code> が実行されるようになっていたというわけです。</p></details> <h3 id="簡単なリクエストを受け取ってみる"><a href="#簡単なリクエストを受け取ってみる" class="header-anchor">#</a> 簡単なリクエストを受け取ってみる</h3> <p>次にクエリパラメータから情報を取得してみましょう。</p> <p>💻 UserController.javaを作成し、サーバを再起動してみてください。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 下記の通りに修正する</span>
❯ <span class="token function">vim</span> src/main/java/com/github/iij/bootcamp/serverapp/UserController.java
<span class="token comment"># Spring Bootサーバーを再起動する</span>
❯ ./gradlew bootRun
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>iij<span class="token punctuation">.</span>bootcamp<span class="token punctuation">.</span>serverapp</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestParam</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>

  <span class="token keyword">private</span> <span class="token class-name">User</span> secretUser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;ボブ&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bob&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>path <span class="token operator">=</span> <span class="token string">&quot;/user&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">find</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> slug<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;bob&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>slug<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>secretUser<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 動作確認</span>
$ <span class="token function">curl</span> <span class="token string">'localhost:8080/user?slug=bob'</span>
<span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;ボブ&quot;</span>,<span class="token string">&quot;slug&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;bob&quot;</span><span class="token punctuation">}</span>
</code></pre></div><h4 id="チェックポイント-3"><a href="#チェックポイント-3" class="header-anchor">#</a> チェックポイント</h4> <ul><li><code>@GetMapping</code>アノテーションを持つメソッドを作成し、HTTPのハンドラとして登録した</li> <li>HTTPのハンドラとして登録されたメソッドの引数に<code>@RequestParam</code>アノテーションを付与することでクエリパラメータを実装した</li></ul> <h4 id="解説-3"><a href="#解説-3" class="header-anchor">#</a> 解説</h4> <p>新しいクラス<code>UserController</code>を作成しました。このクラスにも<code>@RestController</code>アノテーションが付いているためHTTPのインタフェースとして振る舞います。</p> <p><code>UserController</code>クラスの持つメソッド<code>find</code>には<code>@GetMapping</code>アノテーションがついているため、<code>GET /user</code>宛のリクエストのハンドラとして登録されることになります。そのため、Spring Bootアプリケーションの<code>/user</code>へGETリクエストを送ることでこの<code>find</code>メソッドがコールされます。</p> <p>さらに<code>find</code>メソッドの引数<code>slug</code>に<code>@RequestParam</code>アノテーションが付与されています。これにより、HTTPリクエストのクエリパラメータの値がこの変数に注入されます。つまり<code>GET /user?slug=bob</code>へのリクエストをSpring Bootアプリケーションへ送ることで<code>find</code>メソッドがコールされ引数<code>slug=bob</code>が引き渡されます。</p> <h3 id="責任を分離する"><a href="#責任を分離する" class="header-anchor">#</a> 責任を分離する</h3> <p>さて、前章まで基本的なHTTPのインタフェースの作り方と使い方について解説してきました。もう少し実装を深めていきましょう。<br>
現在<code>UserController</code>クラスはHTTPのインタフェースとデータソースの管理の2つの責務を持っています。これは単一責務の原理から外れているためリファクタリングする対象です。</p> <p>今回はシンプルに<code>UserController#find</code>の処理を抽出して別のクラスに分離、処理そのものを<code>UserController</code>クラスの外から与えてあげるようにしましょう。</p> <p>💻 UserService.javaを作成、UserController.javaを修正し、サーバを再起動してください。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 新しいクラスUserServiceを作成する</span>
❯ <span class="token function">vim</span> src/main/java/com/github/iij/bootcamp/serverapp/UserService.java
<span class="token comment"># UserControllerクラスを修正する</span>
❯ <span class="token function">vim</span> src/main/java/com/github/iij/bootcamp/serverapp/UserController.java
<span class="token comment"># Spring Bootサーバーを再起動する</span>
❯ ./gradlew bootRun
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>iij<span class="token punctuation">.</span>bootcamp<span class="token punctuation">.</span>serverapp</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>

  <span class="token comment">// データソースに該当する部分</span>
  <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> userPool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;ボブ&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bob&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">/**
   * ユーザープールからslug値で検索し、その結果を返却します slugと一致するユーザーが見つからない場合nullを返却します
   * TODO 本当にこの実装で問題ないか、考えてみましょう
   *   - 同一のslugをもつインスタンスがいる場合は？データ構造はこれで良いか？
   *   - nullは`User`インスタンスではない、では見つからない場合は何を返すべき？
   */</span>
  <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">findBySlug</span><span class="token punctuation">(</span><span class="token class-name">String</span> slug<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Java8から導入されたStreamAPI</span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userPool
      <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Streamを作成</span>
      <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>u <span class="token operator">-&gt;</span> slug<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span><span class="token function">getSlug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// slugと一致する`User`インスタンスのみを抽出</span>
      <span class="token punctuation">.</span><span class="token function">findFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 抽出結果の先頭1つだけを取り出す</span>
      <span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// もし抽出した結果何も残らなかった場合、nullを返却する</span>
    <span class="token keyword">return</span> user<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><div class="language-java extra-class"><div class="highlight-lines"><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br></div><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>iij<span class="token punctuation">.</span>bootcamp<span class="token punctuation">.</span>serverapp</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestParam</span></span><span class="token punctuation">;</span>
<span class="token comment">// 追記BEGIN</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token comment">// 追記END</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>

  <span class="token comment">// 修正BEGIN</span>
  <span class="token annotation punctuation">@Autowired</span>
  <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>

  <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>path <span class="token operator">=</span> <span class="token string">&quot;/user&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">find</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> slug<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userService<span class="token punctuation">.</span><span class="token function">findBySlug</span><span class="token punctuation">(</span>slug<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 修正END</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 動作確認</span>
$ <span class="token function">curl</span> <span class="token string">'localhost:8080/user?slug=bob'</span>
<span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;ボブ&quot;</span>,<span class="token string">&quot;slug&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;bob&quot;</span><span class="token punctuation">}</span>
</code></pre></div><h4 id="チェックポイント-4"><a href="#チェックポイント-4" class="header-anchor">#</a> チェックポイント</h4> <ul><li><code>@Component</code>アノテーションをクラスに付与し、Spring Boot起動時に自動的にインスタンス化した</li> <li><code>@Autowired</code>アノテーションをフィールドに付与し、そのフィールドにSpring Bootがインスタンス化したインスタンスの中から適切なインスタンスを注入した</li></ul> <h4 id="解説-4"><a href="#解説-4" class="header-anchor">#</a> 解説</h4> <p>新しいクラス<code>UserService</code>を作成しました。このクラスには<code>@Component</code>アノテーションが付与されているため、Spring Boot起動時にSpring Bootによって自動的にインスタンス化されSpring Bootの管理下に入ります。このようにSpring Bootに管理されるようになったインスタンスはほかのクラスから<code>@Autowired</code>を利用することで利用されます。</p> <p>今回の例では<code>UserController</code>クラスが<code>userService</code>フィールドに<code>@Autowired</code>アノテーションを付与しているため自動的に作成された<code>UserService</code>クラスのインスタンスが<code>UserController.userService</code>に代入されることになりました。このように依存関係を分離、外から依存関係を持ち込む構成のことをDI(Dependency Injection)と呼びます。</p> <p>注意点として、デフォルトの挙動ではSpring Bootが管理するインスタンスは各クラス&quot;1つ&quot;となっています。つまり<code>UserController</code>クラスが引っ張ってきている<code>userService</code>とほかのクラスが引っ張ってこれる<code>UserService</code>インスタンスは完全に一致しています。このようにひとつのインスタンスを使い回す構成のことを&quot;シングルトン&quot;と呼びます。</p> <h3 id="少し複雑なリクエストを受け取ってみる"><a href="#少し複雑なリクエストを受け取ってみる" class="header-anchor">#</a> 少し複雑なリクエストを受け取ってみる</h3> <p>最後に、POSTリクエストとリクエストボディを指定して<code>User</code>インスタンスを登録してみましょう。<br> <code>User</code>インスタンスには<code>slug</code>と<code>name</code>の値を指定する必要があるので、これらを与えられるエンドポイントを用意します。</p> <p>💻 UserService.javaとUserController.javaを修正し、サーバを再起動してください。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 下記の通りに修正する</span>
❯ <span class="token function">vim</span> src/main/java/com/github/iij/bootcamp/serverapp/UserService.java
❯ <span class="token function">vim</span> src/main/java/com/github/iij/bootcamp/serverapp/UserController.java
<span class="token comment"># Spring Bootサーバーを再起動する</span>
❯ ./gradlew bootRun
</code></pre></div><div class="language-java extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br></div><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>iij<span class="token punctuation">.</span>bootcamp<span class="token punctuation">.</span>serverapp</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>

  <span class="token comment">// データソースに該当する部分</span>
  <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> userPool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;ボブ&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bob&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">/**
   * ユーザープールからslug値で検索し、その結果を返却します slugと一致するユーザーが見つからない場合nullを返却します
   */</span>
  <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">findBySlug</span><span class="token punctuation">(</span><span class="token class-name">String</span> slug<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userPool
      <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>u <span class="token operator">-&gt;</span> slug<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span><span class="token function">getSlug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">findFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> user<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 追記BEGIN</span>
  <span class="token comment">/**
   * ユーザープールにUserを追加します
   */</span>
  <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>userPool<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> user<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
  <span class="token comment">// 追記END</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br></div><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>iij<span class="token punctuation">.</span>bootcamp<span class="token punctuation">.</span>serverapp</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestParam</span></span><span class="token punctuation">;</span>
<span class="token comment">// 追記BEGIN</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PostMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestBody</span></span><span class="token punctuation">;</span>
<span class="token comment">// 追記END</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Autowired</span>
  <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>

  <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>path <span class="token operator">=</span> <span class="token string">&quot;/user&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">find</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> slug<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userService<span class="token punctuation">.</span><span class="token function">findBySlug</span><span class="token punctuation">(</span>slug<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 追記BEGIN</span>

  <span class="token comment">// POST /user 宛のリクエストボディスキーマ</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">UserCreateRequest</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> slug<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getSlug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> slug<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSlug</span><span class="token punctuation">(</span><span class="token class-name">String</span> slug<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>slug <span class="token operator">=</span> slug<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span>path <span class="token operator">=</span> <span class="token string">&quot;/user&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">UserCreateRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">User</span> newUser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">getSlug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userService<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>newUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 追記END</span>

<span class="token punctuation">}</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 動作確認</span>
$ <span class="token function">curl</span> localhost:8080/user -X POST -H <span class="token string">'Content-Type: application/json'</span> -d <span class="token string">'{&quot;name&quot;: &quot;アリス&quot;, &quot;slug&quot;: &quot;alice&quot;}'</span>
<span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;アリス&quot;</span>, <span class="token string">&quot;slug&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;alice&quot;</span><span class="token punctuation">}</span>

$ <span class="token function">curl</span> <span class="token string">'localhost:8080/user?slug=alice'</span>
<span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;アリス&quot;</span>, <span class="token string">&quot;slug&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;alice&quot;</span><span class="token punctuation">}</span>
</code></pre></div><h4 id="チェックポイント-5"><a href="#チェックポイント-5" class="header-anchor">#</a> チェックポイント</h4> <ul><li><code>@PostMapping</code>アノテーションをメソッドに付与し、POSTリクエストのHTTPハンドラとして登録した</li> <li>JavaのPOJOを用いてPOSTリクエストのリクエストボディのスキーマを表現した</li></ul> <h2 id="まとめ"><a href="#まとめ" class="header-anchor">#</a> まとめ</h2> <p>以上でSpring Bootのハンズオンは終了です。</p> <p>本講義ではJavaの基本的な知識や書き方、Spring Bootの使い方など、基本的な機能や文法に触れてもらいました。しかしSpring Bootには多様な機能がまだまだ存在しており、データベースとの接続や非同期処理などさまざまなプロダクション環境で活躍できるポテンシャルを持っているフレームワークです。</p> <p>本講義が、受講者のみなさまの今後の技術選定の手助けになれれば幸いです。</p> <h3 id="追加の資料"><a href="#追加の資料" class="header-anchor">#</a> 追加の資料</h3> <ul><li><a href="https://spring.pleiades.io/spring-boot/docs/current/reference/html" target="_blank" rel="noopener noreferrer">Spring Bootリファレンスドキュメント<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <ul><li>多くのSpring Boot開発者がお世話になる公式ドキュメントです。アプリケーションの開発からデプロイ方法まで、幅広く情報が提供されています。</li></ul></li> <li><a href="https://spring.pleiades.io/guides" target="_blank" rel="noopener noreferrer">Spring Boot Guides<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <ul><li>Spring Bootの各種機能を試してみるチュートリアルが公開されています。Pub/SubやMongoDB、Dockerとの連携などSpring Bootの拡張が多種公開されています。興味のある項目に触ってみてください。</li></ul></li></ul> <div><hr> <span>CC BY-SA Licensed | Copyright (c) 2020, Internet Initiative Japan Inc.</span></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/iij/bootcamp/edit/master/src/server-app/java/README.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">7/14/2022, 10:37:08 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/bootcamp/assets/js/app.023cf0af.js" defer></script><script src="/bootcamp/assets/js/2.a4216570.js" defer></script><script src="/bootcamp/assets/js/22.2daaf7e7.js" defer></script><script src="/bootcamp/assets/js/14.8a7c315b.js" defer></script><script src="/bootcamp/assets/js/13.b4ca2fef.js" defer></script>
  </body>
</html>
