<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Java; Spring Boot | IIJ Bootcamp</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Spring Bootを使ったアプリ開発を体験するハンズオンです">
    
    <link rel="preload" href="/bootcamp/assets/css/0.styles.095a7d7e.css" as="style"><link rel="preload" href="/bootcamp/assets/js/app.7c511c2a.js" as="script"><link rel="preload" href="/bootcamp/assets/js/2.8be9fd60.js" as="script"><link rel="preload" href="/bootcamp/assets/js/26.2912fe5e.js" as="script"><link rel="preload" href="/bootcamp/assets/js/18.2a5d0854.js" as="script"><link rel="preload" href="/bootcamp/assets/js/17.a5ea2536.js" as="script"><link rel="prefetch" href="/bootcamp/assets/js/10.299b8302.js"><link rel="prefetch" href="/bootcamp/assets/js/11.1132ddf4.js"><link rel="prefetch" href="/bootcamp/assets/js/12.77a094b1.js"><link rel="prefetch" href="/bootcamp/assets/js/13.89775596.js"><link rel="prefetch" href="/bootcamp/assets/js/14.c308d537.js"><link rel="prefetch" href="/bootcamp/assets/js/15.e79f30b8.js"><link rel="prefetch" href="/bootcamp/assets/js/16.83eecbf6.js"><link rel="prefetch" href="/bootcamp/assets/js/19.7070a3f2.js"><link rel="prefetch" href="/bootcamp/assets/js/20.bf13966f.js"><link rel="prefetch" href="/bootcamp/assets/js/21.0e1f1f4b.js"><link rel="prefetch" href="/bootcamp/assets/js/22.b6c9a0d4.js"><link rel="prefetch" href="/bootcamp/assets/js/23.ee032780.js"><link rel="prefetch" href="/bootcamp/assets/js/24.886f15ea.js"><link rel="prefetch" href="/bootcamp/assets/js/25.1947468b.js"><link rel="prefetch" href="/bootcamp/assets/js/27.cba2064c.js"><link rel="prefetch" href="/bootcamp/assets/js/28.270a9665.js"><link rel="prefetch" href="/bootcamp/assets/js/29.d895ab7b.js"><link rel="prefetch" href="/bootcamp/assets/js/3.7fb194b3.js"><link rel="prefetch" href="/bootcamp/assets/js/30.5c8e6cc2.js"><link rel="prefetch" href="/bootcamp/assets/js/31.4e0d7c83.js"><link rel="prefetch" href="/bootcamp/assets/js/32.8cd1a0f9.js"><link rel="prefetch" href="/bootcamp/assets/js/33.948a8676.js"><link rel="prefetch" href="/bootcamp/assets/js/34.e2fb4e29.js"><link rel="prefetch" href="/bootcamp/assets/js/35.a64209f5.js"><link rel="prefetch" href="/bootcamp/assets/js/36.7d1b8dc3.js"><link rel="prefetch" href="/bootcamp/assets/js/37.e33dc2ba.js"><link rel="prefetch" href="/bootcamp/assets/js/38.c1e53061.js"><link rel="prefetch" href="/bootcamp/assets/js/39.09eeb0dd.js"><link rel="prefetch" href="/bootcamp/assets/js/4.fe47842b.js"><link rel="prefetch" href="/bootcamp/assets/js/40.25fe94f1.js"><link rel="prefetch" href="/bootcamp/assets/js/41.f7ea52e9.js"><link rel="prefetch" href="/bootcamp/assets/js/42.c1b189a6.js"><link rel="prefetch" href="/bootcamp/assets/js/43.fced8832.js"><link rel="prefetch" href="/bootcamp/assets/js/44.1545b521.js"><link rel="prefetch" href="/bootcamp/assets/js/45.cb28e54e.js"><link rel="prefetch" href="/bootcamp/assets/js/46.efba779b.js"><link rel="prefetch" href="/bootcamp/assets/js/47.bd53d714.js"><link rel="prefetch" href="/bootcamp/assets/js/48.2651bfbd.js"><link rel="prefetch" href="/bootcamp/assets/js/49.97d4cc5a.js"><link rel="prefetch" href="/bootcamp/assets/js/5.a0004df2.js"><link rel="prefetch" href="/bootcamp/assets/js/50.5738bd9f.js"><link rel="prefetch" href="/bootcamp/assets/js/51.7494acc0.js"><link rel="prefetch" href="/bootcamp/assets/js/52.11d5174a.js"><link rel="prefetch" href="/bootcamp/assets/js/53.100b8756.js"><link rel="prefetch" href="/bootcamp/assets/js/54.a26b4907.js"><link rel="prefetch" href="/bootcamp/assets/js/55.b31b6b6a.js"><link rel="prefetch" href="/bootcamp/assets/js/56.30eb6432.js"><link rel="prefetch" href="/bootcamp/assets/js/57.02508781.js"><link rel="prefetch" href="/bootcamp/assets/js/58.5c6a8b78.js"><link rel="prefetch" href="/bootcamp/assets/js/59.e6e5fc1e.js"><link rel="prefetch" href="/bootcamp/assets/js/6.3784fdd2.js"><link rel="prefetch" href="/bootcamp/assets/js/60.aa2d328c.js"><link rel="prefetch" href="/bootcamp/assets/js/61.0ec08d2b.js"><link rel="prefetch" href="/bootcamp/assets/js/62.0f2814f4.js"><link rel="prefetch" href="/bootcamp/assets/js/63.1b319d01.js"><link rel="prefetch" href="/bootcamp/assets/js/64.d73774ce.js"><link rel="prefetch" href="/bootcamp/assets/js/65.75a58f91.js"><link rel="prefetch" href="/bootcamp/assets/js/7.71150ca1.js"><link rel="prefetch" href="/bootcamp/assets/js/8.b4e304f4.js"><link rel="prefetch" href="/bootcamp/assets/js/9.eecef422.js">
    <link rel="stylesheet" href="/bootcamp/assets/css/0.styles.095a7d7e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/bootcamp/" class="home-link router-link-active"><!----> <span class="site-name">IIJ Bootcamp</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/iij/bootcamp" target="_blank" rel="noopener noreferrer" class="repo-link">
      GitHub
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/iij/bootcamp" target="_blank" rel="noopener noreferrer" class="repo-link">
      GitHub
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Java; Spring Boot</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/bootcamp/server-app/java/#始めに" class="sidebar-link">始めに</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bootcamp/server-app/java/#本講義の前提" class="sidebar-link">本講義の前提</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/java/#この資料のお約束" class="sidebar-link">この資料のお約束</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/java/#下準備" class="sidebar-link">下準備</a></li></ul></li><li><a href="/bootcamp/server-app/java/#java-の基本" class="sidebar-link">Java の基本</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bootcamp/server-app/java/#言語としての特徴" class="sidebar-link">言語としての特徴</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/java/#プロジェクト構成" class="sidebar-link">プロジェクト構成</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/java/#gradle" class="sidebar-link">Gradle</a></li></ul></li><li><a href="/bootcamp/server-app/java/#spring-boot-の基本" class="sidebar-link">Spring Boot の基本</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bootcamp/server-app/java/#特徴" class="sidebar-link">特徴</a></li></ul></li><li><a href="/bootcamp/server-app/java/#spring-boot-ハンズオン" class="sidebar-link">Spring Boot ハンズオン</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bootcamp/server-app/java/#簡単なクラスを作ってみる" class="sidebar-link">簡単なクラスを作ってみる</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/java/#簡単な-http-のインタフェースを作成してみる" class="sidebar-link">簡単な HTTP のインタフェースを作成してみる</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/java/#簡単なリクエストを受け取ってみる" class="sidebar-link">簡単なリクエストを受け取ってみる</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/java/#責任を分離する" class="sidebar-link">責任を分離する</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/java/#少し複雑なリクエストを受け取ってみる" class="sidebar-link">少し複雑なリクエストを受け取ってみる</a></li></ul></li><li><a href="/bootcamp/server-app/java/#まとめ" class="sidebar-link">まとめ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bootcamp/server-app/java/#追加の資料" class="sidebar-link">追加の資料</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><table><tr><td>このハンズオンでやること</td><td>Spring Bootを使ったアプリ開発を体験するハンズオンです</td></tr> <tr><td>想定時間</td><td>2h</td></tr> <tr><td>前提知識・用語</td><td>Java</td></tr></table> <h1 id="page-frontmatter-title"><a href="#page-frontmatter-title" class="header-anchor">#</a> Java; Spring Boot</h1> <h2 id="始めに"><a href="#始めに" class="header-anchor">#</a> 始めに</h2> <ul><li>Java の基本</li> <li>Spring Boot の基本</li> <li>Spring Boot ハンズオン</li></ul> <p>本講義では上記について紹介し、Java というプログラミング言語とその Web フレームワークである Spring Boot といった技術的な選択肢を増やすことを目的としています。</p> <h3 id="本講義の前提"><a href="#本講義の前提" class="header-anchor">#</a> 本講義の前提</h3> <p>本講義ではプログラム言語共通の制御構文や概念、たとえば if 文や型など、の解説は行いません。そのため、受講者は何らかのプログラミング言語で簡単な制御構文が書けることを前提とさせてください。</p> <p>また、ファイルの編集については VSCode を使って編集することを前提として進めていきます。もちろん、vim などのお好きなエディタを使って頂いても問題ありませんが、その場合は適宜資料を読み替えて対応をお願いします。</p> <h3 id="この資料のお約束"><a href="#この資料のお約束" class="header-anchor">#</a> この資料のお約束</h3> <p>💻 は自分で操作する箇所を示しています。 また<code>$</code>はホストマシンのプロンプトを意味し、<code>❯</code>はコンテナ内部でのプロンプトを意味します。</p> <p>たとえば下記の通りです。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># ホストマシン上で git clone git@github.com:iij/bootcamp.git を実行する</span>
$ <span class="token function">git</span> clone git@github.com:iij/bootcamp.git

<span class="token comment"># コンテナ上で curl localhost:8080 を実行する</span>
❯ <span class="token function">curl</span> localhost:8080
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="下準備"><a href="#下準備" class="header-anchor">#</a> 下準備</h3> <p>講義を受講する前にコンテナイメージの pull と起動をしておくことをお勧めしています。
また、Docker の実行環境があることを前提として本講義を進めます。</p> <h4 id="手順"><a href="#手順" class="header-anchor">#</a> 手順</h4> <ol><li><p>ハンズオン用の Docker イメージを pull してくる</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># やや重たいので注意してください</span>
$ <span class="token function">docker</span> pull tamago0224/bootcamp-springboot:2024
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>ハンズオン用の作業ディレクトを作成する</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 適当な場所に作業用ディレクトリを作成し、その中に work ディレクトリを作成してください。</span>
$ <span class="token function">mkdir</span> bootcamp-java-2024 <span class="token comment"># このディレクトリ名は何でも良い</span>
$ <span class="token builtin class-name">cd</span> bootcamp-java-2024
$ <span class="token function">mkdir</span> work
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>ハンズオン用の docker-compose.yml を用意する</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">curl</span> -o docker-compose.yml https://raw.githubusercontent.com/iij/bootcamp/master/src/server-app/java/server-app/docker-compose.yml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">java</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> tamago0224/bootcamp<span class="token punctuation">-</span>springboot<span class="token punctuation">:</span><span class="token number">2024</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./work<span class="token punctuation">:</span>/work
    <span class="token key atrule">working_dir</span><span class="token punctuation">:</span> /work
    <span class="token key atrule">tty</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
     <span class="token punctuation">-</span> <span class="token string">&quot;8080:8080&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p>コンテナを起動する</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># コンテナを起動する</span>
$ <span class="token function">docker</span> compose up -d
<span class="token comment"># コンテナに入る</span>
$ <span class="token function">docker</span> compose <span class="token builtin class-name">exec</span> java /bin/bash
<span class="token operator">&gt;</span> <span class="token builtin class-name">pwd</span>
/work
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>必要なプロジェクトファイルの用意。別画面のターミナルで以下のコマンドを実行</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token builtin class-name">cd</span> bootcamp-java-2024
$ <span class="token function">docker</span> compose <span class="token function">cp</span> java:/app/. ./work
$ <span class="token function">ls</span> ./work <span class="token comment"># 以下のファイル群が確認できる</span>
build  build.gradle  gradle  gradlew  settings.gradle  src
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>アプリケーションの起動チェック</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># Spring Bootを起動する</span>
❯ ./gradlew bootrun
<span class="token comment"># ...</span>
<span class="token comment"># いろんなログが流れる</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>動作チェック</p></li></ol> <p>ホストマシンの適当なブラウザから<a href="http://localhost:8080" target="_blank" rel="noopener noreferrer">localhost:8080<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>にアクセスし、下記のようなエラーページが表示されることを確認してください。</p> <p><img src="/bootcamp/assets/img/white-label-error.c9ee4513.png" alt="初回起動 - WhitelabelErrorPage"></p> <h2 id="java-の基本"><a href="#java-の基本" class="header-anchor">#</a> Java の基本</h2> <p>Java は OpenJDK コミュニティによって開発され、各ベンダからリリースされているプログラミング言語です。
古くから利用されているプログラミング言語/プラットフォームである一方、2024 年現在でも SI や大規模開発の現場などでよく利用されています。</p> <h3 id="言語としての特徴"><a href="#言語としての特徴" class="header-anchor">#</a> 言語としての特徴</h3> <p>Java は C 言語や Rust と同じ静的型付き言語です。そのため文法や記法は C 言語を踏襲した書き方となっています。<br>
Java の言語のパラダイムとしては、クラスの継承の概念やインタフェースなどの言語仕様を持つためオブジェクト指向プログラミングであります。その一方、Java のバージョン 8 以降は関数型インタフェースやパターンマッチなど、関数型プログラミングを楽しめるような仕様も導入されています。</p> <details class="custom-block details"><summary>Java のサンプルコード</summary> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>iij<span class="token punctuation">.</span>bootcamp<span class="token punctuation">.</span>serverapp</span><span class="token punctuation">;</span> <span class="token comment">// パッケージ名(世界でユニークであると良い)</span>

<span class="token comment">// 自社ドメインを持つ企業での製造物には自社ドメインをそのまま利用することが多い</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span> <span class="token comment">// 外部モジュールの利用(JavaではIDEに任せてしまうのが一般的)</span>

<span class="token comment">/**
 * 複数行に渡るコメント文
 *
 * - 一般的にはJavaのクラス名の命名はパスカルケース - クラス名とjavaファイルの名前は一致させる方が良い(1クラス1ファイル)
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SampleClass</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span> <span class="token punctuation">{</span>

  <span class="token comment">// アクセス修飾子はprivate/protected/public</span>
  <span class="token keyword">private</span> <span class="token class-name">String</span> iamPrivate<span class="token punctuation">;</span>

  <span class="token comment">// Javaの変数・メソッドの命名は(ローワー)キャメルケース</span>
  <span class="token keyword">protected</span> <span class="token class-name">String</span> iamProtected<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token class-name">String</span> iamPublic<span class="token punctuation">;</span>

  <span class="token comment">// アノテーション。そのものに効果があるものではなく、横断的に処理したりする際の目印として使うことが多い</span>
  <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;unused&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">sampleMethod</span><span class="token punctuation">(</span><span class="token class-name">String</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> b <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      b <span class="token operator">=</span> <span class="token string">&quot;world&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> b<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 残念ながらJavaはnull安全な言語ではない(NullPointerExceptionの危機)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyInnerClass</span> <span class="token punctuation">{</span> <span class="token comment">// クラスの中にクラスを定義することもできる(インナークラス)</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> finalizedString<span class="token punctuation">;</span> <span class="token comment">// final化(不変化)ができる</span>

    <span class="token keyword">public</span> <span class="token class-name">MyInnerClass</span><span class="token punctuation">(</span><span class="token class-name">String</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// コンストラクタはクラス名を同一にすることで表現</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>finalizedString <span class="token operator">=</span> arg<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getFinalizedString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>finalizedString<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">makeInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// クラスの具体的な値(オブジェクト)のことを&quot;インスタンス&quot;と言います</span>
    <span class="token keyword">var</span> ins <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyInnerClass</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Java11から型推論が使える</span>
    ins<span class="token punctuation">.</span><span class="token function">getFinalizedString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// → hello</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div></details> <h3 id="プロジェクト構成"><a href="#プロジェクト構成" class="header-anchor">#</a> プロジェクト構成</h3> <p>Java のプロジェクトのディレクトリ構成は、ほかのプログラミング言語と異なり言語として定められています。名前空間として定義できる&quot;パッケージ&quot;がそのままディレクトリに反映されるようにディレクトリを構成する必要があります。</p> <p>参考: <a href="https://docs.oracle.com/javase/tutorial/java/package/managingfiles.html" target="_blank" rel="noopener noreferrer">https://docs.oracle.com/javase/tutorial/java/package/managingfiles.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>たとえば<code>com.github.iij.bootcamp</code>パッケージ(=名前空間)配下に<code>Hoge</code>と<code>Huga</code>というクラスを作成する場合、下記のようなディレクトリ構造/ファイル構造になります。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>.
├── build.gradle
└── src
    └── main
        └── java
            └── com
                └── github
                    └── iij
                        └── bootcamp
                            └── Hoge.java
                            │   └── class Hoge { ... }
                            └── Huga.java
                                └── class Huga { ... }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">パッケージ</p> <p>Java におけるパッケージとは、DNS 形式で定義できる名前空間のような概念です。<code>.</code>で区切ることでパッケージ間の親子関係を定義できます。たとえば<code>com.example.iij</code>パッケージと<code>com.example.iij.bootcamp</code>パッケージでは前者が親で後者が子といった関係があります。</p></div> <h3 id="gradle"><a href="#gradle" class="header-anchor">#</a> Gradle</h3> <p>Python であれば pip、Rust であれば cargo、Node.js であれば npm のようにプログラミング言語にはそれぞれ依存関係を解決しビルドを自動化する自動化システムツールが用意されています。</p> <p>Java では Maven と Gradle という 2 つの種類の自動化システムツールがよく利用されています。本講義では Gradle を利用して話を進めていきます。</p> <h2 id="spring-boot-の基本"><a href="#spring-boot-の基本" class="header-anchor">#</a> Spring Boot の基本</h2> <p>Spring Boot は Java の Web フレームワークのひとつです。Spring Boot の規約に従ってアプリケーションロジックを実装することで簡単に Web アプリケーションを構築できます。</p> <p>このフレームワークは大規模な主幹システムや Web アプリケーションを実装/構築する際によく利用されており、IIJ がホストしているいくつかのサービスも Spring Boot を利用して実装されています。</p> <h3 id="特徴"><a href="#特徴" class="header-anchor">#</a> 特徴</h3> <p>Spring Boot は複雑な業務要件や非機能要件をクリアするためのさまざまな機能を有しています。依存関係を宣言して注入してくれる DI コンテナや横断的な関心事を解決する AOP のサポート、数多く公開されている starter パッケージなどはその最たる例です。</p> <p>残念ながらこの Bootcamp ですべての要素に触れることはできないため、興味のあるほうはドキュメントを読んでみることをお勧めします。</p> <h2 id="spring-boot-ハンズオン"><a href="#spring-boot-ハンズオン" class="header-anchor">#</a> Spring Boot ハンズオン</h2> <p>本ハンズオンではブラウザで閲覧できる Web UI の機能を持たない、HTTP API(Application Programming Interface)だけを持つ API サーバを構築していきます。</p> <p>それでは始めましょう。</p> <h3 id="簡単なクラスを作ってみる"><a href="#簡単なクラスを作ってみる" class="header-anchor">#</a> 簡単なクラスを作ってみる</h3> <p>まず始めに、Java 言語のウォーミングアップとして純粋な Java のクラスを作ってみましょう。</p> <p>💻 <code>User</code>クラスを作成します。</p> <p>下記の通りに修正してみましょう。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// src/main/java/com/github/iij/bootcamp/serverapp/User.java</span>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>iij<span class="token punctuation">.</span>bootcamp<span class="token punctuation">.</span>serverapp</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>

  <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setId</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;name: &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;id: &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>これで<code>User</code>クラスを作成できました。次にこのクラスを実際にインスタンス化してみます。<br>
Spring Boot アプリケーションの main 関数は<code>com.github.iij.bootcamp.serverapp.ServerAppApplication</code>にあります。ためしにこの main 関数の中で<code>User</code>クラスをインスタンス化してみます。</p> <p>💻 ServerAppApplication.java を修正してください。</p> <div class="language-java line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br></div><pre class="language-java"><code><span class="token comment">// src/main/java/com/github/iij/bootcamp/serverapp/ServerAppApplication.java</span>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>iij<span class="token punctuation">.</span>bootcamp<span class="token punctuation">.</span>serverapp</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServerAppApplication</span> <span class="token punctuation">{</span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 追記BEGIN</span>
		<span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;アリス&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;alice&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 追記END</span>
		<span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ServerAppApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>編集が完了したら以下のコマンドをコンテナから実行してサーバを起動しましょう。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>❯ ./gradlew bootRun
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>再起動時にログに&quot;name: アリス,id: alice&quot;と表示されていれば OK です。</p> <h4 id="チェックポイント-その-1"><a href="#チェックポイント-その-1" class="header-anchor">#</a> チェックポイント その 1</h4> <ul><li>Java のクラスを作成した</li> <li>クラスをインスタンス化し、標準出力に文字列を表示した</li></ul> <h4 id="解説"><a href="#解説" class="header-anchor">#</a> 解説</h4> <p>純粋な Java のクラスを作成し、インスタンス化とメソッドの呼び出しを行いました。<code>User</code>クラスを眺めてもらうとわかるとおり、<code>getName</code>や<code>getId</code>など Java にはかなり冗長なコードが多いです。これらのコードはよく「ボイラープレート」と呼ばれ、開発者が嫌うコードです。</p> <p>Java には Lombok などのボイラープレートを解消するツールなどありますが、本講義はあえて紹介しません。興味がある人は調べてみてください。</p> <h3 id="簡単な-http-のインタフェースを作成してみる"><a href="#簡単な-http-のインタフェースを作成してみる" class="header-anchor">#</a> 簡単な HTTP のインタフェースを作成してみる</h3> <p>それでは Spring Boot を使ってみましょう。<br>
簡単な HTTP のインタフェースを作成し、実際に Spring Boot がどのように動作しているのかを見てみます。</p> <p>💻 ServerAppApplication.java を修正し、サーバを再起動してみてください。</p> <div class="language-java line-numbers-mode"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br></div><pre class="language-java"><code><span class="token comment">// src/main/java/com/github/iij/bootcamp/serverapp/ServerAppApplication.java</span>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>iij<span class="token punctuation">.</span>bootcamp<span class="token punctuation">.</span>serverapp</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span>
<span class="token comment">// 追記BEGIN</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>
<span class="token comment">// 追記END</span>

<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServerAppApplication</span> <span class="token punctuation">{</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;アリス&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;alice&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ServerAppApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 追記BEGIN</span>
  <span class="token annotation punctuation">@RestController</span>
  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>path <span class="token operator">=</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">helloWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">&quot;hello world&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 追記END</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># Spring Bootサーバーを再起動する</span>
❯ ./gradlew bootRun
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code># 動作確認
$ curl localhost:8080 -X GET
hello world
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>&quot;hello world&quot;が返ってきたら成功です。</p> <h4 id="チェックポイント-その-2"><a href="#チェックポイント-その-2" class="header-anchor">#</a> チェックポイント その 2</h4> <ul><li><code>@RestController</code>アノテーションをクラスに付与して HTTP のインタフェースを作成した</li></ul> <h4 id="解説-2"><a href="#解説-2" class="header-anchor">#</a> 解説</h4> <p><code>bootRun</code>コマンドにより Spring Boot が起動します。すると、Spring Boot の機能により <code>@RestController</code>アノテーションが付いている<code>ServerAppApplication.HelloController</code>が HTTP のインタフェースとして登録されます。</p> <p><img src="/bootcamp/assets/img/http-handler.0b72f6d9.png" alt="handler"></p> <p>その結果、この Spring Boot が動いている 8080 番ポート宛の HTTP リクエストと<code>ServerAppApplication.HelloController#helloWorld</code>が紐づけられることになり、<code>GET /</code>へのリクエストのレスポンスとして&quot;hello world&quot;が返ってきました。</p> <details class="custom-block details"><summary>Spring Boot と DI コンテナ</summary> <p>Spring Boot は起動時に起動クラスのパッケージ配下の Java ファイルから特殊なアノテーション(<code>@Contoroller</code> / <code>@Component</code> / etc...)がついたクラスを探し出します。そして Spring Boot はそのクラスを適当な方法でインスタンス化し、自身の管理下(=DI コンテナ)に置きます。</p> <p>(「適当な方法」を指定することもできます &gt; <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/Bean.html" target="_blank" rel="noopener noreferrer">Bean Annotation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)</p> <p>DI コンテナに格納されたインスタンスは、後述する<code>@Autowired</code>アノテーションを使って引き出すことができます。</p> <p>特に、<code>@Controller</code> <code>@RestController</code>アノテーションが付与されたクラスから生成されたインスタンスは HTTP のインタフェースとして働くことになります。</p> <p>今回の例では、 <code>ServerAppApplication</code>クラスに<code>@SpringBootApplication</code>アノテーションが付与されているので<code>ServerAppApplication</code>クラスのパッケージ<code>com.github.iij.bootcamp.serverapp</code>配下のクラスから上述の特殊なアノテーションがついているクラスを探索します。</p> <p><code>HelloController</code>クラスは<code>@RestController</code>アノテーションが付与されているため、Spring Boot 起動時に<code>HelloController</code>が Spring Boot によってインスタンス化され DI コンテナに登録されました。
その結果、<code>GET /</code>のリクエストを Spring Boot が受け取ると<code>HelloController#helloWorld</code> が実行されるようになっていたというわけです。</p></details> <h3 id="簡単なリクエストを受け取ってみる"><a href="#簡単なリクエストを受け取ってみる" class="header-anchor">#</a> 簡単なリクエストを受け取ってみる</h3> <p>次にクエリパラメータから情報を取得してみましょう。</p> <p>💻 UserController.java を作成し、サーバを再起動してみてください。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// src/main/java/com/github/iij/bootcamp/serverapp/UserController.java</span>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>iij<span class="token punctuation">.</span>bootcamp<span class="token punctuation">.</span>serverapp</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestParam</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>

  <span class="token keyword">private</span> <span class="token class-name">User</span> secretUser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;ボブ&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bob&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>path <span class="token operator">=</span> <span class="token string">&quot;/user&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">find</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;bob&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>secretUser<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># Spring Bootサーバーを再起動する</span>
❯ ./gradlew bootRun
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 動作確認</span>
$ <span class="token function">curl</span> <span class="token string">'localhost:8080/user?id=bob'</span>
<span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;ボブ&quot;</span>,<span class="token string">&quot;id&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;bob&quot;</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="チェックポイント-その-3"><a href="#チェックポイント-その-3" class="header-anchor">#</a> チェックポイント その 3</h4> <ul><li><code>@GetMapping</code>アノテーションを持つメソッドを作成し、HTTP のハンドラとして登録した</li> <li>HTTP のハンドラとして登録されたメソッドの引数に<code>@RequestParam</code>アノテーションを付与することでクエリパラメータを実装した</li></ul> <h4 id="解説-3"><a href="#解説-3" class="header-anchor">#</a> 解説</h4> <p>新しいクラス<code>UserController</code>を作成しました。このクラスにも<code>@RestController</code>アノテーションが付いているため HTTP のインタフェースとして振る舞います。</p> <p><code>UserController</code>クラスの持つメソッド<code>find</code>には<code>@GetMapping</code>アノテーションがついているため、<code>GET /user</code>宛のリクエストのハンドラとして登録されることになります。そのため、Spring Boot アプリケーションの<code>/user</code>へ GET リクエストを送ることでこの<code>find</code>メソッドがコールされます。</p> <p>さらに<code>find</code>メソッドの引数<code>id</code>に<code>@RequestParam</code>アノテーションが付与されています。これにより、HTTP リクエストのクエリパラメータの値がこの変数に注入されます。つまり<code>GET /user?id=bob</code>へのリクエストを Spring Boot アプリケーションへ送ることで<code>find</code>メソッドがコールされ引数<code>id=bob</code>が引き渡されます。</p> <h3 id="責任を分離する"><a href="#責任を分離する" class="header-anchor">#</a> 責任を分離する</h3> <p>さて、前章まで基本的な HTTP のインタフェースの作り方と使い方について解説してきました。もう少し実装を深めていきましょう。<br>
現在<code>UserController</code>クラスは HTTP のインタフェースとデータソースの管理の 2 つの責務を持っています。これは単一責務の原理から外れているためリファクタリングする対象です。</p> <p>今回はシンプルに<code>UserController#find</code>の処理を抽出して別のクラスに分離、処理そのものを<code>UserController</code>クラスの外から与えてあげるようにしましょう。</p> <p>💻 UserService.java を作成、UserController.java を修正し、サーバを再起動してください。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// src/main/java/com/github/iij/bootcamp/serverapp/UserService.java</span>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>iij<span class="token punctuation">.</span>bootcamp<span class="token punctuation">.</span>serverapp</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>

  <span class="token comment">// データソースに該当する部分</span>
  <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> userPool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;ボブ&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bob&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/**
   * ユーザープールからid値で検索し、その結果を返却します idと一致するユーザーが見つからない場合nullを返却します
   * TODO 本当にこの実装で問題ないか、考えてみましょう
   *   - 同一のidをもつインスタンスがいる場合は？データ構造はこれで良いか？
   *   - nullは`User`インスタンスではない、では見つからない場合は何を返すべき？
   */</span>
  <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Java8から導入されたStreamAPI</span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userPool
      <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Streamを作成</span>
      <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>u <span class="token operator">-&gt;</span> id<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// idと一致する`User`インスタンスのみを抽出</span>
      <span class="token punctuation">.</span><span class="token function">findFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 抽出結果の先頭1つだけを取り出す</span>
      <span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// もし抽出した結果何も残らなかった場合、nullを返却する</span>
    <span class="token keyword">return</span> user<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><div class="language-java line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br></div><pre class="language-java"><code><span class="token comment">// src/main/java/com/github/iij/bootcamp/serverapp/UserController.java</span>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>iij<span class="token punctuation">.</span>bootcamp<span class="token punctuation">.</span>serverapp</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestParam</span></span><span class="token punctuation">;</span>
<span class="token comment">// 追記BEGIN</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token comment">// 追記END</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>

  <span class="token comment">// 修正BEGIN</span>
  <span class="token annotation punctuation">@Autowired</span>
  <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>

  <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>path <span class="token operator">=</span> <span class="token string">&quot;/user&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">find</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userService<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 修正END</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># Spring Bootサーバーを再起動する</span>
❯ ./gradlew bootRun
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 動作確認</span>
$ <span class="token function">curl</span> <span class="token string">'localhost:8080/user?id=bob'</span>
<span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;ボブ&quot;</span>,<span class="token string">&quot;id&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;bob&quot;</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="チェックポイント-その-4"><a href="#チェックポイント-その-4" class="header-anchor">#</a> チェックポイント その 4</h4> <ul><li><code>@Component</code>アノテーションをクラスに付与し、Spring Boot 起動時に自動的にインスタンス化した</li> <li><code>@Autowired</code>アノテーションをフィールドに付与し、そのフィールドに Spring Boot がインスタンス化したインスタンスの中から適切なインスタンスを注入した</li></ul> <h4 id="解説-4"><a href="#解説-4" class="header-anchor">#</a> 解説</h4> <p>新しいクラス<code>UserService</code>を作成しました。このクラスには<code>@Component</code>アノテーションが付与されているため、Spring Boot 起動時に Spring Boot によって自動的にインスタンス化され Spring Boot の管理下に入ります。このように Spring Boot に管理されるようになったインスタンスはほかのクラスから<code>@Autowired</code>を利用することで利用されます。</p> <p>今回の例では<code>UserController</code>クラスが<code>userService</code>フィールドに<code>@Autowired</code>アノテーションを付与しているため自動的に作成された<code>UserService</code>クラスのインスタンスが<code>UserController.userService</code>に代入されることになりました。このように依存関係を分離、外から依存関係を持ち込む構成のことを DI(Dependency Injection)と呼びます。</p> <p>注意点として、デフォルトの挙動では Spring Boot が管理するインスタンスは各クラス&quot;1 つ&quot;となっています。つまり<code>UserController</code>クラスが引っ張ってきている<code>userService</code>とほかのクラスが引っ張ってこれる<code>UserService</code>インスタンスは完全に一致しています。このようにひとつのインスタンスを使い回す構成のことを&quot;シングルトン&quot;と呼びます。</p> <h3 id="少し複雑なリクエストを受け取ってみる"><a href="#少し複雑なリクエストを受け取ってみる" class="header-anchor">#</a> 少し複雑なリクエストを受け取ってみる</h3> <p>最後に、POST リクエストとリクエストボディを指定して<code>User</code>インスタンスを登録してみましょう。<br> <code>User</code>インスタンスには<code>id</code>と<code>name</code>の値を指定する必要があるので、これらを与えられるエンドポイントを用意します。</p> <p>💻 UserService.java と UserController.java を修正し、サーバを再起動してください。</p> <div class="language-java line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br></div><pre class="language-java"><code><span class="token comment">// src/main/java/com/github/iij/bootcamp/serverapp/UserService.java</span>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>iij<span class="token punctuation">.</span>bootcamp<span class="token punctuation">.</span>serverapp</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>

  <span class="token comment">// データソースに該当する部分</span>
  <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> userPool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;ボブ&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bob&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/**
   * ユーザープールからid値で検索し、その結果を返却します idと一致するユーザーが見つからない場合nullを返却します
   */</span>
  <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userPool
      <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>u <span class="token operator">-&gt;</span> id<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">findFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> user<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 追記BEGIN</span>
  <span class="token comment">/**
   * ユーザープールにUserを追加します
   */</span>
  <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>userPool<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> user<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 追記END</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><div class="language-java line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br></div><pre class="language-java"><code><span class="token comment">// src/main/java/com/github/iij/bootcamp/serverapp/UserController.java</span>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>iij<span class="token punctuation">.</span>bootcamp<span class="token punctuation">.</span>serverapp</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestParam</span></span><span class="token punctuation">;</span>
<span class="token comment">// 追記BEGIN</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PostMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestBody</span></span><span class="token punctuation">;</span>
<span class="token comment">// 追記END</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Autowired</span>
  <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>

  <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>path <span class="token operator">=</span> <span class="token string">&quot;/user&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">find</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userService<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 追記BEGIN</span>

  <span class="token comment">// POST /user 宛のリクエストボディスキーマ</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">UserCreateRequest</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setId</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span>path <span class="token operator">=</span> <span class="token string">&quot;/user&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">UserCreateRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">User</span> newUser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userService<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>newUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 追記END</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># Spring Bootサーバーを再起動する</span>
❯ ./gradlew bootRun
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 動作確認</span>
$ <span class="token function">curl</span> localhost:8080/user -X POST -H <span class="token string">'Content-Type: application/json'</span> -d <span class="token string">'{&quot;name&quot;: &quot;アリス&quot;, &quot;id&quot;: &quot;alice&quot;}'</span>
<span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;アリス&quot;</span>, <span class="token string">&quot;id&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;alice&quot;</span><span class="token punctuation">}</span>

$ <span class="token function">curl</span> <span class="token string">'localhost:8080/user?id=alice'</span>
<span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;アリス&quot;</span>, <span class="token string">&quot;id&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;alice&quot;</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="チェックポイント-その-5"><a href="#チェックポイント-その-5" class="header-anchor">#</a> チェックポイント その 5</h4> <ul><li><code>@PostMapping</code>アノテーションをメソッドに付与し、POST リクエストの HTTP ハンドラとして登録した</li> <li>Java の POJO を用いて POST リクエストのリクエストボディのスキーマを表現した</li></ul> <h2 id="まとめ"><a href="#まとめ" class="header-anchor">#</a> まとめ</h2> <p>以上で Spring Boot のハンズオンは終了です。</p> <p>本講義では Java の基本的な知識や書き方、Spring Boot の使い方など、基本的な機能や文法に触れてもらいました。しかし Spring Boot には多様な機能がまだまだ存在しており、データベースとの接続や非同期処理などさまざまなプロダクション環境で活躍できるポテンシャルを持っているフレームワークです。</p> <p>本講義が、受講者のみなさまの今後の技術選定の手助けになれれば幸いです。</p> <h3 id="追加の資料"><a href="#追加の資料" class="header-anchor">#</a> 追加の資料</h3> <ul><li><a href="https://spring.pleiades.io/spring-boot/docs/current/reference/html" target="_blank" rel="noopener noreferrer">Spring Boot リファレンスドキュメント<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <ul><li>多くの Spring Boot 開発者がお世話になる公式ドキュメントです。アプリケーションの開発からデプロイ方法まで、幅広く情報が提供されています。</li></ul></li> <li><a href="https://spring.pleiades.io/guides" target="_blank" rel="noopener noreferrer">Spring Boot Guides<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <ul><li>Spring Boot の各種機能を試してみるチュートリアルが公開されています。Pub/Sub や MongoDB、Docker との連携など Spring Boot の拡張が多種公開されています。興味のある項目に触ってみてください。</li></ul></li></ul> <div><hr> <span>CC BY-SA Licensed | Copyright (c) 2020, Internet Initiative Japan Inc.</span></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/iij/bootcamp/edit/master/src/server-app/java/README.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">8/19/2024, 12:17:43 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/bootcamp/assets/js/app.7c511c2a.js" defer></script><script src="/bootcamp/assets/js/2.8be9fd60.js" defer></script><script src="/bootcamp/assets/js/26.2912fe5e.js" defer></script><script src="/bootcamp/assets/js/18.2a5d0854.js" defer></script><script src="/bootcamp/assets/js/17.a5ea2536.js" defer></script>
  </body>
</html>
