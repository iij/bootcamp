<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>IIJ Bootcamp</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="Java Springフレームワークを使ったアプリ開発に関するハンズオンです">
    <link rel="preload" href="/bootcamp/assets/css/0.styles.18b30168.css" as="style"><link rel="preload" href="/bootcamp/assets/js/app.22a49ce1.js" as="script"><link rel="preload" href="/bootcamp/assets/js/2.d60b740b.js" as="script"><link rel="preload" href="/bootcamp/assets/js/30.b67696f0.js" as="script"><link rel="preload" href="/bootcamp/assets/js/8.6a14b673.js" as="script"><link rel="preload" href="/bootcamp/assets/js/7.c01d2735.js" as="script"><link rel="prefetch" href="/bootcamp/assets/js/10.d1d96387.js"><link rel="prefetch" href="/bootcamp/assets/js/11.a4a003d9.js"><link rel="prefetch" href="/bootcamp/assets/js/12.4fe1dc3d.js"><link rel="prefetch" href="/bootcamp/assets/js/13.c1ab7b6e.js"><link rel="prefetch" href="/bootcamp/assets/js/14.6633ee23.js"><link rel="prefetch" href="/bootcamp/assets/js/15.0ae21d70.js"><link rel="prefetch" href="/bootcamp/assets/js/16.27f81301.js"><link rel="prefetch" href="/bootcamp/assets/js/17.d91f6ab0.js"><link rel="prefetch" href="/bootcamp/assets/js/18.7d29e7e7.js"><link rel="prefetch" href="/bootcamp/assets/js/19.fd7ec36f.js"><link rel="prefetch" href="/bootcamp/assets/js/20.41338eff.js"><link rel="prefetch" href="/bootcamp/assets/js/21.5ae85c01.js"><link rel="prefetch" href="/bootcamp/assets/js/22.7d5ee5a4.js"><link rel="prefetch" href="/bootcamp/assets/js/23.2b87ca2a.js"><link rel="prefetch" href="/bootcamp/assets/js/24.796c40e9.js"><link rel="prefetch" href="/bootcamp/assets/js/25.d576758f.js"><link rel="prefetch" href="/bootcamp/assets/js/26.354c01ea.js"><link rel="prefetch" href="/bootcamp/assets/js/27.5b5c8d37.js"><link rel="prefetch" href="/bootcamp/assets/js/28.5ae6b74c.js"><link rel="prefetch" href="/bootcamp/assets/js/29.60d49b21.js"><link rel="prefetch" href="/bootcamp/assets/js/3.cf5b019b.js"><link rel="prefetch" href="/bootcamp/assets/js/31.cc649247.js"><link rel="prefetch" href="/bootcamp/assets/js/32.494d9410.js"><link rel="prefetch" href="/bootcamp/assets/js/33.53a9da0b.js"><link rel="prefetch" href="/bootcamp/assets/js/34.5b88ebf2.js"><link rel="prefetch" href="/bootcamp/assets/js/4.507b5d38.js"><link rel="prefetch" href="/bootcamp/assets/js/5.28168a90.js"><link rel="prefetch" href="/bootcamp/assets/js/6.bac51d5e.js"><link rel="prefetch" href="/bootcamp/assets/js/9.9be8ba1d.js">
    <link rel="stylesheet" href="/bootcamp/assets/css/0.styles.18b30168.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/bootcamp/" class="home-link router-link-active"><!----> <span class="site-name">IIJ Bootcamp</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/iij/bootcamp" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/iij/bootcamp" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/bootcamp/server-app/java/#springとは" class="sidebar-link">Springとは</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/bootcamp/server-app/java/#環境構築" class="sidebar-link">環境構築</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bootcamp/server-app/java/#必要な道具" class="sidebar-link">必要な道具</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/java/#jdk" class="sidebar-link">JDK</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/java/#データベース" class="sidebar-link">データベース</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/java/#maven" class="sidebar-link">Maven</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/java/#ide" class="sidebar-link">IDE</a></li></ul></li><li><a href="/bootcamp/server-app/java/#プロジェクトの準備" class="sidebar-link">プロジェクトの準備</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bootcamp/server-app/java/#pom-xmlの準備" class="sidebar-link">pom.xmlの準備</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/java/#ソースディレクトリの作成" class="sidebar-link">ソースディレクトリの作成</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/java/#メインクラスの作成" class="sidebar-link">メインクラスの作成</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/java/#データベースアクセス" class="sidebar-link">データベースアクセス</a></li></ul></li><li><a href="/bootcamp/server-app/java/#最後に" class="sidebar-link">最後に</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><table><tr><td>このハンズオンでやること</td><td>Java Springフレームワークを使ったアプリ開発に関するハンズオンです</td></tr> <tr><td>想定時間</td><td>1h</td></tr> <tr><td>前提知識・用語</td><td>特になし</td></tr></table> <h1 id="springでwebアプリを作る"><a href="#springでwebアプリを作る" class="header-anchor">#</a> SpringでWebアプリを作る</h1> <h2 id="springとは"><a href="#springとは" class="header-anchor">#</a> Springとは</h2> <p>ここでいうSpringとはSpringフレームワークのことです。</p> <p>Springフレームワークは、もともと、複雑すぎるJava EEに対するアンチテーゼとして登場したフレームワークでした。Java EE (Enterprise Edition) は多数のサーバからなる分散アプリケーションを包括的に実現する業界標準として鳴り物入りで登場しました。ServletやJSPといった技術もJava EEの部分を構成する要素技術です。</p> <p>話が長くなるので結論だけ言うと、Springは大成功を収め、現在では巨大なフレームワークに成長しています。その首尾範囲と言い、規模と言い...おそらく一人でSpringフレームワークの全容を把握できる人はいないのではないか? と思われるほどです。</p> <p>あまりにも巨大になったSpringフレームワークの導入を助けるために、現在ではSpring Bootと呼ばれる、スタンドアローンなSpringベースのWebアプリケーションを簡単に作り始めることのできる仕組みが用意されています。</p> <p>われわれも、このSpring Bootを使って、SpringベースのWebアプリケーションを簡単に作ってみようと思います。</p> <h2 id="環境構築"><a href="#環境構築" class="header-anchor">#</a> 環境構築</h2> <h3 id="必要な道具"><a href="#必要な道具" class="header-anchor">#</a> 必要な道具</h3> <ol><li>JDK</li> <li>データベース</li> <li>Maven</li> <li>IDE</li></ol> <h3 id="jdk"><a href="#jdk" class="header-anchor">#</a> JDK</h3> <p>事前準備で用意したVMにOpenJDK8がインストール済みなので、そのまま使います。</p> <p>JDKとはJava Development Kitのアクロニムで、プログラミング言語Javaで開発を行なうために必須のプログラムです。
(そう、SpringフレームワークはJavaのためのフレームワークです!)</p> <p>OpenJDKは、JDKのオープンソース実装です。</p> <p>JDのバージョン8は、少し古いバージョンなのですが、バージョン9で入った変更が非常に大きなインパクトがあり、まだ本番環境でバージョン9以降を採用しているところは多くないと思われます。そこで、今回はバージョン8を採用してハンズオンを進めたいと思います。</p> <h3 id="データベース"><a href="#データベース" class="header-anchor">#</a> データベース</h3> <p>データベースも、事前準備で用意したVMにMongoDBがインストール済みなので、そのまま使います。</p> <h3 id="maven"><a href="#maven" class="header-anchor">#</a> Maven</h3> <p>Mavenは、Javaにおけるプロジェクト管理およびライブラリ管理のための標準的なツールです。</p> <p>プロジェクト管理とは、Mavenの文脈では、プロジェクトに必要なライブラリやプラグインをダウンロードしてきてインストールし、ソースコードをしかるべきディレクトリに整理し、プロジェクトを実行可能な形式にビルドし、テストを実行し、ステージング環境や本番環境にデプロイする、といったタスクを一元的に引き受けてくれるツールを指します。</p> <p>Mavenのインストールは、以下のとおりの手順です。</p> <div class="language- extra-class"><pre class="language-text"><code>$ curl -OL wget https://archive.apache.org/dist/maven/maven-3/3.6.1/binaries/apache-maven-3.6.1-bin.tar.gz
$ gzip -dc apache-maven-3.6.1-bin.tar.gz | tar xvf -
$ sudo mv apache-maven-3.6.1 /opt/
$ sudo ln -s /opt/apache-maven-3.6.1 /opt/apache-maven
$ rm apache-maven-3.6.1-bin.tar.gz
</code></pre></div><p>やっていることは、</p> <ol><li>最新の安定板であるバージョン3.6.1のバイナリtarボールをダウンロードしてきて</li> <li>展開し</li> <li>/opt以下にmvして</li> <li>新しいバージョンが出てきたときに備えてシンボリックリンクを切り、</li> <li>1でダウンロードしたtarボールを削除する</li></ol> <p>ということですね。</p> <p>それから、社内でMavenを使うためにはプロキシの設定が必要です。</p> <p>ホームディレクトリの直下に.m2というディレクトリを作り、そこに以下の内容のsettings.xmlを置いてください。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>settings</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>proxies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>proxy</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>active</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>active</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>host</span><span class="token punctuation">&gt;</span></span>proxy.jp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>host</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>port</span><span class="token punctuation">&gt;</span></span>8080<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>port</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>proxy</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>proxies</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>settings</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><h3 id="ide"><a href="#ide" class="header-anchor">#</a> IDE</h3> <p>Javaの開発では、実質的にIDE (統合開発環境) の使用が必須です。</p> <p>有名なIDEは以下の3つです。</p> <ol><li>Eclipse</li> <li>IntelliJ IDEA</li> <li>NetBeans</li></ol> <p>講師はIntelliJ IDEAをおすすめします。</p> <p>デフォルトで気の利いた設定になっており、あれこれプラグインを入れる必要がなく、動作も軽快だからです。</p> <p>IntelliJ IDEAは無料のCommunity Editionと有料のUltimate Editionがありますが、どちらを選んでもかまいません。Untimate Editionでも、30日間は試用が可能ですし、それほど高価なソフトウェアではありません。</p> <p>(IntelliJ IDEAのインストールは、やや時間がかかるので、ハンズオンでは説明を省略し、IDEを使わずに進めます。)</p> <h2 id="プロジェクトの準備"><a href="#プロジェクトの準備" class="header-anchor">#</a> プロジェクトの準備</h2> <p>まずはプロジェクトディレクトリを作りましょう。</p> <p>どこでも良いですし、どんな名前でも良いです。</p> <p>講師は、個人的に、ホームディレクトリの直下にworkというディレクトリを作成し、その中に各種プロジェクトのディレクトリを作るようにしています。</p> <div class="language- extra-class"><pre class="language-text"><code>$ mkdir -p work/bootcamp-spring
</code></pre></div><p>このような感じですね。</p> <p>gitを使っているなら、このディレクトリでgit initしましょう。</p> <p>GitHubを使っているなら、.gitignoreのプルダウンメニューからMavenを選んで新しいレポジトリを作ってgit cloneすると良いと思います。</p> <p>MercurialやBitBucketを使っている人も、まあ、同様です。</p> <p>gitもGitHubもMercurialもBitBucketも使っていないなら...後で校長室に来るように。</p> <h3 id="pom-xmlの準備"><a href="#pom-xmlの準備" class="header-anchor">#</a> pom.xmlの準備</h3> <p>続いてpom.xmlを準備します。pom.xmlは、Mavenのためのプロジェクト設定ファイルです。</p> <p>個人的には、この種の設定ファイルは写経を兼ねて手で入力すると良いと思うのですが、今日はハンズオンですので、以下のURLからダウンロードしてください。</p> <p><a href="https://iij.github.io/bootcamp/server-app/java/pom.xml" target="_blank" rel="noopener noreferrer">https://iij.github.io/bootcamp/server-app/java/pom.xml<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>pom.xmlはプロジェクトディレクトリの直下に置きます。</p> <h3 id="ソースディレクトリの作成"><a href="#ソースディレクトリの作成" class="header-anchor">#</a> ソースディレクトリの作成</h3> <p>プロジェクトディレクトリの下にソースディレクトリを作成します。</p> <div class="language- extra-class"><pre class="language-text"><code>$ cd プロジェクトディレクトリ
$ mkdir -p src/main/java
$ mkdir -p src/main/resources
$ mkdir -p src/test/java
$ mkdir -p src/test/resources
</code></pre></div><p>src/main/java以下には、プロダクトコードを配置します。実際に動かすソフトウェアのためのソースコードす。</p> <p>src/main/resources以下には、JARファイルに格納したいリソース(各種設定ファイル等)を配置します。</p> <p>src/test/java以下には、テストコードを配置します。JUnitなどを使うコードですね。本ハンズオンでは、使用しません...</p> <p>src/test/java以下には、テスト用のリソースを配置します。src/test/javaに書いたテストコードで利用したいリソースをここに配置して、読み込ませます。本ハンズオンでは、使用しません...</p> <p>IntelliJ IDEAを使っている場合は、ここで一度<code>mvn compile</code>します。</p> <div class="language- extra-class"><pre class="language-text"><code>$ mvn compile
</code></pre></div><p>そうしてから、プロジェクトディレクトリをOpenすると、Mavenプロジェクトであることを認識してくれます。</p> <h3 id="メインクラスの作成"><a href="#メインクラスの作成" class="header-anchor">#</a> メインクラスの作成</h3> <p>src/main/javaの下にパッケージjp.ad.iij.bootcamp.simpleのためのディレクトリ(つまりsrc/main/java/jp/ad/iij/bootcamp/simple)を作成し、以下の内容のソースファイルSimpleApplication.javaを作成しましょう。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">jp<span class="token punctuation">.</span>ad<span class="token punctuation">.</span>iij<span class="token punctuation">.</span>bootcamp<span class="token punctuation">.</span>simple</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot</span><span class="token punctuation">.</span><span class="token class-name">SpringApplication</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure</span><span class="token punctuation">.</span><span class="token class-name">EnableAutoConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">RequestMapping</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">RestController</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@EnableAutoConfiguration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleApplication</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token function">home</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;Hello World!&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">SimpleApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>(IntelliJ IDEAでやる場合のデモを見せる。)</p> <p>そうしたらコマンドラインから以下でサーバを起動します。</p> <div class="language- extra-class"><pre class="language-text"><code>$ mvn spring-boot:run
</code></pre></div><p>ブラウザを開いて、 <a href="http://localhost:8080" target="_blank" rel="noopener noreferrer">http://localhost:8080<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> にアクセスしましょう。</p> <p>Hello World! と表示されましたね。</p> <p>上記のソースコードは、コード量としては少ないですが、実はいろいろなことをやっています。</p> <p>少し詳しく（しかし簡単に）読んでみましょう。</p> <p>まずクラスSimpleApplicationの宣言に2つのアノテーションが記述されています。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@EnableAutoConfiguration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleApplication</span> <span class="token punctuation">{</span>
</code></pre></div><p>最初のアノテーション <code>@RestController</code> はこのSimpleApplicationがRESTコントローラであることを宣言しています。</p> <p>そのことによって、その後に出てくる <code>SpringApplication.run</code>によってアプリケーションを起動しようとするとき、RESTコントローラであるこを意識した起動プロセスが実行される仕組みになっています。</p> <p>その次のアノテーション <code>@EnableAutoConfiguration</code> も似たような感じですが、こちらはソースコードをビルドする際に、このクラスのアノテーションから設定ファイルを自動生成してくれます。ここでいう設定ファイルとは、アプリケーションサーバであるTomcatのための設定ファイルです。今回、われわれがpom.xmlに記述しているspring-boot-starter-data-mongodbには、Tomcatが同梱されています。TomcatにWebアプリケーションをデプロイするためにはアプリケーション記述子と呼ばれる設定ファイルが最低限必要で、その他にも諸々の設定ファイルが必要になるのですが、それらの設定ファイルを自動生成してくれるのですね。</p> <p>（Tomcatというのは、JavaにおけるWebアプケーション開発に必要となるServlet標準のためのリファレンス実装であるアプリケーションサーバです。簡単に言えば、JavaにおけるWebアプリケーションの実行にはServlet標準に準拠したアプリケーションサーバが必要で、Tomcatはそのもっとも標準的な実装である、ということですね。）</p> <h3 id="データベースアクセス"><a href="#データベースアクセス" class="header-anchor">#</a> データベースアクセス</h3> <p>最後に...というほどのことはしていませんが...データベースへのアクセスを実現してみましょう。</p> <p>以下のコマンドでMongoDBを起動してください。</p> <div class="language- extra-class"><pre class="language-text"><code>$ sudo service mongod start
</code></pre></div><p>今回はpeoplesというテーブルに<code>_id</code>と<code>name</code>という属性をもつドキュメントを作成し、その一覧を取得するAPIを作ってみます。</p> <p>まずはモデルクラスを定義します。ここでいうモデルは、MongoDBで言うところのコレクションに対応します。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">jp<span class="token punctuation">.</span>ad<span class="token punctuation">.</span>iij<span class="token punctuation">.</span>bootcamp<span class="token punctuation">.</span>simple<span class="token punctuation">.</span>model</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Id</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>mongodb<span class="token punctuation">.</span>core<span class="token punctuation">.</span>mapping</span><span class="token punctuation">.</span><span class="token class-name">Document</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Document</span><span class="token punctuation">(</span>collection<span class="token operator">=</span><span class="token string">&quot;peoples&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">People</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Id</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">People</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">People</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>
</code></pre></div><p>パッケージをjp.ad.iij.bootcamp.simple.modelとしましたが、実は規約等で決まっているわけではありません（この点はRuby on Railsなどとは異なるところです）。ただ、通常は多数のモデルを扱うので、モデルクラスを定義するmodelパッケージを専用に用意することは、慣習的に行なわれています。</p> <p>アノテーション <code>@Document</code> は、このクラスがMongoDBのドキュメントに対応するモデルクラスであることを表現しています。<code>collection=&quot;peoples&quot;</code>という指定は、このクラスで取り扱うモデル（ドキュメント）を格納するコレクションを指定しています。（MongoDBでいうコレクションは、RDBでいうテーブルに相当する概念です...MongoDBでは、あるコレクションに挿入するドキュメントの形式/構造は自由です。任意のJSONドキュメントを挿入することができます。しかし、一般的には、あるコレクションには一定の型のドキュメントを入れることが多く、RDBにおけるテーブルのように考えるわけです。）</p> <p>アノテーション <code>@Id</code> は、Springにおいてモデルの主キーを指定するものです。つまり、変数名idは主キーであることを意味しておらず、アノテーション <code>@Id</code>が付与されていることだけがその変数を主キーに対応させるのです。</p> <p>続いてレポジトリのインターフェースを定義します。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">jp<span class="token punctuation">.</span>ad<span class="token punctuation">.</span>iij<span class="token punctuation">.</span>bootcamp<span class="token punctuation">.</span>simple<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">jp<span class="token punctuation">.</span>ad<span class="token punctuation">.</span>iij<span class="token punctuation">.</span>bootcamp<span class="token punctuation">.</span>simple<span class="token punctuation">.</span>model</span><span class="token punctuation">.</span><span class="token class-name">People</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>mongodb<span class="token punctuation">.</span>repository</span><span class="token punctuation">.</span><span class="token class-name">MongoRepository</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PeopleRepository</span> <span class="token keyword">extends</span> <span class="token class-name">MongoRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">People</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><p>レポジトリとは、DBアクセスのためのクラスを指すSpringフレームワークの用語です。</p> <p>ここではインターフェースとして定義しており、MongoRepositoryインターフェースを継承しています。</p> <p>Spring Bootのビルドプロセスは、MongoRepositoryインターフェースを継承しているインターフェースを探索し、その定義に基づいて実装クラスを自動的に生成します。ここではPeopleクラスをモデルとして用い、主キーの型をStringとして定義することが宣言されているので、それに従って実装クラスが生成されるのです。</p> <p>データベース接続設定について、設定ファイルを用意します</p> <p>src/main/resourcesにapplication.ymlを以下の内容で記述してください。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token comment"># MONGODB (MongoProperties)</span>
  <span class="token key atrule">data</span><span class="token punctuation">:</span>
    <span class="token key atrule">mongodb</span><span class="token punctuation">:</span>
      <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">27017</span>
      <span class="token key atrule">uri</span><span class="token punctuation">:</span> mongodb<span class="token punctuation">:</span>//localhost/bootcamp
      <span class="token key atrule">database</span><span class="token punctuation">:</span> bootcamp
</code></pre></div><p>最後に、RESTコントローラーにエントリポイントを追加し、データベース問い合わせを記述してみます。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">jp<span class="token punctuation">.</span>ad<span class="token punctuation">.</span>iij<span class="token punctuation">.</span>bootcamp<span class="token punctuation">.</span>simple</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">jp<span class="token punctuation">.</span>ad<span class="token punctuation">.</span>iij<span class="token punctuation">.</span>bootcamp<span class="token punctuation">.</span>simple<span class="token punctuation">.</span>model</span><span class="token punctuation">.</span><span class="token class-name">People</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">jp<span class="token punctuation">.</span>ad<span class="token punctuation">.</span>iij<span class="token punctuation">.</span>bootcamp<span class="token punctuation">.</span>simple<span class="token punctuation">.</span>service</span><span class="token punctuation">.</span><span class="token class-name">PeopleRepository</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot</span><span class="token punctuation">.</span><span class="token class-name">SpringApplication</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure</span><span class="token punctuation">.</span><span class="token class-name">EnableAutoConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">RequestMapping</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">RestController</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@EnableAutoConfiguration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleApplication</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">PeopleRepository</span> peopleRepository<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/api/people/listAll&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">People</span><span class="token punctuation">&gt;</span></span> <span class="token function">listAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> peopleRepository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token function">home</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;Hello World!&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">SimpleApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>まずアノテーション <code>@Autowired</code> を付与しているPeopleRepository peopleRepositoryを定義しています。</p> <p>メソッドlistAllを定義しています。アノテーション <code>@RequestMapping</code> を通じて、このメソッドはRESTコントローラーのリクエスト処理用のメソッドであること、対応するクエリパスが/api/people/listAllであることを宣言しています。</p> <p>peopleRepository.findAll()によって、データベースbootcampのコレクションpeoplesからドキュメントを取得し、これを <code>List&lt;People&gt;</code> にインスタンス化して、戻しています。RESTコントローラーは、これをJSON形式に変換してレスポンスボディに書き込みます。</p> <p>（まだサーバが動いているなら、Ctrl-Cで止めて）<code>mvn spring-boot:run</code>しましょう。</p> <p>そしてブラウザで <a href="http://localhost:8080/api/people/listAll" target="_blank" rel="noopener noreferrer">http://localhost:8080/api/people/listAll<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> にアクセスしてみます。</p> <p>最初は <code>[]</code> が表示されますね。</p> <p>mongoコマンドを使ってデータを投入してみます。</p> <div class="language- extra-class"><pre class="language-text"><code>$ mongo
&gt; use bootcamp
&gt; db.createCollection('peoples')
{ &quot;ok&quot; : 1 }
&gt; db.peoples.insert({name: 'Alice'})
WriteResult({ &quot;nInserted&quot; : 1 })
&gt; db.peoples.insert({name: 'Bob'})
WriteResult({ &quot;nInserted&quot; : 1 })
</code></pre></div><p>ブラウザをリロードしてください。</p> <p>挿入したデータが画面に表示されたと思います。</p> <h2 id="最後に"><a href="#最後に" class="header-anchor">#</a> 最後に</h2> <p>もし、JavaによるWebアプリケーション開発について、Struts時代のものしか知らなかった人がSpring Bootを見たら、なんと簡単なんだ!! と驚くと思います。</p> <p>Springフレームワークは、非常に広大なフレームワークなので、ここで述べたことは本当にごくごく一部です。</p> <p>みなさんがJavaによるWebアプリケーション開発について、怖がらずに、「やってみようかな」と思っていただけたら、幸いに存じます。</p> <div><hr> <span>CC BY-SA Licensed | Copyright (c) 2019, Internet Initiative Japan Inc.</span></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/iij/bootcamp/edit/master/src/server-app/java/README.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">7/2/2020, 3:38:41 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/bootcamp/assets/js/app.22a49ce1.js" defer></script><script src="/bootcamp/assets/js/2.d60b740b.js" defer></script><script src="/bootcamp/assets/js/30.b67696f0.js" defer></script><script src="/bootcamp/assets/js/8.6a14b673.js" defer></script><script src="/bootcamp/assets/js/7.c01d2735.js" defer></script>
  </body>
</html>
