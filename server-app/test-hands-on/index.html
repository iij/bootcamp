<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>テストプログラミング ハンズオン | IIJ Bootcamp</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="開発を行う際に覚えておくと非常に便利なテストを伝授します。">
    
    <link rel="preload" href="/bootcamp/assets/css/0.styles.095a7d7e.css" as="style"><link rel="preload" href="/bootcamp/assets/js/app.4ac86e2f.js" as="script"><link rel="preload" href="/bootcamp/assets/js/2.af9abb6e.js" as="script"><link rel="preload" href="/bootcamp/assets/js/33.ae4e4d4a.js" as="script"><link rel="preload" href="/bootcamp/assets/js/18.41cb2d44.js" as="script"><link rel="preload" href="/bootcamp/assets/js/17.3a9aad5f.js" as="script"><link rel="prefetch" href="/bootcamp/assets/js/10.179f010c.js"><link rel="prefetch" href="/bootcamp/assets/js/11.84de2553.js"><link rel="prefetch" href="/bootcamp/assets/js/12.9f2d4ca8.js"><link rel="prefetch" href="/bootcamp/assets/js/13.86591752.js"><link rel="prefetch" href="/bootcamp/assets/js/14.02cac1c1.js"><link rel="prefetch" href="/bootcamp/assets/js/15.a71e3b10.js"><link rel="prefetch" href="/bootcamp/assets/js/16.54dbd410.js"><link rel="prefetch" href="/bootcamp/assets/js/19.c4781204.js"><link rel="prefetch" href="/bootcamp/assets/js/20.ae4709ea.js"><link rel="prefetch" href="/bootcamp/assets/js/21.c3ca3b4b.js"><link rel="prefetch" href="/bootcamp/assets/js/22.9bc38853.js"><link rel="prefetch" href="/bootcamp/assets/js/23.5390553d.js"><link rel="prefetch" href="/bootcamp/assets/js/24.9afaa8ff.js"><link rel="prefetch" href="/bootcamp/assets/js/25.e1160bb9.js"><link rel="prefetch" href="/bootcamp/assets/js/26.61ed861a.js"><link rel="prefetch" href="/bootcamp/assets/js/27.d43e6b52.js"><link rel="prefetch" href="/bootcamp/assets/js/28.7ca8166a.js"><link rel="prefetch" href="/bootcamp/assets/js/29.a48ff228.js"><link rel="prefetch" href="/bootcamp/assets/js/3.86b3daee.js"><link rel="prefetch" href="/bootcamp/assets/js/30.d5d1d330.js"><link rel="prefetch" href="/bootcamp/assets/js/31.47116511.js"><link rel="prefetch" href="/bootcamp/assets/js/32.225e251d.js"><link rel="prefetch" href="/bootcamp/assets/js/34.c12183f8.js"><link rel="prefetch" href="/bootcamp/assets/js/35.b7824e55.js"><link rel="prefetch" href="/bootcamp/assets/js/36.21895f99.js"><link rel="prefetch" href="/bootcamp/assets/js/37.f00b3d3e.js"><link rel="prefetch" href="/bootcamp/assets/js/38.44fffd58.js"><link rel="prefetch" href="/bootcamp/assets/js/39.32cc7016.js"><link rel="prefetch" href="/bootcamp/assets/js/4.30ac62b8.js"><link rel="prefetch" href="/bootcamp/assets/js/40.19f63cf8.js"><link rel="prefetch" href="/bootcamp/assets/js/41.e2d92431.js"><link rel="prefetch" href="/bootcamp/assets/js/42.e3411ebd.js"><link rel="prefetch" href="/bootcamp/assets/js/43.69fd99fb.js"><link rel="prefetch" href="/bootcamp/assets/js/44.52fb13b7.js"><link rel="prefetch" href="/bootcamp/assets/js/45.cf436824.js"><link rel="prefetch" href="/bootcamp/assets/js/46.41b61a06.js"><link rel="prefetch" href="/bootcamp/assets/js/47.593c8737.js"><link rel="prefetch" href="/bootcamp/assets/js/48.e046ab25.js"><link rel="prefetch" href="/bootcamp/assets/js/49.d2592a9c.js"><link rel="prefetch" href="/bootcamp/assets/js/5.0cc44b28.js"><link rel="prefetch" href="/bootcamp/assets/js/50.26d89f91.js"><link rel="prefetch" href="/bootcamp/assets/js/51.b09ff847.js"><link rel="prefetch" href="/bootcamp/assets/js/52.05d8a96b.js"><link rel="prefetch" href="/bootcamp/assets/js/53.9b9c6253.js"><link rel="prefetch" href="/bootcamp/assets/js/54.f40f4c78.js"><link rel="prefetch" href="/bootcamp/assets/js/55.a1945508.js"><link rel="prefetch" href="/bootcamp/assets/js/56.8f2fd708.js"><link rel="prefetch" href="/bootcamp/assets/js/57.65fb5c18.js"><link rel="prefetch" href="/bootcamp/assets/js/58.6447bf5d.js"><link rel="prefetch" href="/bootcamp/assets/js/59.c4a74795.js"><link rel="prefetch" href="/bootcamp/assets/js/6.7627ec92.js"><link rel="prefetch" href="/bootcamp/assets/js/60.b5492756.js"><link rel="prefetch" href="/bootcamp/assets/js/61.21d77950.js"><link rel="prefetch" href="/bootcamp/assets/js/62.5780cba0.js"><link rel="prefetch" href="/bootcamp/assets/js/63.3a97fde5.js"><link rel="prefetch" href="/bootcamp/assets/js/64.8b1c36ed.js"><link rel="prefetch" href="/bootcamp/assets/js/65.c2b144e8.js"><link rel="prefetch" href="/bootcamp/assets/js/7.409c16f2.js"><link rel="prefetch" href="/bootcamp/assets/js/8.898435ae.js"><link rel="prefetch" href="/bootcamp/assets/js/9.5bf30042.js">
    <link rel="stylesheet" href="/bootcamp/assets/css/0.styles.095a7d7e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/bootcamp/" class="home-link router-link-active"><!----> <span class="site-name">IIJ Bootcamp</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/iij/bootcamp" target="_blank" rel="noopener noreferrer" class="repo-link">
      GitHub
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/iij/bootcamp" target="_blank" rel="noopener noreferrer" class="repo-link">
      GitHub
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>テストプログラミング ハンズオン</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/bootcamp/server-app/test-hands-on/#なぜテストを行うのか" class="sidebar-link">なぜテストを行うのか</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/bootcamp/server-app/test-hands-on/#効率的なテストとは" class="sidebar-link">効率的なテストとは</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/bootcamp/server-app/test-hands-on/#いつテストを作るのか" class="sidebar-link">いつテストを作るのか</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/bootcamp/server-app/test-hands-on/#dockerコンテナの立ち上げ方" class="sidebar-link">dockerコンテナの立ち上げ方</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/bootcamp/server-app/test-hands-on/#テストの実行方法" class="sidebar-link">テストの実行方法</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/bootcamp/server-app/test-hands-on/#関数・テストの修正方法" class="sidebar-link">関数・テストの修正方法</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/bootcamp/server-app/test-hands-on/#_1-同値クラス・境界値テスト" class="sidebar-link">1. 同値クラス・境界値テスト</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bootcamp/server-app/test-hands-on/#同値クラステストとは" class="sidebar-link">同値クラステストとは</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/test-hands-on/#境界値テストとは" class="sidebar-link">境界値テストとは</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/test-hands-on/#テスト実装例" class="sidebar-link">テスト実装例</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/test-hands-on/#問題にチャレンジしよう" class="sidebar-link">問題にチャレンジしよう</a></li></ul></li><li><a href="/bootcamp/server-app/test-hands-on/#_2-apiと関数のモック" class="sidebar-link">2. APIと関数のモック</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bootcamp/server-app/test-hands-on/#モックとは" class="sidebar-link">モックとは</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/test-hands-on/#テスト実装例-2" class="sidebar-link">テスト実装例</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/test-hands-on/#fastapiについて" class="sidebar-link">FastAPIについて</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/test-hands-on/#テスト実装例-3" class="sidebar-link">テスト実装例</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/test-hands-on/#問題にチャレンジしよう-2" class="sidebar-link">問題にチャレンジしよう</a></li></ul></li><li><a href="/bootcamp/server-app/test-hands-on/#_3-tddをやってみる" class="sidebar-link">3. TDDをやってみる</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bootcamp/server-app/test-hands-on/#tddのやり方" class="sidebar-link">TDDのやり方</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/test-hands-on/#テスト実装例-4" class="sidebar-link">テスト実装例</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/test-hands-on/#サイクル-1-todoリスト" class="sidebar-link">サイクル(1) TODOリスト</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/test-hands-on/#サイクル-1-red" class="sidebar-link">サイクル(1) Red</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/test-hands-on/#サイクル-1-green" class="sidebar-link">サイクル(1) Green</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/test-hands-on/#サイクル-1-refactoring" class="sidebar-link">サイクル(1) Refactoring</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/test-hands-on/#サイクル-1-フィードバック" class="sidebar-link">サイクル(1) フィードバック</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/test-hands-on/#サイクル-2-red" class="sidebar-link">サイクル(2) Red</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/test-hands-on/#サイクル-2-green" class="sidebar-link">サイクル(2) Green</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/test-hands-on/#サイクル-2-refactoring" class="sidebar-link">サイクル(2) Refactoring</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/test-hands-on/#サイクル-2-フィードバック" class="sidebar-link">サイクル(2) フィードバック</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/test-hands-on/#サイクル-3-red" class="sidebar-link">サイクル(3) Red</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/test-hands-on/#サイクル-3-green" class="sidebar-link">サイクル(3) Green</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/test-hands-on/#サイクル-3-refactoring" class="sidebar-link">サイクル(3) Refactoring</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/test-hands-on/#サイクル-3-フィードバック" class="sidebar-link">サイクル(3) フィードバック</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/test-hands-on/#サイクル-4-red" class="sidebar-link">サイクル(4) Red</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/test-hands-on/#サイクル-4-green" class="sidebar-link">サイクル(4) Green</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/test-hands-on/#サイクル-4-refactoring" class="sidebar-link">サイクル(4) Refactoring</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/test-hands-on/#サイクル-4-フィードバック" class="sidebar-link">サイクル(4) フィードバック</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/test-hands-on/#問題にチャレンジしよう-3" class="sidebar-link">問題にチャレンジしよう</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><table><tr><td>このハンズオンでやること</td><td>開発を行う際に覚えておくと非常に便利なテストを伝授します。</td></tr> <tr><td>想定時間</td><td>2h</td></tr> <tr><td>前提知識・用語</td><td>Python3</td></tr></table> <h1 id="page-frontmatter-title"><a href="#page-frontmatter-title" class="header-anchor">#</a> テストプログラミング ハンズオン</h1> <h1 id="目次"><a href="#目次" class="header-anchor">#</a> 目次</h1> <ul><li><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB">はじめに</a></li> <li><a href="#%E6%A6%82%E8%AB%96">概論</a> <ul><li><a href="#%E3%81%AA%E3%81%9C%E3%83%86%E3%82%B9%E3%83%88%E3%82%92%E8%A1%8C%E3%81%86%E3%81%AE%E3%81%8B">なぜテストを行うのか</a></li> <li><a href="#%E5%8A%B9%E7%8E%87%E7%9A%84%E3%81%AA%E3%83%86%E3%82%B9%E3%83%88%E3%81%A8%E3%81%AF">効率的なテストとは</a></li> <li><a href="#%E3%81%84%E3%81%A4%E3%83%86%E3%82%B9%E3%83%88%E3%82%92%E4%BD%9C%E3%82%8B%E3%81%AE%E3%81%8B">いつテストを作るのか</a></li></ul></li> <li><a href="#%E6%BA%96%E5%82%99">準備</a> <ul><li><a href="#docker%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%81%AE%E7%AB%8B%E3%81%A1%E4%B8%8A%E3%81%92%E6%96%B9">dockerコンテナの立ち上げ方</a></li> <li><a href="#%E3%83%86%E3%82%B9%E3%83%88%E3%81%AE%E5%AE%9F%E8%A1%8C%E6%96%B9%E6%B3%95">テストの実行</a></li> <li><a href="#%E9%96%A2%E6%95%B0%E3%83%BB%E3%83%86%E3%82%B9%E3%83%88%E3%81%AE%E4%BF%AE%E6%AD%A3%E6%96%B9%E6%B3%95">関数・テストの修正方法</a></li></ul></li> <li><a href="#%E3%83%86%E3%82%B9%E3%83%88%E3%82%92%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B">テストを実行する</a> <ul><li><a href="#%E5%90%8C%E5%80%A4%E3%82%AF%E3%83%A9%E3%82%B9%E3%83%BB%E5%A2%83%E7%95%8C%E5%80%A4%E3%83%86%E3%82%B9%E3%83%88">同値クラス・境界値テスト</a></li> <li><a href="#api%E3%81%A8%E9%96%A2%E6%95%B0%E3%81%AE%E3%83%A2%E3%83%83%E3%82%AF">APIと関数のモック</a></li> <li><a href="#tdd%E3%82%92%E3%82%84%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B">TDDをやってみる</a></li></ul></li> <li><a href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB">おわりに</a></li></ul> <h1 id="はじめに"><a href="#はじめに" class="header-anchor">#</a> はじめに</h1> <p>本講義はdockerを使用します。
dockerコンテナのpullには時間を要するため、概論の聴講と並行して「準備 ⇒ <a href="#docker%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%81%AE%E7%AB%8B%E3%81%A1%E4%B8%8A%E3%81%92%E6%96%B9">dockerコンテナの立ち上げ方</a>」を実施することを推奨します。</p> <p>また、ローカルでのコマンド実行なのか、docker コンテナ内でのコマンド実行なのかが分かるよう、以下の記述方法を用います。
基本的には、手を動かすのはローカル、成果物の確認 (テスト実行) は docker コンテナになります。</p> <div class="language-terminal line-numbers-mode"><pre class="language-text"><code>### &quot;$&quot; で始まるものはローカルでのコマンド実行
$ cd bootcamp/src/server-app/test-hands-on

### &quot;root@...&quot; で始まるものは docker コンテナ内でのコマンド実行
root@a3f5935947a2:/# cd /test-hands-on
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>また、ファイルを開くのは以下のように vscode を前提として書いていますが、適宜お手元のエディターに読み替えていただいて問題ありません。</p> <div class="language-terminal line-numbers-mode"><pre class="language-text"><code>### とりあえず vscode にしているが、コードを編集できれば何でもよい
$ code ./exercises/exercise0/test_challenge.py
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h1 id="概論"><a href="#概論" class="header-anchor">#</a> 概論</h1> <h2 id="なぜテストを行うのか"><a href="#なぜテストを行うのか" class="header-anchor">#</a> なぜテストを行うのか</h2> <p>昨今ではIT技術が普及し、炊飯器・電子レンジ・洗濯機といった身の回りのものから、航空機や車など、普段の生活に必須になるものにまで、ソフトウェアが使用されています。
また、世の中に流通しているソフトウェアはテストが実施されており、その挙動で問題が起こらないことを保証されています。</p> <p>例えばソフトウェアに対し、テストを行われていないと仮定して、個人的に運営しているブログなどで不具合が発生した場合はどうなるでしょうか。
その不具合によってサーバがダウンしている間は、運営者に広告費が入らないなど、ある程度小規模で済みます。
（ブログ収益で生計を立てている場合、致命的ですが。）</p> <p>例えば自動車や医療機器などで不具合が発生してしまった場合、どうなるでしょうか。
最悪の場合、ブレーキが効かない、医療機器のレーザーの出力が多すぎたなど、ソフトウェアの欠陥によって人命が失われてしまう可能性もあります。</p> <p>上記2つの例を上げましたが、大なり小なり、ソフトウェアの不具合によって、どこかの誰かが被害を被ってしまいます。
そのため、自身が作成するプログラムでは必ず動作のテストを行い、極力不具合を発生させないソフトウェアを作ることを目指す必要があります。</p> <h2 id="効率的なテストとは"><a href="#効率的なテストとは" class="header-anchor">#</a> 効率的なテストとは</h2> <p>テストを作成する場合には、不具合をなくすことも重要ですが、テストにコストをかけないことも重要になります。</p> <p>例えば、あるプロダクトに使用される、以下のような仕様の関数<code>f(x)</code>があるとします。</p> <ul><li>関数<code>f</code>は、任意の数字<code>x</code>の値を取ります。</li> <li>任意の数字<code>x</code>は、int型であり、 <em>-2,147,483,648</em> から <em>2,147,483,647</em> の範囲の値を格納できます。</li> <li>関数<code>f</code>は、与えられた数字が <em>0</em> から <em>100</em> の間であれば<code>True</code>、そうでなければ<code>False</code>を返却します。</li></ul> <p>上記の<code>f(x)</code>の挙動を100%確かめるためには、 <em>4,294,967,296</em> 件のテストを行わなければなりません。
しかし、実際のプロダクトを作成する場合、1つの関数に対し40億回もテストを実施してしまうと、プロダクトの売上以上に人件費や計算機の運用コストがかかってしまい、会社は倒産の危機に瀕してしまいます。</p> <p>そのため、後述する「同値クラス・境界値テスト」などの手法によって、最低限かつ最適な回数でテストを行うことが求められます。</p> <h2 id="いつテストを作るのか"><a href="#いつテストを作るのか" class="header-anchor">#</a> いつテストを作るのか</h2> <p>開発を行う際、ウォーターフォール型の開発では、下記の流れになるかと思います。
右下向きの矢印が設計工程、中央が開発工程、右上向きの矢印がテスト工程になります。</p> <p><img src="/bootcamp/assets/img/figure1.959b588c.png" alt="figure1.png" title="figure1"></p> <p>設計における各要素は、テスト工程の各要素に対応することになります。
例えば、まずは要求定義を行い、ソフトウェアに必要な要件を決めますが、この時点で明確な要件が定義できているのであれば、システムテストで実施するテスト項目を作成しておくことができます。</p> <p>このように各設計段階でテスト項目を作成することで、要件に沿ったテストを作成することができます。
（何年も開発を行っているとわかるのですが、ものを作ってからテストを作成すると、「今動くものを通すテスト」を無意識的に書いてしまい、要件も網羅できないテストを作ってしまう傾向が出てきます。）</p> <p>また、後述するTDD（テスト駆動開発）のように、テストを作成しながら開発を進める手法もあります。</p> <p>今回のハンズオンではコーディング・単体テスト段階で実施するテストプログラミングをやってみましょう。</p> <h1 id="準備"><a href="#準備" class="header-anchor">#</a> 準備</h1> <h2 id="dockerコンテナの立ち上げ方"><a href="#dockerコンテナの立ち上げ方" class="header-anchor">#</a> dockerコンテナの立ち上げ方</h2> <p>下記のコマンドでdockerコンテナを立ち上げます。</p> <div class="language-terminal line-numbers-mode"><pre class="language-text"><code>### リポジトリのクローン (既にある場合はスキップで OK)
$ git clone https://github.com/iij/bootcamp.git
$ cd bootcamp/src/server-app/test-hands-on
### clone をスキップした場合は、リポジトリを最新化
$ git pull

### コンテナの立ち上げ
$ docker compose up --build

### 以下のように出力されたら OK.
(中略)
 ✔ Network test-hands-on_default            Created  0.0s
 ✔ Container test-hands-on-bootcamp-test-1  Created  0.0s
Attaching to bootcamp-test-1
bootcamp-test-1  | Python 3.12.4 (main, Aug  1 2024, 21:02:17) [GCC 12.2.0] on linux
bootcamp-test-1  | Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="テストの実行方法"><a href="#テストの実行方法" class="header-anchor">#</a> テストの実行方法</h2> <p>まずは単純な例で、テストの実行と修正をやってみましょう。</p> <p>「<a href="#docker%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%81%AE%E7%AB%8B%E3%81%A1%E4%B8%8A%E3%81%92%E6%96%B9">dockerコンテナの立ち上げ方</a>」で、起動中のコンソールとは別のコンソールを開き、実行中のコンテナにアクセスします。
コマンドを実行すると、コンテナ内のbashが実行されます。</p> <div class="language-terminal line-numbers-mode"><pre class="language-text"><code>$ cd bootcamp/src/server-app/test-hands-on
$ docker compose exec bootcamp-test bash
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>下記のコマンドで、テストを実行してみましょう。</p> <div class="language-terminal line-numbers-mode"><pre class="language-text"><code>### コードは全て&quot;/test-hands-on&quot;配下にあります。
root@a3f5935947a2:/# cd /test-hands-on

### 任意のテストを実行します。
root@a3f5935947a2:/test-hands-on# python -m unittest -v exercises.exercise0.test_challenge
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="関数・テストの修正方法"><a href="#関数・テストの修正方法" class="header-anchor">#</a> 関数・テストの修正方法</h2> <p>「テストの実行方法」の項でテストを行うと、初回は下記のようにテストが失敗してしまいます。</p> <div class="language-terminal line-numbers-mode"><pre class="language-text"><code>root@a3f5935947a2:/test-hands-on# python -m unittest -v exercises.exercise0.test_challenge
test_success (exercises.exercise0.test_challenge.HelloTestCase.test_success) ... FAIL

======================================================================
FAIL: test_success (exercises.exercise0.test_challenge.HelloTestCase.test_success)
----------------------------------------------------------------------
Traceback (most recent call last):
  File &quot;/test-hands-on/exercises/exercise0/test_challenge.py&quot;, line 7, in test_success
    self.assertEqual(hello(), &quot;hello iij-bootcamp&quot;)
AssertionError: 'hello world' != 'hello iij-bootcamp'
- hello world
+ hello iij-bootcamp


----------------------------------------------------------------------
Ran 1 test in 0.001s

FAILED (failures=1)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>テストコードを開いて確認してみましょう。</p> <div class="language-terminal line-numbers-mode"><pre class="language-text"><code>$ cd bootcamp/src/server-app/test-hands-on
$ code ./exercises/exercise0/test_challenge.py
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>内容は下記のようになっており、コード内でimportしている <code>hello()</code> 関数に対し、文字列 &quot;hello iij-bootcamp&quot; が来ることを期待してテストを行っているようです。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> unittest
<span class="token keyword">from</span> <span class="token punctuation">.</span>challenge <span class="token keyword">import</span> hello


<span class="token keyword">class</span> <span class="token class-name">HelloTestCase</span><span class="token punctuation">(</span>unittest<span class="token punctuation">.</span>TestCase<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">test_success</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>hello<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;hello iij-bootcamp&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>では次に、テスト対象である <code>hello()</code> 関数を見てみましょう。</p> <div class="language-terminal line-numbers-mode"><pre class="language-text"><code>$ code ./exercises/exercise0/challenge.py
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>どうやら、この関数は文字列&quot;hello world&quot;を返すようです。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">&quot;hello world&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>しかし、これではテストコードで期待されている関数の返り値と、実際の関数の返り値が異なってしまっています。</p> <p>ちなみにテストコードは、対象の関数やインスタンスが動作したときにどういった振る舞いをするのかを具体的に表現したもの、「動く仕様書」であると考えることができます。
この考えからいくと、今回は仕様を表現している (期待値を書いている) テストコードが正であり、実装に不具合があるといえます。</p> <p>それでは、テストが失敗する (期待する振る舞いになっていない) 原因である、return 値 &quot;hello world&quot; を &quot;hello iij-bootcamp&quot; に変えてみましょう。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">&quot;hello iij-bootcamp&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>もう一度テストを実行してみると、先程まで失敗していたテストが成功しました。</p> <div class="language-terminal line-numbers-mode"><pre class="language-text"><code>root@a3f5935947a2:/test-hands-on# python -m unittest -v exercises.exercise0.test_challenge
test_success (exercises.exercise0.test_challenge.HelloTestCase.test_success) ... ok

----------------------------------------------------------------------
Ran 1 test in 0.000s

OK
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>このように、テストコードというものは、テストを実施したい関数に対して動作を確認するように作成・実行します。
そして動作に問題があれば、適宜実装を (場合によってはテストコードも) 修正していくことになります。</p> <p>本講義では、テストを実施したい関数に対し、テストコードで期待する返り値を設定し、関数の動作確認を行っていきます。</p> <p>ちなみに、ローカルでのコードの変更は、コンテナ内にも自動で同期されます。
以降はローカルでファイルを変更し、コンテナ内でテストを実行してみましょう。</p> <h1 id="テストを実行する"><a href="#テストを実行する" class="header-anchor">#</a> テストを実行する</h1> <h2 id="_1-同値クラス・境界値テスト"><a href="#_1-同値クラス・境界値テスト" class="header-anchor">#</a> 1. 同値クラス・境界値テスト</h2> <p>この項では「同値クラステスト」と「境界値テスト」という手法のテストを実施し、効率的なテストについて学びます。</p> <h3 id="同値クラステストとは"><a href="#同値クラステストとは" class="header-anchor">#</a> 同値クラステストとは</h3> <p>同値クラステストとは「任意の関数<code>g(x)</code>の引数<code>x</code>に対し、有効である値、無効である値のグループ（有効同値クラス、無効同値クラス）を定義してテストを実施する」ものになります。</p> <p>例えば、本書の冒頭で出てきた、関数<code>f(x)</code>では、<code>x</code>の値が <em>0</em> から <em>100</em> の間であれば有効同値クラス、そうでなければ無効同値クラス、と定義できます。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>関数fは、任意の数字xの値を取ります。
任意の数字xは、int型であり、 -2,147,483,648 から 2,147,483,647 の範囲の値を格納できます。
関数fは、与えられた数字が 0 から 100 の間であればTrue、そうでなければFalseを返却します。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>仮に「有効同値クラス内の値が入力された場合は正常終了、無効同値クラス内の値が入力された場合は異常終了する」と見た場合、終了の仕方は「正常終了か異常終了か」の2択と見ることができます。</p> <p>すなわち、関数<code>f(x)</code>に対する同値クラステストとは、有効同値である <em>10</em> , <em>50</em> , <em>90</em> など、いくつかの値のグループと、無効同値である <em>-500</em> , <em>-10</em> , <em>110</em> , <em>500</em> などの値のグループのテストを実施すればよいことになります。</p> <h3 id="境界値テストとは"><a href="#境界値テストとは" class="header-anchor">#</a> 境界値テストとは</h3> <p>同値クラステストでは「有効/無効と定義した値に対する処理が正しく動くか」を確認できました。</p> <p>しかし、これでは「有効/無効の範囲は正しいか」が確認できていません。
こういった場合は境界値テストを実施し、有効値/無効値の境界が、正しく実行されるかのテストを行います。</p> <p>本書冒頭の関数<code>f(x)</code>を例にすると、下限の境界値は <em>-1</em> , <em>0</em> 、上限の境界値は <em>100</em> , <em>101</em> となります。</p> <h3 id="テスト実装例"><a href="#テスト実装例" class="header-anchor">#</a> テスト実装例</h3> <p>本書冒頭で定義した、関数<code>f(x)</code>がPythonで以下のように定義されているとします。</p> <p><code>exercies/sample1/sample.py</code> を作成してみましょう。</p> <div class="language-terminal line-numbers-mode"><pre class="language-text"><code>$ cd exercies/
$ mkdir sample1
$ cd sample1
$ code ./sample.py
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> x <span class="token operator">&lt;=</span> <span class="token number">100</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>上記の関数に対し、同値クラスのテストを定義すると、下記のように書くことができます。
下記のテストでは、関数<code>f(x)</code>に有効同値クラスの値を入力すると<code>True</code>、そうでない値を入力すると<code>False</code>が返却されることを確認しています。</p> <p><code>exercies/sample1/test_sample.py</code> を作成してみましょう。</p> <div class="language-terminal line-numbers-mode"><pre class="language-text"><code>$ code ./test_sample.py
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> unittest
<span class="token keyword">from</span> <span class="token punctuation">.</span>sample <span class="token keyword">import</span> f


<span class="token keyword">class</span> <span class="token class-name">ExampleTestCase</span><span class="token punctuation">(</span>unittest<span class="token punctuation">.</span>TestCase<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">test_equivalence_partitioning</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 有効同値のテスト</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>f<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>f<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>f<span class="token punctuation">(</span><span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>

        <span class="token comment"># 無効同値のテスト</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>f<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>f<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>f<span class="token punctuation">(</span><span class="token number">110</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>f<span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>境界値テストを定義すると、下記のように書くことができます。
下記のテストでは、関数<code>f(x)</code>に下限の境界値 <em>-1</em> , <em>0</em> 、上限の境界値 <em>100</em> , <em>101</em> を入力し、適宜<code>True</code>か<code>False</code>が返却されることを確認しています。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> unittest
<span class="token keyword">from</span> <span class="token punctuation">.</span>sample <span class="token keyword">import</span> f


<span class="token keyword">class</span> <span class="token class-name">ExampleTestCase</span><span class="token punctuation">(</span>unittest<span class="token punctuation">.</span>TestCase<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">test_equivalence_partitioning</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 有効同値のテスト</span>
        <span class="token comment"># ... 略</span>

        <span class="token comment"># 無効同値のテスト</span>
        <span class="token comment"># ... 略</span>

        <span class="token comment"># 下限の境界値</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>f<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>f<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>

        <span class="token comment"># 上限の境界値</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>f<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>f<span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>docker コンテナ内からテスト実行してみましょう。</p> <div class="language-terminal line-numbers-mode"><pre class="language-text"><code>root@a3f5935947a2:/test-hands-on# python -m unittest -v exercises.sample1.test_sample
test_equivalence_partitioning (exercises.sample1.test_sample1.ExampleTestCase.test_equivalence_partitioning) ... ok

----------------------------------------------------------------------
Ran 1 test in 0.000s

OK
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="問題にチャレンジしよう"><a href="#問題にチャレンジしよう" class="header-anchor">#</a> 問題にチャレンジしよう</h3> <p><code>exercises/exercise1/challenge.py</code>に、商品の申し込みを行う関数<code>apply(quantity)</code>が定義されています。</p> <p>関数は以下の仕様になっています。</p> <ul><li>この関数は、int型の引数<code>quantity</code>を取ります。</li> <li>関数<code>apply()</code>は、10以上、100以下の値が入力されると、申し込みが成功し、文字列<code>&quot;accepted&quot;</code>が返却されます。</li> <li>申し込みに失敗した場合は、文字列<code>&quot;not accepted&quot;</code>が返却されます。</li> <li>int型以外のデータが入力された場合、例外<code>TypeError()</code>が発生し、プログラムが異常終了します。</li></ul> <p><code>exercises/exercise1/test_challenge.py</code>に、作成途中のテストクラス<code>ApplyTestCase</code>が定義されているため、関数<code>apply(quantity)</code>に対するテストを作成してみましょう。</p> <h2 id="_2-apiと関数のモック"><a href="#_2-apiと関数のモック" class="header-anchor">#</a> 2. APIと関数のモック</h2> <p>この項では、Pythonで実行できるAPI（FastAPI）のフレームワークを使用し、APIに対するテストや、関数のモックに触れてみましょう。</p> <h3 id="モックとは"><a href="#モックとは" class="header-anchor">#</a> モックとは</h3> <p>「モックアップ」の略称であり、工業製品などの試作や、店頭展示などのためにつくられる実物大模型のことを指します。
「<a href="https://dictionary.goo.ne.jp/word/%e3%83%a2%e3%83%83%e3%82%af%e3%82%a2%e3%83%83%e3%83%97/" target="_blank" rel="noopener noreferrer">goo辞書 モックアップ（mock-up）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>」より</p> <p>テストにおけるモックとは、主にクラスや関数の動作をシミュレートするためのオブジェクトになります。</p> <p>例えば、以下のような仕様の関数<code>rock_paper_scissors(shoot)</code>があるとします。</p> <ul><li>関数<code>rock_paper_scissors(shoot)</code>は、じゃんけんを行う関数で、引数<code>shoot</code>は文字列&quot;rock&quot;, &quot;paper&quot;, &quot;scissors&quot;の、いずれかを取ります。</li> <li>関数<code>rock_paper_scissors()</code>は、内部で引数に対してじゃんけんの手を出す関数<code>my_shoot()</code>が実行されます。</li> <li>関数<code>my_shoot()</code>は、それぞれ <em>1/3</em> の確率で&quot;rock&quot;, &quot;paper&quot;, &quot;scissors&quot;のいずれかを取得します。</li> <li>関数<code>rock_paper_scissors()</code>は、入力された引数<code>shoot</code>が、関数<code>my_shoot()</code>の返り値に勝利できる場合 <em>1</em> 、引き分けであれば <em>0</em> 、敗北であれば <em>-1</em> を返します。</li></ul> <p>上記の関数<code>rock_paper_scissors()</code>をテストする場合、内部の関数の返り値が乱数で決定されてしまうため、通常であればテストが実行できません。
（例えば、1回目の<code>my_shoot()</code>を実行した時に&quot;rock&quot;が返却されたとしても、2回目も&quot;rock&quot;が返却されるとは限らないですよね）</p> <p>こういった場合、関数のモックを使用して、テスト対象の関数内で使用されているクラスや関数をモックし、返り値を固定してシミュレーションを行う必要があります。</p> <h3 id="テスト実装例-2"><a href="#テスト実装例-2" class="header-anchor">#</a> テスト実装例</h3> <p>関数<code>rock_paper_scissors(shoot)</code>が、Pythonで以下のように定義されているとします。</p> <p><code>exercies/sample2/sample.py</code> を作成してみましょう。</p> <div class="language-terminal line-numbers-mode"><pre class="language-text"><code>$ cd exercies/
$ mkdir sample2
$ cd sample2
$ code ./sample.py
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> random


<span class="token keyword">def</span> <span class="token function">_my_shoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    choices <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;rock&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;paper&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;scissors&quot;</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>choices<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">rock_paper_scissors</span><span class="token punctuation">(</span>shoot<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 1/3で&quot;rock&quot;, &quot;paper&quot;, &quot;scissors&quot;が格納される</span>
    my_shoot_result <span class="token operator">=</span> _my_shoot<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># あいこ</span>
    <span class="token keyword">if</span> shoot <span class="token operator">==</span> my_shoot_result<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">0</span>

    <span class="token comment"># 勝利</span>
    <span class="token keyword">if</span> shoot <span class="token operator">==</span> <span class="token string">&quot;rock&quot;</span> <span class="token keyword">and</span> my_shoot_result <span class="token operator">==</span> <span class="token string">&quot;scissors&quot;</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">1</span>
    <span class="token keyword">if</span> shoot <span class="token operator">==</span> <span class="token string">&quot;paper&quot;</span> <span class="token keyword">and</span> my_shoot_result <span class="token operator">==</span> <span class="token string">&quot;rock&quot;</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">1</span>
    <span class="token keyword">if</span> shoot <span class="token operator">==</span> <span class="token string">&quot;scissors&quot;</span> <span class="token keyword">and</span> my_shoot_result <span class="token operator">==</span> <span class="token string">&quot;paper&quot;</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">1</span>

    <span class="token comment"># 敗北</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>上記の関数に対し、モックを使用したテストを定義すると、下記のように書くことができます。</p> <p><code>exercies/sample2/test_sample.py</code> を作成してみましょう。</p> <div class="language-terminal line-numbers-mode"><pre class="language-text"><code>$ code ./test_sample.py
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> unittest
<span class="token keyword">from</span> unittest <span class="token keyword">import</span> mock
<span class="token keyword">from</span> <span class="token punctuation">.</span> <span class="token keyword">import</span> sample

rock_paper_scissors <span class="token operator">=</span> sample<span class="token punctuation">.</span>rock_paper_scissors


<span class="token keyword">class</span> <span class="token class-name">ExampleTestCase</span><span class="token punctuation">(</span>unittest<span class="token punctuation">.</span>TestCase<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">test_rock_paper_scissors</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># あいこのテスト</span>
        <span class="token keyword">with</span> mock<span class="token punctuation">.</span>patch<span class="token punctuation">.</span><span class="token builtin">object</span><span class="token punctuation">(</span>sample<span class="token punctuation">,</span> <span class="token string">'_my_shoot'</span><span class="token punctuation">,</span> return_value<span class="token operator">=</span><span class="token string">&quot;rock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>rock_paper_scissors<span class="token punctuation">(</span><span class="token string">&quot;rock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

        <span class="token comment"># 勝利のテスト</span>
        <span class="token keyword">with</span> mock<span class="token punctuation">.</span>patch<span class="token punctuation">.</span><span class="token builtin">object</span><span class="token punctuation">(</span>sample<span class="token punctuation">,</span> <span class="token string">'_my_shoot'</span><span class="token punctuation">,</span> return_value<span class="token operator">=</span><span class="token string">&quot;scissors&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>rock_paper_scissors<span class="token punctuation">(</span><span class="token string">&quot;rock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

        <span class="token comment"># 敗北のテスト</span>
        <span class="token keyword">with</span> mock<span class="token punctuation">.</span>patch<span class="token punctuation">.</span><span class="token builtin">object</span><span class="token punctuation">(</span>sample<span class="token punctuation">,</span> <span class="token string">'_my_shoot'</span><span class="token punctuation">,</span> return_value<span class="token operator">=</span><span class="token string">&quot;paper&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>rock_paper_scissors<span class="token punctuation">(</span><span class="token string">&quot;rock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>docker コンテナ内から実行してみましょう。</p> <div class="language-terminal line-numbers-mode"><pre class="language-text"><code>root@a3f5935947a2:/test-hands-on# python -m unittest -v exercises.sample2.test_sample
test_rock_paper_scissors (exercises.sample2.test_sample2.ExampleTestCase.test_rock_paper_scissors) ... ok

----------------------------------------------------------------------
Ran 1 test in 0.000s

OK
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="fastapiについて"><a href="#fastapiについて" class="header-anchor">#</a> FastAPIについて</h3> <p>IIJ Bootcamp「FastAPI でwebアプリを作る」にて紹介されているため、詳細の説明は省きます。</p> <p>下記「テスト実装例」にサンプルを記載するように、簡単にAPIを実装できるフレームワークになっています。</p> <h3 id="テスト実装例-3"><a href="#テスト実装例-3" class="header-anchor">#</a> テスト実装例</h3> <p>FastAPIは、下記のようにAPIを実装できます。
下記は、ブラウザで<code>http://localhost:8000/hello</code>にアクセスすると、データ<code>{&quot;response&quot;: &quot;hello&quot;}</code>を返却します。</p> <p><code>exercies/sample3/sample.py</code> を作成してみましょう。</p> <div class="language-terminal line-numbers-mode"><pre class="language-text"><code>$ cd exercies/
$ mkdir sample3
$ cd sample3
$ code ./sample.py
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> fastapi <span class="token keyword">import</span> FastAPI

app <span class="token operator">=</span> FastAPI<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">get_hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">&quot;response&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>上記のAPIに対し、HTTPステータスやレスポンスを検証するテストは、下記のように書くことができます。</p> <p><code>exercies/sample3/test_sample.py</code> を作成してみましょう。</p> <div class="language-terminal line-numbers-mode"><pre class="language-text"><code>$ code ./test_sample.py
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> unittest
<span class="token keyword">from</span> fastapi<span class="token punctuation">.</span>testclient <span class="token keyword">import</span> TestClient
<span class="token keyword">from</span> <span class="token punctuation">.</span> <span class="token keyword">import</span> sample

client <span class="token operator">=</span> TestClient<span class="token punctuation">(</span>sample<span class="token punctuation">.</span>app<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">ExampleTestCase</span><span class="token punctuation">(</span>unittest<span class="token punctuation">.</span>TestCase<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">test_api</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># パス&quot;/hello&quot;に接続する</span>
        res <span class="token operator">=</span> client<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">)</span>

        <span class="token comment"># HTTPステータスと、レスポンスの取得</span>
        status <span class="token operator">=</span> res<span class="token punctuation">.</span>status_code
        data <span class="token operator">=</span> res<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># HTTPステータスと、レスポンスの検証</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>status<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">&quot;response&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>docker コンテナ内から実行してみましょう。</p> <div class="language-terminal line-numbers-mode"><pre class="language-text"><code>root@233072c168ae:/test-hands-on# python -m unittest -v exercises.sample3.test_sample
test_api (exercises.sample3.test_sample.ExampleTestCase.test_api) ... ok

----------------------------------------------------------------------
Ran 1 test in 0.003s

OK
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="問題にチャレンジしよう-2"><a href="#問題にチャレンジしよう-2" class="header-anchor">#</a> 問題にチャレンジしよう</h3> <p><code>exercises/exercise2/challenge.py</code>に、FastAPIと、いくつかのエンドポイントが定義されています。</p> <p>上記のAPIは、コンテナから下記のコマンドで実行することができます。</p> <div class="language-terminal line-numbers-mode"><pre class="language-text"><code>root@233072c168ae:/test-hands-on# python3 -m uvicorn exercises.exercise2.challenge:app --reload --host &quot;0.0.0.0&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>API実行後は、ブラウザに下記のURLを入力すると、APIにアクセスできます。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>http://localhost:8000/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>また、APIは下記のエンドポイントがあります。</p> <table><thead><tr><th>パス</th> <th>詳細</th></tr></thead> <tbody><tr><td>/</td> <td><code>{&quot;message&quot;: &quot;hello world&quot;}</code>が返却されます。</td></tr> <tr><td>/echo/{data}</td> <td><code>{&quot;message&quot;: &quot;got the message: {data}&quot;}</code>が返却されます。<br>※<code>{data}</code>は、任意の値が代入されます。</td></tr> <tr><td>/gacha</td> <td><code>{&quot;message&quot;: &quot;{result}&quot;</code>が返却されます。<br>※<code>{result}</code>は、 <em>1/100</em> で文字列&quot;you win&quot;、それ以外で文字列&quot;you lose&quot;が代入されます。</td></tr></tbody></table> <p><code>exercises/exercise2/test_challenge.py</code>に、作成途中のテストクラス<code>ApiTestCase</code>が定義されているため、上記の仕様のAPIに対するテストを作成してみましょう。</p> <h2 id="_3-tddをやってみる"><a href="#_3-tddをやってみる" class="header-anchor">#</a> 3. TDDをやってみる</h2> <p>TDDとは、「テスト駆動開発( <em>Test Driven Development</em> )」のことを指し「イテレーティブ (反復的) な手順」と「インクリメンタル (少しずつ着実) な設計」を組み合わせて開発を行う、反復型の <strong>開発手法</strong> のことになります。(※テスト手法のことではない)</p> <h3 id="tddのやり方"><a href="#tddのやり方" class="header-anchor">#</a> TDDのやり方</h3> <p>TDDは、下記のサイクルで開発を行っていきます。</p> <ol start="0"><li>準備
<ul><li>必要になりそうなテスト (実装したい振る舞い) を TODO リストとして書き出す</li></ul></li> <li>Red
<ul><li>TODO リストから 1 つ選び、テストから書き (テストファースト)、そのテストを実行して失敗させる</li></ul></li> <li>Green
<ul><li>迅速に、テストを実行できるコードを書いてテストを通すようにする (※このとき、コードが汚くても良い)</li></ul></li> <li>Refactoring
<ul><li>Green を保ったまま、コードをきれいにする</li></ul></li> <li>フィードバック
<ul><li><em>3.</em> まで終わったら、気付きを TODO リストに反映し、1. に戻る</li></ul></li></ol> <p>上記 <em>1. ~ 4.</em> のサイクルを反復的に実行することで、自動テストによってとりあえず動くことが保証され、かつリファクタリングによってきれいになっていくコードを、少しずつ着実に作って (設計して) いきます。</p> <h3 id="テスト実装例-4"><a href="#テスト実装例-4" class="header-anchor">#</a> テスト実装例</h3> <p>例えば、以下の仕様のプログラムを作りたいとして、実際に TDD による開発を体験してみましょう。</p> <ul><li>実行回数が 3 の倍数なら &quot;Fizz&quot;、5 の倍数なら &quot;Buzz&quot;、両方を満たすなら &quot;FizzBuzz&quot; を返す</li> <li>実行回数は内部でカウントする</li> <li>3 でも 5 の倍数でもないカウントに対しては、そのカウント数を返す</li></ul> <h3 id="サイクル-1-todoリスト"><a href="#サイクル-1-todoリスト" class="header-anchor">#</a> サイクル(1) TODOリスト</h3> <p>コーディングする際、何もない状態で、何も考えずにいきなりコードを書き始めることはあまり多くありません。
TDD も例外ではなく、まずはやること (TODO) リストを作るところから始めます。</p> <p>愚直に整理してみると、以下のようになりそうです。</p> <ul><li>[ ] 実行回数を内部で保持し、カウントする</li> <li>[ ] 実行すると、カウント数を返す</li> <li>[ ] 実行回数が 3 の倍数なら、カウント数の代わりに &quot;Fizz&quot; を返す</li> <li>[ ] 実行回数が 5 の倍数なら、カウント数の代わりに &quot;Buzz&quot; を返す</li> <li>[ ] 実行回数が 3 と 5 両方の倍数なら、カウント数の代わりに &quot;FizzBuzz&quot; を返す</li></ul> <p>TODO リストが整理できたところで、<code>exercises/sample4/sample.py</code> と <code>exercises/sample4/test_sample.py</code> を作成し、サイクル(1) に進みましょう。</p> <div class="language-terminal line-numbers-mode"><pre class="language-text"><code>$ cd exercies/
$ mkdir sample4
$ cd sample4
$ code ./sample.py
$ code ./test_sample.py
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="サイクル-1-red"><a href="#サイクル-1-red" class="header-anchor">#</a> サイクル(1) Red</h3> <p>TODO リストから 1 つ選びます。</p> <blockquote><ul><li>[ ] 実行すると、カウント数を返す</li></ul></blockquote> <p>最初は、この仕様の実装に向けてサイクルを回してみましょう。</p> <p>Red でやるべきは「失敗するテストを書く」でした。</p> <blockquote><ol><li>Red
<ul><li>TODO リストから 1 つ選び、テストから書き (テストファースト)、そのテストを実行して失敗させる</li></ul></li></ol></blockquote> <p>とにかく仕様をテストコードで表現してみるというのが、ここでやるべきことです。</p> <p>とりあえず1回目の実行では「1」が返ってくるはずなので、テストでは「1」を期待してみます。
<code>FizzBuzz</code> クラスに、<code>increment_counter()</code> メソッドがあると仮定して、<code>test_sample.py</code> を書いてみましょう。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> unittest
<span class="token keyword">from</span> <span class="token punctuation">.</span>sample <span class="token keyword">import</span> FizzBuzz


<span class="token keyword">class</span> <span class="token class-name">TestFizzBuzz</span><span class="token punctuation">(</span>unittest<span class="token punctuation">.</span>TestCase<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">test_increment_counter</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        fizzbuzz <span class="token operator">=</span> FizzBuzz<span class="token punctuation">(</span><span class="token punctuation">)</span>
        expected <span class="token operator">=</span> fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>expected<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>テスト実行してみると、そもそも実装がないので当然エラーになります。</p> <div class="language-terminal line-numbers-mode"><pre class="language-text"><code>root@233072c168ae:/test-hands-on# python -m unittest -v exercises.sample4.test_sample
test_sample (unittest.loader._FailedTest.test_sample) ... ERROR

======================================================================
ERROR: test_sample (unittest.loader._FailedTest.test_sample)
----------------------------------------------------------------------
ImportError: Failed to import test module: test_sample
Traceback (most recent call last):
  File &quot;/usr/local/lib/python3.12/unittest/loader.py&quot;, line 137, in loadTestsFromName
    module = __import__(module_name)
             ^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;/test-hands-on/exercises/sample4/test_sample.py&quot;, line 2, in &lt;module&gt;
    from .sample import FizzBuzz
ModuleNotFoundError: No module named 'exercises.sample4.sample'


----------------------------------------------------------------------
Ran 1 test in 0.000s

FAILED (errors=1)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="サイクル-1-green"><a href="#サイクル-1-green" class="header-anchor">#</a> サイクル(1) Green</h3> <p>次は「とりあえず動くコード」を目指します。</p> <blockquote><ol start="2"><li>Green
<ul><li>迅速に、テストを実行できるコードを書いてテストを通すようにする (※このとき、コードが汚くても良い)</li></ul></li></ol></blockquote> <p>とにかくテストを通すようなコードを最短距離で書くというのが、ここでやるべきことです。</p> <p>テストでは 1 が返却されることを期待していますので、<code>sample.py</code> に実装を書いて、1 を返すようにしてみましょう。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">FizzBuzz</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">increment_counter</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>テスト実行してみると、成功するようになりました。</p> <div class="language-terminal line-numbers-mode"><pre class="language-text"><code>root@233072c168ae:/test-hands-on# python -m unittest -v exercises.sample4.test_sample
test_increment_counter (exercises.sample4.test_sample.TestFizzBuzz.test_increment_counter) ... ok

----------------------------------------------------------------------
Ran 1 test in 0.000s

OK
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="サイクル-1-refactoring"><a href="#サイクル-1-refactoring" class="header-anchor">#</a> サイクル(1) Refactoring</h3> <blockquote><ol start="3"><li>Refactoring
<ul><li>Green を保ったまま、コードをきれいにする</li></ul></li></ol></blockquote> <p>次は、「動作するきれいなコード」を目指します。
今回、あまり直すところはないですが、テストコードに一部冗長なところがあるのでインライン化してみましょう。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> unittest
<span class="token keyword">from</span> <span class="token punctuation">.</span>sample <span class="token keyword">import</span> FizzBuzz


<span class="token keyword">class</span> <span class="token class-name">TestFizzBuzz</span><span class="token punctuation">(</span>unittest<span class="token punctuation">.</span>TestCase<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">test_increment_counter</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        fizzbuzz <span class="token operator">=</span> FizzBuzz<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># expected をインライン化</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>テスト実行してみると、成功したままなので OK です。</p> <div class="language-terminal line-numbers-mode"><pre class="language-text"><code>root@233072c168ae:/test-hands-on# python -m unittest -v exercises.sample4.test_sample
test_increment_counter (exercises.sample4.test_sample.TestFizzBuzz.test_increment_counter) ... ok

----------------------------------------------------------------------
Ran 1 test in 0.000s

OK
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="サイクル-1-フィードバック"><a href="#サイクル-1-フィードバック" class="header-anchor">#</a> サイクル(1) フィードバック</h3> <p>TODO リストを見直してみると、サイクル(1) を回しきったことで仕様を満たせているものはなさそうですが、とりあえずの仮実装はできていそうです。</p> <ul><li>[ ] 実行回数を内部で保持し、カウントする</li> <li>[ ] 実行すると、カウント数を返す
<ul><li>[x] とりあえず 1 を返す (仮実装)</li></ul></li> <li>[ ] 実行回数が 3 の倍数なら、カウント数の代わりに &quot;Fizz&quot; を返す</li> <li>[ ] 実行回数が 5 の倍数なら、カウント数の代わりに &quot;Buzz&quot; を返す</li> <li>[ ] 実行回数が 3 と 5 両方の倍数なら、カウント数の代わりに &quot;FizzBuzz&quot; を返す</li></ul> <p>では、次のサイクルにいきましょう。</p> <h3 id="サイクル-2-red"><a href="#サイクル-2-red" class="header-anchor">#</a> サイクル(2) Red</h3> <p>2サイクル目に来ました。</p> <p>引き続き、<code>increment_counter()</code> の実装を進めていきます。</p> <blockquote><ul><li>[ ] 実行すると、カウント数を返す</li></ul></blockquote> <p>実行回数毎にカウントアップする仕様ですから、何度か実行してみて、期待する値を増加させてみましょう。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> unittest
<span class="token keyword">from</span> <span class="token punctuation">.</span>sample <span class="token keyword">import</span> FizzBuzz


<span class="token keyword">class</span> <span class="token class-name">TestFizzBuzz</span><span class="token punctuation">(</span>unittest<span class="token punctuation">.</span>TestCase<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">test_increment_counter</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        fizzbuzz <span class="token operator">=</span> FizzBuzz<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>テスト実行してみると、対応する実装がないので失敗しました。</p> <div class="language-terminal line-numbers-mode"><pre class="language-text"><code>root@233072c168ae:/test-hands-on# python -m unittest -v exercises.sample4.test_sample
test_increment_counter (exercises.sample4.test_sample.TestFizzBuzz.test_increment_counter) ... FAIL

======================================================================
FAIL: test_increment_counter (exercises.sample4.test_sample.TestFizzBuzz.test_increment_counter)
----------------------------------------------------------------------
Traceback (most recent call last):
  File &quot;/test-hands-on/exercises/sample4/test_sample.py&quot;, line 9, in test_increment_counter
    self.assertEqual(fizzbuzz.increment_counter(), 2)
AssertionError: 1 != 2

----------------------------------------------------------------------
Ran 1 test in 0.001s

FAILED (failures=1)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="サイクル-2-green"><a href="#サイクル-2-green" class="header-anchor">#</a> サイクル(2) Green</h3> <p>「とりあえず動くコード」を目指し、書いてみます。一例として、以下のような実装になりそうです。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">FizzBuzz</span><span class="token punctuation">:</span>
    count <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">def</span> <span class="token function">increment_counter</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        FizzBuzz<span class="token punctuation">.</span>count <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token keyword">return</span> FizzBuzz<span class="token punctuation">.</span>count
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>テスト実行してみると、成功しました。</p> <div class="language-terminal line-numbers-mode"><pre class="language-text"><code>root@233072c168ae:/test-hands-on# python -m unittest -v exercises.sample4.test_sample
test_increment_counter (exercises.sample4.test_sample.TestFizzBuzz.test_increment_counter) ... ok

----------------------------------------------------------------------
Ran 1 test in 0.000s

OK
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="サイクル-2-refactoring"><a href="#サイクル-2-refactoring" class="header-anchor">#</a> サイクル(2) Refactoring</h3> <p>現在の <code>FizzBuzz</code> はクラス変数というものを利用しています。
設計にもよりますが、インスタンス間で値を共有させないようにするのが一般的でしょう。</p> <p>python では <code>__init__</code> メソッドを使うことで、インスタンス生成時に保持させる、インスタンス変数を定義することができます。これを使うと、基本的にはインスタンス間での値の共有はできなくなります。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">FizzBuzz</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">def</span> <span class="token function">do</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>count <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>count
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>テスト実行してみると、成功したままなので OK です。</p> <div class="language-terminal line-numbers-mode"><pre class="language-text"><code>root@233072c168ae:/test-hands-on# python -m unittest -v exercises.sample4.test_sample
test_increment_counter (exercises.sample4.test_sample.TestFizzBuzz.test_increment_counter) ... ok

----------------------------------------------------------------------
Ran 1 test in 0.000s

OK
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="サイクル-2-フィードバック"><a href="#サイクル-2-フィードバック" class="header-anchor">#</a> サイクル(2) フィードバック</h3> <p>TODO リストを見直してみると、カウント数を返す実装はできていそうです。</p> <p>また、リファクタリングをしたことで、<code>increment_counter()</code> の外側にインスタンス変数としてカウント変数を保持させることができるようになりました。</p> <ul><li>[x] 実行回数を内部で保持し、カウントする</li> <li>[x] 実行すると、カウント数を返す
<ul><li>[x] とりあえず 1 を返す (仮実装)</li></ul></li> <li>[ ] 実行回数が 3 の倍数なら、カウント数の代わりに &quot;Fizz&quot; を返す</li> <li>[ ] 実行回数が 5 の倍数なら、カウント数の代わりに &quot;Buzz&quot; を返す</li> <li>[ ] 実行回数が 3 と 5 両方の倍数なら、カウント数の代わりに &quot;FizzBuzz&quot; を返す</li></ul> <p>では、次のサイクルにいきましょう。</p> <h3 id="サイクル-3-red"><a href="#サイクル-3-red" class="header-anchor">#</a> サイクル(3) Red</h3> <p>3 サイクル目です。次は、以下の仕様を実装してみましょう。</p> <blockquote><ul><li>[ ] 実行回数が 3 の倍数なら、カウント数の代わりに &quot;Fizz&quot; を返す</li></ul></blockquote> <p>失敗するテストを書きます。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> unittest
<span class="token keyword">from</span> <span class="token punctuation">.</span>sample <span class="token keyword">import</span> FizzBuzz


<span class="token keyword">class</span> <span class="token class-name">TestFizzBuzz</span><span class="token punctuation">(</span>unittest<span class="token punctuation">.</span>TestCase<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">test_increment_counter</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        fizzbuzz <span class="token operator">=</span> FizzBuzz<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;Fizz&quot;</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;Fizz&quot;</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;Fizz&quot;</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;Fizz&quot;</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;Fizz&quot;</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>予想通り、テストは失敗しますね。</p> <div class="language-terminal line-numbers-mode"><pre class="language-text"><code>root@233072c168ae:/test-hands-on# python -m unittest -v exercises.sample4.test_sample
test_increment_counter (exercises.sample4.test_sample.TestFizzBuzz.test_increment_counter) ... FAIL

======================================================================
FAIL: test_increment_counter (exercises.sample4.test_sample.TestFizzBuzz.test_increment_counter)
----------------------------------------------------------------------
Traceback (most recent call last):
  File &quot;/test-hands-on/exercises/sample4/test_sample.py&quot;, line 10, in test_increment_counter
    self.assertEqual(fizzbuzz.increment_counter(), &quot;Fizz&quot;)
AssertionError: 3 != 'Fizz'

----------------------------------------------------------------------
Ran 1 test in 0.001s

FAILED (failures=1)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="サイクル-3-green"><a href="#サイクル-3-green" class="header-anchor">#</a> サイクル(3) Green</h3> <p>さて、&quot;Fizz&quot; を返せるようにコードを修正しましょう。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">FizzBuzz</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">def</span> <span class="token function">increment_counter</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>count <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>count <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">&quot;Fizz&quot;</span>

        <span class="token keyword">return</span> self<span class="token punctuation">.</span>count
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>テストも問題なしです。</p> <div class="language-terminal line-numbers-mode"><pre class="language-text"><code>root@233072c168ae:/test-hands-on# python -m unittest -v exercises.sample4.test_sample
test_increment_counter (exercises.sample4.test_sample.TestFizzBuzz.test_increment_counter) ... ok

----------------------------------------------------------------------
Ran 1 test in 0.000s

OK
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="サイクル-3-refactoring"><a href="#サイクル-3-refactoring" class="header-anchor">#</a> サイクル(3) Refactoring</h3> <p>このサイクルで書いたコードは、特にリファクタリング箇所もなさそうなのでスキップします。</p> <h3 id="サイクル-3-フィードバック"><a href="#サイクル-3-フィードバック" class="header-anchor">#</a> サイクル(3) フィードバック</h3> <p>サイクル(3) では、&quot;Fizz&quot; を返す実装ができました。</p> <ul><li>[x] 実行回数を内部で保持し、カウントする</li> <li>[x] 実行すると、カウント数を返す
<ul><li>[x] とりあえず 1 を返す (仮実装)</li></ul></li> <li>[x] 実行回数が 3 の倍数なら、カウント数の代わりに &quot;Fizz&quot; を返す</li> <li>[ ] 実行回数が 5 の倍数なら、カウント数の代わりに &quot;Buzz&quot; を返す</li> <li>[ ] 実行回数が 3 と 5 両方の倍数なら、カウント数の代わりに &quot;FizzBuzz&quot; を返す</li></ul> <h3 id="サイクル-4-red"><a href="#サイクル-4-red" class="header-anchor">#</a> サイクル(4) Red</h3> <p>4 サイクル目です。次は、以下の仕様を実装してみましょう。</p> <blockquote><ul><li>[ ] 実行回数が 5 の倍数なら、カウント数の代わりに &quot;Buzz&quot; を返す</li></ul></blockquote> <p><code>15</code> の部分については、&quot;FizzBuzz&quot; としていることに注意してください。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> unittest
<span class="token keyword">from</span> <span class="token punctuation">.</span>sample <span class="token keyword">import</span> FizzBuzz


<span class="token keyword">class</span> <span class="token class-name">TestFizzBuzz</span><span class="token punctuation">(</span>unittest<span class="token punctuation">.</span>TestCase<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">test_increment_counter</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        fizzbuzz <span class="token operator">=</span> FizzBuzz<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;Fizz&quot;</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;Buzz&quot;</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;Fizz&quot;</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;Fizz&quot;</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;Buzz&quot;</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;Fizz&quot;</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>fizzbuzz<span class="token punctuation">.</span>increment_counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;FizzBuzz&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>少しずつ、Red, Green, Refactoring のサイクルの感覚は掴めてきたでしょうか。
このテストは当然失敗し、次の Green ではそれを成功に導くわけですね。</p> <p>分割統治法で 1 つずつ確実に課題をクリアしていく面白さを実感してもらえればなと思います。</p> <div class="language-terminal line-numbers-mode"><pre class="language-text"><code>root@233072c168ae:/test-hands-on# python -m unittest -v exercises.sample4.test_sample
test_increment_counter (exercises.sample4.test_sample.TestFizzBuzz.test_increment_counter) ... FAIL

======================================================================
FAIL: test_increment_counter (exercises.sample4.test_sample.TestFizzBuzz.test_increment_counter)
----------------------------------------------------------------------
Traceback (most recent call last):
  File &quot;/test-hands-on/exercises/sample4/test_sample.py&quot;, line 12, in test_increment_counter
    self.assertEqual(fizzbuzz.increment_counter(), &quot;Buzz&quot;)
AssertionError: 5 != 'Buzz'

----------------------------------------------------------------------
Ran 1 test in 0.001s

FAILED (failures=1)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="サイクル-4-green"><a href="#サイクル-4-green" class="header-anchor">#</a> サイクル(4) Green</h3> <p>&quot;Buzz&quot;および&quot;FizzBuzz&quot;を返せるようにしましょう。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">FizzBuzz</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">def</span> <span class="token function">increment_counter</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>count <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>count <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">and</span> self<span class="token punctuation">.</span>count <span class="token operator">%</span> <span class="token number">5</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">&quot;FizzBuzz&quot;</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>count <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">&quot;Fizz&quot;</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>count <span class="token operator">%</span> <span class="token number">5</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">&quot;Buzz&quot;</span>

        <span class="token keyword">return</span> self<span class="token punctuation">.</span>count
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>テストも成功します。</p> <div class="language-terminal line-numbers-mode"><pre class="language-text"><code>root@233072c168ae:/test-hands-on# python -m unittest -v exercises.sample4.test_sample
test_increment_counter (exercises.sample4.test_sample.TestFizzBuzz.test_increment_counter) ... ok

----------------------------------------------------------------------
Ran 1 test in 0.000s

OK
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="サイクル-4-refactoring"><a href="#サイクル-4-refactoring" class="header-anchor">#</a> サイクル(4) Refactoring</h3> <p>最後のリファクタリングになります。</p> <p><code>if self.count % 3 == 0 and self.count % 5 == 0</code> も誤りではないですが、もう少しきれいに書けそうです。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">FizzBuzz</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">def</span> <span class="token function">increment_counter</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>count <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>count <span class="token operator">%</span> <span class="token number">15</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">&quot;FizzBuzz&quot;</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>count <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">&quot;Fizz&quot;</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>count <span class="token operator">%</span> <span class="token number">5</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">&quot;Buzz&quot;</span>

        <span class="token keyword">return</span> self<span class="token punctuation">.</span>count
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="language-terminal line-numbers-mode"><pre class="language-text"><code>root@233072c168ae:/test-hands-on# python -m unittest -v exercises.sample4.test_sample
test_increment_counter (exercises.sample4.test_sample.TestFizzBuzz.test_increment_counter) ... ok

----------------------------------------------------------------------
Ran 1 test in 0.000s

OK
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="サイクル-4-フィードバック"><a href="#サイクル-4-フィードバック" class="header-anchor">#</a> サイクル(4) フィードバック</h3> <p>当初、&quot;Buzz&quot; を返す実装だけやるつもりでしたが、&quot;FizzBuzz&quot; を返す実装も同時にできましたね。</p> <ul><li>[x] 実行回数を内部で保持し、カウントする</li> <li>[x] 実行すると、カウント数を返す
<ul><li>[x] とりあえず 1 を返す (仮実装)</li></ul></li> <li>[x] 実行回数が 3 の倍数なら、カウント数の代わりに &quot;Fizz&quot; を返す</li> <li>[x] 実行回数が 5 の倍数なら、カウント数の代わりに &quot;Buzz&quot; を返す</li> <li>[x] 実行回数が 3 と 5 両方の倍数なら、カウント数の代わりに &quot;FizzBuzz&quot; を返す</li></ul> <p>これで全て完了です！</p> <h3 id="問題にチャレンジしよう-3"><a href="#問題にチャレンジしよう-3" class="header-anchor">#</a> 問題にチャレンジしよう</h3> <p><code>exercises/exercise3/challenge.py</code>には、FastAPIで書かれた作りかけのAPIがあります。</p> <p>上記のAPIは、コンテナから下記のコマンドで実行することができます。</p> <div class="language-terminal line-numbers-mode"><pre class="language-text"><code>root@233072c168ae:/test-hands-on# python3 -m uvicorn exercises.exercise3.challenge:app --reload --host &quot;0.0.0.0&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>API実行後は、ブラウザに下記のURLを入力すると、APIにアクセスできます。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>http://localhost:8000/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>TDD を使って、上記のAPIを完成させてみましょう。
API 仕様は、以下になります。</p> <ul><li><code>/</code>, <code>/add</code>, <code>/sub</code>, <code>/mul</code>, <code>/div</code> の5つのエンドポイントがある</li> <li>内部で int 型の値を保持し、現在設定されている値を、<code>/</code> にアクセスすることで確認できる (また、値は 0 とする)</li> <li><code>/add</code>, <code>/sub</code>, <code>/mul</code>, <code>/div</code> にパスパラメータを与えると、保持されている値に対し、四則演算を行う（後述）</li> <li>計算は全て int 型で行う</li></ul> <p>また、各パスの詳細な仕様な以下の通りです:</p> <table><thead><tr><th>パス</th> <th>詳細</th></tr></thead> <tbody><tr><td>/</td> <td><code>{&quot;current_number&quot;: {数値}}</code>が返却されます。<br>{数値}には、サーバで保持されている値が入ります。</td></tr> <tr><td>/add/{data}</td> <td><code>{&quot;current_number&quot;: {数値}}</code>が返却されます。<br>{data}に渡された値をサーバで保持している値に加算します。</td></tr> <tr><td>/sub/{data}</td> <td><code>{&quot;current_number&quot;: {数値}}</code>が返却されます。<br>{data}に渡された値をサーバで保持している値から減算します。</td></tr> <tr><td>/mul/{data}</td> <td><code>{&quot;current_number&quot;: {数値}}</code>が返却されます。<br>{data}に渡された値をサーバで保持している値に乗算します。</td></tr> <tr><td>/div/{data}</td> <td><code>{&quot;current_number&quot;: {数値}}</code>が返却されます。<br>{data}に渡された値をサーバで保持している値から除算します。</td></tr></tbody></table> <p>サーバでの値の保持・取得関数は、コード内に定義されています。
以下に、使い方の例を記載します。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># サーバ内に保持されている値を記録します。</span>
set_current_number<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment"># サーバ内に保持されている値を取得します</span>
got_data <span class="token operator">=</span> get_current_number<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>got_data<span class="token punctuation">)</span>  <span class="token comment"># -&gt; 1</span>

set_current_number<span class="token punctuation">(</span><span class="token number">123</span> <span class="token operator">+</span> <span class="token number">456</span><span class="token punctuation">)</span>
got_data <span class="token operator">=</span> get_current_number<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>got_data<span class="token punctuation">)</span>  <span class="token comment"># -&gt; 579</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><code>exercises/exercise3/test_challenge.py</code> には、本APIが完成すると通るようになる、テスト<code>test_success()</code>が定義されています。</p> <p>上記のテストがOKになるよう、各種APIをTDDを使って作成してみましょう。</p> <h1 id="おわりに"><a href="#おわりに" class="header-anchor">#</a> おわりに</h1> <p>一般的にソフトウェアテストというと、専門のテスト部隊があって「Excelにスクショをペタペタ貼るだけでしょ？」というようなイメージを持ち、敬遠される方も少なくはないと思います。</p> <p>開発者がテストについて知識を持ち、単体テストで可能な限りの不具合をなくしておくと、後の工程で不具合が少なく済ますことができたり、メリットがあります。
また、後の工程で発生した不具合の内容を聞いた・見ただけで、どのモジュール同士で問題が起こっているのか目星がつくなど、効率的なトラブルシュートやソフトウェアの理解にも繋がります。</p> <p>冒頭でも述べましたが、ソフトウェアにも品質というものがあり、この品質次第で会社の売上に影響が出たり、企業のセキュリティや人命に影響を及ぼしてしまう懸念もあります。</p> <p>そのため、開発を行う際には是非テストにも注力し、ユーザーの満足できるソフトウェアを作れるよう、目指してみてください。</p> <p>良いエンジニアライフを！👍</p> <div><hr> <span>CC BY-SA Licensed | Copyright (c) 2022, Internet Initiative Japan Inc.</span></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/iij/bootcamp/edit/master/src/server-app/test-hands-on/README.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/9/2024, 4:55:12 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/bootcamp/assets/js/app.4ac86e2f.js" defer></script><script src="/bootcamp/assets/js/2.af9abb6e.js" defer></script><script src="/bootcamp/assets/js/33.ae4e4d4a.js" defer></script><script src="/bootcamp/assets/js/18.41cb2d44.js" defer></script><script src="/bootcamp/assets/js/17.3a9aad5f.js" defer></script>
  </body>
</html>
