<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>IIJ Bootcamp</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Docker の概要を学び、コンテナ操作を体験します">
    
    <link rel="preload" href="/bootcamp/assets/css/0.styles.5f3404af.css" as="style"><link rel="preload" href="/bootcamp/assets/js/app.ed014b26.js" as="script"><link rel="preload" href="/bootcamp/assets/js/2.bc4131d0.js" as="script"><link rel="preload" href="/bootcamp/assets/js/30.1defa3d3.js" as="script"><link rel="preload" href="/bootcamp/assets/js/11.ab6fb600.js" as="script"><link rel="preload" href="/bootcamp/assets/js/10.e02dca73.js" as="script"><link rel="prefetch" href="/bootcamp/assets/js/12.40f7a20c.js"><link rel="prefetch" href="/bootcamp/assets/js/13.a6e766f3.js"><link rel="prefetch" href="/bootcamp/assets/js/14.918009e3.js"><link rel="prefetch" href="/bootcamp/assets/js/15.392ab58e.js"><link rel="prefetch" href="/bootcamp/assets/js/16.71f12062.js"><link rel="prefetch" href="/bootcamp/assets/js/17.e78f9abe.js"><link rel="prefetch" href="/bootcamp/assets/js/18.4e112dbe.js"><link rel="prefetch" href="/bootcamp/assets/js/19.ce4aa69a.js"><link rel="prefetch" href="/bootcamp/assets/js/20.c8ef1011.js"><link rel="prefetch" href="/bootcamp/assets/js/21.d2358bbc.js"><link rel="prefetch" href="/bootcamp/assets/js/22.8d533405.js"><link rel="prefetch" href="/bootcamp/assets/js/23.b5659a7e.js"><link rel="prefetch" href="/bootcamp/assets/js/24.00434f80.js"><link rel="prefetch" href="/bootcamp/assets/js/25.b5f97dc8.js"><link rel="prefetch" href="/bootcamp/assets/js/26.12e6c4ca.js"><link rel="prefetch" href="/bootcamp/assets/js/27.58178f1c.js"><link rel="prefetch" href="/bootcamp/assets/js/28.7e9f0fdd.js"><link rel="prefetch" href="/bootcamp/assets/js/29.63edadbb.js"><link rel="prefetch" href="/bootcamp/assets/js/3.bbd6b5ec.js"><link rel="prefetch" href="/bootcamp/assets/js/31.0c012fae.js"><link rel="prefetch" href="/bootcamp/assets/js/32.f9b06db3.js"><link rel="prefetch" href="/bootcamp/assets/js/33.29945ab7.js"><link rel="prefetch" href="/bootcamp/assets/js/34.3d957610.js"><link rel="prefetch" href="/bootcamp/assets/js/35.f558954b.js"><link rel="prefetch" href="/bootcamp/assets/js/36.84aae32f.js"><link rel="prefetch" href="/bootcamp/assets/js/37.efd70738.js"><link rel="prefetch" href="/bootcamp/assets/js/38.640c609c.js"><link rel="prefetch" href="/bootcamp/assets/js/39.e61a7d7b.js"><link rel="prefetch" href="/bootcamp/assets/js/4.9fc7b733.js"><link rel="prefetch" href="/bootcamp/assets/js/40.31d5c2f8.js"><link rel="prefetch" href="/bootcamp/assets/js/41.5023758f.js"><link rel="prefetch" href="/bootcamp/assets/js/5.37979a01.js"><link rel="prefetch" href="/bootcamp/assets/js/6.4478843a.js"><link rel="prefetch" href="/bootcamp/assets/js/7.68c1a96e.js"><link rel="prefetch" href="/bootcamp/assets/js/8.a3a91d4f.js"><link rel="prefetch" href="/bootcamp/assets/js/9.91c207b4.js">
    <link rel="stylesheet" href="/bootcamp/assets/css/0.styles.5f3404af.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/bootcamp/" class="home-link router-link-active"><!----> <span class="site-name">IIJ Bootcamp</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/iij/bootcamp" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/iij/bootcamp" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/bootcamp/development/docker/docker/#おさらい" class="sidebar-link">おさらい</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/bootcamp/development/docker/docker/#_1-docker-とは" class="sidebar-link">1. Docker とは</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/bootcamp/development/docker/docker/#_2-docker-でhello-world" class="sidebar-link">2. Docker でHello World</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/bootcamp/development/docker/docker/#_3-dockerコマンドを用いたコンテナ・イメージの管理" class="sidebar-link">3. dockerコマンドを用いたコンテナ・イメージの管理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bootcamp/development/docker/docker/#_3-1-docker-ps" class="sidebar-link">3.1 docker ps</a></li><li class="sidebar-sub-header"><a href="/bootcamp/development/docker/docker/#_3-2-docker-images" class="sidebar-link">3.2 docker images</a></li><li class="sidebar-sub-header"><a href="/bootcamp/development/docker/docker/#_3-3-docker-start、stop" class="sidebar-link">3.3 docker start、stop</a></li><li class="sidebar-sub-header"><a href="/bootcamp/development/docker/docker/#_3-4-docker-rm、rmi" class="sidebar-link">3.4 docker rm、rmi</a></li></ul></li><li><a href="/bootcamp/development/docker/docker/#_4-dockerfile-によるdocker-イメージ作成" class="sidebar-link">4. Dockerfile によるDocker イメージ作成</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/bootcamp/development/docker/docker/#_5-docker-イメージの共有方法" class="sidebar-link">5. Docker イメージの共有方法</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/bootcamp/development/docker/docker/#_6-まとめ" class="sidebar-link">6. まとめ</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><table><tr><td>このハンズオンでやること</td><td>Docker の概要を学び、コンテナ操作を体験します</td></tr> <tr><td>想定時間</td><td>1h</td></tr> <tr><td>前提知識・用語</td><td>仮想化、CUI 操作</td></tr></table> <h1 id="dockerを触ってみよう"><a href="#dockerを触ってみよう" class="header-anchor">#</a> Dockerを触ってみよう</h1> <h2 id="おさらい"><a href="#おさらい" class="header-anchor">#</a> おさらい</h2> <p>前回の下準備でDockerコマンドのインストールを実施いただきました。</p> <p>下記コマンドを入力し、コマンドが実行できるか確認してください。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker version
</code></pre></div><h2 id="_1-docker-とは"><a href="#_1-docker-とは" class="header-anchor">#</a> 1. Docker とは</h2> <p>Docker は、現在Docker 社が開発しているコンテナ型の仮想環境プラットフォームです。コンテナとは仮想マシンのような1台のコンピュータの上で、仮想的に複数のコンピュータを動作させる技術の1つのしくみです。しかしながら、仮想マシンとは少し異なるしくみの元動作しています。一般的な仮想マシンと呼ばれるソフトウェア（VirtualBox など）では、ホストOS上で仮想マシン用のソフトウェアを動かし、その中でまたOS を起動します。OS の中で別のOSを起動するため起動やホスト自体のハードウェアにアクセスする際、時間がかかるなどのデメリットが存在します。しかしコンテナ型では、ホストOS 上に専用のアプリケーション実行用の領域を作成しその中で実行するしくみとなっているためアプリケーションや環境の起動が高速でメモリやディスクも小容量で実行できます。また、開発環境などにDocker を使うことでホストアプリケーションを実行に必要な環境と合わせて配布することで、メンバー全員が同じ環境で開発を行うことが容易になります。</p> <p>Docker には、大きくわけて2つの重要な概念が存在します。1つ目は、前述しているコンテナである「<strong>Docker コンテナ</strong>」です。2つ目は、「<strong>Docker イメージ</strong>」と呼ばれるコンテナの土台となるシステムファイルです。
多くの場合、docker内のアプリケーションが動作するまでの流れは以下のようになっています。</p> <ol><li>Docker イメージのダウンロード（または作成）</li> <li>Docker イメージを元にコンテナを作成</li> <li>Docker コンテナを起動しアプリケーションを実行</li></ol> <p>そこで本講義では、</p> <ul><li>Docker イメージのダウンロード、Docker コンテナの作成方法</li> <li>ダウンロードしたDocker イメージやDocker コンテナの管理方法</li> <li>Dockerfileを用いたDocker イメージの作成</li></ul> <p>についてご紹介したいと思います。</p> <h2 id="_2-docker-でhello-world"><a href="#_2-docker-でhello-world" class="header-anchor">#</a> 2. Docker でHello World</h2> <p>では初めに、<code>docker run</code> コマンドを用いて、初めてのコンテナ作成をしてみましょう。</p> <p><code>docker run</code> コマンドは、上記の</p> <ol><li>Docker イメージのダウンロード</li> <li>Docker イメージを元にコンテナを作成</li></ol> <p>を実行してくれるコマンドです。今回の場合、初めに「hello-world」のDocker イメージをダウンロードしてきます。ダウンロードが完了後、Docker イメージの定義に基づいて、<strong>Hello from Docker!</strong> という文字列を表示するアプリケーションが自動的に実行されます。</p> <p>以下のコマンドを実行してください。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker run hello-world
</code></pre></div><p>上記コマンドを実行すると以下のような画面が表示されると思います。</p> <div class="language- extra-class"><pre class="language-text"><code>Unable to find image 'hello-world:latest' locally
latest: Pulling from library/hello-world
1b930d010525: Pull complete
Digest: sha256:2557e3c07ed1e38f26e389462d03ed943586f744621577a99efb77324b0fe535
Status: Downloaded newer image for hello-world:latest

Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the &quot;hello-world&quot; image from the Docker Hub.
    (amd64)
 3. The Docker daemon created a new container from that image which runs the
    executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it
    to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
 $ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
 https://hub.docker.com/

For more examples and ideas, visit:
 https://docs.docker.com/get-started/
</code></pre></div><h2 id="_3-dockerコマンドを用いたコンテナ・イメージの管理"><a href="#_3-dockerコマンドを用いたコンテナ・イメージの管理" class="header-anchor">#</a> 3. dockerコマンドを用いたコンテナ・イメージの管理</h2> <h3 id="_3-1-docker-ps"><a href="#_3-1-docker-ps" class="header-anchor">#</a> 3.1 docker ps</h3> <p><code>docker ps</code> コマンドは、ローカル環境に存在するDockerコンテナに関する情報を表示してくれます。現在起動しているコンテナは<code>docker ps</code> と入力すると表示されます。しかしながら今の状態で本コマンドを実行してもヘッダー情報だけで何も表示されないと思います。実は今回のコンテナは文字を出力したら終了してしまいます。つまり永続的に稼働しているコンテナではありません。こういったすでに終了してしまったり、エラーで起動できていないコンテナを確認するためには、オプションで<code>-a</code> を付けることで表示可能です。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker <span class="token function">ps</span> -a
CONTAINER ID        IMAGE                           COMMAND                  CREATED             STATUS                      PORTS                      NAMES
9b1f2c08a269        hello-world                     <span class="token string">&quot;/hello&quot;</span>                 <span class="token number">11</span> seconds ago      Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">11</span> seconds ago                              admiring_jang
</code></pre></div><h3 id="_3-2-docker-images"><a href="#_3-2-docker-images" class="header-anchor">#</a> 3.2 docker images</h3> <p><code>docker images</code> コマンドは、ローカル環境に存在するDocker イメージの一覧を表示するコマンドです。現状では、「hello-world」イメージのみが存在すると思います。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker images
REPOSITORY                    TAG                 IMAGE ID            CREATED             SIZE
hello-world                   latest              fce289e99eb9        <span class="token number">5</span> weeks ago         <span class="token number">1</span>.84kB
</code></pre></div><p>Dockerイメージには、名前の他に「TAG」を付けることができます。TAGでは、主にバージョンを管理していることが多いです。今回表示されている「latest」は最新版であることを意味しています。</p> <h3 id="_3-3-docker-start、stop"><a href="#_3-3-docker-start、stop" class="header-anchor">#</a> 3.3 docker start、stop</h3> <p><code>docker start</code> は、コンテナの起動を行うコマンドで、<code>docker stop</code> は、コンテナを停止するコマンドです。これらのコマンドでは、起動・停止対象のコンテナを選択する必要があるため、引数として<code>docker ps</code> の表示結果にあった「CONTAINER ID」を設定します。</p> <p>では、今回のコンテナを起動してみましょう。ただし普通に起動するだけでは、標準入出力がコンテナ内にとどまってしまい、最初と同じ画面は表示されません。そこで、手元の標準入出力とコンテナ内の標準入出力を紐づけるために、<code>-a</code> オプション（<code>--attach</code> オプション)を付けてあげます。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker start -a 9b1f2c08a269
<span class="token punctuation">(</span>省略<span class="token punctuation">)</span>
</code></pre></div><h3 id="_3-4-docker-rm、rmi"><a href="#_3-4-docker-rm、rmi" class="header-anchor">#</a> 3.4 docker rm、rmi</h3> <p><code>docker rm</code> と<code>docker rmi</code> は、それぞれDocker コンテナ、Docker イメージの削除を行うコマンドです。それぞれ引数に「CONTAINER ID」や「IMAGE ID」を設定する必要があります。また、削除したいDocker イメージを元に作成したDocker コンテナが存在する場合削除できません。その際は、事前にDocker コンテナを削除した後に、Docker イメージを削除してください。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker <span class="token function">rm</span> 9b1f2c08a269
9b1f2c08a269
$ docker rmi fce289e99eb9
Untagged: hello-world:latest
Untagged: hello-world@sha256:2557e3c07ed1e38f26e389462d03ed943586f744621577a99efb77324b0fe535
Deleted: sha256:fce289e99eb9bca977dae136fbe2a82b6b7d4c372474c9235adc1741675f587e
Deleted: sha256:af0b15c8625bb1938f1d7b17081031f649fd14e6b233688eea3c5483994a66a3
</code></pre></div><h2 id="_4-dockerfile-によるdocker-イメージ作成"><a href="#_4-dockerfile-によるdocker-イメージ作成" class="header-anchor">#</a> 4. Dockerfile によるDocker イメージ作成</h2> <p>Docker では、「<strong>Dockerfile</strong>」というファイルを用いて、Docker イメージの作成を行うことができます。Dockerfile は専用言語で記述します。このようにコンテナを初めとするサーバ環境やミドルウェアなどをコード（プログラム、設定ファイルなど）で構成管理することを「<strong>Infrastructure as Code（IaC）</strong>」と呼びます。Dockerfile のように環境をコード化して管理することにより、以下のようなメリットが挙げられます。</p> <ul><li>新規メンバーの開発環境が、Dockerfile を共有するだけで構築可能</li> <li>複雑なインフラ環境がテキストベースで管理でき、git 等での管理が容易に</li> <li>構築手順などがコード化されるため、漏れや間違いが発見しやすくなる</li></ul> <p>今回は、ubuntu というDocker イメージを元にカスタマイズしながら、nginx によるWeb サーバのDocker イメージを作成します。また、作成したDocker イメージを使ってDocker コンテナを立ち上げ、HTML ファイルがレスポンスされることを確認します。</p> <p>では、実際にDockerfile を作成し、Docker イメージを作成していきましょう。以下の内容をファイル名「Dockerfile」として作成してください。</p> <div class="language-Dockerfile extra-class"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">FROM</span> ubuntu</span>
<span class="token instruction"><span class="token keyword">LABEL</span> maintainer=<span class="token string">&quot;your_email&quot;</span></span>

<span class="token instruction"><span class="token keyword">RUN</span> apt-get update &amp;&amp; <span class="token operator">\</span>
    apt-get install nginx -y &amp;&amp; <span class="token operator">\</span>
    rm /var/www/html/index.nginx-debian.html</span>

<span class="token instruction"><span class="token keyword">COPY</span> index.html /var/www/html/</span>

<span class="token instruction"><span class="token keyword">EXPOSE</span> 80</span>
<span class="token instruction"><span class="token keyword">ENTRYPOINT</span> [<span class="token string">&quot;nginx&quot;</span>, <span class="token string">&quot;-g&quot;</span>, <span class="token string">&quot;daemon off;&quot;</span>]</span>
</code></pre></div><p>また、<code>COPY</code> コマンドで利用する「index.html」を以下のように作成してください（あくまで一例です）。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Hello world<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>IIJ Boot Camp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Hello World from docker container!!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>作成したDockerfile の内容を先頭から読み解いていきましょう。</p> <ul><li><code>FROM</code> 命令は、ベースとなるDocker イメージを設定する命令です。今回は、ubuntu を利用しています。Dockerfile は必ず<code>FROM</code> 命令から始まっていなければなりません。</li> <li><code>LABEL</code> 命令は、Docker イメージにメタデータを付加するときに利用します。今回は、<code>maintainer</code> つまり管理者を追加しています。昔のDockerfile においては、<code>MAINTAINER</code> 命令を使って設定していましたが、現在は非推奨となっています。</li> <li><code>RUN</code> 命令は、Dockerfile の中でもとても重要な命令で、Docker イメージ作成時に実行する命令を記述します。今回はパッケージのアップデートとnginx のインストール、nginx のデフォルトウェブページであるHTML ファイルの削除を行っています。この行で重要なのは、<strong>&amp;&amp;</strong> で繋いで実行している点です。Dockerfile からDocker イメージを作成する際、<code>RUN</code> 命令などの実行した状態をキャッシュとして保存します。そのため、<code>apt-get update</code> と<code>apt-get install nginx -y</code> が異なる行で書かれていると、新しくパッケージを追加するために、<code>apt-get install nginx -y</code>の行を更新して、再度Docker イメージを作成しようとした際に、<code>apt-get update</code> で作成されたキャッシュを利用してしまい、<strong>最新版ではないnginx やパッケージがインストールされてしまう</strong>可能性があります。</li> <li><code>COPY</code> 命令は、ローカルにあるファイルなどをコンテナの内部へコピーする際に利用します。</li> <li><code>EXPOSE</code> 命令は、コンテナ実行時にポートで待ち受けることをdocker に伝えます。注意点として、この命令を書いただけでは、ホスト環境からアクセスはできません。実際にアクセスするためには、後述する<code>docker run</code> コマンドのオプションでポートを設定する必要があります。</li> <li><code>ENTRYPOINT</code> 命令は、<code>RUN</code> 命令と異なり、Dockerイメージから実際のコンテナを作成する際に実行されます。</li></ul> <p>その他詳しい機能について知りたい方は、<a href="https://docs.docker.com/engine/reference/builder/" target="_blank" rel="noopener noreferrer">公式のリファレンス<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>をご参照ください。</p> <p>では、先ほど作成したDockerfileが存在するディレクトリ内で以下のコマンドを実行してください。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker build -t iijbootcamp <span class="token builtin class-name">.</span>
</code></pre></div><p>このコマンドによって、Dockerfile からDocker イメージが作成されます。<code>-t</code> オプションでイメージ名を決めることができます。また、最後の<code>.</code> は、Dockerfile が存在するディレクトリ（カレントディレクトリ）を意味しています。</p> <p>実際にDockerイメージが作成されているかコマンドで確認してみてください。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
iijbootcamp         latest              417ab982faaa        <span class="token number">6</span> days ago          170MB
ubuntu              latest              93fd78260bd1        <span class="token number">6</span> days ago          <span class="token number">86</span>.2MB
</code></pre></div><p>「REPOSITORY」がubuntu とiijbootcamp の２つのイメージが新たに作られていると思います。ubuntu は<code>FROM</code> で指定したDocker イメージです。iijbootcamp は、ubuntu のDocker イメージを元にnginx やHTML ファイルを追加して今回作成したDocker イメージです。</p> <p>では、実際にこのコンテナを起動してアクセスしてみましょう。次のコマンドを実行してください。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker run -d -p <span class="token number">8888</span>:80 iijbootcamp
</code></pre></div><p><code>-d</code> オプションはコンテナをデタッチドモードで起動することを意味しています。また、nginx はデフォルトでデーモンとして起動してしまうため、Dockerfile ではnginx をデーモンとして起動しないオプションで起動しています。また、<code>-p</code> オプションでは、ホスト側とコンテナ側のポートを対応付けています。「:」の左側がホスト環境、右側がコンテナ環境のポートを示しており、<strong>ホスト環境の8888ポートへアクセスすると、コンテナの80ポートにつながる</strong>ようになっています。</p> <p>コンテナが起動していることを確認してください。正しく実行されていると以下のような画面が表示されます。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker <span class="token function">ps</span>
CONTAINER ID        IMAGE                      COMMAND                  CREATED             STATUS              PORTS                      NAMES
171c3b25c75e        iijbootcamp:latest         <span class="token string">&quot;nginx -g 'daemon of…&quot;</span>   <span class="token number">15</span> minutes ago      Up <span class="token number">15</span> minutes       <span class="token number">0.0</span>.0.0:8888-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp       condescending_wilson
</code></pre></div><p>では、実際にコンテナに対してアクセスしてみましょう。お好きな方法（Webブラウザでもcurlコマンド等でも)で「 <a href="http://localhost:8888" target="_blank" rel="noopener noreferrer">http://localhost:8888<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 」にアクセスしてみましょう。以下にcurl コマンドを用いた例を示します。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">curl</span> http://localhost:8888
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta <span class="token assign-left variable">charset</span><span class="token operator">=</span><span class="token string">&quot;utf-8&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Hello world<span class="token operator">&lt;</span>/title<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>/head<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>h<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>IIJ Boot Camp<span class="token operator">&lt;</span>/h<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>
    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>Hello World from docker container<span class="token operator">!</span><span class="token operator">!</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>/body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/html<span class="token operator">&gt;</span>
</code></pre></div><p>上記のように実際に作成したHTMLが表示されていれば成功です。
プロキシを設定している場合は下記のように<code>--noproxy</code>オプションを指定する必要があります。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">curl</span> --noproxy localhost http://localhost:8888
</code></pre></div><p><strong>curlコマンドによってHTMLが取得できることを確認してください</strong></p> <h2 id="_5-docker-イメージの共有方法"><a href="#_5-docker-イメージの共有方法" class="header-anchor">#</a> 5. Docker イメージの共有方法</h2> <p>皆さんが作成したDocker イメージなどを他の人に共有したい場合、Dockerfile をファイルサーバやGitHub 等で共有する以外に、<a href="https://hub.docker.com/" target="_blank" rel="noopener noreferrer">Docker Hub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>を始めとする「<strong>Docker イメージレジストリ</strong>」で公開し、それを利用してもらうことが可能です。例えば、本講義で利用した「hello-world」や「ubuntu」のDocker イメージは、Docker Hubで公開されているものを利用しています。</p> <p>Docker イメージレジストリに自分のDocker イメージを公開する際には、<code>docker push</code> コマンドを利用します。逆に、Docker イメージをダウンロードしたい場合は、<code>docker pull</code> コマンドを利用します。また、Dockerイメージを<code>docker save</code> コマンドでtarファイルとして保存し、<code>docker load</code> コマンドでtarからロードするといったことも行うことができます。</p> <h2 id="_6-まとめ"><a href="#_6-まとめ" class="header-anchor">#</a> 6. まとめ</h2> <p>今回は、仮想環境プラットフォームであるDocker を実際に触っていただきました。Docker の基礎知識、Docker コンテナ、イメージの管理方法に加え、Dockerfile を作成し自身でコンテナを作っていただきました。仮想マシンに比べ軽く高速で作成することが可能なため使いどころは多いでしょう。しかしながら、実際のサービスでは、単一のアプリケーションのみで1つのコンテナで完成することはありえません。Web サーバやWeb アプリケーション、データベースなど様々なものが１つに組み合わさって初めてサービスとして完成します。Docker コンテナでは、「1コンテナ1プロセス」や「1コンテナ1ロール」が基本となっています。そのため複数のコンテナを組み合わせて構築する必要があります。次の講義「開発環境をdocker-composeで構築」では、複数のコンテナを組み合わせて管理する手法について学びます。</p> <div><hr> <span>CC BY-SA Licensed | Copyright (c) 2020, Internet Initiative Japan Inc.</span></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/iij/bootcamp/edit/master/src/development/docker/docker/README.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">6/28/2021, 3:12:31 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/bootcamp/assets/js/app.ed014b26.js" defer></script><script src="/bootcamp/assets/js/2.bc4131d0.js" defer></script><script src="/bootcamp/assets/js/30.1defa3d3.js" defer></script><script src="/bootcamp/assets/js/11.ab6fb600.js" defer></script><script src="/bootcamp/assets/js/10.e02dca73.js" defer></script>
  </body>
</html>
