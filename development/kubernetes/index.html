<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Kubernetes入門 | IIJ Bootcamp</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Kubenetesの基本的なアーキテクチャを学び、実際に触ってみる">
    
    <link rel="preload" href="/bootcamp/assets/css/0.styles.095a7d7e.css" as="style"><link rel="preload" href="/bootcamp/assets/js/app.9b5d2d24.js" as="script"><link rel="preload" href="/bootcamp/assets/js/2.0d322aa6.js" as="script"><link rel="preload" href="/bootcamp/assets/js/11.ce6a2bf0.js" as="script"><link rel="preload" href="/bootcamp/assets/js/14.c8974a20.js" as="script"><link rel="prefetch" href="/bootcamp/assets/js/10.dd8644f9.js"><link rel="prefetch" href="/bootcamp/assets/js/12.d25a1efe.js"><link rel="prefetch" href="/bootcamp/assets/js/13.9be8637e.js"><link rel="prefetch" href="/bootcamp/assets/js/15.0b6b2bf6.js"><link rel="prefetch" href="/bootcamp/assets/js/16.e4ade53b.js"><link rel="prefetch" href="/bootcamp/assets/js/17.cb43e59d.js"><link rel="prefetch" href="/bootcamp/assets/js/18.ce9241c0.js"><link rel="prefetch" href="/bootcamp/assets/js/19.5185799d.js"><link rel="prefetch" href="/bootcamp/assets/js/20.27f9c598.js"><link rel="prefetch" href="/bootcamp/assets/js/21.c274a4a1.js"><link rel="prefetch" href="/bootcamp/assets/js/22.cf755e50.js"><link rel="prefetch" href="/bootcamp/assets/js/23.958292cb.js"><link rel="prefetch" href="/bootcamp/assets/js/24.c25183d4.js"><link rel="prefetch" href="/bootcamp/assets/js/25.95aecd73.js"><link rel="prefetch" href="/bootcamp/assets/js/26.aeb9c634.js"><link rel="prefetch" href="/bootcamp/assets/js/27.f22429f1.js"><link rel="prefetch" href="/bootcamp/assets/js/28.cfb3729c.js"><link rel="prefetch" href="/bootcamp/assets/js/29.a77e9435.js"><link rel="prefetch" href="/bootcamp/assets/js/3.4f3ff0ea.js"><link rel="prefetch" href="/bootcamp/assets/js/30.8900b286.js"><link rel="prefetch" href="/bootcamp/assets/js/31.a310dbc0.js"><link rel="prefetch" href="/bootcamp/assets/js/32.faa73779.js"><link rel="prefetch" href="/bootcamp/assets/js/33.4573c574.js"><link rel="prefetch" href="/bootcamp/assets/js/34.66fe8e77.js"><link rel="prefetch" href="/bootcamp/assets/js/35.f7277e8c.js"><link rel="prefetch" href="/bootcamp/assets/js/36.5a0cdf15.js"><link rel="prefetch" href="/bootcamp/assets/js/37.87be7d87.js"><link rel="prefetch" href="/bootcamp/assets/js/38.9b56dbfc.js"><link rel="prefetch" href="/bootcamp/assets/js/39.2dbc9b8f.js"><link rel="prefetch" href="/bootcamp/assets/js/4.43aacb64.js"><link rel="prefetch" href="/bootcamp/assets/js/40.02c70a18.js"><link rel="prefetch" href="/bootcamp/assets/js/41.0297d11c.js"><link rel="prefetch" href="/bootcamp/assets/js/42.76ec9409.js"><link rel="prefetch" href="/bootcamp/assets/js/43.d8893198.js"><link rel="prefetch" href="/bootcamp/assets/js/44.5e7bd4f8.js"><link rel="prefetch" href="/bootcamp/assets/js/45.0448dfa1.js"><link rel="prefetch" href="/bootcamp/assets/js/46.387843f2.js"><link rel="prefetch" href="/bootcamp/assets/js/47.46bf658b.js"><link rel="prefetch" href="/bootcamp/assets/js/48.acbad534.js"><link rel="prefetch" href="/bootcamp/assets/js/49.e4b5002f.js"><link rel="prefetch" href="/bootcamp/assets/js/5.d950eaf0.js"><link rel="prefetch" href="/bootcamp/assets/js/50.f46a345f.js"><link rel="prefetch" href="/bootcamp/assets/js/51.115b10a1.js"><link rel="prefetch" href="/bootcamp/assets/js/52.8a33187a.js"><link rel="prefetch" href="/bootcamp/assets/js/53.12e5254b.js"><link rel="prefetch" href="/bootcamp/assets/js/54.17ab1d3e.js"><link rel="prefetch" href="/bootcamp/assets/js/55.f683cbcb.js"><link rel="prefetch" href="/bootcamp/assets/js/56.22f6bda9.js"><link rel="prefetch" href="/bootcamp/assets/js/57.47e4aee6.js"><link rel="prefetch" href="/bootcamp/assets/js/6.9247dbce.js"><link rel="prefetch" href="/bootcamp/assets/js/7.ac3646d0.js"><link rel="prefetch" href="/bootcamp/assets/js/8.8ce40d63.js"><link rel="prefetch" href="/bootcamp/assets/js/9.f699ab60.js">
    <link rel="stylesheet" href="/bootcamp/assets/css/0.styles.095a7d7e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/bootcamp/" class="home-link router-link-active"><!----> <span class="site-name">IIJ Bootcamp</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/iij/bootcamp" target="_blank" rel="noopener noreferrer" class="repo-link">
      GitHub
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/iij/bootcamp" target="_blank" rel="noopener noreferrer" class="repo-link">
      GitHub
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Kubernetes入門</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/bootcamp/development/kubernetes/#_0-まえがき" class="sidebar-link">0. まえがき</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bootcamp/development/kubernetes/#_0-1-想定している受講者" class="sidebar-link">0-1. 想定している受講者</a></li><li class="sidebar-sub-header"><a href="/bootcamp/development/kubernetes/#_0-2-前提知識" class="sidebar-link">0-2. 前提知識</a></li><li class="sidebar-sub-header"><a href="/bootcamp/development/kubernetes/#_0-3-事前準備" class="sidebar-link">0-3. 事前準備</a></li></ul></li><li><a href="/bootcamp/development/kubernetes/#_1-kubernetesとは" class="sidebar-link">1. Kubernetesとは</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/bootcamp/development/kubernetes/#_2-kubernetesの基本構造" class="sidebar-link">2. Kubernetesの基本構造</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bootcamp/development/kubernetes/#_2-1-宣言的な構成管理" class="sidebar-link">2-1. 宣言的な構成管理</a></li><li class="sidebar-sub-header"><a href="/bootcamp/development/kubernetes/#_2-2-コントロールプレーンとワーカーノード" class="sidebar-link">2-2. コントロールプレーンとワーカーノード</a></li><li class="sidebar-sub-header"><a href="/bootcamp/development/kubernetes/#_2-3-kubernetesの基本構造まとめ" class="sidebar-link">2-3. Kubernetesの基本構造まとめ</a></li></ul></li><li><a href="/bootcamp/development/kubernetes/#_3-マニフェストファイルの書き方" class="sidebar-link">3. マニフェストファイルの書き方</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bootcamp/development/kubernetes/#_3-1-kubernetesオブジェクト" class="sidebar-link">3-1. Kubernetesオブジェクト</a></li><li class="sidebar-sub-header"><a href="/bootcamp/development/kubernetes/#_3-2-deployment" class="sidebar-link">3-2. Deployment</a></li><li class="sidebar-sub-header"><a href="/bootcamp/development/kubernetes/#_3-3-service" class="sidebar-link">3-3. Service</a></li><li class="sidebar-sub-header"><a href="/bootcamp/development/kubernetes/#_3-4-podを削除してみる" class="sidebar-link">3-4. Podを削除してみる</a></li></ul></li><li><a href="/bootcamp/development/kubernetes/#_4-応用-kubernetesの監視" class="sidebar-link">4. 応用(Kubernetesの監視)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bootcamp/development/kubernetes/#_4-1-node-exporterのデプロイ" class="sidebar-link">4-1. node exporterのデプロイ</a></li><li class="sidebar-sub-header"><a href="/bootcamp/development/kubernetes/#_4-2-rbac認可を使ってリソースにアクセスするためのアカウントをデプロイ" class="sidebar-link">4-2. RBAC認可を使ってリソースにアクセスするためのアカウントをデプロイ</a></li><li class="sidebar-sub-header"><a href="/bootcamp/development/kubernetes/#_4-3-prometheusのデプロイ" class="sidebar-link">4-3. Prometheusのデプロイ</a></li><li class="sidebar-sub-header"><a href="/bootcamp/development/kubernetes/#_4-4-prometheusの確認" class="sidebar-link">4-4. Prometheusの確認</a></li></ul></li><li><a href="/bootcamp/development/kubernetes/#_5-最後に" class="sidebar-link">5. 最後に</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><table><tr><td>このハンズオンでやること</td><td>Kubenetesの基本的なアーキテクチャを学び、実際に触ってみる</td></tr> <tr><td>想定時間</td><td>2h</td></tr> <tr><td>前提知識・用語</td><td>deployment</td></tr></table> <h1 id="kubernetes-でアプリケーション開発"><a href="#kubernetes-でアプリケーション開発" class="header-anchor">#</a> Kubernetes でアプリケーション開発</h1> <h2 id="_0-まえがき"><a href="#_0-まえがき" class="header-anchor">#</a> 0. まえがき</h2> <h3 id="_0-1-想定している受講者"><a href="#_0-1-想定している受講者" class="header-anchor">#</a> 0-1. 想定している受講者</h3> <p>本講義では以下の受講者を対象としています。</p> <ul><li>Kubernetesという名前は知っているがどんなものなのかは知らない</li> <li>Kubernetes入門しようにも何から始めたらよいのかわからない</li> <li>Kubernetesの仕組みがわからない</li></ul> <h3 id="_0-2-前提知識"><a href="#_0-2-前提知識" class="header-anchor">#</a> 0-2. 前提知識</h3> <p>以下の点を知らないと講義についていけない可能性があります。</p> <ul><li>Linuxの基本的なコマンド</li> <li>dockerの基礎</li></ul> <p>加えて以下の点を知っていると講義をスムーズに聞けます。</p> <ul><li>YAMLファイルの読み方/書き方</li> <li>コンテナアーキテクチャの基礎</li></ul> <h3 id="_0-3-事前準備"><a href="#_0-3-事前準備" class="header-anchor">#</a> 0-3. 事前準備</h3> <ul><li>docker / docker-compose のインストール</li> <li>Kubernetes環境
<ul><li>環境構築に自信が無い人katacodaを使ってください
<ul><li><a href="https://www.katacoda.com/courses/kubernetes/playground" target="_blank" rel="noopener noreferrer">https://www.katacoda.com/courses/kubernetes/playground<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><strong><strong>外部リソースなのでコピペする際は気を付けてください</strong></strong></li></ul></li> <li>ローカルでkubernetesを動かしたい人はkindを以下の手順で構築してください</li></ul></li></ul> <blockquote><p>kindを使ったkubernetes環境の構築</p> <p>kindはkubernetes in dockerの略です。その名の通り、dockerを使ってkubernetes環境を構築します。
(<a href="https://kind.sigs.k8s.io/docs/user/quick-start/" target="_blank" rel="noopener noreferrer">公式ドキュメント参照<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># curl -Lo ./kind https://kind.sigs.k8s.io/dl/v0.14.0/kind-linux-amd64</span>
<span class="token comment"># chmod +x ./kind</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>dockerホストからkindに対してコマンドを実行したいのでkubectlをdockerホストに入れます</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># curl -LO &quot;https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl&quot;</span>
<span class="token comment"># install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>試験的にクラスターを構築して正しくインストールされたか確認する</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># kind create cluster</span>
Creating cluster <span class="token string">&quot;kind&quot;</span> <span class="token punctuation">..</span>.
 ✓ Ensuring <span class="token function">node</span> image <span class="token punctuation">(</span>kindest/node:v1.24.0<span class="token punctuation">)</span> 🖼 
 ✓ Preparing nodes 📦  
 ✓ Writing configuration 📜 
 ✓ Starting control-plane 🕹️ 
 ✓ Installing CNI 🔌 
 ✓ Installing StorageClass 💾 
Set kubectl context to <span class="token string">&quot;kind-kind&quot;</span>
You can now use your cluster with:

kubectl cluster-info --context kind-kind

Have a question, bug, or feature request? Let us know<span class="token operator">!</span> https://kind.sigs.k8s.io/<span class="token comment">#community 🙂</span>

<span class="token comment"># docker ps</span>
CONTAINER ID   IMAGE                  COMMAND                  CREATED          STATUS          PORTS                       NAMES
d76ca5889d8d   kindest/node:v1.24.0   <span class="token string">&quot;/usr/local/bin/entr…&quot;</span>   <span class="token number">59</span> seconds ago   Up <span class="token number">49</span> seconds   <span class="token number">127.0</span>.0.1:35447-<span class="token operator">&gt;</span><span class="token number">6443</span>/tcp   kind-control-plane

<span class="token comment"># kubectl cluster-info --context kind-kind</span>
Kubernetes control plane is running at https://127.0.0.1:35447
CoreDNS is running at https://127.0.0.1:35447/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy

To further debug and diagnose cluster problems, use <span class="token string">'kubectl cluster-info dump'</span><span class="token builtin class-name">.</span>

<span class="token comment"># kubectl get node</span>
NAME                 STATUS   ROLES           AGE     VERSION
kind-control-plane   Ready    control-plane   2m43s   v1.24.0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>確認出来たら削除</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># kind delete cluster</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>bootcamp用のクラスター環境を構築する</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># vim cluster.yml </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>以下の内容を記載する</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">kind</span><span class="token punctuation">:</span> Cluster
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> kind.x<span class="token punctuation">-</span>k8s.io/v1alpha4
<span class="token key atrule">nodes</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">role</span><span class="token punctuation">:</span> control<span class="token punctuation">-</span>plane
    <span class="token key atrule">image</span><span class="token punctuation">:</span> kindest/node<span class="token punctuation">:</span>v1.24.0@sha256<span class="token punctuation">:</span>0866296e693efe1fed79d5e6c7af8df71fc73ae45e3679af05342239cdc5bc8e
  <span class="token punctuation">-</span> <span class="token key atrule">role</span><span class="token punctuation">:</span> worker
    <span class="token key atrule">image</span><span class="token punctuation">:</span> kindest/node<span class="token punctuation">:</span>v1.24.0@sha256<span class="token punctuation">:</span>0866296e693efe1fed79d5e6c7af8df71fc73ae45e3679af05342239cdc5bc8e
  <span class="token punctuation">-</span> <span class="token key atrule">role</span><span class="token punctuation">:</span> worker
    <span class="token key atrule">image</span><span class="token punctuation">:</span> kindest/node<span class="token punctuation">:</span>v1.24.0@sha256<span class="token punctuation">:</span>0866296e693efe1fed79d5e6c7af8df71fc73ae45e3679af05342239cdc5bc8e 
  <span class="token punctuation">-</span> <span class="token key atrule">role</span><span class="token punctuation">:</span> worker
    <span class="token key atrule">image</span><span class="token punctuation">:</span> kindest/node<span class="token punctuation">:</span>v1.24.0@sha256<span class="token punctuation">:</span>0866296e693efe1fed79d5e6c7af8df71fc73ae45e3679af05342239cdc5bc8e
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>クラスター構築</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># kind create cluster --config cluster.yml </span>
Creating cluster <span class="token string">&quot;kind&quot;</span> <span class="token punctuation">..</span>.
 ✓ Ensuring <span class="token function">node</span> image <span class="token punctuation">(</span>kindest/node:v1.24.0<span class="token punctuation">)</span> 🖼 
 ✓ Preparing nodes 📦 📦 📦 📦  
 ✓ Writing configuration 📜 
 ✓ Starting control-plane 🕹️ 
 ✓ Installing CNI 🔌 
 ✓ Installing StorageClass 💾 
 ✓ Joining worker nodes 🚜 
Set kubectl context to <span class="token string">&quot;kind-kind&quot;</span>
You can now use your cluster with:

kubectl cluster-info --context kind-kind

Thanks <span class="token keyword">for</span> using kind<span class="token operator">!</span> 😊

<span class="token comment"># kubectl cluster-info --context kind-kind</span>
Kubernetes control plane is running at https://127.0.0.1:46863
CoreDNS is running at https://127.0.0.1:46863/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy

To further debug and diagnose cluster problems, use <span class="token string">'kubectl cluster-info dump'</span><span class="token builtin class-name">.</span>

<span class="token comment"># kubectl get node</span>
NAME                 STATUS   ROLES           AGE   VERSION
kind-control-plane   Ready    control-plane   72s   v1.24.0
kind-worker          Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>          33s   v1.24.0
kind-worker2         Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>          33s   v1.24.0
kind-worker3         Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>          32s   v1.24.0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div></blockquote> <h2 id="_1-kubernetesとは"><a href="#_1-kubernetesとは" class="header-anchor">#</a> 1. Kubernetesとは</h2> <p>Kubernetesは複数サーバで構成された基盤上でコンテナ群を一元管理するためツール「コンテナオーケストレーションツール」と呼ばれるものです。最近ではdockerを使ってコンテナ単位でアプリケーションを実装することが多くなりましたが、docker単体では複数台のdockerホスト上でコンテナ群を一元管理することができません。そのため複数ホストで構成される規模のプロダクションに耐えられるシステムをdocker単体で構築することは困難とされてきました。そこで複数のdockerホストに跨ってコンテナアプリケーションをデプロイ、スケーリング、ネットワーク管理機能などをするオーケストレーションツールが登場しました。</p> <p>Kubernetesは元々Googleがアプリケーションデプロイに利用していたBorgと呼ばれるクラスターマネージャーをOSS化したもので、現在はLinux Foundation傘下にあるCNCF(Cloud Native Computing Foundation)が管理しています。ランクはGraduatedで成熟したCNCFプロジェクトとなっています。</p> <blockquote><p>【豆知識】</p> <p>Kubernetesはギリシャ語で「操舵士」や「パイロット」を意味し、ロゴは操舵士にちなんで舵をモチーフにされています。7つのスポークは当初のKubernetesのコードネーム「Project Seven」にちなんでいます。</p></blockquote> <p>KubernetesをベースにカスタマイズしたKubernetesサービスを最近ではKaaS(Kubernetes as a Service)と言い、AWSやGCPなどの各クラウドベンダで提供されています。</p> <ul><li>Amazon EKS</li> <li>Google Kubernetes Engine(GKE)</li> <li>Azure Kubernetes Service(AKS)</li></ul> <p>先ほど「カスタマイズ」と言いましたが、Kubernetesはそれ単体で完成するものではなくログ基盤にfluentdとelasticsearchを使ったり、それぞれのクラウドサービスとの繋ぎこみなど提供元によって機能やスペックが異なります。このようにカスタマイズされたKubernetes基盤のことをLinuxのディストリビューションに例えて「Kubernetesディストリビューション」と呼びます。</p> <p>IIJでも社内向けのKubernetes基盤としてIKE(IIJ Kubernetes Engine)の運用と導入が進んでいます。</p> <ul><li><a href="https://www.iij.ad.jp/dev/report/iir/040/03.html" target="_blank" rel="noopener noreferrer">IIR<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://eng-blog.iij.ad.jp/kubernetes" target="_blank" rel="noopener noreferrer">IIJエンジニアブログ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>従来のVMでのシステム構築と比べてKubernetesを利用することでシステム開発・管理が格段に楽になります。例えば従来のシステム構築では、どのVMに何を割り当てるかのリソース計算を人が考えなければならず、システムがスケーリングするたびに多くの労力を使いましたが、Kubernetesではマシンリソースやネットワークをプールとして扱い自動で管理するため、システムのスケーリングに柔軟に対応することができます(<a href="https://kubernetes.io/ja/docs/tutorials/kubernetes-basics/scale/scale-intro/" target="_blank" rel="noopener noreferrer">詳細<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)。また、従来ではシステムのアップデートを行うたびに「サービス停止→アップデート→サービス再開」という手順でアップデートをしていたが、Kubernetesではサービスを停止することなくシステムアップデートを行うことができ、サービス可用性を高めてくれます(<a href="https://kubernetes.io/ja/docs/tutorials/kubernetes-basics/update/update-intro/" target="_blank" rel="noopener noreferrer">詳細<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)。</p> <p>上記以外にも多くのメリットがあり、Kubernetesでシステム開発を行うとアプリケーションの構築作業が劇的に減る他、APIなどからの自動デプロイなども非常に簡単に行うことができます。</p> <h2 id="_2-kubernetesの基本構造"><a href="#_2-kubernetesの基本構造" class="header-anchor">#</a> 2. Kubernetesの基本構造</h2> <h3 id="_2-1-宣言的な構成管理"><a href="#_2-1-宣言的な構成管理" class="header-anchor">#</a> 2-1. 宣言的な構成管理</h3> <p>Kubernetes上にアプリケーションをデプロイする際、その構成管理は宣言的に行われます。デプロイしたい人は「アプリケーションやそれを構成するコンテナ群はこのような配置であるべき」という宣言(manifest)を<strong>マニフェストファイル</strong>に記載することで、Kubernetesはマニフェストファイルに沿った構成を宣言どおりにデプロイします。このような構成管理方法はIaC(Infrastructure as a Code)と呼ばれており、Ansible同様に冪等性の確保や自動化に貢献しています。このような構成管理方法の主なメリットはGitによるバージョン管理のしやすさが挙げられます。</p> <blockquote><p>Ansibleで「Playbook」と呼ばれているものがKubernetesでいう「Manifest」です。</p></blockquote> <h3 id="_2-2-コントロールプレーンとワーカーノード"><a href="#_2-2-コントロールプレーンとワーカーノード" class="header-anchor">#</a> 2-2. コントロールプレーンとワーカーノード</h3> <p>Kubernetesは大きく分けて2つの要素で構成されています。<strong>コントロールプレーン</strong>と<strong>ワーカーノード</strong>です。</p> <blockquote><p>文献によってはコントロールプレーンのことを<strong>マスターノード</strong>と表記することがありますが、同じ意味なので誤解の無いように注意してください。</p></blockquote> <p><img src="/bootcamp/assets/img/components-of-kubernetes.51120ad2.svg" alt="component"></p> <h4 id="_2-2-1-コントロールプレーン"><a href="#_2-2-1-コントロールプレーン" class="header-anchor">#</a> 2-2-1. コントロールプレーン</h4> <p>コントロールプレーンはKubernetesクラスター全体の状態の管理を行うことが主な仕事です。例えばアプリケーション開発者が宣言したマニフェストファイルどおりに作られたPodがワーカーノードに割り当てられているかを監視し、割り当てられていなかった場合はそのPodを実行するノードを各のノードのリソース状況を考慮して割り当てます。このようなコンポーネントを<strong>kube-schduler</strong>と言います。他にもマニフェストファイルによって宣言された構成情報を閲覧/編集するためのAPIサーバの役割を果たす<strong>kube-apiserver</strong>などがあります。(他のコンポーネントも知りたい人は<a href="https://kubernetes.io/ja/docs/concepts/overview/components/" target="_blank" rel="noopener noreferrer">公式ページ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>へ)</p> <blockquote><p>【Podとは】</p> <p>Kubernetesはコンテナを「pod」と呼ばれる単位で管理します。podにはいくつかのコンテナの集まりで、同じpodに所属するコンテナ同士はlocalhostでお互いに通信することができます。
<img src="/bootcamp/assets/img/module_03_pods.ccc5ba54.svg" alt="Pod">
Podにどのようなコンテナを同居させるのかは設計次第ですが、例えばアプリケーションのログを集めるコンテナを同じpodに同居させたり、nginxなどwebのフロントになるアプリケーションを同居させたりします。</p></blockquote> <h4 id="_2-2-2-ワーカーノード"><a href="#_2-2-2-ワーカーノード" class="header-anchor">#</a> 2-2-2. ワーカーノード</h4> <p>ワーカーノードはPodの管理やPodの実行環境/通信機能を提供することが主な仕事です。例えばコントロールプレーンコンポーネントである<strong>kube-apiserver</strong>から受け取った構成情報どおりにPodが稼働するように管理します。このようなコンポーネントを<strong>kubelet</strong>と言います。ただしkubeletは実際にPodを作成したり、そのネットワーク環境を構築することはせず、あくまでもノード上のPod状態を維持するように管理することが仕事です。実際にPodを作ったりするコンポーネントを<strong>コンテナランタイム</strong>と言います。他には、後程出てきますがService宛の通信を稼働中のPod群へ転送させる<strong>kube-proxy</strong>などがあります。</p> <h3 id="_2-3-kubernetesの基本構造まとめ"><a href="#_2-3-kubernetesの基本構造まとめ" class="header-anchor">#</a> 2-3. Kubernetesの基本構造まとめ</h3> <p>Kubernetesは主に<strong>コントロールプレーン</strong>と<strong>ワーカーノード</strong>に分けられており、コントロールプレーンはクラスター全体の状態管理、ワーカーノードはコントロールプレーンからの指示通りにユーザによって宣言された構成を作り上げることが役割でした。そして、それぞれの役割を果たすために多くのコンポーネントが内蔵されている、という話でした。各コンポーネントについてもっと詳しく知りたい方は<a href="https://kubernetes.io/ja/docs/concepts/architecture/" target="_blank" rel="noopener noreferrer">公式ページ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>を参照してください。</p> <h2 id="_3-マニフェストファイルの書き方"><a href="#_3-マニフェストファイルの書き方" class="header-anchor">#</a> 3. マニフェストファイルの書き方</h2> <h3 id="_3-1-kubernetesオブジェクト"><a href="#_3-1-kubernetesオブジェクト" class="header-anchor">#</a> 3-1. Kubernetesオブジェクト</h3> <p>先ほども説明したように、Kubernetes上にPodなどをデプロイする際、ユーザはマニフェストファイルを書く必要があります。マニフェストファイルではいくつかのKubernetesオブジェクトを組み合わせて、ユーザの意図する状態を記載します。マニフェストファイルに記載されたKubernetesオブジェクトはコントロールプレーンによって読み取られ、読み取られたKubernetesオブジェクトが存在し続けるようにクラスター全体を管理します。</p> <blockquote><p>【Kubernetesオブジェクト】</p> <p>Kubernetesオブジェクトはクラスターの状態を表現するパーツです。以下にKubernetesオブジェクトの例と簡単な説明を記載します</p> <ul><li>ReplicaSet: Pod群の稼働状況を管理する</li> <li>Deployment：バージョンに相当するReplicaSetを管理する</li> <li>CronJob：定期実行するpodを管理する</li> <li>Service：特定のラベルを持ち、サービスを提供できる状態のPod群への接続を提供する</li> <li>Ingress：証明書やドメイン名を通して外部からの通信を制御する</li> <li>PersistentVolume：ストレージなどの永続化volumeを管理する</li></ul> <p>代表的な物を上げましたが、他にも色々あります。興味のある方は<a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.22/" target="_blank" rel="noopener noreferrer">公式サイト<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>参照。</p></blockquote> <h3 id="_3-2-deployment"><a href="#_3-2-deployment" class="header-anchor">#</a> 3-2. Deployment</h3> <p>上でも述べた通りDeploymentはPodの稼働状況を管理するオブジェクトです。予め起動するPodの数を指定することで、何かしらの原因でPodが消失しても自動で立ち上げ直してくれたり、逆に多すぎる場合は終了させます。</p> <p>現在稼働しているPodは、kubectlというcliツールを使って確認できます。
今は何も稼働してないはずです。</p> <blockquote><p>【kubectl】</p> <p>KubernetesのコントロールプレーンにはKubernetesクラスターの構成管理情報にアクセスするためのエンドポイントを提供する<strong>kube-apiserver</strong>がありますが、生身の人間がAPIを生で叩いて<strong>kube-apiserver</strong>にアクセスするのは少しキツイものがあります。そこでAPIをコマンドで操作できる<strong>kubectl</strong>というものがあり、kubectlを使うことによりコマンドベースでAPIを叩くことができます。</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ kubectl get pods
No resources found in default namespace.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>以下のようなマニフェストファイルを<code>app.yml</code>として作成し、Kubernetesクラスターにデプロイしてみましょう。
<code>image</code>として指定しているのはサンプル用の簡単なアプリケーションです。</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> bootcamp
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> bootcamp
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> bootcamp
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> bootcamp<span class="token punctuation">-</span>app
        <span class="token key atrule">image</span><span class="token punctuation">:</span> gcr.io/google<span class="token punctuation">-</span>samples/node<span class="token punctuation">-</span>hello<span class="token punctuation">:</span><span class="token number">1.0</span>
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">8080</span>
      <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> Always
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><blockquote><p>【Deploymentにおける必須フィールド】</p> <p>Kubernetesオブジェクトをマニフェストファイルに記載する際、必ず以下のフィールドに値をセットする必要があります</p> <ul><li>apiVersion：オブジェクトのAPIVersionを指定</li> <li>kind：どのオブジェクトを作るかを指定</li> <li>metadata：オブジェクトを特定するための情報を指定</li> <li>spec：オブジェクトの状態を指定</li></ul></blockquote> <p><code>apiVersion</code>にはオブジェクトのAPIVersionを書きます。
オブジェクトAPIがどのAPIGROUPに属しているかでapiVersionの書き方が変わってきます。
今回はDeploymentのオブジェクトなのでそのAPIグループを調べます。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ kubectl api-resources
NAME                              SHORTNAMES         APIGROUP                           NAMESPACED   KIND
bindings                                                                                true         Binding
componentstatuses                 cs                                                    false        ComponentStatus
configmaps                        cm                                                    true         ConfigMap
...
deployments                       deploy             apps                               true         Deployment
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>ここではDeploymentが<code>apps</code>に属しているということが分かりました。
もしAPIGROUPが空の場合はCore groupに属するため、<code>apiVersion: v1</code>で問題ないです。
次にAPIGROUPで利用可能なversionを調べます。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ kubectl api-versions | grep apps
apps/v1
apps/v1beta1
apps/v1beta2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ここでは3つほど出ましたが、この中の最も新しいversionを使ってください。
今回は<code>apps/v1</code>を使ってマニフェストファイルを作りました。</p> <p>yamlを作成したら、以下のコマンドでデプロイできます。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ kubectl apply -f app.yml
deployment.apps/bootcamp created
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>別端末で<code>get pods</code>しながらpodが作られる様子を見てみましょう<code>-w</code>をつけると自動で表示を更新してくれます。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ kubectl get pods -w
NAME                        READY   STATUS              RESTARTS   AGE
bootcamp-6bcddb7cf8-jpzg5   <span class="token number">0</span>/1     ContainerCreating   <span class="token number">0</span>          11s
bootcamp-6bcddb7cf8-tq2fs   <span class="token number">0</span>/1     ContainerCreating   <span class="token number">0</span>          11s
bootcamp-6bcddb7cf8-jpzg5   <span class="token number">1</span>/1     Running             <span class="token number">0</span>          83s
bootcamp-6bcddb7cf8-tq2fs   <span class="token number">1</span>/1     Running             <span class="token number">0</span>          84s
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><code>Running</code>となっていれば無事にアプリケーションが起動しました。今回は<code>replicas</code>に<code>2</code>を指定したのでpodが2個起動しています。<code>replicas</code>の値を変えて再度<code>kubectl apply</code>して遊んでみましょう。</p> <h3 id="_3-3-service"><a href="#_3-3-service" class="header-anchor">#</a> 3-3. Service</h3> <p>Podの起動ができましたので、次はPodへのアクセスを試みます。KubernetesクラスターではPod群へのサービスディスカバリーの方法としてServiceオブジェクトが用いられます。Serviceを利用することでPod群に共通のIPアドレスを割り当て、まるで一つの「サービス」であるかのようにアクセスできるようになります。</p> <blockquote><p>【PodとServiceの関係】</p> <p>Podは生成の度にIPアドレスが割り振られます。これは何かしらの理由でPodが落ちて別のPodが再生成されるときにもIPアドレスが割り振られますが、落ちたPodと同じIPアドレスが割り振られるとは限りません。こうなった場合に新しいPodへアクセスしたい別Podは新しいPodのIPアドレスがわからなくなってしまいます。ServiceはこのようなPodを共通のIPアドレスで管理し、Podへのアクセスやロードバランシングを行う役割を持っています。また、Serviceの生成によりKubernetesクラスター内の<a href="https://kubernetes.io/ja/docs/tasks/administer-cluster/coredns/" target="_blank" rel="noopener noreferrer">CoreDNS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>のA/AAAAレコードやPod内の<code>resolve.conf</code>が自動的に書き換えられるため、Service名を使ってPodへアクセスすることも可能になります。</p></blockquote> <blockquote><p>【ServiceからPodへの通信の受け渡し】</p> <p>Serviceが作られるとService宛の通信がPodへ転送されますが、その仕組みは<strong>ワーカーノード</strong>内のコンポーネントである<strong>kube-proxy</strong>によって実現されます。すべてのServiceは基本的にClusterIP(あとで説明します)によるVIPの保持が義務付けられており、またClusterIP配下のPodのIPアドレスはendpointに記載されています。そして、ClusterIPからPodの持つIPへの振り替えを<strong>kube-proxy</strong>が行います。<strong>kube-proxy</strong>の振り替え方式はいくつか選択肢がありますが、デフォルトの<strong>iptableモード</strong>ではiptablesのchainがあり、これによってパケットが転送されます。他のモードについて知りたい方は<a href="https://kubernetes.io/ja/docs/concepts/services-networking/service/#virtual-ips-and-service-proxies" target="_blank" rel="noopener noreferrer">公式ページ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>を参照してください。</p></blockquote> <p>先ほどと同じようにServiceのマニフェストファイルを作りましょう。今回は<code>service.yml</code>とします。</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> bootcamp<span class="token punctuation">-</span>svc
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> ClusterIP
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">8080</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> bootcamp
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>Serviceオブジェクトの中には様々なサービスタイプ種類があり、今回は<code>ClusterIP</code>というサービスタイプを利用しています。ClusterIPはServiceにおけるデフォルト設定であり、明示的に記載が無ければ<code>type: ClusterIP</code>が設定されることに注意してください。</p> <blockquote><p>【サービスタイプ】</p> <p>それぞれのServiceの特徴について簡単に触れます。少し長くなるので講義では<code>ClusterIP</code>のみを説明しますが、興味のある人は他のサービスタイプも読んでみてください。</p> <h4 id="clusterip"><a href="#clusterip" class="header-anchor">#</a> ClusterIP</h4> <p>ClusterIPによって割り振られるIPアドレスはKubernetesクラスター内でのみ有効です。主にクラスター外からアクセスする必要のない箇所などでクラスター内ロードバランスをする際に利用されます。
<img src="/bootcamp/assets/img/image_clusterip.8223e0b9.svg" alt="ClusterIP"></p> <h4 id="nodeport"><a href="#nodeport" class="header-anchor">#</a> NodePort</h4> <p>ClusterIPを作った上で、全node各々の<code>&lt;ip address:port&gt;</code>で受信したアクセスをServiceへ転送することで、クラスタ外からアクセスできるようにします。Docker Swarmでいうところの<code>Expose</code>です。図では全Kubernetes nodeの<code>port:30080</code>へのアクセスを<code>NodePort Service</code>に転送しています。
<img src="/bootcamp/assets/img/image_nodeport.5357aa05.svg" alt="NodePort"></p> <h4 id="loadbalancer"><a href="#loadbalancer" class="header-anchor">#</a> LoadBalancer</h4> <p>Kubernetesクラスター外のロードバランサーより払い出された仮想IPアドレスを利用してクラスター外からのアクセスを可能にします。NodePortでは各nodeに<code>&lt;node ip&gt;:&lt;node port&gt;</code>が割り振られ、ユーザはいずれかのアドレス宛にアクセスするため、アクセスしているnodeで障害が起きた際にそのnodeを利用しているユーザはサービスを利用できなくなります。それに対して<code>type: LoadBalancer</code>は、ユーザがクラスター外のロードバランサーから払い出されたIPアドレスのみを知っておくだけでサービスを利用することができます。また、nodeで障害が起きてもそのnodeの切り離しを行うようにクラスター外のロードバランサーを設定することで、ユーザはサービスを継続して利用することができます(ただし従来のロードバランサー＋仮想マシンの組み合わせ同様に、障害検知から除外までの間は通信断が発生します)。ここでいうクラスター外のロードバランサーはプロバイダに依存しており、たとえばGCPの場合はGCLBが使われています。
<img src="/bootcamp/assets/img/image_loadbalancer.7df1efb3.svg" alt="LoadBalancer"></p></blockquote> <p>それでは同じようにapplyしてから<code>Service</code>の稼働状況を確認します。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ kubectl apply -f service.yml
service/bootcamp-svc created
$ kubectl get svc
NAME           TYPE        CLUSTER-IP       EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>   AGE
bootcamp-svc   ClusterIP   xxx.xxx.xxx.xxx   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">80</span>/TCP    1h
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>次に実際にPodにアクセスしてみましょう。<code>kubectl proxy</code>でコントロールプレーンのAPIサーバにポートフォワーディングします。先ほども説明しましたが<code>type: ClusterIP</code>は外から直接アクセスができません。そのため手元のホストからコントロールプレーンまでをポートフォワードし、コントロールプレーンからPodまでをREST APIを使って通信させます。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ kubectl proxy
Starting to serve on 127.0.0.1:8001
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>このプロキシ機能はServiceへのアクセスをRESTとして<code>/api/v1/namespaces/&lt;namespace&gt;/services/&lt;scheme&gt;:&lt;service&gt;:&lt;port&gt;/proxy/</code>と表現しているため、今回は<code>http://127.0.0.1:8001/api/v1/namespaces/&lt;your namespace&gt;/services/bootcamp-svc/proxy/</code>へアクセスすることでコンテンツを取得することができます。</p> <blockquote><p><code>&lt;your namespace&gt;</code>にはデプロイ先のnamespaceを入力します。
namespaceがわからない場合は<code>kubectl config get-contexts</code>から探してください。<code>CURRENT</code>に米印が付いているものがいま作業しているコンテキストになります。もし<code>NAMESPACE</code>の欄に何もなければ<code>namespace: default</code>ということになります。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ kubectl config get-contexts
CURRENT   NAME                CLUSTER    AUTHINFO   NAMESPACE
          minikube            minikube   nirazuka
*         nira                nirakube   nirazuka   nirazuka
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></blockquote> <p>katacodeを使っている場合、RESTを辿ることができないため<code>kubectl port-foward</code>を利用します。<code>kubectl port-foward</code>はローカルのポートをPodやServiceに直接フォワーディングすることができます。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ kubectl port-forward service/bootcamp-svc --address=0.0.0.0 :80
Forwarding from 0.0.0.0:35715 -&gt; 8080
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>あとはTerminal横の「＋」ボタンから「select port to view on Host 1」を選択し、表示されているポートへアクセスすればコンテンツを取得することができます。</p> <p><code>Hello Kubernetes!</code> が表示されたでしょうか。無事にpodにアクセスすることができました。</p> <blockquote><p>今回はServiceでアプリケーションを公開しましたが、本来はServiceの上にIngressを作って公開することが推奨されています。
Ingressを利用するとSSLの設定やVirtualHostの設定などを行えるようになります。
興味のある方は<a href="https://kubernetes.io/ja/docs/concepts/services-networking/ingress/" target="_blank" rel="noopener noreferrer">公式ページ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>を参考に触ってみて下さい。</p></blockquote> <h3 id="_3-4-podを削除してみる"><a href="#_3-4-podを削除してみる" class="header-anchor">#</a> 3-4. Podを削除してみる</h3> <p>試しに手動で無理やりpodを削除してみましょう。<code>kubectl get pods -w</code>で確認しながら、以下のコマンドでpodを削除してみます。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ kubectl delete pods <span class="token operator">&lt;</span>pod-name<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>例によってpod-nameはコピペしてください。<code>kubectl get pods -w</code>しているとPodの数が<code>replicas</code>の設定値に合うように新しく起動される様子が分かります。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ kubectl get pods -w
NAME                        READY   STATUS    RESTARTS   AGE
bootcamp-6bcddb7cf8-jpzg5   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          23m
bootcamp-6bcddb7cf8-tq2fs   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          23m
bootcamp-6bcddb7cf8-jpzg5   <span class="token number">1</span>/1     Terminating   <span class="token number">0</span>          23m
bootcamp-6bcddb7cf8-ffj7f   <span class="token number">0</span>/1     Pending       <span class="token number">0</span>          0s
bootcamp-6bcddb7cf8-ffj7f   <span class="token number">0</span>/1     Pending       <span class="token number">0</span>          0s
bootcamp-6bcddb7cf8-ffj7f   <span class="token number">0</span>/1     ContainerCreating   <span class="token number">0</span>          0s
bootcamp-6bcddb7cf8-ffj7f   <span class="token number">1</span>/1     Running             <span class="token number">0</span>          7s
bootcamp-6bcddb7cf8-jpzg5   <span class="token number">0</span>/1     Terminating         <span class="token number">0</span>          23m
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><code>bootcamp-6bcddb7cf8-jpzg5</code>が手動で削除したpodです。<code>bootcamp-6bcddb7cf8-jpzg5</code>の削除が始まった途端に新しく<code>bootcamp-6bcddb7cf8-ffj7f</code>というpodを立てようとしているのが分かります。</p> <p>このようにpodがエラーで停止したり、新しいアプリケーションのデプロイなどでpodを停止してもすぐさま<code>ReplicaSet</code>が状態を修復してくれます。
それだけではなく、前段の<code>Service</code>がpodの状態を監視しながら通信を流す先を決めてくれるため、一部のpodが停止している間も自動的に生きているpodに通信を流してくれます。</p> <p>そのためユーザーに一切影響なくpodの停止と復旧が全て自動で可能になっています。このようなインフラをKubernetesとコンテナなしで構築するのはかなり困難です。</p> <h2 id="_4-応用-kubernetesの監視"><a href="#_4-応用-kubernetesの監視" class="header-anchor">#</a> 4. 応用(Kubernetesの監視)</h2> <p>ここからは本格的なアプリケーションのデプロイを体験してもらいます。katacodeでやっている方はうまくいかないことがあるため本項目は飛ばしてください。</p> <p>今回Kubernetes上に構築するアプリケーションは監視ツールのPrometheusで、以下の順序でデプロイします。(マニフェストファイルは<a href="https://www.hanmoto.com/bd/isbn/9784910313009" target="_blank" rel="noopener noreferrer">Prometheus実践ガイド<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>の内容を一部改変したものを利用しています)</p> <ol><li>node exporterのデプロイ</li> <li>RBAC認可を使ってリソースにアクセスするためのアカウントをデプロイ</li> <li>Prometheusのデプロイ</li></ol> <h3 id="_4-1-node-exporterのデプロイ"><a href="#_4-1-node-exporterのデプロイ" class="header-anchor">#</a> 4-1. node exporterのデプロイ</h3> <p>node exporterは各ノードのメトリクス情報を収集するツール(exporter)です。これを各nodeに配置する必要がありますが、<code>Deployment</code>オブジェクトを利用すると配置nodeの指定を都度行う必要があり煩雑です。そのため、ここでは<code>DeamonSet</code>オブジェクトを利用します。<code>DeamonSet</code>オブジェクトは各ノードに等しくPodを配置するオブジェクトです。<code>node-exporter.yml</code>という名前で以下の内容のマニフェストファイルを作成します。</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> DaemonSet
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span>exporter
  <span class="token key atrule">name</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span>exporter
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span>exporter
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span>exporter
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span>exporter
          <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">'prom/node-exporter:v1.3.1'</span>
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
              <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">9100</span>
              <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
      <span class="token key atrule">hostNetwork</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">hostPID</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">tolerations</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span>role.kubernetes.io/control<span class="token punctuation">-</span>plane
          <span class="token key atrule">operator</span><span class="token punctuation">:</span> Exists
          <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">''</span>
          <span class="token key atrule">effect</span><span class="token punctuation">:</span> NoSchedule
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span>exporter
  <span class="token key atrule">name</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span>exporter
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9100</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> http
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span>exporter
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><p>各ノードに対して<code>prom/node-exporter:v1.3.1</code>というコンテナを1つずつデプロイさせています。<code>hostNetwork</code>と<code>hostPID</code>を<code>true</code>にすることでノードとコンテナのネットワーク/プロセスIDを共有させます。これは通常、コンテナはホストの環境とプロセス等が分離された状態になっているため、共有させないとPodからノードの情報を取得することができためです。<code>node-exporter</code>は外部から接続させる必要がないため、<code>Service</code>は<code>CluserIP</code>を指定しています。</p> <p>準備が出来たら<code>kubectl apply -f node-exporter.yml</code>でデプロイします。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># kubectl apply -f node-exporter.yml</span>
daemonset.apps/node-exporter created
service/node-exporter created

<span class="token comment"># kubectl get pods</span>
NAME                          READY   STATUS    RESTARTS   AGE
node-exporter-75rpz           <span class="token number">1</span>/1     Running   <span class="token number">0</span>          47m
node-exporter-p25gq           <span class="token number">1</span>/1     Running   <span class="token number">0</span>          47m
node-exporter-tcbsp           <span class="token number">1</span>/1     Running   <span class="token number">0</span>          47m
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_4-2-rbac認可を使ってリソースにアクセスするためのアカウントをデプロイ"><a href="#_4-2-rbac認可を使ってリソースにアクセスするためのアカウントをデプロイ" class="header-anchor">#</a> 4-2. RBAC認可を使ってリソースにアクセスするためのアカウントをデプロイ</h3> <p>KubernetesはRole Based Access Control(RBAC)といわれる、各種リソースへのアクセス制御をユーザロールベースで行っています。そのため、監視に必要なリソースへのアクセスに必要な権限をユーザに付与する必要があります。ここでは権限の定義を行う<code>ClusterRole</code>、権限とユーザとの紐づけを行う<code>ClusterRoleBind</code>という二つのオブジェクトを利用します。<code>role-based-access-control.yml</code>という名前でマニフェストファイルを作り、以下の内容を記載します。</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> prometheus
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&quot;</span><span class="token punctuation">]</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> nodes
  <span class="token punctuation">-</span> services
  <span class="token punctuation">-</span> endpoints
  <span class="token punctuation">-</span> pods
  <span class="token punctuation">-</span> metrics
  <span class="token punctuation">-</span> nodes/metrics
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;watch&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> extensions
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> ingresses
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;watch&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">-</span> <span class="token key atrule">nonResourceURLs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> /metrics
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRoleBinding
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> prometheus
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
  <span class="token key atrule">name</span><span class="token punctuation">:</span> prometheus
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
  <span class="token key atrule">name</span><span class="token punctuation">:</span> prometheus
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> prometheus
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p><code>default</code>namespace上の<code>prometheus</code>というアカウントに対して、各種リソースへの参照権限を付与する内容になります。<code>kubectl apply -f role-based-access-control.yml</code>を実行してデプロイします。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># kubectl apply -f role-based-access-control.yml </span>
clusterrole.rbac.authorization.k8s.io/prometheus created
clusterrolebinding.rbac.authorization.k8s.io/prometheus created
serviceaccount/prometheus created
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>これにより、API Serverなどへのアクセスするための認証情報が払い出されました。</p> <h3 id="_4-3-prometheusのデプロイ"><a href="#_4-3-prometheusのデプロイ" class="header-anchor">#</a> 4-3. Prometheusのデプロイ</h3> <p>最後にPrometheusのデプロイを行います。Prometheusのデプロイには<code>Deployment</code>と<code>Service</code>オブジェクトを利用しますが、Prometheus自体の設定ファイルは<code>ConfigMap</code>というオブジェクトを利用して定義します。これを利用することによりコンフィグファイルをマニフェストファイルとして管理することができ、さらにPrometheusに反映させることが出来ます。<code>prometheus.yml</code>というマニフェストファイルを作り以下の内容を記載します。</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> prometheus
  <span class="token key atrule">name</span><span class="token punctuation">:</span> prometheus
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> prometheus
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> prometheus
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">serviceAccountName</span><span class="token punctuation">:</span> prometheus
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> prom/prometheus<span class="token punctuation">:</span>v2.33.3
        <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
        <span class="token key atrule">name</span><span class="token punctuation">:</span> prometheus
        <span class="token key atrule">args</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>config.file=/prometheus/prometheus.yml
        <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>log.level=debug
        <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>web.enable<span class="token punctuation">-</span>lifecycle
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
          <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">9090</span>
          <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
        <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> prometheus
          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /prometheus/prometheus.yml
          <span class="token key atrule">subPath</span><span class="token punctuation">:</span> prometheus.yml
      <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> prometheus
        <span class="token key atrule">configMap</span><span class="token punctuation">:</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> prometheus
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> prometheus
  <span class="token key atrule">name</span><span class="token punctuation">:</span> prometheus
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9090</span>
    <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">9090</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> prometheus
  <span class="token key atrule">type</span><span class="token punctuation">:</span> ClusterIP
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ConfigMap
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> prometheus
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> prometheus
<span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token key atrule">prometheus.yml</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
    global:
      scrape_interval: 15s
    scrape_configs:
    - job_name: 'prometheus'
      kubernetes_sd_configs:
      - role: pod
      relabel_configs:
      - source_labels: [__meta_kubernetes_pod_name]
        regex: prometheus-.+
        action: keep
    - job_name: 'apiserver'
      kubernetes_sd_configs:
        - role: service
      scheme: https
      tls_config:
        ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
      authorization:
        credentials_file: /var/run/secrets/kubernetes.io/serviceaccount/token
      relabel_configs:
      - source_labels:
        - __meta_kubernetes_namespace
        - __meta_kubernetes_service_name
        - __meta_kubernetes_service_port_name
        action: keep
        regex: default;kubernetes;https
    - job_name: 'node-exporter'
      scheme: http
      kubernetes_sd_configs:
      - role: node
      relabel_configs:
      - source_labels: [__address__]
        action: replace
        regex: (.+):.+
        replacement: ${1}:9100
        target_label: __address__</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br></div></div><p>Prometheusの設定の詳細については割愛しますが、4-2ににて発行した認証情報は<code>tls_config</code>ならびに<code>authorization</code>で指定しています。</p> <blockquote><p>【Prometheus講義受講者向け】</p> <p>Prometheusの講義内で「Prometheusの特徴の1つにサービスディスカバリがあり、監視対象を動的に取得することができる」と話しました。
そのサービスディスカバリは<code>kubernetes_sd_configs</code>の部分で設定しています。<code>role</code>という概念を利用してKubernetes内の各種リソースを動的に取得します。<code>role</code>で取得できるリソースは以下の5つです。</p> <ul><li>Node</li> <li>Service</li> <li>Endpoints</li> <li>Pod</li> <li>Ingress</li></ul></blockquote> <p><code>kubectl apply -f prometheus.yml</code>でPrometheusをデプロイし、確認を行います。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># kubectl apply -f prometheus.yml </span>
service/prometheus created
deployment.apps/prometheus created
configmap/prometheus created

<span class="token comment"># kubectl get all</span>
NAME                              READY   STATUS    RESTARTS   AGE
pod/node-exporter-75rpz           <span class="token number">1</span>/1     Running   <span class="token number">0</span>          115m
pod/node-exporter-p25gq           <span class="token number">1</span>/1     Running   <span class="token number">0</span>          115m
pod/node-exporter-tcbsp           <span class="token number">1</span>/1     Running   <span class="token number">0</span>          115m
pod/prometheus-76b579c56c-r7nps   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          115m

NAME                    TYPE        CLUSTER-IP     EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>    AGE
service/kubernetes      ClusterIP   <span class="token number">10.96</span>.0.1      <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">443</span>/TCP    29h
service/node-exporter   ClusterIP   <span class="token number">10.96</span>.16.136   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">9100</span>/TCP   115m
service/prometheus      ClusterIP   <span class="token number">10.96</span>.128.27   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">9090</span>/TCP   115m

NAME                           DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE
daemonset.apps/node-exporter   <span class="token number">3</span>         <span class="token number">3</span>         <span class="token number">3</span>       <span class="token number">3</span>            <span class="token number">3</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>          115m

NAME                         READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/prometheus   <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           115m

NAME                                    DESIRED   CURRENT   READY   AGE
replicaset.apps/prometheus-76b579c56c   <span class="token number">1</span>         <span class="token number">1</span>         <span class="token number">1</span>       115m
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="_4-4-prometheusの確認"><a href="#_4-4-prometheusの確認" class="header-anchor">#</a> 4-4. Prometheusの確認</h3> <p>ひと通りのアプリケーションのデプロイが完了したので、さっそくアクセスします。Prometheusは<code>ClusterIP</code>の配下にあるため、ポートフォワーディングしてあげます。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># kubectl port-forward svc/prometheus --address 0.0.0.0 8080:9090</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>ブラウザからアクセスし、<code>Status</code>タブの<code>Targets</code>を開いて全て問題なく取得できていれば完了です。
<img src="images/prometheus_main-menu.png" alt="prometheus_main-nemu">
これでKuberentes上の各コンポーネントに対して監視を行うことが出来ました。</p> <blockquote><p>【Prometheus講義を受講した人向け】</p> <p>式ブラウザから各種APIオブジェクトのメトリクス情報を取得してみてください。
また、Kubernetes上で動くアプリケーションの監視にはkube-state-metricsやcAdvidsorといったエクスポートを利用します。余裕のある人はPodの監視も行ってみてください。</p></blockquote> <h2 id="_5-最後に"><a href="#_5-最後に" class="header-anchor">#</a> 5. 最後に</h2> <p>Kubernetesの紹介と代表的なオブジェクトである<code>Deployment</code>と<code>Service</code>について簡単に触ってみました。
Kubetenetesでは他にも様々なオブジェクトや設定を使います。</p> <p>例えば</p> <ul><li>アプリケーションの環境変数を設定するために<code>env</code>を使う</li> <li>データベースなどステートフルなpodを稼働させるために<code>StatefulSet</code>を使う</li> <li>データの永続化のため<code>PersistentVolume</code>や<code>PersistentVolumeClaim</code>を使う</li> <li>アプリケーションのコンフィグファイルを管理するのに<code>ConfigMap</code>を使う</li> <li>APIキーやパスワードなど秘密情報を扱うために<code>Secret</code>を使う(ただしキー値はbase64でエンコードされた文字列)</li></ul> <p>などなどです。<code>PersistentVolume</code>や<code>PersistentVolumeClaim</code>などはディストリビューションごとに扱い方が違ったりしますし、構築したいアプリケーションによってマニフェストファイルの書き方は様々なので今回は割愛しました。</p> <p>社内でKubetenetesを使ってアプリケーションを構築する場合はIKEが使いやすいかと思いますので、ぜひチュートリアルなどを眺めてみてください。</p> <blockquote><p>【参考文献】</p> <ol><li>Kubernetes完全ガイド/青山信也(インプレス)</li> <li>イラストでわかるDockerとKubernetes/徳永航平(技術評論社)</li> <li>Docker/Kubernetes実践コンテナ開発入門/山田明憲(技術評論社)</li> <li><a href="https://kubernetes.io/" target="_blank" rel="noopener noreferrer">Kubernetes公式ドキュメント<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>/CNCF</li> <li>Prometheus実践ガイド/仲亀拓馬(テッキーメディア)</li></ol></blockquote></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/iij/bootcamp/edit/master/src/development/kubernetes/README.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">9/1/2022, 1:11:54 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/bootcamp/assets/js/app.9b5d2d24.js" defer></script><script src="/bootcamp/assets/js/2.0d322aa6.js" defer></script><script src="/bootcamp/assets/js/11.ce6a2bf0.js" defer></script><script src="/bootcamp/assets/js/14.c8974a20.js" defer></script>
  </body>
</html>
