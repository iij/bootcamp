<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>IIJ Bootcamp</title>
    <meta name="description" content="Go言語を使って簡単なWebアプリを作ります">
    
    
    <link rel="preload" href="/bootcamp/assets/css/0.styles.2b6a07f9.css" as="style"><link rel="preload" href="/bootcamp/assets/js/app.958a0e13.js" as="script"><link rel="preload" href="/bootcamp/assets/js/2.acfdd0a4.js" as="script"><link rel="preload" href="/bootcamp/assets/js/22.14bb7511.js" as="script"><link rel="preload" href="/bootcamp/assets/js/5.d20398c4.js" as="script"><link rel="preload" href="/bootcamp/assets/js/4.a9d4f0c2.js" as="script"><link rel="prefetch" href="/bootcamp/assets/js/10.8e85b0e5.js"><link rel="prefetch" href="/bootcamp/assets/js/11.40cb7855.js"><link rel="prefetch" href="/bootcamp/assets/js/12.82fa6dfa.js"><link rel="prefetch" href="/bootcamp/assets/js/13.41ca94bd.js"><link rel="prefetch" href="/bootcamp/assets/js/14.42aafd44.js"><link rel="prefetch" href="/bootcamp/assets/js/15.978ffdd5.js"><link rel="prefetch" href="/bootcamp/assets/js/16.367b0b40.js"><link rel="prefetch" href="/bootcamp/assets/js/17.3f35d88c.js"><link rel="prefetch" href="/bootcamp/assets/js/18.3c897ca0.js"><link rel="prefetch" href="/bootcamp/assets/js/19.97637d7d.js"><link rel="prefetch" href="/bootcamp/assets/js/20.8abaa144.js"><link rel="prefetch" href="/bootcamp/assets/js/21.22b2e012.js"><link rel="prefetch" href="/bootcamp/assets/js/23.7a641002.js"><link rel="prefetch" href="/bootcamp/assets/js/24.81644ee3.js"><link rel="prefetch" href="/bootcamp/assets/js/25.8d586102.js"><link rel="prefetch" href="/bootcamp/assets/js/26.1538250f.js"><link rel="prefetch" href="/bootcamp/assets/js/27.0a017c6a.js"><link rel="prefetch" href="/bootcamp/assets/js/28.34bb0599.js"><link rel="prefetch" href="/bootcamp/assets/js/29.6684ca04.js"><link rel="prefetch" href="/bootcamp/assets/js/3.ed6eaec0.js"><link rel="prefetch" href="/bootcamp/assets/js/30.43568e40.js"><link rel="prefetch" href="/bootcamp/assets/js/6.03563dad.js"><link rel="prefetch" href="/bootcamp/assets/js/7.936be0e4.js"><link rel="prefetch" href="/bootcamp/assets/js/8.632a3463.js"><link rel="prefetch" href="/bootcamp/assets/js/9.76124e4d.js">
    <link rel="stylesheet" href="/bootcamp/assets/css/0.styles.2b6a07f9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/bootcamp/" class="home-link router-link-active"><!----> <span class="site-name">IIJ Bootcamp</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/iij/bootcamp" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/iij/bootcamp" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/bootcamp/server-app/go/#事前準備" class="sidebar-link">事前準備</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/bootcamp/server-app/go/#goとは" class="sidebar-link">Goとは</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bootcamp/server-app/go/#特徴" class="sidebar-link">特徴</a></li></ul></li><li><a href="/bootcamp/server-app/go/#_1-hello-世界" class="sidebar-link">1. Hello, 世界</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bootcamp/server-app/go/#_1-1-解説" class="sidebar-link">1-1. 解説</a></li></ul></li><li><a href="/bootcamp/server-app/go/#_2-パッケージ-モジュール" class="sidebar-link">2. パッケージ/モジュール</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bootcamp/server-app/go/#_2-1-解説" class="sidebar-link">2-1. 解説</a></li></ul></li><li><a href="/bootcamp/server-app/go/#_3-net-httpはじめの一歩" class="sidebar-link">3. net/httpはじめの一歩</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bootcamp/server-app/go/#_3-1-動かし方" class="sidebar-link">3-1. 動かし方</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/go/#_3-2-解説" class="sidebar-link">3-2. 解説</a></li></ul></li><li><a href="/bootcamp/server-app/go/#_4-rdbをgoから触る" class="sidebar-link">4. RDBをGoから触る</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bootcamp/server-app/go/#_4-1-ディレクトリ構造" class="sidebar-link">4-1. ディレクトリ構造</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/go/#_4-2-使い方" class="sidebar-link">4-2. 使い方</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><table><tr><td>このハンズオンでやること</td><td>Go言語を使って簡単なWebアプリを作ります</td></tr> <tr><td>想定時間</td><td>1.5h</td></tr> <tr><td>前提知識・用語</td><td>golang</td></tr></table> <h1 id="goでwebアプリを作る"><a href="#goでwebアプリを作る" class="header-anchor">#</a> GoでWebアプリを作る</h1> <h2 id="事前準備"><a href="#事前準備" class="header-anchor">#</a> 事前準備</h2> <p><a href="./init">GoでWebアプリを作る(事前準備編)</a></p> <h2 id="goとは"><a href="#goとは" class="header-anchor">#</a> Goとは</h2> <p>Googleが開発しているプログラミング言語。 <br>
ググラビリティが低いのでGolangやGo言語と書かれることもあるが、言語としての正式名称はGoである。 <br>
参考: <a href="https://twitter.com/rob_pike/status/886054143235719169" target="_blank" rel="noopener noreferrer">開発者の一人(Rob Pike 氏)のツイート<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="特徴"><a href="#特徴" class="header-anchor">#</a> 特徴</h3> <p>参考: <a href="https://budougumi0617.github.io/2019/06/20/golangtokyo25-read-again-awesome-go-article/" target="_blank" rel="noopener noreferrer">今改めて読み直したい Go基礎情報 その1<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <br>
参考: <a href="https://www.slideshare.net/takuyaueda967/2016-go" target="_blank" rel="noopener noreferrer">Go入門<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h4 id="ポータビリティが高い"><a href="#ポータビリティが高い" class="header-anchor">#</a> ポータビリティが高い</h4> <ul><li>Cの標準ライブラリに依存しないようにソースコードをコンパイルできる</li> <li>GoはGoで書かれている
<ul><li>つまりGoコンパイラ自身がGoで書かれている</li> <li>標準パッケージ群もGoで書かれている(例外はあります)</li></ul></li></ul> <h4 id="クロスコンパイル"><a href="#クロスコンパイル" class="header-anchor">#</a> クロスコンパイル</h4> <ul><li>コンパイル時に環境変数を指定するだけで、例えばLinux端末上からWindows用のバイナリをコンパイルすることができる
<ul><li>ただし、ソースコード上もOSに依存しない記述にする必要がある</li> <li>標準パッケージは大抵OSに依存しないように記述されているので、積極的に利用するとよい</li></ul></li></ul> <h4 id="文法がシンプル"><a href="#文法がシンプル" class="header-anchor">#</a> 文法がシンプル</h4> <ul><li>設計思想としてSimplicityを是としている
<ul><li>参考: <a href="https://talks.golang.org/2015/simplicity-is-complicated.slide#1" target="_blank" rel="noopener noreferrer">Simplicity is Complicated<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li> <li><code>go</code>と書くだけで並行処理(並列ではない)が可能だったり</li> <li>言語仕様が小さい(個人の感想)
<ul><li>参考: <a href="https://golang.org/ref/spec" target="_blank" rel="noopener noreferrer">The Go Programming Language Specification<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li> <li>暗黙的な仕様が少ない(個人の感想)</li></ul> <h4 id="並行プログラミングが文法レベルでサポートされている"><a href="#並行プログラミングが文法レベルでサポートされている" class="header-anchor">#</a> 並行プログラミングが文法レベルでサポートされている</h4> <ul><li>Goroutine : 軽量スレッドのようなもの</li> <li>並列に動く、とは一言も言っていない点には注意が必要
<ul><li>参考: <a href="https://www.oreilly.co.jp/books/9784873118468/" target="_blank" rel="noopener noreferrer">Go言語による並行処理<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul> <h4 id="周辺ツールが標準で提供されている"><a href="#周辺ツールが標準で提供されている" class="header-anchor">#</a> 周辺ツールが標準で提供されている</h4> <ul><li>go build: buildコマンド</li> <li>go test: test実行</li> <li>go fmt: コードフォーマッタ</li> <li>go vet: 静的解析</li> <li>go doc: ドキュメント生成</li> <li>go mod: モジュール管理</li> <li>...
<ul><li>参考: <a href="https://golang.org/cmd/" target="_blank" rel="noopener noreferrer">コマンド一覧<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul> <h4 id="標準パッケージが充実している"><a href="#標準パッケージが充実している" class="header-anchor">#</a> 標準パッケージが充実している</h4> <ul><li>net/http: HTTPサーバ/クライアントなど</li> <li>html/template: HTMLテンプレート</li> <li>database/sql: DB操作</li> <li>...
<ul><li>参考: <a href="https://golang.org/pkg/" target="_blank" rel="noopener noreferrer">標準パッケージ一覧<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul> <h2 id="_1-hello-世界"><a href="#_1-hello-世界" class="header-anchor">#</a> 1. Hello, 世界</h2> <p><a href="https://play.golang.org/p/7vin2BK8_A6" target="_blank" rel="noopener noreferrer">The Go Playground<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <br>
チュートリアルリポジトリの<code>1_hello_world</code>ディレクトリにサンプルコードが入っています。</p> <ul><li><code>main.go</code></li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, 世界&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>このファイルを<code>main.go</code>というファイル名で保存して、次のようにコマンドを実行します。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ go run main.go
Hello, 世界
</code></pre></div><h3 id="_1-1-解説"><a href="#_1-1-解説" class="header-anchor">#</a> 1-1. 解説</h3> <h4 id="_1-1-0-the-go-playground"><a href="#_1-1-0-the-go-playground" class="header-anchor">#</a> 1-1-0. The Go Playground</h4> <p><a href="https://play.golang.org" target="_blank" rel="noopener noreferrer">The Go Playground<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>はGoのプログラムを手軽に実行できる環境で、Go公式に用意されています。 <br>
後述しますが、一部のパッケージが動かないようにされていますが、簡単なコードを試しに動かすためには便利です。</p> <p>念の為ですが、外部サイトになるため、業務で扱うプロダクトコードをここで実行してはいけません。</p> <h4 id="_1-1-1-package文"><a href="#_1-1-1-package文" class="header-anchor">#</a> 1-1-1. package文</h4> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main
</code></pre></div><p>Go のプログラムはパッケージ単位で構成されます。 <br>
そして、Go のプログラムは必ず<code>main</code>パッケージから実行されます。 <br>
例えば、先の例で package 名を<code>hoge</code>にするとエラーが返ってきます。 <br>
試しに先に作成した<code>main.go</code>を変更してみましょう。</p> <ul><li><code>main.go</code> <a href="https://play.golang.org/p/rlUktSgVozz" target="_blank" rel="noopener noreferrer">The Go Playground<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> hoge

<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, 世界&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>$ go run test.go
go run: cannot run non-main package
</code></pre></div><h4 id="_1-1-2-import文"><a href="#_1-1-2-import文" class="header-anchor">#</a> 1-1-2. import文</h4> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>
</code></pre></div><p>他パッケージで定義された関数などを<code>import</code>文で取り込むことができます。</p> <div class="language-go extra-class"><pre class="language-go"><code>  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, 世界&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>具体的には、ここで<code>fmt</code>パッケージで定義されている<code>Println</code>関数を呼ぶために、<code>import</code>文で<code>fmt</code>パッケージを読み込んでいます。</p> <h4 id="_1-1-3-func"><a href="#_1-1-3-func" class="header-anchor">#</a> 1-1-3. func</h4> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, 世界&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Go の関数定義は<code>func</code>キーワードで行います。 <br>
ここで<code>main</code>という名前の関数を定義しています。 <br>
Goでコンパイルされた実行可能ファイルは<code>main</code>パッケージで定義された<code>main</code>関数から実行されます。 <br> <code>fmt.Println()</code>は標準出力に引数の文字列(ここでは <code>Hello, 世界</code>)を最後に改行文字を付けて出力します。</p> <h2 id="_2-パッケージ-モジュール"><a href="#_2-パッケージ-モジュール" class="header-anchor">#</a> 2. パッケージ/モジュール</h2> <p><a href="https://play.golang.org/p/74u0FTkyOvZ" target="_blank" rel="noopener noreferrer">The Go Playground<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <br>
チュートリアルリポジトリの<code>2_package</code>ディレクトリにサンプルコードが入っています。</p> <ul><li><code>go.mod</code></li></ul> <div class="language-go extra-class"><pre class="language-go"><code>module test
</code></pre></div><ul><li><code>calc/add.go</code> <ul><li><code>calc</code>という名前のディレクトリを作成するのを忘れないように</li></ul></li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> calc

<span class="token keyword">func</span> <span class="token function">Add</span><span class="token punctuation">(</span>a <span class="token builtin">int</span><span class="token punctuation">,</span> b <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>
  c <span class="token operator">:=</span> a <span class="token operator">+</span> b
  <span class="token keyword">return</span> c
<span class="token punctuation">}</span>
</code></pre></div><ul><li><code>main.go</code></li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
  <span class="token string">&quot;fmt&quot;</span>
  <span class="token string">&quot;test/calc&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>calc<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>$ go run main.go
<span class="token number">3</span>
</code></pre></div><h3 id="_2-1-解説"><a href="#_2-1-解説" class="header-anchor">#</a> 2-1. 解説</h3> <h4 id="_2-1-1-go-mod"><a href="#_2-1-1-go-mod" class="header-anchor">#</a> 2-1-1. <code>go.mod</code></h4> <p>このファイルはGoプログラムを外部から読み込むときの名前を定義したり、ソースコードで利用している他モジュールを管理するためのものです。</p> <div class="language-go extra-class"><pre class="language-go"><code>module test
</code></pre></div><p>このように書くことで、このモジュールは<code>test</code>という名前で外部から読み込むことができます。</p> <ul><li><code>main.go</code></li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token punctuation">(</span>
  <span class="token string">&quot;fmt&quot;</span>
  <span class="token string">&quot;test/calc&quot;</span>
<span class="token punctuation">)</span>
</code></pre></div><p>ここで<code>test/calc</code>というのは<code>test</code>モジュールの<code>calc</code>パッケージを読み込んでいる、と解釈されます。 <br>
また、<code>test/calc</code>でディレクトリ構造も指定されており、次のようなディレクトリ構造であることが期待されます。</p> <div class="language- extra-class"><pre class="language-text"><code>- test/
  - main.go (`package main`と宣言されている)
  - calc/
    - add.go (`package calc`と宣言されている)
</code></pre></div><h4 id="_2-1-2-続・func"><a href="#_2-1-2-続・func" class="header-anchor">#</a> 2-1-2. 続・func</h4> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">Add</span><span class="token punctuation">(</span>a <span class="token builtin">int</span><span class="token punctuation">,</span> b <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>
  c <span class="token operator">:=</span> a <span class="token operator">+</span> b
  <span class="token keyword">return</span> c
<span class="token punctuation">}</span>
</code></pre></div><p>今回定義した<code>Add()</code>関数は<code>main</code>パッケージから呼ばれます。 <br>
Go には外部に公開するためのキーワードは無く、大文字から始めるだけで外部に公開されます。 <br>
もしこの関数名が<code>add()</code>であれば、外部から見えないので<code>main</code>で呼び出しても関数が見付からないと言われます。</p> <p>また、Goの型名は変数宣言の後ろに書くことに注意しましょう。 <br>
参考: <a href="https://blog.golang.org/gos-declaration-syntax" target="_blank" rel="noopener noreferrer">Go's Declaration Syntax<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>Go での変数宣言にはいくつか方法があり、一番単純なのは今回使用した、</p> <div class="language-go extra-class"><pre class="language-go"><code>c <span class="token operator">:=</span> a <span class="token operator">+</span> b
</code></pre></div><p>の形式です。 <br> <code>c</code>の型名は<code>a</code>と<code>b</code>が<code>int</code>であることから自明なので、記載を省略できます。 <br>
当然省略せずに書くことも可能で、</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">var</span> c <span class="token builtin">int</span> <span class="token operator">=</span> a <span class="token operator">+</span> b
</code></pre></div><p>と書きます。 <br>
また、</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">var</span> c <span class="token operator">=</span> a <span class="token operator">+</span> b
</code></pre></div><p>のようにも書けます。 <br> <code>:=</code>による宣言は関数定義の中でしか書けないので、状況に応じて使い分ける必要があります。</p> <h2 id="_3-net-httpはじめの一歩"><a href="#_3-net-httpはじめの一歩" class="header-anchor">#</a> 3. net/httpはじめの一歩</h2> <p><a href="https://play.golang.org/p/5YXGZvJ73b_1" target="_blank" rel="noopener noreferrer">The Go Playground<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>(動きません)</p> <ul><li><p>The Go Playgroundでは<code>net/http</code>など一部のパッケージを利用したコードが動かないようになっています</p></li> <li><p><code>main.go</code></p></li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;net/http&quot;</span>
	<span class="token string">&quot;os&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	mux <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">NewServeMux</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	mux<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">,</span> helloHandler<span class="token punctuation">)</span>

	server <span class="token operator">:=</span> <span class="token operator">&amp;</span>http<span class="token punctuation">.</span>Server<span class="token punctuation">{</span>
		Addr<span class="token punctuation">:</span>    <span class="token string">&quot;:8080&quot;</span><span class="token punctuation">,</span>
		Handler<span class="token punctuation">:</span> mux<span class="token punctuation">,</span>
	<span class="token punctuation">}</span>

	server<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">helloHandler</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	fmt<span class="token punctuation">.</span><span class="token function">Fprintln</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">&quot;hello, world!&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-1-動かし方"><a href="#_3-1-動かし方" class="header-anchor">#</a> 3-1. 動かし方</h3> <p>ターミナルを2つ用意します。
docker環境の方は2つ目のターミナルでコンテナ内に入るために、</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker <span class="token builtin class-name">exec</span> -it go-tutor /bin/bash
</code></pre></div><p>を実行する必要があります。</p> <p>片方で以下を実行します。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ go run main.go
<span class="token comment">## プロンプトが返ってこなくなる</span>
</code></pre></div><p>もう一方のターミナルから以下を実行します。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">curl</span> http://localhost:8080
hello, world<span class="token operator">!</span>
</code></pre></div><h3 id="_3-2-解説"><a href="#_3-2-解説" class="header-anchor">#</a> 3-2. 解説</h3> <h4 id="_3-2-1-構造体と独自型とメソッド"><a href="#_3-2-1-構造体と独自型とメソッド" class="header-anchor">#</a> 3-2-1. 構造体と独自型とメソッド</h4> <p>Go は構造体型を持ちます。
<a href="https://play.golang.org/p/ebEr372GDdp" target="_blank" rel="noopener noreferrer">The Go Playground<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// 構造体型を基にしてAという型を宣言する。</span>
<span class="token keyword">type</span> A <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  X <span class="token builtin">int</span>
  Y <span class="token builtin">int</span>
<span class="token punctuation">}</span>

<span class="token comment">// 型AのメソッドHoge()を宣言する。</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>a A<span class="token punctuation">)</span> <span class="token function">Hoge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;X:&quot;</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span>X<span class="token punctuation">)</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Y:&quot;</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span>Y<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// aにA型の値を代入する。</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> A<span class="token punctuation">{</span>
  X<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  Y<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// aの型AのメソッドHoge()を実行する。</span>
a<span class="token punctuation">.</span><span class="token function">Hoge</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// X: 1</span>
<span class="token comment">// Y: 2</span>
</code></pre></div><p>このようにすることで、オブジェクト指向言語におけるクラスとメソッドのようなことができます。 \</p> <p>メソッドは型に対して定義することができるので以下のようなことも可能です。 <br> <a href="https://play.golang.org/p/nb76TxzaYMb" target="_blank" rel="noopener noreferrer">The Go Playground<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">type</span> Age <span class="token builtin">int</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>age Age<span class="token punctuation">)</span> <span class="token function">BirthYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>
  <span class="token comment">// 返り値はint型なのでint(age)でAge型からint型にキャスト(変換)している。</span>
  <span class="token keyword">return</span> <span class="token number">2019</span> <span class="token operator">-</span> <span class="token function">int</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ここでは<code>int</code>型に<code>Age</code>という別名を付けて、そのメソッドとして<code>BirthYear()</code>を定義しています。</p> <h4 id="_3-2-2-net-httpパッケージ"><a href="#_3-2-2-net-httpパッケージ" class="header-anchor">#</a> 3-2-2. <code>net/http</code>パッケージ</h4> <p><code>net/http</code>パッケージはその名の通り、HTTP通信に関連する関数、定数などが定義されたパッケージです。 <br>
このパッケージ一つでHTTPクライアントもHTTPサーバも書くことができます。</p> <h5 id="_3-2-2-1-servemux"><a href="#_3-2-2-1-servemux" class="header-anchor">#</a> 3-2-2-1. <code>ServeMux</code></h5> <div class="language-go extra-class"><pre class="language-go"><code>	mux <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">NewServeMux</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	mux<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">,</span> helloHandler<span class="token punctuation">)</span>
</code></pre></div><p>URLは<code>スキーマ名://ホスト名:ポート番号/パス名</code>という構造をしています。(他にもURLで表される項目はありますが、今回は使用しないため省略します。) <br> <code>http://localhost:8080/hello</code>というURLであれば、
*スキーマ名: http</p> <ul><li>ホスト名: localhost</li> <li>ポート番号: 8080</li> <li>パス名: /hello
と解釈されます。</li></ul> <p><code>http.ServeMux</code>は特定のパスへのリクエストを特定の関数へ飛ばすためのものです。 <br>
今回は<code>http://localhost:8080/hello</code>へのアクセスを<code>helloHandler()</code>という関数(ハンドラ)に引き渡す設定をします。 \</p> <p><code>http.NewServeMux()</code>で<code>http.ServeMux</code>型の値を用意して、<code>mux.HandleFunc()</code>でハンドラの設定をしています。</p> <h5 id="_3-2-2-2-server"><a href="#_3-2-2-2-server" class="header-anchor">#</a> 3-2-2-2. <code>Server</code></h5> <div class="language-go extra-class"><pre class="language-go"><code>	server <span class="token operator">:=</span> <span class="token operator">&amp;</span>http<span class="token punctuation">.</span>Server<span class="token punctuation">{</span>
		Addr<span class="token punctuation">:</span>    <span class="token string">&quot;:8080&quot;</span><span class="token punctuation">,</span>
		Handler<span class="token punctuation">:</span> mux<span class="token punctuation">,</span>
	<span class="token punctuation">}</span>

	server<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><code>http.Server</code>はHTTPサーバそのものを表す型です。 <br> <code>Addr</code>フィールドにHTTP通信を待ち受けるアドレスを設定し、<code>Handler</code>フィールドに先程説明した<code>ServeMux</code>を設定します。</p> <p>そしてその<code>http.Server</code>型の値のメソッドである<code>server.ListenAndServe()</code>関数で実際にサーバを起動してHTTP通信を待ち受け始めます。</p> <h5 id="_3-2-2-3-ハンドラ"><a href="#_3-2-2-3-ハンドラ" class="header-anchor">#</a> 3-2-2-3. ハンドラ</h5> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">helloHandler</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	fmt<span class="token punctuation">.</span><span class="token function">Fprintln</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">&quot;hello, world!&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>HTTP通信が飛んでくると<code>helloHandler()</code>という関数がそのリクエストを受けて処理をします。 <br>
引数の<code>http.Request</code>型の値に実際のリクエストの内容が入っているので、それを利用して処理をすることも可能です。 <br>
引数の<code>http.ResponseWriter</code>は<code>Write()</code>というメソッドを持っている型で、クライアントに送信したいメッセージを作って、<code>Write()</code>が叩かれれば、メッセージが送信されます。 <br>
もう少し踏み込むと、Goではインターフェイス型と呼ばれるメソッド定義のみを持つ型が存在し、<code>http.ResponseWriter</code>型は<code>Write()</code>や<code>Header()</code>などのメソッドを持つインターフェイス型です。 <br>
参考: <a href="https://golang.org/pkg/net/http/#ResponseWriter" target="_blank" rel="noopener noreferrer">ResponseWriter<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><code>fmt.Fprintln()</code>関数は第二引数の値を第一引数の<code>Write()</code>メソッドを使って書き込む、という関数で、今回はその挙動を利用してレスポンスを返しています。</p> <h2 id="_4-rdbをgoから触る"><a href="#_4-rdbをgoから触る" class="header-anchor">#</a> 4. RDBをGoから触る</h2> <p><a href="https://play.golang.org/p/B0_HD0U241F" target="_blank" rel="noopener noreferrer">The Go Playground<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>(動きません)</p> <ul><li><code>go.mod</code></li></ul> <div class="language- extra-class"><pre class="language-text"><code>module test
</code></pre></div><ul><li><code>main.go</code></li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;log&quot;</span>
	<span class="token string">&quot;net/http&quot;</span>
	<span class="token string">&quot;os&quot;</span>

	<span class="token string">&quot;test/handler&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	mux <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">NewServeMux</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token comment">// handlerパッケージのUserRead()関数を&quot;/user/&quot;というパスで登録している。</span>
	mux<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/user/&quot;</span><span class="token punctuation">,</span> handler<span class="token punctuation">.</span>UserRead<span class="token punctuation">)</span>

	<span class="token comment">// HTTPサーバは&quot;localhost:8080&quot;で起動する。</span>
	server <span class="token operator">:=</span> <span class="token operator">&amp;</span>http<span class="token punctuation">.</span>Server<span class="token punctuation">{</span>
		Addr<span class="token punctuation">:</span>    <span class="token string">&quot;:8080&quot;</span><span class="token punctuation">,</span>
		Handler<span class="token punctuation">:</span> mux<span class="token punctuation">,</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Goの特徴的なエラー処理。</span>
	<span class="token keyword">if</span> err <span class="token operator">:=</span> server<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token comment">/*
	  err := server.ListenAndServe()
	  if err != nil {
	    log.Println(err)
	    os.Exit(1)
	  }
	  と同等。
	*/</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><code>handler/user.go</code></li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> handler

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;log&quot;</span>
	<span class="token string">&quot;net/http&quot;</span>
	<span class="token string">&quot;strconv&quot;</span>
	<span class="token string">&quot;strings&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">UserRead</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// HTTPのリクエストがGETであることを確認している。</span>
	<span class="token keyword">if</span> r<span class="token punctuation">.</span>Method <span class="token operator">!=</span> http<span class="token punctuation">.</span>MethodGet <span class="token punctuation">{</span>
		<span class="token comment">// GETでなければ404を返す。</span>
		http<span class="token punctuation">.</span><span class="token function">NotFound</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">)</span>
		<span class="token comment">// 関数を終了する。</span>
		<span class="token comment">// Goではこのようなearly returnというパターンが頻出で、else 文はほぼ書かない。</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// http://localhost:8080/user/1などでアクセスが来る。</span>
	<span class="token comment">// r.URL.Pathには&quot;/user/1&quot;が入っているのでそれを&quot;/&quot;で分割した配列を作る。</span>
	<span class="token comment">// 作られた配列は[&quot;&quot;, &quot;user&quot;, &quot;1&quot;]となっており、User IDは[2]に入っている。</span>
	<span class="token comment">//</span>
	<span class="token comment">// strings.SplitN()関数は第3引数の数だけ分割する。</span>
	<span class="token comment">// 例えば、&quot;/user/1/2/3&quot;というパスを指定されていた場合はuserIDStrには&quot;1/2/3&quot;が入る。</span>
	userIDStr <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">SplitN</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path<span class="token punctuation">,</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>

	<span class="token comment">// userIDStrは文字列なのでuint64型に変換する。</span>
	userID<span class="token punctuation">,</span> err <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">ParseUint</span><span class="token punctuation">(</span>userIDStr<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token comment">// 先の&quot;/user/1/2/3&quot;みたいなパスの場合はこのパースに失敗してこの分岐に入る。</span>
		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		<span class="token comment">// この場合は400を返す。</span>
		<span class="token function">renderError</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> err<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusBadRequest<span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// model packageの関数に処理を持って行き、エラーの判定をする。</span>
	user<span class="token punctuation">,</span> err <span class="token operator">:=</span> model<span class="token punctuation">.</span><span class="token function">FindUserByID</span><span class="token punctuation">(</span>userID<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		<span class="token comment">// ここに入るということはサーバ側の処理で失敗しているので500を返す。</span>
		<span class="token function">renderError</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> err<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusInternalServerError<span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 全ての処理が成功していれば、200とともにuserを返す。</span>
	<span class="token function">renderResponse</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> user<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><code>handler/handler.go</code> <ul><li>このファイルは頑張って JSON を返すための細かい設定をしてくれる便利関数を定義しています</li></ul></li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> handler

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;encoding/json&quot;</span>
	<span class="token string">&quot;log&quot;</span>
	<span class="token string">&quot;net/http&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">renderError</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">,</span> code <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// JSONで返すので&quot;Content-Type&quot;ヘッダに&quot;application/json&quot;を指定します。</span>
	w<span class="token punctuation">.</span><span class="token function">Header</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span>
	<span class="token comment">// 引数で指定されたレスポンスコードを登録します。</span>
	w<span class="token punctuation">.</span><span class="token function">WriteHeader</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span>

	ret <span class="token operator">:=</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span>
		<span class="token comment">// `json:&quot;error&quot;`というのは構造体型のアノテーションと呼ばれるもので、特定の関数に構造体の情報を伝えるために使います。</span>
		<span class="token comment">// この場合はJSONに変換されるとき`error`というフィールド名にすることを指示しています。</span>
		Error <span class="token builtin">string</span> <span class="token string">`json:&quot;error&quot;`</span>
		<span class="token comment">// ここまで構造体の定義。</span>
	<span class="token punctuation">}</span><span class="token punctuation">{</span>
		<span class="token comment">// ここが実際の構造体型の値の定義。</span>
		Error<span class="token punctuation">:</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">NewEncoder</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Encode</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;render error&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token comment">/*
	  enc := json.NewEncoder(w)
	  err := enc.Encode(ret)
	  if err != nil {
	    log.Println(&quot;render error&quot;, err)
	  }
	  と同等
	*/</span>
<span class="token punctuation">}</span>

<span class="token comment">// interface{}型というのは、メソッドが一つも定義されていないメソッドを意味します。</span>
<span class="token comment">// つまり任意の型はinterface{}型を満たします。</span>
<span class="token comment">// Goではインターフェイスは明示的に書かずともインターフェイス型で定義されたメソッドを全て定義した型は、</span>
<span class="token comment">// そのインターフェイスを満たしている、と判断されます。</span>
<span class="token comment">// このような値を引数にとることで、静的型付言語でありながら、任意の型を引数に取る関数を簡単に作ることができます。</span>
<span class="token keyword">func</span> <span class="token function">renderResponse</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> data <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> code <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	w<span class="token punctuation">.</span><span class="token function">Header</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span>
	w<span class="token punctuation">.</span><span class="token function">WriteHeader</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span>

	<span class="token keyword">if</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">NewEncoder</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Encode</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;render error&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><code>model/user.go</code></li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> model

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;database/sql&quot;</span>
	<span class="token comment">// これはSQLite3を使うためのおまじない、として記述してください。</span>
	<span class="token comment">// 詳細知りたければteamsやハンズオン終了後に質問をください。</span>
	<span class="token boolean">_</span> <span class="token string">&quot;github.com/mattn/go-sqlite3&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// SQLite3を使ってdb/chat.dbというファイル名でDBを開き、その操作のための構造体をdbという変数に代入しています。</span>
<span class="token comment">// sql.Open()関数は2つの値を返す関数で、もう一つの返り値はerror型の値ですが、今回エラー処理をさぼるために値を無視します。</span>
<span class="token comment">// _を記載することで、そこに返るはずだった値を無視することができます。</span>
<span class="token comment">// エラーを握り潰すことはよいこはやってはいけません。</span>
<span class="token keyword">var</span> db<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> sql<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;sqlite3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;db/chat.db&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	ID   <span class="token builtin">uint64</span>
	Name <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">FindUserByID</span><span class="token punctuation">(</span>id <span class="token builtin">uint64</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>User<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// SQL文を作っています。</span>
	<span class="token comment">// $1はプレースホルダで、後のstmt.QueryRow()の引数に設定した値が入ります。</span>
	sql <span class="token operator">:=</span> <span class="token string">&quot;SELECT id, name FROM users WHERE id = $1;&quot;</span>
	<span class="token comment">// 先に作成したのはただの文字列なので、正しいSQL文になっているかを検証しつつ、操作のための構造体を返します。</span>
	stmt<span class="token punctuation">,</span> err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Prepare</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token comment">// SQL文が間違っているとここで教えてくれます。</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
	<span class="token comment">// deferというのはGoの特徴的な機能の一つで、ここではstmt.Close()関数は実行されず、FindUserByID()関数の実行完了時に必ず(例外はあります)実行されます。</span>
	<span class="token comment">// ファイルを開いた際のClose処理などにも使われて、後処理を忘れないためによく使われます。</span>
	<span class="token keyword">defer</span> stmt<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	user <span class="token operator">:=</span> User<span class="token punctuation">{</span><span class="token punctuation">}</span>
	<span class="token comment">// 先のSQL文は&quot;SELECT id, name FROM users WHERE id = $1&quot;となっており、`id`の中身が$1に収められstmt.QueryRow()メソッドで実行されます。</span>
	<span class="token comment">// その結果は id と name カラムが埋まっているので、その値を Scan()メソッドで user.ID と user.Name に放り込んでいます。</span>
	<span class="token comment">// &amp;は後ろにくる値のポインタを取得する演算子ですが、詳細には触れません。</span>
	<span class="token comment">// こうしておかないと、Scan()メソッドには値のコピーが渡され、Scan()の中の操作が元の値に反映されなくなってしまいます。</span>
	<span class="token keyword">if</span> err <span class="token operator">:=</span> stmt<span class="token punctuation">.</span><span class="token function">QueryRow</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> <span class="token operator">&amp;</span>user<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token operator">&amp;</span>user<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><code>db/setup.sql</code> <ul><li>少しMySQLとは文法が異なりますが、ここは主題ではないので触れません</li></ul></li></ul> <div class="language-go extra-class"><pre class="language-go"><code>DROP TABLE users<span class="token punctuation">;</span>

CREATE TABLE users <span class="token punctuation">(</span>
  id integer PRIMARY KEY AUTOINCREMENT<span class="token punctuation">,</span>
  name text
<span class="token punctuation">)</span><span class="token punctuation">;</span>

INSERT INTO users <span class="token punctuation">(</span>name<span class="token punctuation">)</span> VALUES <span class="token punctuation">(</span><span class="token string">&quot;hogehoge&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
INSERT INTO users <span class="token punctuation">(</span>name<span class="token punctuation">)</span> VALUES <span class="token punctuation">(</span><span class="token string">&quot;fugafuga&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_4-1-ディレクトリ構造"><a href="#_4-1-ディレクトリ構造" class="header-anchor">#</a> 4-1. ディレクトリ構造</h3> <div class="language- extra-class"><pre class="language-text"><code>- go.mod # パッケージ管理用ファイル
- main.go # サーバを準備したり、起動したりする。最初に実行される。
- handler/
  - handler.go # JSON形式でレスポンスを返すためにごにょごにょしてくれる関数を定義。
  - user.go # HTTPリクエストを受けると実行される関数を定義。
- model/
  - user.go # User構造体を定義し、DBからUserデータを取得するための関数を定義。
- db/
  - setup.sql # DBの初期化用SQLファイル。
</code></pre></div><h3 id="_4-2-使い方"><a href="#_4-2-使い方" class="header-anchor">#</a> 4-2. 使い方</h3> <p>ターミナルを2つ用意します。
docker環境の方は2つ目のターミナルでコンテナ内に入るために、</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker <span class="token builtin class-name">exec</span> -it go-tutor /bin/bash
</code></pre></div><p>を実行する必要があります。 <br>
まず、一方のターミナルで以下を実行します。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># まず、DBを用意します。</span>
<span class="token comment"># エラーが発生しますが、</span>
<span class="token comment">#   Error: near line 1: no such table: users</span>
<span class="token comment"># であれば想定通りなので無視します。</span>
$ sqlite3 db/chat.db -init <span class="token string">&quot;db/setup.sql&quot;</span>
-- Loading resources from db/setup.sql
Error: near line <span class="token number">1</span>: no such table: <span class="token function">users</span>
SQLite version <span class="token number">3.16</span>.2 <span class="token number">2017</span>-01-06 <span class="token number">16</span>:32:41
Enter <span class="token string">&quot;.help&quot;</span> <span class="token keyword">for</span> usage hints.
sqlite<span class="token operator">&gt;</span>

<span class="token comment"># sqlite を終了します。</span>
sqlite<span class="token operator">&gt;</span> .exit

<span class="token comment"># サーバを起動します。</span>
$ go run main.go
go: finding github.com/mattn/go-sqlite3 v1.11.0
go: downloading github.com/mattn/go-sqlite3 v1.11.0
go: extracting github.com/mattn/go-sqlite3 v1.11.0
<span class="token comment"># プロンプトが返ってこなくなる</span>
</code></pre></div><p>その後、もう一方のターミナルで以下を叩きます。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">curl</span> http://localhost:8080/user/1
<span class="token punctuation">{</span><span class="token string">&quot;ID&quot;</span>:1,<span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;hogehoge&quot;</span><span class="token punctuation">}</span>
</code></pre></div><div><hr> <span>CC BY-SA Licensed | Copyright (c) 2019, Internet Initiative Japan Inc.</span></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/iij/bootcamp/edit/master/src/server-app/go/README.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/9/2019, 6:28:20 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/bootcamp/assets/js/app.958a0e13.js" defer></script><script src="/bootcamp/assets/js/2.acfdd0a4.js" defer></script><script src="/bootcamp/assets/js/22.14bb7511.js" defer></script><script src="/bootcamp/assets/js/5.d20398c4.js" defer></script><script src="/bootcamp/assets/js/4.a9d4f0c2.js" defer></script>
  </body>
</html>
