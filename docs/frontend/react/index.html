<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>IIJ Bootcamp</title>
    <meta name="description" content="JavaScriptフレームワークであるReactを使ってみよう">
    
    
    <link rel="preload" href="/bootcamp/assets/css/0.styles.2b6a07f9.css" as="style"><link rel="preload" href="/bootcamp/assets/js/app.d2f1aa0e.js" as="script"><link rel="preload" href="/bootcamp/assets/js/2.acfdd0a4.js" as="script"><link rel="preload" href="/bootcamp/assets/js/19.97637d7d.js" as="script"><link rel="preload" href="/bootcamp/assets/js/5.d20398c4.js" as="script"><link rel="preload" href="/bootcamp/assets/js/4.a9d4f0c2.js" as="script"><link rel="prefetch" href="/bootcamp/assets/js/10.5f8a5456.js"><link rel="prefetch" href="/bootcamp/assets/js/11.543ef737.js"><link rel="prefetch" href="/bootcamp/assets/js/12.4ddb5c1e.js"><link rel="prefetch" href="/bootcamp/assets/js/13.c5c411d4.js"><link rel="prefetch" href="/bootcamp/assets/js/14.42aafd44.js"><link rel="prefetch" href="/bootcamp/assets/js/15.69d56ee8.js"><link rel="prefetch" href="/bootcamp/assets/js/16.2d760d44.js"><link rel="prefetch" href="/bootcamp/assets/js/17.f362e4a8.js"><link rel="prefetch" href="/bootcamp/assets/js/18.37605e11.js"><link rel="prefetch" href="/bootcamp/assets/js/20.8abaa144.js"><link rel="prefetch" href="/bootcamp/assets/js/21.13750af6.js"><link rel="prefetch" href="/bootcamp/assets/js/22.910c6441.js"><link rel="prefetch" href="/bootcamp/assets/js/23.acf9765f.js"><link rel="prefetch" href="/bootcamp/assets/js/24.c37c1784.js"><link rel="prefetch" href="/bootcamp/assets/js/25.1f2988ad.js"><link rel="prefetch" href="/bootcamp/assets/js/26.80262ad6.js"><link rel="prefetch" href="/bootcamp/assets/js/27.ebb5f83a.js"><link rel="prefetch" href="/bootcamp/assets/js/28.1a6e8768.js"><link rel="prefetch" href="/bootcamp/assets/js/3.8871fbf6.js"><link rel="prefetch" href="/bootcamp/assets/js/6.6afd3d90.js"><link rel="prefetch" href="/bootcamp/assets/js/7.b81cb9d1.js"><link rel="prefetch" href="/bootcamp/assets/js/8.0797b3c3.js"><link rel="prefetch" href="/bootcamp/assets/js/9.76124e4d.js">
    <link rel="stylesheet" href="/bootcamp/assets/css/0.styles.2b6a07f9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/bootcamp/" class="home-link router-link-active"><!----> <span class="site-name">IIJ Bootcamp</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/iij/bootcamp" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/iij/bootcamp" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/bootcamp/frontend/react/#事前準備" class="sidebar-link">事前準備</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bootcamp/frontend/react/#おすすめ" class="sidebar-link">おすすめ</a></li></ul></li><li><a href="/bootcamp/frontend/react/#reactとは" class="sidebar-link">Reactとは</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bootcamp/frontend/react/#メリット" class="sidebar-link">メリット</a></li><li class="sidebar-sub-header"><a href="/bootcamp/frontend/react/#弱点" class="sidebar-link">弱点</a></li></ul></li><li><a href="/bootcamp/frontend/react/#create-react-app" class="sidebar-link">Create React App</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bootcamp/frontend/react/#補足-ユニットテスト" class="sidebar-link">(補足) ユニットテスト</a></li></ul></li><li><a href="/bootcamp/frontend/react/#componentを作ってみる" class="sidebar-link">Componentを作ってみる</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/bootcamp/frontend/react/#apiからデータを取得してみる" class="sidebar-link">APIからデータを取得してみる</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/bootcamp/frontend/react/#formを作る" class="sidebar-link">Formを作る</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><table><tr><td>このハンズオンでやること</td><td>JavaScriptフレームワークであるReactを使ってみよう</td></tr> <tr><td>想定時間</td><td>2h</td></tr> <tr><td>前提知識・用語</td><td>特になし</td></tr></table> <h1 id="reactでクライアントサイドwebアプリケーションを書こう"><a href="#reactでクライアントサイドwebアプリケーションを書こう" class="header-anchor">#</a> ReactでクライアントサイドWebアプリケーションを書こう</h1> <h2 id="事前準備"><a href="#事前準備" class="header-anchor">#</a> 事前準備</h2> <p>本ハンズオンの環境として、node.jsが必要です。</p> <p>講師はバージョン10.15.3を使いました。</p> <p>node.jsが動作しているなら、WindowsでもMacOSでもLinuxでも問題ありません。</p> <h3 id="おすすめ"><a href="#おすすめ" class="header-anchor">#</a> おすすめ</h3> <p>nodenv等、複数のバージョンのnode.jsを管理するツールの利用をおすすめします。</p> <p>Reactに限らず、node.jsを必要とするソフトウェア開発は、プロジェクト毎に異なるバージョンのnode.jsが必要になることが、ほぼ確実だからです。</p> <h2 id="reactとは"><a href="#reactとは" class="header-anchor">#</a> Reactとは</h2> <p>Reactは、Facebook社が開発しているWebユーザインターフェースのためのライブラリです。</p> <h3 id="メリット"><a href="#メリット" class="header-anchor">#</a> メリット</h3> <p>簡単に言うと、Webアプリケーションの画面表示まわりをいい感じに実装するためのライブラリで、以下の特徴があります。</p> <ol><li>保守性が高い。
<ul><li>関数型プログラミングの作法を大幅に導入し、状態（ステート）が一意であれば、一意の表示を得ることができます。（jQueryなどと比較して、デバッグが容易）</li></ul></li> <li>仮想DOMによる高いパフォーマンス
<ul><li>画面の背後にあるステートを更新すると、画面の中の「更新すべき部分だけ」自動的に更新することができます。（jQueryでは、プログラマが「更新すべき部分」を決定して、そこだけを更新するように自分で作り込まなければなりません。）</li></ul></li> <li>JSXと呼ばれるHTMLにそっくりの記法でビューを記述する。
<ul><li>あとで出てくるサンプルコードを見るとわかりますが、ビューの記述はほとんどHTMLそのままです。このため、デザイナーの作成したHTMLをビューの記述に取り込むことがカンタンになっています。</li></ul></li></ol> <p>なお、Facebook自身のUIこそが、Reactで書かれたものの実例です（Facebook社がFacebookのUIを、テスト/デバッグしやすく、素早くバージョンアップしていくために、Reactを作ったというわけです）。</p> <h3 id="弱点"><a href="#弱点" class="header-anchor">#</a> 弱点</h3> <p>Reactは非常に強力なライブラリではありますが、色々と敷居の高いライブラリでもあります。</p> <ol><li>バージョンアップのペースが速い。
<ul><li>Reactは非常に速いペースでバージョンアップされています。しかも、バージョンが少し違うだけで、APIが大幅に変化することが珍しくありません。</li> <li>あるバージョンのために学習した経験が、あっという間に陳腐化するのは、辛いものがあります。</li></ul></li> <li>学習コストが高い。
<ul><li>Reactは、React自身の学習コストがそこそこ高いことに加えて、Reactと組み合わせて使用すべきライブラリも多数あります。そして、それらのライブラリも、バージョンアップのペースが速いのです。</li> <li>Reactの実装をスムーズに行なうための周辺ツールが多数あります。これらのツールをどう組み合わせてどう使うべきか、ある程度のベストプラクティスはあるものの、そのベストプラクティスの寿命はけっして長くありません。Web上に散在するヒント的なドキュメントの多くは、もはや陳腐化していることがほとんどです。</li></ul></li> <li>関数型プログラミングの知識が期待される。
<ul><li>Reactは関数型プログラミングのアイデアを大幅に採用しています。関数型プログラミングの知識や経験の少ない人は、Reactで何が可能で何が難しいかをイメージすることが難しいと思われます。</li></ul></li></ol> <p>本講座では、2019年6月現在において、もっとも安定して使える、なるべく新しいバージョンを使っていきます。</p> <h2 id="create-react-app"><a href="#create-react-app" class="header-anchor">#</a> Create React App</h2> <p>Reactを始めるための方法としては、いくつかの方法があります。</p> <p>Reactの基礎を体験したいだけなら、オンラインサービスを使って体験するのが一番簡単です。</p> <ul><li><a href="https://reactjs.org/redirect-to-codepen/hello-world" target="_blank" rel="noopener noreferrer">CodePen<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://codesandbox.io/s/new" target="_blank" rel="noopener noreferrer">CodeSandbox<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://glitch.com/edit/#!/remix/starter-react-template" target="_blank" rel="noopener noreferrer">Glitch<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>また、既存のHTMLページの中にReactで書いたものを埋め込むだけなら、下記のチュートリアルが参考になります。</p> <ul><li><a href="https://reactjs.org/docs/add-react-to-a-website.html" target="_blank" rel="noopener noreferrer">Add React to a WebSite<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>しかし、一般的には、Reactを利用する目的は、ある程度の規模と機能をそなえたSingle Page Applicationを実装するためでしょう。</p> <p>この場合の公式サイト上の出発点は、以下になります。</p> <ul><li><a href="https://facebook.github.io/create-react-app/docs/getting-started" target="_blank" rel="noopener noreferrer">Create React App<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>ここにあるように、以下を実行すると、プロジェクトmy-appが作成され、サンプルアプリケーションをブラウザで確認できます。</p> <div class="language- extra-class"><pre class="language-text"><code>npx create-react-app my-app
cd my-app
npm start
</code></pre></div><p>(<code>npx</code>を使うためには、version 5.2.0以降のnpmが必要です。講師は、node 10.15.3に同梱されているversion 6.4.1で動作確認しています。)</p> <p>わかると思いますが、一応説明しますと<code>npx create-react-app my-app</code>がプロジェクトの作成です。my-appがプロジェクト名で、まさしくその名前のディレクトリが作成されます。</p> <p>プロジェクトディレクトリに入りまして、<code>npm start</code>しますと、ソースコードのビルドが行なわれた後、開発サーバが起動しまして <a href="http://localhost:3000/" target="_blank" rel="noopener noreferrer">http://localhost:3000/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> にてブラウザで開発中のアプリケーションを確認できるという塩梅です。（なお、npm startで起動した開発サーバを止めるには、npm startしたコンソールでCtrl-Cをタイプしてください。）</p> <p>それぞれのコマンドが、実際のところ何をしているかは、最終的には把握した方が良いですが、入門段階では「人間が勉強するにはかったるいことを、いろいろやってくれているんだなあ、便利だなあ」と思っておけば十分です。</p> <p>開発サーバは、ソースコードの変更を察知して、その変更を即座にブラウザに伝えてくれます。</p> <p>さっそくひとつやってみましょう。</p> <p>src/App.jsを適当なエディタ(私はWebStormというIDEを使っています)で開きますと、以下のようなコードが見えます。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> logo <span class="token keyword">from</span> <span class="token string">'./logo.svg'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'./App.css'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;App&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>header className<span class="token operator">=</span><span class="token string">&quot;App-header&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token punctuation">{</span>logo<span class="token punctuation">}</span> className<span class="token operator">=</span><span class="token string">&quot;App-logo&quot;</span> alt<span class="token operator">=</span><span class="token string">&quot;logo&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>
          Edit <span class="token operator">&lt;</span>code<span class="token operator">&gt;</span>src<span class="token operator">/</span>App<span class="token punctuation">.</span>js<span class="token operator">&lt;</span><span class="token operator">/</span>code<span class="token operator">&gt;</span> and save to reload<span class="token punctuation">.</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>a
          className<span class="token operator">=</span><span class="token string">&quot;App-link&quot;</span>
          href<span class="token operator">=</span><span class="token string">&quot;https://reactjs.org&quot;</span>
          target<span class="token operator">=</span><span class="token string">&quot;_blank&quot;</span>
          rel<span class="token operator">=</span><span class="token string">&quot;noopener noreferrer&quot;</span>
        <span class="token operator">&gt;</span>
          Learn React
        <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>header<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>
</code></pre></div><p>にわかにJavaScriptのコードだとは思えない、HTMLとES2015のコードが混ぜこぜになっているようなコードが出てきます。</p> <p>このHTML風の表現になっている部分は、<a href="http://facebook.github.io/jsx/" target="_blank" rel="noopener noreferrer">JSX<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>というJavaScriptの拡張構文で、実際にはJavaScriptにトランスパイルされてから実行されます。</p> <p>JSXについての詳細には踏み込みませんが、3点だけ注意しておきます。</p> <ol><li>JSXはHTML風の記法でHTML出力のためのコードを記述できるものであって、HTMLそのものではありません。</li> <li>HTMLではCSSのクラス名を適用するのにclass属性を記述しますが、classはECMAScriptの予約語なので、これを避けてclassNameという語を用います。(上の例にあるとおりです。)</li> <li>(上記の例では出てきませんが)HTMLではlabelタグにfor属性を使いますが、forはJavaScriptの予約語なので、これを避けてhtmlForという語を用います。</li></ol> <p>ここではdivタグによって作られたDOMツリーを表現するオブジェクトを生成してreturnしています。</p> <p>(JSXは、あくまでも記法なので、JSXを使わずに同じ意味のコードを書くことは可能です。が、Reactで開発する人のほとんどはJSXを利用しますので、本チュートリアルでは解説しません。)</p> <p>さて、このコードを適当に変更してみましょう。</p> <p>たとえば、このような具合です。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> logo <span class="token keyword">from</span> <span class="token string">'./logo.svg'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'./App.css'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;App&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>header className<span class="token operator">=</span><span class="token string">&quot;App-header&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token punctuation">{</span>logo<span class="token punctuation">}</span> className<span class="token operator">=</span><span class="token string">&quot;App-logo&quot;</span> alt<span class="token operator">=</span><span class="token string">&quot;logo&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>code<span class="token operator">&gt;</span>src<span class="token operator">/</span>App<span class="token punctuation">.</span>js<span class="token operator">&lt;</span><span class="token operator">/</span>code<span class="token operator">&gt;</span>を編集し、保存して、リロードしてみよう。
        <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>a
          className<span class="token operator">=</span><span class="token string">&quot;App-link&quot;</span>
          href<span class="token operator">=</span><span class="token string">&quot;https://reactjs.org&quot;</span>
          target<span class="token operator">=</span><span class="token string">&quot;_blank&quot;</span>
          rel<span class="token operator">=</span><span class="token string">&quot;noopener noreferrer&quot;</span>
        <span class="token operator">&gt;</span>
          Reactを学ぶ。
        <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>header<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>
</code></pre></div><p>ブラウザに戻ってみますと、リロードするまでもなく、反映されているのがわかると思います。</p> <h3 id="補足-ユニットテスト"><a href="#補足-ユニットテスト" class="header-anchor">#</a> (補足) ユニットテスト</h3> <p>ユニットテスト とは、メソッドや関数単位でテストコードを作成し、コードを書くのと同時に自動でテストを行う開発手法です。TDD (Test Driven Development) など聞いたことがあるかもしれません。</p> <p>実は、create react appで作ったプロジェクトには、ユニットテスト用の環境も用意してくれています。以下のコマンドを実行してください。(npm startを止めてこちらを実行した方がいいかもしれません)</p> <div class="language- extra-class"><pre class="language-text"><code>npm test
</code></pre></div><p><a href="./Screenshot001.png" title="スクリーンショット001">スクリーンショット001</a></p> <p>このような画面が出力され、テストがパスしていることが報告されています。</p> <p>そのテストコードはsrc/App.test.jsにあります。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App'</span><span class="token punctuation">;</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'renders without crashing'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> div<span class="token punctuation">)</span><span class="token punctuation">;</span>
  ReactDOM<span class="token punctuation">.</span><span class="token function">unmountComponentAtNode</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>ここでは、document.createElement('div')で作ったdivオブジェクトの中に、<App></App>をレンダリングしてトラブルがないことを確認しています。</p> <p>開始タグと終了タグの対応を壊したりしますと、テストに失敗するはずです。</p> <p>npm startで起動させた開発サーバ同様、npm testで起動させたテストランナーも、ソースファイルを保存すると自動的にテストをやりなおしてくれます。</p> <h2 id="componentを作ってみる"><a href="#componentを作ってみる" class="header-anchor">#</a> Componentを作ってみる</h2> <p>次はComponentを作ってみましょう。</p> <p>実は、Componentを記述する方法はいくつもあるのですが、ここではクラスベースのオブジェクト指向のスタイルで書いてみます。</p> <p>以下のソースコードをsrc/Peoples.jsに作成してください。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Peoples</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>peoples works<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>その上で、src/App.jsでPeoplesを使うように修正します。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> logo <span class="token keyword">from</span> <span class="token string">'./logo.svg'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'./App.css'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Peoples <span class="token keyword">from</span> <span class="token string">'./Peoples'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;App&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>header className<span class="token operator">=</span><span class="token string">&quot;App-header&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token punctuation">{</span>logo<span class="token punctuation">}</span> className<span class="token operator">=</span><span class="token string">&quot;App-logo&quot;</span> alt<span class="token operator">=</span><span class="token string">&quot;logo&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>code<span class="token operator">&gt;</span>src<span class="token operator">/</span>App<span class="token punctuation">.</span>js<span class="token operator">&lt;</span><span class="token operator">/</span>code<span class="token operator">&gt;</span>を編集し、保存して、リロードしてみよう。
        <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Peoples <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>a
          className<span class="token operator">=</span><span class="token string">&quot;App-link&quot;</span>
          href<span class="token operator">=</span><span class="token string">&quot;https://reactjs.org&quot;</span>
          target<span class="token operator">=</span><span class="token string">&quot;_blank&quot;</span>
          rel<span class="token operator">=</span><span class="token string">&quot;noopener noreferrer&quot;</span>
        <span class="token operator">&gt;</span>
          Reactを学ぶ。
        <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>header<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>
</code></pre></div><p>さあ、ブラウザに表示されている内容が変化したと思います。</p> <p>つまり、ReactではComponentを作ることによって、JSXに記述できるタグを増やすことができます。</p> <p>この程度のことでは面白くないので、人々のリストを表示させてみましょう。</p> <p>まずはsrc/Peoples.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Peoples</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>peoples works<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>table border<span class="token operator">=</span><span class="token string">&quot;1&quot;</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>thead<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span>tr<span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span>th<span class="token operator">&gt;</span><span class="token constant">ID</span><span class="token operator">&lt;</span><span class="token operator">/</span>th<span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span>th<span class="token operator">&gt;</span>Name<span class="token operator">&lt;</span><span class="token operator">/</span>th<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token operator">/</span>tr<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>thead<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>tbody<span class="token operator">&gt;</span>
                        <span class="token punctuation">{</span>
                            <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>peoples<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">people</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                                <span class="token keyword">return</span> <span class="token punctuation">(</span>
                                    <span class="token operator">&lt;</span>tr key<span class="token operator">=</span><span class="token punctuation">{</span>people<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token operator">&gt;</span>
                                        <span class="token operator">&lt;</span>td<span class="token operator">&gt;</span><span class="token punctuation">{</span>people<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">&gt;</span>
                                        <span class="token operator">&lt;</span>td<span class="token operator">&gt;</span><span class="token punctuation">{</span>people<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">&gt;</span>
                                    <span class="token operator">&lt;</span><span class="token operator">/</span>tr<span class="token operator">&gt;</span>
                                <span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span><span class="token punctuation">)</span>
                        <span class="token punctuation">}</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>tbody<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>table<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>そして、src/App.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> logo <span class="token keyword">from</span> <span class="token string">'./logo.svg'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'./App.css'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Peoples <span class="token keyword">from</span> <span class="token string">'./Peoples'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> peoples <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;bob&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;alice&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;John&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;App&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>header className<span class="token operator">=</span><span class="token string">&quot;App-header&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token punctuation">{</span>logo<span class="token punctuation">}</span> className<span class="token operator">=</span><span class="token string">&quot;App-logo&quot;</span> alt<span class="token operator">=</span><span class="token string">&quot;logo&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>code<span class="token operator">&gt;</span>src<span class="token operator">/</span>App<span class="token punctuation">.</span>js<span class="token operator">&lt;</span><span class="token operator">/</span>code<span class="token operator">&gt;</span>を編集し、保存して、リロードしてみよう。
        <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Peoples peoples<span class="token operator">=</span><span class="token punctuation">{</span>peoples<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>a
          className<span class="token operator">=</span><span class="token string">&quot;App-link&quot;</span>
          href<span class="token operator">=</span><span class="token string">&quot;https://reactjs.org&quot;</span>
          target<span class="token operator">=</span><span class="token string">&quot;_blank&quot;</span>
          rel<span class="token operator">=</span><span class="token string">&quot;noopener noreferrer&quot;</span>
        <span class="token operator">&gt;</span>
          Reactを学ぶ。
        <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>header<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>
</code></pre></div><p>どうなりましたか。</p> <p>peoples works!の下に、テーブルが表示され、その中に人々の一覧が表示されましたね。</p> <p>どのようにして、この仕組みが動いているのか、解説します。</p> <p>まずsrc/App.jsですが、ここでは定数peoplesに表示したい人々のデータを定義しています。</p> <p>（ここで記述している人々のデータは、後でAPIサーバから取得することになるJSONと同じものです。)</p> <p>そして、そのpeoplesを以下のようにしてPeoplesタグのpeoples属性として渡しています。</p> <div class="language-JSX extra-class"><pre class="language-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Peoples</span></span> <span class="token attr-name">peoples</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>peoples<span class="token punctuation">}</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>このpeoples属性は、src/Peoples.jsに定義しているPeoplesクラスの中では、<code>this.props.peoples</code>で参照することができます。(<code>this.props</code>はそのインスタンスに与えられた属性を保持しているオブジェクトで、このオブジェクトのことを「プロパティ」と呼びます。どこでプロパティがセットされるかというと、上記のJSXがPeoplesクラスのインスタンスをnewしており、その引数として属性リストが渡されるという塩梅です。)</p> <p>上記のコードでは<code>this.props.peoples</code>にmapメソッドを適用して、配列(リスト)の各要素をJSXにてHTMLに展開しています（より正確に言うと、プロパティpeoplesと仮想DOMの対応を定義している、ということになりますが、さしあたりHTMLに展開していると思っておいて良いです）。</p> <p><code>&lt;tr&gt;</code>にkey属性を指定しています。これはHTMLでは不要の記述で、React独特の書き方です。key属性に、mapで展開される各要素を特定するユニークな値を指定することで、this.props.peoplesの中身が変化したとき、画面を自動的に（リアクティヴに）更新することができるようになっているのです。（あとで、実際に変化させる実験をします。）</p> <p>mapメソッドは、関数型プログラミングにおけるHello World的な存在です。</p> <p>ここでは、<code>this.props.peoples</code>に定義されているオブジェクトのリストの写像(map)として<code>&lt;tr&gt;</code>から<code>&lt;/tr&gt;</code>で表現されるテーブルの行のリストを仮想DOMの中に展開しています。</p> <p><code>this.props.peoples</code>に対してforEach的なループを記述するのではなく、mapを使う、というところがReactのReactらしいところです。</p> <p>Reactでは、ほぼほぼ、プロパティにあるリストをmapで展開する、という方法でのみ繰り返しデータをレンダリングします。</p> <p>関数型プログラミング（とりわけHaskellのような遅延評価のある言語）に親しんでいる人には、renderメソッドが実際にレンダリング処理を記述しているというよりは、renderメソッドの定義を通じて「プロパティと仮想DOMの対応を宣言している」という言い方が通じると思います。</p> <p>ここで重要なことは、<code>this.props</code>の内容が同一であれば、出力される画面も同一になる、ということです。</p> <p><code>this.props</code>以外の情報をrenderは参照していません。</p> <p>このような原則を守らせる強制力をJavaScriptは持っていないのですが、Reactのプログラマーは自主的に<code>this.props</code>以外の情報をrenderが参照しないように留意します。この原則を守ることによってデバッグが容易になり、複雑なアプリケーションを安心して開発/保守できるようになるのです。</p> <p>せっかくなので、ここでユニットテストを書きましょう。</p> <p>まずはテストを書くために便利なライブラリであるreact-test-rendererをインストールします。</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> react-test-renderer
</code></pre></div><p>そして、以下の内容でsrc/Peoples.test.jsを記述してください。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Peoples <span class="token keyword">from</span> <span class="token string">'./Peoples'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> renderer <span class="token keyword">from</span> <span class="token string">'react-test-renderer'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> peoples <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;bob&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;alice&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;John&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'renders with peoples correctly'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> peoplesTable <span class="token operator">=</span> renderer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Peoples peoples<span class="token operator">=</span><span class="token punctuation">{</span>peoples<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>peoplesTable<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>こうしておいて、<code>npm test</code>を実行すると、srcディレクトリの中に<code>__snapshots__</code>というディレクトリができて、その中にPeoples.test.js.snapなるファイルが作られます。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// Jest Snapshot v1, https://goo.gl/fbAQLP</span>

exports<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">renders with peoples correctly 1</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
&lt;div&gt;
  &lt;p&gt;
    peoples works!
  &lt;/p&gt;
  &lt;table
    border=&quot;1&quot;
  &gt;
    &lt;thead&gt;
      &lt;tr&gt;
        &lt;th&gt;
          ID
        &lt;/th&gt;
        &lt;th&gt;
          Name
        &lt;/th&gt;
      &lt;/tr&gt;
    &lt;/thead&gt;
    &lt;tbody&gt;
      &lt;tr&gt;
        &lt;td&gt;
          1
        &lt;/td&gt;
        &lt;td&gt;
          bob
        &lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td&gt;
          2
        &lt;/td&gt;
        &lt;td&gt;
          alice
        &lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td&gt;
          3
        &lt;/td&gt;
        &lt;td&gt;
          John
        &lt;/td&gt;
      &lt;/tr&gt;
    &lt;/tbody&gt;
  &lt;/table&gt;
&lt;/div&gt;
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
</code></pre></div><p>この出力を良く眺めて、意図どおりであるなら、まずはOKです。</p> <p>スナップショットは、そのテストについてスナップショットがない状態で<code>npm test</code>すると自動的に生成されます。以後は、このスナップショットをテストの正解として、テストが実行されます。</p> <p>Peoples.jsを少し変更（たとえば<code>&lt;tr&gt;</code>の中のIDの<code>&lt;td&gt;</code>とNameの<code>&lt;td&gt;</code>を入れ替えてみるとか）して<code>npm test</code>し、テストが失敗することを確認してみましょう。</p> <p>期待どおりにエラーがレポートされたと思います。</p> <h2 id="apiからデータを取得してみる"><a href="#apiからデータを取得してみる" class="header-anchor">#</a> APIからデータを取得してみる</h2> <p>次は外からHTTPアクセスでデータを取得してみます。実際にはWebサーバのAPIを叩くことが多いですが、今回はjQueryの時と同様に以下のJSONファイルの内容を取得してみます。</p> <p><a href="https://https" target="_blank" rel="noopener noreferrer">https://https<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>😕/iij.github.io/bootcamp//test.json</p> <p>React自身は外部との通信をどのように記述するかの規則はありません。この点、Serviceを使うことになっているAngularとは異なります。</p> <p>React自身は外部で通信することだけではなく、状態の管理についてもオープンです。ここで私が慣れているという理由でReduxというライブラリを使います。</p> <p>なぜ状態管理が必要なのかというと、通信が走る前と通信が完了した後では状態を変化させる必要があるためです。</p> <p>実際のコードを書いて、このあたりのことを実感しながら前進しましょう。</p> <p>まずはHTTPクライアントとして、axiosをインストールします。</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> --save axios

</code></pre></div><p>続いてsrc/App.jsを以下のように修正します。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> logo <span class="token keyword">from</span> <span class="token string">'./logo.svg'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'./App.css'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Peoples <span class="token keyword">from</span> <span class="token string">'./Peoples'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> axiosBase <span class="token keyword">from</span> <span class="token string">'axios'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> axios <span class="token operator">=</span> axiosBase<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  headers<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
    <span class="token string">'X-Requested-With'</span><span class="token punctuation">:</span> <span class="token string">'XMLHttpRequest'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  responseType<span class="token punctuation">:</span> <span class="token string">'json'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'https://iij.github.io/bootcamp//test.json'</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> peoples <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            peoples <span class="token operator">=</span> response<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'got!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span>peoples<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">response status is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>response<span class="token punctuation">.</span>status<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'an error occurs.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">an error on get </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;App&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>header className<span class="token operator">=</span><span class="token string">&quot;App-header&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token punctuation">{</span>logo<span class="token punctuation">}</span> className<span class="token operator">=</span><span class="token string">&quot;App-logo&quot;</span> alt<span class="token operator">=</span><span class="token string">&quot;logo&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>code<span class="token operator">&gt;</span>src<span class="token operator">/</span>App<span class="token punctuation">.</span>js<span class="token operator">&lt;</span><span class="token operator">/</span>code<span class="token operator">&gt;</span>を編集し、保存して、リロードしてみよう。
        <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Peoples peoples<span class="token operator">=</span><span class="token punctuation">{</span>peoples<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>a
          className<span class="token operator">=</span><span class="token string">&quot;App-link&quot;</span>
          href<span class="token operator">=</span><span class="token string">&quot;https://reactjs.org&quot;</span>
          target<span class="token operator">=</span><span class="token string">&quot;_blank&quot;</span>
          rel<span class="token operator">=</span><span class="token string">&quot;noopener noreferrer&quot;</span>
        <span class="token operator">&gt;</span>
          Reactを学ぶ。
        <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>header<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>
</code></pre></div><p>ここでブラウザで見ようとするとエラーになります。</p> <p>詳しくは長くなるので別途勉強してほしいのですが、localhost:3000で提供されているJavaScriptのコードから、別サイトのgithub.comのリソースをGETしようとしたので、Cross-Originリクエストとしてブロックされたのです。</p> <p>実際にアプリケーションを作るときには、APIとアプリケーションを別のドメインで提供することはあるので、そのときにはこの問題を解決するためにAPIサーバにちょっとした設定をします。今回はそこまでの設定をするほどのことではないので、安直な解決策を選びます。</p> <p>chromeないしchromium-browserを使っているなら、起動オプションに<code>--user-data-dir=/tmp/myhome --disable-web-security</code>を付与します。こうすることで、Cross-Originリクエストがブロックされなくなります。（もちろん、この起動オプションをつけて起動したブラウザは危険ですから、自分の開発中のアプリケーション以外にアクセスしてはいけません。）</p> <p>今度はどうでしょう。エラーは出なくなりましたが、画面には人々が表示されません。</p> <p>コンソールを確認すると、ちゃんと通信は成功しています。</p> <p>(axiosの処理の部分で.thenおよび.catchを使った構文があります。これはES2015で採用されたPromiseという仕組みを利用しています。このあたりについても詳しいことは述べませんが、.thenの中身は通信が成功した後に処理されるのであって、最初は通信を始めた後、通信の結果を待たずに先に進んでしまう、ということを知っておいてください。つまり、peoplesは空配列のまま先に進んでAppクラスのインスタンスが生成されます。その後になって通信が成功して.thenの中身が実行される、という順番になります。)</p> <p>要するに通信が成功してpeoplesが更新されたにも関わらず、peoplesが変化したことにAppクラスのインスタンスが気付いていないのです。</p> <p>peoplesの変化をAppクラスのインスタンスに伝える必要があります。</p> <p>そこでReduxを導入していきます。</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> --save react-redux redux-thunk redux
</code></pre></div><p>Reduxは、React専用の状態管理ライブラリというわけではありません。</p> <p>そのため、ReactからReduxを使うためのモジュールとしてreact-reduxがあります。</p> <p>redux-thunkは、あるアクションの結果を受けて続きのアクションを実行するための「サンク」を提供するReduxのための「ミドルウェア」です。</p> <p>順番に見ていきましょう。</p> <p>まず、src/index.jsですが、以下のように修正します。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Provider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./redux/store'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'./index.css'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> serviceWorker <span class="token keyword">from</span> <span class="token string">'./serviceWorker'</span><span class="token punctuation">;</span>

ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Provider store<span class="token operator">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">&gt;</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// If you want your app to work offline and load faster, you can change</span>
<span class="token comment">// unregister() to register() below. Note this comes with some pitfalls.</span>
<span class="token comment">// Learn more about service workers: https://bit.ly/CRA-PWA</span>
serviceWorker<span class="token punctuation">.</span><span class="token function">unregister</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>重要なことは、2つ。</p> <ol><li>react-reduxモジュールからProviderをインポートし、AppをProviderで囲んでいます。</li> <li>Providerに渡すstoreなるものをsrc/redux/store.jsからインポートしています。</li></ol> <p>src/redux/store.jsは、以下の内容です。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> applyMiddleware<span class="token punctuation">,</span> compose<span class="token punctuation">,</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> thunk <span class="token keyword">from</span> <span class="token string">'redux-thunk'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> rootReducer <span class="token keyword">from</span> <span class="token string">'./reducers'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">createStore</span><span class="token punctuation">(</span>
    rootReducer<span class="token punctuation">,</span>
    <span class="token function">compose</span><span class="token punctuation">(</span>
        <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>thunk<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>reduxモジュールからapplyMiddleware, compose, createStoreをインポートしています。</p> <p>createStoreは、文字どおり「ストア」を作るメソッドです。</p> <p>composeは関数合成のためのメソッドで、applyMiddlewareはミドルウェアを導入するためのメソッドです。ここではひとつしかミドルウェアがないのでcomposeは不要なのですが、あとでミドルウェアを追加することを考えてcomposeを使っています。（実際、追加することになります。）</p> <p>redux-thunkモジュールからthunkをインポートしています。thunkは前述のとおり、複数のアクションをひとつのアクションとしてまとめる機能を実現するミドルウェアです。</p> <p>src/redux/reducers/index.jsからrootReducerをインポートしています。</p> <p>リデューサとは、Reduxのコンセプト上の用語で、具体的には「状態」と「アクション」を引数にとって、「新しい状態」を返す関数として定義します。</p> <p>Reduxの「ストア」の中には「状態 state」が存在するのですが、この状態は不変オブジェクトです。状態を変更することは許可されておらず、新しい状態を作るための唯一の方法が、ストアにアクションをdispatchすることです。ストアにアクションをdispatchすると、ストアはリデューサに現在の状態とアクションを渡します。リデューサは、状態とアクションから新しい状態を作り、ストアに返します。ストアは、新しい状態を、ストアとconnectしているコンポーネントに反映させます。</p> <p>そのsrc/redux/reducers/index.jsは以下の内容です。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> combineReducers <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> peoples <span class="token keyword">from</span> <span class="token string">'./peoples'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token punctuation">{</span> peoples <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>reduxモジュールからcombineReducersをインポートします。combineReducersは複数のリデューサを合成します。</p> <p>そしてsrc/redux/reducers/peoples.jsからpeopleをインポートし、combineReducersを使って合成してエクスポートしていますね。</p> <p>そのsrc/redux/reducers/peoples.jsの内容は以下のとおりです。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">SET_FETCHING</span><span class="token punctuation">,</span> <span class="token constant">FETCH_PEOPLES</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../actionTypes'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span>
    inFetching<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    peoples<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> initialState<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;PEOPLES Reducer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token constant">SET_FETCHING</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
               inFetching<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
               peoples<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">FETCH_PEOPLES</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                inFetching<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                peoples<span class="token punctuation">:</span> action<span class="token punctuation">.</span>peoples
            <span class="token punctuation">}</span>
        <span class="token keyword">default</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> state<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>src/redux/actionTypes.jsから<code>SET_FETCHING</code>, <code>FETCH_PEOPLES</code>をインポートしています。あとで見ますが、これは単にアクションの種別を区別するための定数で、その実体は同名の文字列です。</p> <p>定数initialStateは初期状態です。ここではisFetching すなわちAPIから人々のデータを取得中であるかどうかのフラグおよびpeoples すなわち人々のデータを格納するリストを定義しています。isFetchingはfalse、peoplesは空リストを初期値としました。</p> <p>export defaultしている関数が、peoplesリデューサです。</p> <p>状態とアクションを引数としてとります。</p> <p>consoleは、デバッグ用の出力です。実際には必要ありません。</p> <p>switchからがリデューサの本体です。</p> <p><code>SET_FETCHING</code>に対しては、isFetchingをtrueにして、peopleを空リストにした新しい状態を返しています。</p> <p><code>FETCH_PEOPLES</code>に対しては、isFetchingをfalseにして、アクションのpeopleプロパティをpeopleに渡した新しい状態を返しています。</p> <p>デフォルトは古い状態をそのまま返しています。</p> <p>src/redux/actionTypes.jsも見ておきましょう。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">SET_FETCHING</span> <span class="token operator">=</span> <span class="token string">'SET_FETCHING'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">FETCH_PEOPLES</span> <span class="token operator">=</span> <span class="token string">'FETCH_PEOPLES'</span><span class="token punctuation">;</span>

</code></pre></div><p>見てのとおりですね。特に面白くはありません。</p> <p>さて、以上でindex.jsにインポートされたstoreの正体がわかりました。</p> <p>要するに...</p> <ol><li>src/redux/actionTypes.jsに反応するリデューサと、redux-thunkモジュールの提供するthunkミドルウェアを適用してcreateStoreしたストアであるstoreを用意し、</li> <li>Providerにそのstoreを渡してAppを囲んでいる</li></ol> <p>...わけです。</p> <p>そしてAppクラスとstoreをconnectします。</p> <p>src/App.jsは以下のように修正しました。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> logo <span class="token keyword">from</span> <span class="token string">'./logo.svg'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'./App.css'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Peoples <span class="token keyword">from</span> <span class="token string">'./Peoples'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> actions <span class="token keyword">from</span> <span class="token string">'./redux/actions'</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> lastFetching <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'App render'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>peoples<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>isFetching<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> now <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>lastFetching <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                lastFetching <span class="token operator">=</span> now<span class="token punctuation">;</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;FETCH_PEOPLES&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">fetchPeoples</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span>
                <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>fetch peoples<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>isFetching<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span>
                <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>now loading<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;App&quot;</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>header className<span class="token operator">=</span><span class="token string">&quot;App-header&quot;</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token punctuation">{</span>logo<span class="token punctuation">}</span> className<span class="token operator">=</span><span class="token string">&quot;App-logo&quot;</span> alt<span class="token operator">=</span><span class="token string">&quot;logo&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span>code<span class="token operator">&gt;</span>src<span class="token operator">/</span>App<span class="token punctuation">.</span>js<span class="token operator">&lt;</span><span class="token operator">/</span>code<span class="token operator">&gt;</span>を編集し、保存して、リロードしてみよう。
                    <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>Peoples peoples<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>peoples<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>a
                        className<span class="token operator">=</span><span class="token string">&quot;App-link&quot;</span>
                        href<span class="token operator">=</span><span class="token string">&quot;https://reactjs.org&quot;</span>
                        target<span class="token operator">=</span><span class="token string">&quot;_blank&quot;</span>
                        rel<span class="token operator">=</span><span class="token string">&quot;noopener noreferrer&quot;</span>
                    <span class="token operator">&gt;</span>
                        Reactを学ぶ。
                    <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>header<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token punctuation">{</span>
        isFetching<span class="token punctuation">:</span> state<span class="token punctuation">.</span>peoples<span class="token punctuation">.</span>isFetching<span class="token punctuation">,</span>
        peoples<span class="token punctuation">:</span> state<span class="token punctuation">.</span>peoples<span class="token punctuation">.</span>peoples<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> props<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">mapDispatchToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">dispatch</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token function">fetchPeoples</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> action <span class="token operator">=</span> actions<span class="token punctuation">.</span><span class="token function">fetchPeoples</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">dispatch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>mapStateToProps<span class="token punctuation">,</span> mapDispatchToProps<span class="token punctuation">)</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>react-reduxモジュールからconnect関数をインポートしています。</p> <p>connectはsrc/App.jsの最後の行で、2つの関数とAppクラスとを接続するために使っています。</p> <p>簡単に言うと、Providerに渡されたstoreとAppクラスを接続するのがconnectの役割です。</p> <p>connectの最初の引数mapStateToPropsは、状態を引数としてとり、これをAppのプロパティとしてどのように対応させるかを定義する関数です。ここではstate.peoples.isFetchingをプロパティisFetchingに、state.peoples.peoplesをプロパティpeoplesに対応させています。</p> <p>stateの次にpeoplesとあるのは、peoplesリデューサの管理下の状態であることを意味しています。規模が大きくなってくると、リデューサも大きくなってくるので、リデューサを適当な粒度で分割できるようにしているわけです。</p> <p>connectの2つ目の引数mapDispatchToPropsは、ストアにアクションをdispatchするための関数オブジェクトdispatchを引数にとって、Appのプロパティに実際にアクションをdispatchする関数オブジェクトを定義する関数です。ここではプロパティfetchPeoplesに、src/redux.actions.jsに定義されているactions.fetchPeoplesをdispatchする関数オブジェクトを定義しています。</p> <p>そのsrc/actions.jsは最後に述べるので、その前に、Appクラスのrenderメソッドを読んでいきましょう。</p> <p>最初にあるconsoleはデバッグを助けるためのもので、実際には不要です。</p> <p>次のif文は、プロパティpeoplesが空リストであり、プロパティisFetchingがfalseであるなら、ということですから、初期状態であるなら、という意味です。</p> <p>const nowにはエポックからのミリ秒をセットします。</p> <p>その上で、モジュールAppに閉じた変数lastFetching (初期値null) がnullであるかを検査し、nullであるなら、lastFetchingにnowをセットした上で、プロパティfetchPeoplesにある関数オブジェクトを評価します。つまりactions.jsで定義されたactions.fetchPeoplesをストアにdispatchするわけです。</p> <p>その上で</p><div>fetch peoples</div>をreturnしています。ほんの一瞬だけ、画面にはfetch peoplesが見えるかも、しれません。<p></p> <p>ここでsrc/redux/actions.jsを見てみましょう。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">FETCH_PEOPLES</span><span class="token punctuation">,</span> <span class="token constant">SET_FETCHING</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./actionTypes'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> axiosBase <span class="token keyword">from</span> <span class="token string">'axios'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> axios <span class="token operator">=</span> axiosBase<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    headers<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
        <span class="token string">'X-Requested-With'</span><span class="token punctuation">:</span> <span class="token string">'XMLHttpRequest'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    responseType<span class="token punctuation">:</span> <span class="token string">'json'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">errorHandler</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'failed to call api'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">fetchPeoples</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'https://iij.github.io/bootcamp//test.json'</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">dispatch</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            type<span class="token punctuation">:</span> <span class="token constant">SET_FETCHING</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">errorHandler</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> peoples <span class="token operator">=</span> response<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'got!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span>peoples<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                type<span class="token punctuation">:</span> <span class="token constant">FETCH_PEOPLES</span><span class="token punctuation">,</span>
                peoples<span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>src/redux/actionTypes.jsから<code>FETCH_PEOPLES</code>と<code>SET_FETCHING</code>をインポートしているのは、リデューサに伝えるアクション種別が必要だからです。</p> <p>関数fetchPeoplesの定義を見ていきましょう。</p> <p>定数urlに取得したいリソースのURLが定義されています。</p> <p>そしてasyncで修飾された、dispatchを引数とするラムダ式をreturnしています。</p> <p>このdispatchを引数とするラムダ式としてアクションを表現する技法が「サンク thunk」なのです。</p> <p>サンクとは、コンピュータ科学の世界では、遅延評価される関数オブジェクトのようなものを指しています。</p> <p>redux-thunkミドルウェアを適用されたReduxストアは、dispatchされたアクションが単純なオブジェクトであればそのままリデューサに渡します(言わば通常どおりの挙動です)。dispatchされたアクションが、dispatchを引数とするラムダ式であるなら、そのラムダ式にdispatchオブジェクトを渡します。</p> <p>かくして、多段階的なアクションをエレガントに表現することができるのです。</p> <p>fetchPeoplesでは、まず以下のオブジェクトをdispatchしてます。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  type<span class="token operator">:</span> SET_FETCHING
<span class="token punctuation">}</span>
</code></pre></div><p>すでにpeoplesリデューサで見たように、<code>SET_FETCHING</code>アクションは、状態isFetchingをtrueにして状態peoplesを空リストにした新しい状態を作り出すアクションです。つまるところ、通信中のフラグを立てた、ということです。</p> <p>その上で、axiosを使ってurlをGETし、結果をresponseにセットします。</p> <p>このとき、axios.getの前にキーワードawaitが修飾されています。awaitはasyncと対になっているキーワードで非同期処理を表現しています。</p> <p>ここでは、responseはaxios.getが成功した場合にセットされ、その後の行の処理に進みます。
非同期なので、axios.getを実行したら、結果を待たずに抜けてしまいます。</p> <p>ここではif (response.status === 200) 以降の処理は、axios.getが成功した後に、コールバック処理として、呼び出されます。</p> <p>なので、最初の瞬間は<code>SET_FETCHING</code>をdispatchして、axios.getをリクエストする、というアクションとして実行されます。</p> <p>ここでAppクラスのrenderに戻りましょう。</p> <p>アクション<code>SET_FETCHING</code>がpeoplesリデューサに処理されますと、isFetchingがtrueな新しい状態が作られます。state.peoples.isFetchingが変化したので、mapStateToPropsの定義にしたがってAppクラスのプロパティisFetchingが変化しますので、renderメソッドが呼び出されます。</p> <p>renderメソッドの最初のif文はisFetchingがtrueなので、次のif文に進みます。</p> <p>次のif文では、プロパティisFetchingがtrueなので</p><div>now loading</div>をreturnします。やはり一瞬だけ、now loadingが画面に見えるかもしれません。<p></p> <p>この後、axios.getが完了しますと、if (response.status === 200)以降が評価されます。</p> <p>response.dataに <a href="https://iij.github.io/bootcamp//test.json" target="_blank" rel="noopener noreferrer">https://iij.github.io/bootcamp//test.json<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> が返してきたJSONオブジェクトが入っています。</p> <p>これをアクション <code>FETCH_PEOPLES</code> にpepolesとして加えてdispatchします。</p> <p>するとpeoplesリデューサによって、isFetchingがfalseであり、peoplesにアクションに含まれるpeoplesをセットした新しい状態が作られます。</p> <p>新しい状態が作られたので、mapStateToPropsにある定義によって、AppクラスのプロパティisFetchingがfalseになり、peoplesに <a href="https://iij.github.io/bootcamp//test.json" target="_blank" rel="noopener noreferrer">https://iij.github.io/bootcamp//test.json<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> が返してきたJSONオブジェクトがセットされます。</p> <p>プロパティが変化したので、renderが呼ばれます。</p> <p>最初の2つのif文がfalseなので、最後のreturnが評価されます。</p> <p>ふう。ちょっと長いセクションでしたね。</p> <p>少し休憩をとりましょう。</p> <p><a href="./redux.png" title="Reduxの概念図">Reduxの概念図</a></p> <h2 id="formを作る"><a href="#formを作る" class="header-anchor">#</a> Formを作る</h2> <p>最後にFormを作ります。</p> <p>ここでは、Peoplesの作る表の下に、AddPeopleフォームを作ることにしましょう。</p> <p>AddPeopleコンポーネントをsrc/AddPeople.jsに定義しましょう。</p> <p>内容は以下のとおりです。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> actions <span class="token keyword">from</span> <span class="token string">'./redux/actions'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">AddPeople</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>handleChange <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleChange</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>handleSubmit <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleSubmit</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">handleChange</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">handleSubmit</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'please input name.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">addPeople</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">(</span>
          <span class="token operator">&lt;</span>form onSubmit<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleSubmit<span class="token punctuation">}</span><span class="token operator">&gt;</span>
              <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleChange<span class="token punctuation">}</span> value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>name<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
              <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;submit&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;add&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">makeDispatchToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">dispatch</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token function">addPeople</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> action <span class="token operator">=</span> actions<span class="token punctuation">.</span><span class="token function">addPeople</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">dispatch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> makeDispatchToProps<span class="token punctuation">)</span><span class="token punctuation">(</span>AddPeople<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>いくつか新しい概念が出てきています。</p> <p>まずコンストラクタを定義しています。</p> <p>その内容は以下のとおり。</p> <ol><li>super(props)を通じてスーパークラスの初期化処理を実行します。</li> <li>this.stateを初期化</li> <li>this.handleChangeとthis.handleSubmitにthisをbind</li></ol> <p>1はおまじないみたいなものですが、React.Componentのサブクラスにコンストラクタを定義するための常套句です。</p> <p>2で、入力フォームに入力された新しい人物の名前を保持するstateを用意します。ここでいうstateはReduxストアにあるstateとは関係がなく、Reactの基本機能として用意されているもので、プロパティのように親コンポーネントから渡されるものではなく、このコンポーネントの中に閉じた状態を保持するための機構です。</p> <p>3は...これも常套句なのですが、AddPeopleクラスのメソッドhandleChangeとhandleSubmitをthisとむすびつけます...これを宣言しないと、各メソッドは単なる関数として機能し、その関数の中でthisが使えないのです。</p> <p>handleChangeメソッドは、renderの中にある<code>&lt;input type=&quot;text&quot; ... /&gt;</code>の中のonChangeから呼び出されます。つまり入力フォームに文字を入力すると、そのonChangeイベントがhandleChangeに渡ります。event.target.valueで入力フォームに入った文字列が取得できるので、これをthis.setStateで新しい状態としてセットしています。</p> <p>handleSubmitメソッドは、renderの中にある<code>&lt;form&gt;</code>のonSubmitから呼び出されます。</p> <p>ここでは、this.state.nameが空であったらダイアログを出して入力を促し、さもなければthis.state.nameを引数にしてthis.props.addPeopleを呼び出して、さらにthis.setStateを使って入力フィールドを空にしています。</p> <p>handleSubmitの最後に<code>event.preventDefault()</code>があるのもJavaScriptの常套句で、この場合はformのsubmit時のデフォルトの挙動である、そのフォームを提供したURL自身へのGETリクエストを抑止します。</p> <p>this.props.addPeopleはmakeDispatchToPropsを通じてthis.propsにセットされており、その関数オブジェクトは、actions.addPeopleに引数nameを渡してアクションんを作ってdispatchしています。</p> <p>addPeopleはsrc/redux/actions.jsに新しく定義します。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">addPeople</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> <span class="token constant">ADD_PEOPLE</span><span class="token punctuation">,</span>
        name<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>定義というほどものもでもありませんが、<code>ADD_PEOPLE</code>をアクション種別とし、引数nameを合わせ持つJSONオブジェクトを作ってreturnするだけです。</p> <p><code>ADD_PEOPLE</code>は、例によってsrc/redux/actionTypes.jsに定義します。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">ADD_PEOPLE</span> <span class="token operator">=</span> <span class="token string">'ADD_PEOPLE'</span><span class="token punctuation">;</span>
</code></pre></div><p>そしてsrc/redux/reducers/peoples.jsに<code>ADD_PEOPLE</code>を処理するケースを加えます。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>        <span class="token keyword">case</span> <span class="token constant">ADD_PEOPLE</span><span class="token punctuation">:</span>
            <span class="token keyword">const</span> peoples <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> maxId <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            state<span class="token punctuation">.</span>peoples<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token keyword">if</span> <span class="token punctuation">(</span>maxId <span class="token operator">&lt;</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                   maxId <span class="token operator">=</span> id<span class="token punctuation">;</span>
               <span class="token punctuation">}</span>
               peoples<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> newPeople <span class="token operator">=</span> <span class="token punctuation">{</span>
                id<span class="token punctuation">:</span> maxId <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
                name<span class="token punctuation">:</span> action<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
            peoples<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>newPeople<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                inFetching<span class="token punctuation">:</span> state<span class="token punctuation">.</span>inFetching<span class="token punctuation">,</span>
                peoples<span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><p>そして最後に、src/App.jsのrenderの中にAddPeopleを埋め込みます。</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code>                    <span class="token operator">&lt;</span>Peoples peoples<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>peoples<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>AddPeople <span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre></div><p>さあ、どうでしょう。</p> <p>期待どおりに動きましたか？</p> <div><hr> <span>CC BY-SA Licensed | Copyright (c) 2019, Internet Initiative Japan Inc.</span></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/iij/bootcamp/edit/master/src/frontend/react/README.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/2/2019, 11:26:47 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/bootcamp/assets/js/app.d2f1aa0e.js" defer></script><script src="/bootcamp/assets/js/2.acfdd0a4.js" defer></script><script src="/bootcamp/assets/js/19.97637d7d.js" defer></script><script src="/bootcamp/assets/js/5.d20398c4.js" defer></script><script src="/bootcamp/assets/js/4.a9d4f0c2.js" defer></script>
  </body>
</html>
